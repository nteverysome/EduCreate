<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phaser 2 çœŸå¯¦é£›æ©Ÿé¸æ“‡æ¼”ç¤º</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@2.6.2/build/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #2c3e50;
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
        }
        
        h1 {
            color: #ecf0f1;
            margin-bottom: 20px;
        }
        
        .plane-selector {
            background: #34495e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .plane-option {
            display: inline-block;
            margin: 8px;
            padding: 12px;
            background: #2c3e50;
            border: 2px solid #3498db;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 180px;
            font-size: 12px;
        }
        
        .plane-option:hover {
            background: #3498db;
            transform: scale(1.05);
        }
        
        .plane-option.selected {
            background: #e74c3c;
            border-color: #c0392b;
        }
        
        #game-container {
            margin: 20px auto;
            border: 3px solid #34495e;
            border-radius: 10px;
            display: inline-block;
        }
        
        .controls {
            background: #34495e;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .info {
            background: #27ae60;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .asset-status {
            background: #f39c12;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ›©ï¸ Phaser 2 çœŸå¯¦é£›æ©Ÿé¸æ“‡æ¼”ç¤º</h1>
    
    <div class="info">
        <h3>âœˆï¸ ä½¿ç”¨çœŸå¯¦ä¸‹è¼‰çš„é£›æ©Ÿç´ æï¼</h3>
        <p>é¸æ“‡ä¸åŒçš„çœŸå¯¦é£›æ©Ÿ PNG åœ–ç‰‡ï¼Œé«”é©—å°ˆæ¥­çš„é£›æ©Ÿè¨­è¨ˆ</p>
    </div>
    
    <div class="asset-status">
        <h3>ğŸ“ ç´ æç‹€æ…‹</h3>
        <p><strong>å¦‚æœçœ‹åˆ°å¾Œå‚™åœ–å½¢ï¼š</strong>è¡¨ç¤ºéœ€è¦ä¸‹è¼‰ä¸¦è§£å£“ç¸®çœŸå¯¦çš„ PNG æª”æ¡ˆ</p>
        <p><strong>å¦‚æœçœ‹åˆ°çœŸå¯¦é£›æ©Ÿï¼š</strong>è¡¨ç¤º PNG æª”æ¡ˆè¼‰å…¥æˆåŠŸ</p>
    </div>
    
    <div class="plane-selector">
        <h3>ğŸ¯ é¸æ“‡çœŸå¯¦é£›æ©Ÿ</h3>
        <div class="plane-option selected" data-plane="b17">
            <h4>ğŸ›©ï¸ B-17 è½Ÿç‚¸æ©Ÿ</h4>
            <p><strong>æª”æ¡ˆï¼š</strong>B-17/Type-1/B-17.png</p>
            <p><strong>é¡å‹ï¼š</strong>é‡å‹è½Ÿç‚¸æ©Ÿ</p>
            <p><strong>ç‰¹è‰²ï¼š</strong>å››å¼•æ“è¨­è¨ˆ</p>
        </div>
        <div class="plane-option" data-plane="bf109">
            <h4>âœˆï¸ BF-109E æˆ°é¬¥æ©Ÿ</h4>
            <p><strong>æª”æ¡ˆï¼š</strong>BF-109E/Type-1/BF109E.png</p>
            <p><strong>é¡å‹ï¼š</strong>å–®å¼•æ“æˆ°é¬¥æ©Ÿ</p>
            <p><strong>ç‰¹è‰²ï¼š</strong>æ•æ·æ©Ÿå‹•</p>
        </div>
        <div class="plane-option" data-plane="biplane">
            <h4>ğŸ›« é›™ç¿¼æˆ°é¬¥æ©Ÿ</h4>
            <p><strong>æª”æ¡ˆï¼š</strong>Bipolar Plane/Type_1/Biploar_type1_5.png</p>
            <p><strong>é¡å‹ï¼š</strong>é›™ç¿¼è¨­è¨ˆ</p>
            <p><strong>ç‰¹è‰²ï¼š</strong>ç¶“å…¸å¾©å¤</p>
        </div>
        <div class="plane-option" data-plane="tbm3">
            <h4>ğŸš TBM-3 é­šé›·è½Ÿç‚¸æ©Ÿ</h4>
            <p><strong>æª”æ¡ˆï¼š</strong>TBM3/Type_1/TBM-3.png</p>
            <p><strong>é¡å‹ï¼š</strong>æµ·è»è½Ÿç‚¸æ©Ÿ</p>
            <p><strong>ç‰¹è‰²ï¼š</strong>è‰¦è¼‰è¨­è¨ˆ</p>
        </div>
        <div class="plane-option" data-plane="hawker">
            <h4>ğŸ›¬ Hawker Tempest MKII</h4>
            <p><strong>æª”æ¡ˆï¼š</strong>Hawker Tempest MKII/Type_1/Hawker_type1.png</p>
            <p><strong>é¡å‹ï¼š</strong>è‹±åœ‹æˆ°é¬¥æ©Ÿ</p>
            <p><strong>ç‰¹è‰²ï¼š</strong>é«˜é€Ÿè¨­è¨ˆ</p>
        </div>
        <div class="plane-option" data-plane="ju87">
            <h4>ğŸª‚ JU-87B2 ä¿¯è¡è½Ÿç‚¸æ©Ÿ</h4>
            <p><strong>æª”æ¡ˆï¼š</strong>JU-87B2/Type_1/JU87B2.png</p>
            <p><strong>é¡å‹ï¼š</strong>å¾·åœ‹ä¿¯è¡è½Ÿç‚¸æ©Ÿ</p>
            <p><strong>ç‰¹è‰²ï¼š</strong>ç²¾ç¢ºè½Ÿç‚¸</p>
        </div>
        <div class="plane-option" data-plane="blenheim">
            <h4>ğŸ’£ Blenheim è½Ÿç‚¸æ©Ÿ</h4>
            <p><strong>æª”æ¡ˆï¼š</strong>Blenheim/Type_1/Blenheim.png</p>
            <p><strong>é¡å‹ï¼š</strong>è‹±åœ‹é›™å¼•æ“è½Ÿç‚¸æ©Ÿ</p>
            <p><strong>ç‰¹è‰²ï¼š</strong>ä¸­å‹è½Ÿç‚¸</p>
        </div>
    </div>
    
    <div id="game-container"></div>
    
    <div class="controls">
        <h4>ğŸ® éŠæˆ²æ§åˆ¶</h4>
        <p><strong>æ–¹å‘éµ</strong>ï¼šç§»å‹•é£›æ©Ÿ | <strong>ç©ºç™½éµ</strong>ï¼šç™¼å°„å­å½ˆ | <strong>Réµ</strong>ï¼šé‡æ–°é–‹å§‹</p>
        <p><strong>1-7æ•¸å­—éµ</strong>ï¼šå¿«é€Ÿåˆ‡æ›é£›æ©Ÿé¡å‹</p>
        <p>é«”é©—çœŸå¯¦çš„äºŒæˆ°é£›æ©Ÿè¨­è¨ˆï¼</p>
    </div>

    <script>
        // éŠæˆ²é…ç½®
        var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'game-container', {
            preload: preload,
            create: create,
            update: update
        });

        // éŠæˆ²è®Šæ•¸
        var player;
        var enemies;
        var bullets;
        var cursors;
        var fireButton;
        var restartButton;
        var numberKeys = {};
        var enemyTimer;
        var score = 0;
        var scoreText;
        var gameOver = false;
        var bulletTime = 0;
        var currentPlane = 'b17';
        var planeInfoText;
        var assetsLoaded = {};
        var loadingComplete = false;

        // çœŸå¯¦é£›æ©Ÿé…ç½®
        var planeConfigs = {
            b17: {
                name: 'B-17 è½Ÿç‚¸æ©Ÿ',
                file: 'assets/planes/B-17/Type-1/B-17.png',
                key: 'b17-plane',
                speed: 250,
                fireRate: 300,
                scale: 0.8,
                pngData: null
            },
            bf109: {
                name: 'BF-109E æˆ°é¬¥æ©Ÿ',
                file: 'assets/planes/BF-109E/Type-1/BF109E.png',
                key: 'bf109-plane',
                speed: 350,
                fireRate: 150,
                scale: 0.7,
                pngData: null
            },
            biplane: {
                name: 'é›™ç¿¼æˆ°é¬¥æ©Ÿ',
                file: 'assets/planes/Bipolar Plane/Type_1/Biploar_type1_5.png',
                key: 'biplane-plane',
                speed: 200,
                fireRate: 400,
                scale: 0.6,
                pngData: null
            },
            tbm3: {
                name: 'TBM-3 é­šé›·è½Ÿç‚¸æ©Ÿ',
                file: 'assets/planes/TBM3/Type_1/TBM-3.png',
                key: 'tbm3-plane',
                speed: 280,
                fireRate: 250,
                scale: 0.75,
                pngData: null
            },
            hawker: {
                name: 'Hawker Tempest MKII',
                file: 'assets/planes/Hawker Tempest MKII/Type_1/Hawker_type1.png',
                key: 'hawker-plane',
                speed: 400,
                fireRate: 100,
                scale: 0.7,
                pngData: null
            },
            ju87: {
                name: 'JU-87B2 ä¿¯è¡è½Ÿç‚¸æ©Ÿ',
                file: 'assets/planes/JU-87B2/Type_1/JU87B2.png',
                key: 'ju87-plane',
                speed: 220,
                fireRate: 350,
                scale: 0.75,
                pngData: null
            },
            blenheim: {
                name: 'Blenheim è½Ÿç‚¸æ©Ÿ',
                file: 'assets/planes/Blenheim/Type_1/Blenheim.png',
                key: 'blenheim-plane',
                speed: 260,
                fireRate: 280,
                scale: 0.8,
                pngData: null
            }
        };

        // å‰µå»ºçœŸå¯¦ PNG æ•¸æ“š
        function createRealPNGData() {
            // B-17 è½Ÿç‚¸æ©Ÿ
            var canvas = document.createElement('canvas');
            canvas.width = 200;
            canvas.height = 150;
            var ctx = canvas.getContext('2d');
            drawB17PNG(ctx, 200, 150);
            planeConfigs.b17.pngData = canvas.toDataURL('image/png');

            // BF-109 æˆ°é¬¥æ©Ÿ
            canvas.width = 180;
            canvas.height = 140;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBF109PNG(ctx, 180, 140);
            planeConfigs.bf109.pngData = canvas.toDataURL('image/png');

            // é›™ç¿¼æˆ°é¬¥æ©Ÿ
            canvas.width = 160;
            canvas.height = 120;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBiplanePNG(ctx, 160, 120);
            planeConfigs.biplane.pngData = canvas.toDataURL('image/png');

            // TBM-3 é­šé›·è½Ÿç‚¸æ©Ÿ
            canvas.width = 190;
            canvas.height = 145;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawTBM3PNG(ctx, 190, 145);
            planeConfigs.tbm3.pngData = canvas.toDataURL('image/png');

            // Hawker Tempest
            canvas.width = 185;
            canvas.height = 140;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawHawkerPNG(ctx, 185, 140);
            planeConfigs.hawker.pngData = canvas.toDataURL('image/png');

            // JU-87B2 ä¿¯è¡è½Ÿç‚¸æ©Ÿ
            canvas.width = 175;
            canvas.height = 135;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawJU87PNG(ctx, 175, 135);
            planeConfigs.ju87.pngData = canvas.toDataURL('image/png');

            // Blenheim è½Ÿç‚¸æ©Ÿ
            canvas.width = 195;
            canvas.height = 150;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBlenheimPNG(ctx, 195, 150);
            planeConfigs.blenheim.pngData = canvas.toDataURL('image/png');
        }

        // B-17 è½Ÿç‚¸æ©Ÿç¹ªè£½å‡½æ•¸ - è©³ç´°ç‰ˆæœ¬
        function drawB17PNG(ctx, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // ä¸»æ©Ÿèº« (æ·±è—è‰²ï¼Œåœ“è§’)
            ctx.fillStyle = '#1e3a8a';
            ctx.beginPath();
            ctx.roundRect(centerX - 8, centerY - 40, 16, 80, 4);
            ctx.fill();

            // æ©Ÿèº«ä¸­æ®µåŠ å¯¬
            ctx.fillStyle = '#2563eb';
            ctx.beginPath();
            ctx.roundRect(centerX - 10, centerY - 20, 20, 40, 3);
            ctx.fill();

            // æ©Ÿèº«ç´°ç¯€æ¢ç´‹
            ctx.fillStyle = '#3b82f6';
            for (let i = -35; i < 35; i += 8) {
                ctx.fillRect(centerX - 6, centerY + i, 12, 2);
            }

            // ä¸»æ©Ÿç¿¼ (æ·±è—è‰²ï¼Œæ¢¯å½¢)
            ctx.fillStyle = '#1e3a8a';
            ctx.beginPath();
            ctx.moveTo(centerX - 40, centerY - 8);
            ctx.lineTo(centerX - 35, centerY - 12);
            ctx.lineTo(centerX + 35, centerY - 12);
            ctx.lineTo(centerX + 40, centerY - 8);
            ctx.lineTo(centerX + 35, centerY + 8);
            ctx.lineTo(centerX - 35, centerY + 8);
            ctx.closePath();
            ctx.fill();

            // æ©Ÿç¿¼ç´°ç¯€
            ctx.fillStyle = '#3b82f6';
            ctx.beginPath();
            ctx.moveTo(centerX - 35, centerY - 10);
            ctx.lineTo(centerX + 35, centerY - 10);
            ctx.lineTo(centerX + 30, centerY + 6);
            ctx.lineTo(centerX - 30, centerY + 6);
            ctx.closePath();
            ctx.fill();

            // å››å€‹å¼•æ“ (è©³ç´°è¨­è¨ˆ)
            const enginePositions = [-28, -14, 14, 28];
            enginePositions.forEach(pos => {
                // å¼•æ“ä¸»é«”
                ctx.fillStyle = '#374151';
                ctx.beginPath();
                ctx.roundRect(centerX + pos - 4, centerY - 6, 8, 12, 2);
                ctx.fill();

                // å¼•æ“é€²æ°£å£
                ctx.fillStyle = '#111827';
                ctx.beginPath();
                ctx.ellipse(centerX + pos, centerY - 8, 3, 2, 0, 0, 2 * Math.PI);
                ctx.fill();

                // èºæ—‹æ§³
                ctx.fillStyle = '#fbbf24';
                ctx.beginPath();
                ctx.ellipse(centerX + pos, centerY - 10, 6, 1, 0, 0, 2 * Math.PI);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(centerX + pos, centerY - 10, 1, 6, 0, 0, 2 * Math.PI);
                ctx.fill();
            });

            // æ©Ÿé ­ (åœ“éŒå½¢)
            ctx.fillStyle = '#1e3a8a';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 45);
            ctx.lineTo(centerX - 8, centerY - 35);
            ctx.lineTo(centerX + 8, centerY - 35);
            ctx.closePath();
            ctx.fill();

            // é§•é§›è‰™ (é€æ˜ç»ç’ƒæ•ˆæœ)
            ctx.fillStyle = 'rgba(147, 197, 253, 0.8)';
            ctx.beginPath();
            ctx.roundRect(centerX - 5, centerY - 25, 10, 15, 3);
            ctx.fill();

            // é§•é§›è‰™æ¡†æ¶
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.roundRect(centerX - 5, centerY - 25, 10, 15, 3);
            ctx.stroke();

            // æ©Ÿå°¾å‚ç›´å°¾ç¿¼
            ctx.fillStyle = '#1e3a8a';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + 35);
            ctx.lineTo(centerX - 6, centerY + 45);
            ctx.lineTo(centerX + 6, centerY + 45);
            ctx.closePath();
            ctx.fill();

            // æ°´å¹³å°¾ç¿¼
            ctx.fillStyle = '#2563eb';
            ctx.beginPath();
            ctx.roundRect(centerX - 12, centerY + 32, 24, 6, 2);
            ctx.fill();

            // æ©Ÿèº«çª—æˆ¶
            ctx.fillStyle = 'rgba(147, 197, 253, 0.6)';
            const windowPositions = [-15, -5, 5, 15];
            windowPositions.forEach(pos => {
                ctx.beginPath();
                ctx.ellipse(centerX + 7, centerY + pos, 2, 3, 0, 0, 2 * Math.PI);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(centerX - 7, centerY + pos, 2, 3, 0, 0, 2 * Math.PI);
                ctx.fill();
            });
        }

        // BF-109 æˆ°é¬¥æ©Ÿç¹ªè£½å‡½æ•¸ - è©³ç´°ç‰ˆæœ¬
        function drawBF109PNG(ctx, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // ä¸»æ©Ÿèº« (æµç·šå‹è¨­è¨ˆ)
            ctx.fillStyle = '#dc2626';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 30);
            ctx.quadraticCurveTo(centerX - 6, centerY - 25, centerX - 5, centerY);
            ctx.quadraticCurveTo(centerX - 4, centerY + 20, centerX, centerY + 25);
            ctx.quadraticCurveTo(centerX + 4, centerY + 20, centerX + 5, centerY);
            ctx.quadraticCurveTo(centerX + 6, centerY - 25, centerX, centerY - 30);
            ctx.fill();

            // æ©Ÿèº«ç´°ç¯€æ¢ç´‹
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 28);
            ctx.quadraticCurveTo(centerX - 4, centerY - 23, centerX - 3, centerY);
            ctx.quadraticCurveTo(centerX - 2, centerY + 18, centerX, centerY + 23);
            ctx.quadraticCurveTo(centerX + 2, centerY + 18, centerX + 3, centerY);
            ctx.quadraticCurveTo(centerX + 4, centerY - 23, centerX, centerY - 28);
            ctx.fill();

            // ä¸»æ©Ÿç¿¼ (å¾Œæ ç¿¼è¨­è¨ˆ)
            ctx.fillStyle = '#b91c1c';
            ctx.beginPath();
            ctx.moveTo(centerX - 25, centerY + 2);
            ctx.lineTo(centerX - 22, centerY - 8);
            ctx.lineTo(centerX - 5, centerY - 5);
            ctx.lineTo(centerX + 5, centerY - 5);
            ctx.lineTo(centerX + 22, centerY - 8);
            ctx.lineTo(centerX + 25, centerY + 2);
            ctx.lineTo(centerX + 20, centerY + 8);
            ctx.lineTo(centerX - 20, centerY + 8);
            ctx.closePath();
            ctx.fill();

            // æ©Ÿç¿¼ç´°ç¯€
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.moveTo(centerX - 20, centerY);
            ctx.lineTo(centerX - 18, centerY - 6);
            ctx.lineTo(centerX + 18, centerY - 6);
            ctx.lineTo(centerX + 20, centerY);
            ctx.lineTo(centerX + 15, centerY + 6);
            ctx.lineTo(centerX - 15, centerY + 6);
            ctx.closePath();
            ctx.fill();

            // å¼•æ“ç½© (åœ“éŒå½¢)
            ctx.fillStyle = '#374151';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 32, 4, 6, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å¼•æ“é€²æ°£å£
            ctx.fillStyle = '#111827';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 35, 2, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            // èºæ—‹æ§³ (ä¸‰è‘‰ç‰‡)
            ctx.fillStyle = '#fbbf24';
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#f59e0b';

            // èºæ—‹æ§³ä¸­å¿ƒ
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 38, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // ä¸‰å€‹èºæ—‹æ§³è‘‰ç‰‡
            for (let i = 0; i < 3; i++) {
                const angle = (i * 120) * Math.PI / 180;
                const x1 = centerX + Math.cos(angle) * 8;
                const y1 = centerY - 38 + Math.sin(angle) * 8;
                const x2 = centerX + Math.cos(angle) * 2;
                const y2 = centerY - 38 + Math.sin(angle) * 2;

                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(x1, y1);
                ctx.stroke();
            }

            // é§•é§›è‰™ (æ°£æ³¡å¼)
            ctx.fillStyle = 'rgba(147, 197, 253, 0.8)';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 15, 4, 8, 0, 0, 2 * Math.PI);
            ctx.fill();

            // é§•é§›è‰™æ¡†æ¶
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 15, 4, 8, 0, 0, 2 * Math.PI);
            ctx.stroke();

            // å‚ç›´å°¾ç¿¼
            ctx.fillStyle = '#dc2626';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + 20);
            ctx.lineTo(centerX - 4, centerY + 30);
            ctx.lineTo(centerX + 4, centerY + 30);
            ctx.closePath();
            ctx.fill();

            // æ°´å¹³å°¾ç¿¼
            ctx.fillStyle = '#b91c1c';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 22, 8, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            // æ©Ÿèº«æ¨™è¨˜ (å¾·åœ‹åå­—)
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(centerX - 1, centerY - 8, 2, 6);
            ctx.fillRect(centerX - 3, centerY - 6, 6, 2);
            ctx.fillStyle = '#000000';
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 0.5;
            ctx.strokeRect(centerX - 1, centerY - 8, 2, 6);
            ctx.strokeRect(centerX - 3, centerY - 6, 6, 2);
        }

        // é›™ç¿¼æˆ°é¬¥æ©Ÿç¹ªè£½å‡½æ•¸ - è©³ç´°ç‰ˆæœ¬
        function drawBiplanePNG(ctx, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // æ©Ÿèº« (å¾©å¤é‡‘è‰²ï¼Œåœ“å½¢æˆªé¢)
            ctx.fillStyle = '#d97706';
            ctx.beginPath();
            ctx.roundRect(centerX - 4, centerY - 28, 8, 56, 4);
            ctx.fill();

            // æ©Ÿèº«ç´°ç¯€ (äº®é‡‘è‰²)
            ctx.fillStyle = '#f59e0b';
            ctx.beginPath();
            ctx.roundRect(centerX - 3, centerY - 25, 6, 50, 3);
            ctx.fill();

            // æ©Ÿèº«æ¢ç´‹è£é£¾
            ctx.fillStyle = '#92400e';
            for (let i = -20; i < 20; i += 6) {
                ctx.fillRect(centerX - 2, centerY + i, 4, 1);
            }

            // ä¸Šç¿¼ (æ¢¯å½¢è¨­è¨ˆ)
            ctx.fillStyle = '#d97706';
            ctx.beginPath();
            ctx.moveTo(centerX - 30, centerY - 12);
            ctx.lineTo(centerX - 25, centerY - 18);
            ctx.lineTo(centerX + 25, centerY - 18);
            ctx.lineTo(centerX + 30, centerY - 12);
            ctx.lineTo(centerX + 25, centerY - 8);
            ctx.lineTo(centerX - 25, centerY - 8);
            ctx.closePath();
            ctx.fill();

            // ä¸Šç¿¼ç´°ç¯€
            ctx.fillStyle = '#f59e0b';
            ctx.beginPath();
            ctx.moveTo(centerX - 25, centerY - 16);
            ctx.lineTo(centerX + 25, centerY - 16);
            ctx.lineTo(centerX + 20, centerY - 10);
            ctx.lineTo(centerX - 20, centerY - 10);
            ctx.closePath();
            ctx.fill();

            // ä¸‹ç¿¼ (æ¢¯å½¢è¨­è¨ˆ)
            ctx.fillStyle = '#d97706';
            ctx.beginPath();
            ctx.moveTo(centerX - 30, centerY + 8);
            ctx.lineTo(centerX - 25, centerY + 4);
            ctx.lineTo(centerX + 25, centerY + 4);
            ctx.lineTo(centerX + 30, centerY + 8);
            ctx.lineTo(centerX + 25, centerY + 14);
            ctx.lineTo(centerX - 25, centerY + 14);
            ctx.closePath();
            ctx.fill();

            // ä¸‹ç¿¼ç´°ç¯€
            ctx.fillStyle = '#f59e0b';
            ctx.beginPath();
            ctx.moveTo(centerX - 25, centerY + 6);
            ctx.lineTo(centerX + 25, centerY + 6);
            ctx.lineTo(centerX + 20, centerY + 12);
            ctx.lineTo(centerX - 20, centerY + 12);
            ctx.closePath();
            ctx.fill();

            // ç¿¼é–“æ”¯æŸ± (è©³ç´°è¨­è¨ˆ)
            const strutPositions = [-20, -10, 10, 20];
            ctx.fillStyle = '#374151';
            strutPositions.forEach(pos => {
                // å‚ç›´æ”¯æŸ±
                ctx.fillRect(centerX + pos - 1, centerY - 18, 2, 32);

                // æ–œæ’
                ctx.beginPath();
                ctx.moveTo(centerX + pos - 5, centerY - 15);
                ctx.lineTo(centerX + pos + 5, centerY + 11);
                ctx.lineWidth = 1;
                ctx.strokeStyle = '#374151';
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(centerX + pos + 5, centerY - 15);
                ctx.lineTo(centerX + pos - 5, centerY + 11);
                ctx.stroke();
            });

            // å¼•æ“ç½© (åœ“å½¢)
            ctx.fillStyle = '#374151';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 32, 5, 7, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å¼•æ“æ•£ç†±ç‰‡
            ctx.fillStyle = '#111827';
            for (let i = 0; i < 6; i++) {
                ctx.fillRect(centerX - 4, centerY - 35 + i * 2, 8, 1);
            }

            // èºæ—‹æ§³ (æœ¨è£½å¤–è§€)
            ctx.fillStyle = '#92400e';
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#451a03';

            // èºæ—‹æ§³ä¸­å¿ƒ
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 40, 3, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å…©å€‹èºæ—‹æ§³è‘‰ç‰‡
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 40, 12, 2, 0, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 40, 2, 12, 0, 0, 2 * Math.PI);
            ctx.fill();

            // é§•é§›è‰™ (é–‹æ”¾å¼)
            ctx.fillStyle = 'rgba(139, 69, 19, 0.8)';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 8, 3, 6, 0, 0, 2 * Math.PI);
            ctx.fill();

            // é§•é§›è‰™é‚Šç·£
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 8, 3, 6, 0, 0, 2 * Math.PI);
            ctx.stroke();

            // å°¾ç¿¼
            ctx.fillStyle = '#d97706';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + 25);
            ctx.lineTo(centerX - 5, centerY + 35);
            ctx.lineTo(centerX + 5, centerY + 35);
            ctx.closePath();
            ctx.fill();

            // æ°´å¹³å°¾ç¿¼
            ctx.fillStyle = '#f59e0b';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 27, 10, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            // èµ·è½æ¶ (å›ºå®šå¼)
            ctx.fillStyle = '#374151';
            ctx.fillRect(centerX - 12, centerY + 12, 2, 8);
            ctx.fillRect(centerX + 10, centerY + 12, 2, 8);

            // è¼ªå­
            ctx.fillStyle = '#111827';
            ctx.beginPath();
            ctx.ellipse(centerX - 11, centerY + 22, 3, 3, 0, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(centerX + 11, centerY + 22, 3, 3, 0, 0, 2 * Math.PI);
            ctx.fill();
        }

        // TBM-3 é­šé›·è½Ÿç‚¸æ©Ÿç¹ªè£½å‡½æ•¸ - è©³ç´°ç‰ˆæœ¬
        function drawTBM3PNG(ctx, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // ä¸»æ©Ÿèº« (æµ·è»ç¶ è‰²ï¼Œç²—å£¯è¨­è¨ˆ)
            ctx.fillStyle = '#065f46';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 35);
            ctx.quadraticCurveTo(centerX - 8, centerY - 30, centerX - 7, centerY);
            ctx.quadraticCurveTo(centerX - 6, centerY + 25, centerX, centerY + 30);
            ctx.quadraticCurveTo(centerX + 6, centerY + 25, centerX + 7, centerY);
            ctx.quadraticCurveTo(centerX + 8, centerY - 30, centerX, centerY - 35);
            ctx.fill();

            // æ©Ÿèº«ç´°ç¯€ (äº®ç¶ è‰²)
            ctx.fillStyle = '#059669';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 32);
            ctx.quadraticCurveTo(centerX - 6, centerY - 27, centerX - 5, centerY);
            ctx.quadraticCurveTo(centerX - 4, centerY + 22, centerX, centerY + 27);
            ctx.quadraticCurveTo(centerX + 4, centerY + 22, centerX + 5, centerY);
            ctx.quadraticCurveTo(centerX + 6, centerY - 27, centerX, centerY - 32);
            ctx.fill();

            // æ©Ÿèº«æµ·è»æ¨™è¨˜æ¢ç´‹
            ctx.fillStyle = '#10b981';
            for (let i = -25; i < 25; i += 8) {
                ctx.fillRect(centerX - 4, centerY + i, 8, 2);
            }

            // ä¸»æ©Ÿç¿¼ (å¯¬å¤§çš„è‰¦è¼‰æ©Ÿç¿¼)
            ctx.fillStyle = '#047857';
            ctx.beginPath();
            ctx.moveTo(centerX - 35, centerY - 5);
            ctx.lineTo(centerX - 32, centerY - 12);
            ctx.lineTo(centerX - 8, centerY - 10);
            ctx.lineTo(centerX + 8, centerY - 10);
            ctx.lineTo(centerX + 32, centerY - 12);
            ctx.lineTo(centerX + 35, centerY - 5);
            ctx.lineTo(centerX + 30, centerY + 10);
            ctx.lineTo(centerX + 8, centerY + 8);
            ctx.lineTo(centerX - 8, centerY + 8);
            ctx.lineTo(centerX - 30, centerY + 10);
            ctx.closePath();
            ctx.fill();

            // æ©Ÿç¿¼ç´°ç¯€ (æµ·è»è—è‰²æ¢ç´‹)
            ctx.fillStyle = '#059669';
            ctx.beginPath();
            ctx.moveTo(centerX - 30, centerY - 8);
            ctx.lineTo(centerX + 30, centerY - 8);
            ctx.lineTo(centerX + 25, centerY + 6);
            ctx.lineTo(centerX - 25, centerY + 6);
            ctx.closePath();
            ctx.fill();

            // æ©Ÿç¿¼æŠ˜ç–Šé‰¸éˆ (è‰¦è¼‰æ©Ÿç‰¹å¾µ)
            ctx.fillStyle = '#374151';
            ctx.fillRect(centerX - 18, centerY - 8, 2, 16);
            ctx.fillRect(centerX + 16, centerY - 8, 2, 16);

            // æ©Ÿç¿¼å°–ç«¯å°èˆªç‡ˆ
            ctx.fillStyle = '#ef4444'; // ç´…è‰²
            ctx.beginPath();
            ctx.ellipse(centerX - 32, centerY - 2, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = '#22c55e'; // ç¶ è‰²
            ctx.beginPath();
            ctx.ellipse(centerX + 32, centerY - 2, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å¼•æ“ç½© (å¤§å‹æ˜Ÿå½¢å¼•æ“)
            ctx.fillStyle = '#374151';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 38, 6, 8, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å¼•æ“æ•£ç†±ç‰‡
            ctx.fillStyle = '#111827';
            for (let i = 0; i < 8; i++) {
                ctx.fillRect(centerX - 5, centerY - 42 + i * 2, 10, 1);
            }

            // å¼•æ“é€²æ°£å£
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 45, 3, 4, 0, 0, 2 * Math.PI);
            ctx.fill();

            // ä¸‰è‘‰èºæ—‹æ§³ (å¤§å‹)
            ctx.fillStyle = '#92400e';
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#451a03';

            // èºæ—‹æ§³ä¸­å¿ƒ
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 48, 3, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            // ä¸‰å€‹èºæ—‹æ§³è‘‰ç‰‡
            for (let i = 0; i < 3; i++) {
                const angle = (i * 120) * Math.PI / 180;
                const x1 = centerX + Math.cos(angle) * 12;
                const y1 = centerY - 48 + Math.sin(angle) * 12;
                const x2 = centerX + Math.cos(angle) * 3;
                const y2 = centerY - 48 + Math.sin(angle) * 3;

                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(x1, y1);
                ctx.stroke();
            }

            // é§•é§›è‰™ (å°é–‰å¼ï¼Œæµ·è»é¢¨æ ¼)
            ctx.fillStyle = 'rgba(147, 197, 253, 0.8)';
            ctx.beginPath();
            ctx.roundRect(centerX - 5, centerY - 22, 10, 12, 3);
            ctx.fill();

            // é§•é§›è‰™æ¡†æ¶
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.roundRect(centerX - 5, centerY - 22, 10, 12, 3);
            ctx.stroke();

            // å¾Œåº§æ©Ÿæ§æ‰‹ä½ç½®
            ctx.fillStyle = 'rgba(147, 197, 253, 0.6)';
            ctx.beginPath();
            ctx.roundRect(centerX - 3, centerY + 5, 6, 8, 2);
            ctx.fill();

            // é­šé›·æ›æ¶ (TBM-3 ç‰¹å¾µ)
            ctx.fillStyle = '#374151';
            ctx.fillRect(centerX - 2, centerY + 15, 4, 8);

            // é­šé›· (å¯é¸è£å‚™)
            ctx.fillStyle = '#6b7280';
            ctx.beginPath();
            ctx.roundRect(centerX - 3, centerY + 20, 6, 15, 2);
            ctx.fill();

            // å‚ç›´å°¾ç¿¼ (é«˜å¤§è¨­è¨ˆ)
            ctx.fillStyle = '#065f46';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + 25);
            ctx.lineTo(centerX - 6, centerY + 40);
            ctx.lineTo(centerX + 6, centerY + 40);
            ctx.closePath();
            ctx.fill();

            // æ°´å¹³å°¾ç¿¼
            ctx.fillStyle = '#047857';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 27, 12, 4, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å°¾è¼ª (ä¸‰é»å¼èµ·è½æ¶)
            ctx.fillStyle = '#374151';
            ctx.fillRect(centerX - 1, centerY + 28, 2, 6);
            ctx.fillStyle = '#111827';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 36, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // ç¾åœ‹æµ·è»æ¨™è¨˜ (æ˜Ÿå½¢)
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 5);
            for (let i = 0; i < 5; i++) {
                const angle = (i * 144 - 90) * Math.PI / 180;
                const x = centerX + Math.cos(angle) * 4;
                const y = centerY - 5 + Math.sin(angle) * 4;
                ctx.lineTo(x, y);
                const innerAngle = ((i + 0.5) * 144 - 90) * Math.PI / 180;
                const innerX = centerX + Math.cos(innerAngle) * 2;
                const innerY = centerY - 5 + Math.sin(innerAngle) * 2;
                ctx.lineTo(innerX, innerY);
            }
            ctx.closePath();
            ctx.fill();

            // æ˜Ÿå½¢é‚Šæ¡†
            ctx.strokeStyle = '#1e40af';
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        // Hawker Tempest MKII ç¹ªè£½å‡½æ•¸ - è©³ç´°ç‰ˆæœ¬
        function drawHawkerPNG(ctx, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // ä¸»æ©Ÿèº« (è‹±åœ‹çš‡å®¶ç©ºè»è—è‰²ï¼Œæµç·šå‹)
            ctx.fillStyle = '#1e40af';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 32);
            ctx.quadraticCurveTo(centerX - 6, centerY - 28, centerX - 5, centerY - 5);
            ctx.quadraticCurveTo(centerX - 4, centerY + 20, centerX, centerY + 28);
            ctx.quadraticCurveTo(centerX + 4, centerY + 20, centerX + 5, centerY - 5);
            ctx.quadraticCurveTo(centerX + 6, centerY - 28, centerX, centerY - 32);
            ctx.fill();

            // æ©Ÿèº«ç´°ç¯€ (äº®è—è‰²)
            ctx.fillStyle = '#3b82f6';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 30);
            ctx.quadraticCurveTo(centerX - 4, centerY - 26, centerX - 3, centerY - 5);
            ctx.quadraticCurveTo(centerX - 2, centerY + 18, centerX, centerY + 26);
            ctx.quadraticCurveTo(centerX + 2, centerY + 18, centerX + 3, centerY - 5);
            ctx.quadraticCurveTo(centerX + 4, centerY - 26, centerX, centerY - 30);
            ctx.fill();

            // æ©Ÿèº«çš‡å®¶ç©ºè»æ¢ç´‹
            ctx.fillStyle = '#60a5fa';
            for (let i = -20; i < 20; i += 6) {
                ctx.fillRect(centerX - 2, centerY + i, 4, 1);
            }

            // ä¸»æ©Ÿç¿¼ (æ©¢åœ“ç¿¼è¨­è¨ˆï¼ŒTempest ç‰¹å¾µ)
            ctx.fillStyle = '#1e3a8a';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 2, 28, 8, 0, 0, 2 * Math.PI);
            ctx.fill();

            // æ©Ÿç¿¼ç´°ç¯€ (æ¼¸è®Šæ•ˆæœ)
            ctx.fillStyle = '#2563eb';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 2, 24, 6, 0, 0, 2 * Math.PI);
            ctx.fill();

            // æ©Ÿç¿¼å‰ç·£ (éŠ³åˆ©è¨­è¨ˆ)
            ctx.fillStyle = '#1e40af';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 6, 26, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            // æ©Ÿç¿¼ç‚®å£ (å››é–€ 20mm æ©Ÿç‚®)
            ctx.fillStyle = '#111827';
            const cannonPositions = [-15, -8, 8, 15];
            cannonPositions.forEach(pos => {
                ctx.beginPath();
                ctx.ellipse(centerX + pos, centerY - 8, 1, 2, 0, 0, 2 * Math.PI);
                ctx.fill();
            });

            // å¼•æ“ç½© (Napier Sabre å¼•æ“)
            ctx.fillStyle = '#374151';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 35, 5, 7, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å¼•æ“é€²æ°£å£ (ä¸‹æ–¹é€²æ°£)
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.roundRect(centerX - 4, centerY - 30, 8, 3, 1);
            ctx.fill();

            // å¼•æ“æ•£ç†±å£
            ctx.fillStyle = '#111827';
            for (let i = 0; i < 6; i++) {
                ctx.fillRect(centerX - 3, centerY - 38 + i * 2, 6, 1);
            }

            // å››è‘‰èºæ—‹æ§³ (é«˜æ€§èƒ½è¨­è¨ˆ)
            ctx.fillStyle = '#92400e';
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#451a03';

            // èºæ—‹æ§³ä¸­å¿ƒ
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 42, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å››å€‹èºæ—‹æ§³è‘‰ç‰‡
            for (let i = 0; i < 4; i++) {
                const angle = (i * 90) * Math.PI / 180;
                const x1 = centerX + Math.cos(angle) * 10;
                const y1 = centerY - 42 + Math.sin(angle) * 10;
                const x2 = centerX + Math.cos(angle) * 2;
                const y2 = centerY - 42 + Math.sin(angle) * 2;

                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(x1, y1);
                ctx.stroke();
            }

            // é§•é§›è‰™ (æ°£æ³¡å¼ï¼Œç¾ä»£åŒ–è¨­è¨ˆ)
            ctx.fillStyle = 'rgba(147, 197, 253, 0.9)';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 18, 4, 10, 0, 0, 2 * Math.PI);
            ctx.fill();

            // é§•é§›è‰™æ¡†æ¶ (é‡‘å±¬æ¡†)
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 18, 4, 10, 0, 0, 2 * Math.PI);
            ctx.stroke();

            // é§•é§›è‰™å…§éƒ¨ç´°ç¯€
            ctx.fillStyle = 'rgba(139, 69, 19, 0.6)';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 18, 2, 6, 0, 0, 2 * Math.PI);
            ctx.fill();

            // ç„¡ç·šé›»å¤©ç·š
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 25);
            ctx.lineTo(centerX, centerY - 30);
            ctx.stroke();

            // å‚ç›´å°¾ç¿¼ (é«˜è³è¨­è¨ˆ)
            ctx.fillStyle = '#1e40af';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + 22);
            ctx.lineTo(centerX - 5, centerY + 35);
            ctx.lineTo(centerX + 5, centerY + 35);
            ctx.closePath();
            ctx.fill();

            // æ°´å¹³å°¾ç¿¼ (æ©¢åœ“è¨­è¨ˆ)
            ctx.fillStyle = '#2563eb';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 24, 10, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å°¾ç¿¼ç´°ç¯€
            ctx.fillStyle = '#3b82f6';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 24, 8, 2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // è‹±åœ‹çš‡å®¶ç©ºè»åœ“å½¢æ¨™è¨˜
            ctx.fillStyle = '#1e40af'; // è—è‰²å¤–åœˆ
            ctx.beginPath();
            ctx.ellipse(centerX - 12, centerY + 2, 5, 5, 0, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#ffffff'; // ç™½è‰²ä¸­åœˆ
            ctx.beginPath();
            ctx.ellipse(centerX - 12, centerY + 2, 3, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#dc2626'; // ç´…è‰²ä¸­å¿ƒ
            ctx.beginPath();
            ctx.ellipse(centerX - 12, centerY + 2, 1.5, 1.5, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å³ç¿¼æ¨™è¨˜
            ctx.fillStyle = '#1e40af';
            ctx.beginPath();
            ctx.ellipse(centerX + 12, centerY + 2, 5, 5, 0, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.ellipse(centerX + 12, centerY + 2, 3, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#dc2626';
            ctx.beginPath();
            ctx.ellipse(centerX + 12, centerY + 2, 1.5, 1.5, 0, 0, 2 * Math.PI);
            ctx.fill();

            // æ©Ÿèº«ç·¨è™Ÿå€åŸŸ (é ç•™)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.roundRect(centerX - 3, centerY + 8, 6, 4, 1);
            ctx.fill();

            // æ’æ°£ç®¡ (å´é¢)
            ctx.fillStyle = '#374151';
            ctx.fillRect(centerX + 4, centerY - 15, 2, 8);
            ctx.fillRect(centerX - 6, centerY - 15, 2, 8);

            // æ’æ°£ç«ç„°æ•ˆæœ (å¯é¸)
            ctx.fillStyle = 'rgba(255, 165, 0, 0.6)';
            ctx.beginPath();
            ctx.ellipse(centerX + 7, centerY - 11, 1, 3, 0, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(centerX - 3, centerY - 11, 1, 3, 0, 0, 2 * Math.PI);
            ctx.fill();
        }

        // JU-87B2 ä¿¯è¡è½Ÿç‚¸æ©Ÿç¹ªè£½å‡½æ•¸ - è©³ç´°ç‰ˆæœ¬
        function drawJU87PNG(ctx, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // ä¸»æ©Ÿèº« (å¾·åœ‹ç°ç¶ è‰²)
            ctx.fillStyle = '#4a5568';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 30);
            ctx.quadraticCurveTo(centerX - 6, centerY - 25, centerX - 5, centerY + 5);
            ctx.quadraticCurveTo(centerX - 4, centerY + 25, centerX, centerY + 30);
            ctx.quadraticCurveTo(centerX + 4, centerY + 25, centerX + 5, centerY + 5);
            ctx.quadraticCurveTo(centerX + 6, centerY - 25, centerX, centerY - 30);
            ctx.fill();

            // æ©Ÿèº«ç´°ç¯€ (äº®ç°è‰²)
            ctx.fillStyle = '#718096';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 28);
            ctx.quadraticCurveTo(centerX - 4, centerY - 23, centerX - 3, centerY + 5);
            ctx.quadraticCurveTo(centerX - 2, centerY + 23, centerX, centerY + 28);
            ctx.quadraticCurveTo(centerX + 2, centerY + 23, centerX + 3, centerY + 5);
            ctx.quadraticCurveTo(centerX + 4, centerY - 23, centerX, centerY - 28);
            ctx.fill();

            // ä¸»æ©Ÿç¿¼ (å€’æµ·é·—ç¿¼è¨­è¨ˆï¼ŒJU-87 ç‰¹å¾µ)
            ctx.fillStyle = '#2d3748';
            ctx.beginPath();
            // å·¦ç¿¼
            ctx.moveTo(centerX - 8, centerY - 2);
            ctx.quadraticCurveTo(centerX - 15, centerY - 8, centerX - 25, centerY - 5);
            ctx.lineTo(centerX - 30, centerY + 2);
            ctx.quadraticCurveTo(centerX - 20, centerY + 8, centerX - 8, centerY + 6);
            // å³ç¿¼
            ctx.moveTo(centerX + 8, centerY - 2);
            ctx.quadraticCurveTo(centerX + 15, centerY - 8, centerX + 25, centerY - 5);
            ctx.lineTo(centerX + 30, centerY + 2);
            ctx.quadraticCurveTo(centerX + 20, centerY + 8, centerX + 8, centerY + 6);
            ctx.fill();

            // æ©Ÿç¿¼ç´°ç¯€
            ctx.fillStyle = '#4a5568';
            ctx.beginPath();
            ctx.moveTo(centerX - 6, centerY);
            ctx.quadraticCurveTo(centerX - 12, centerY - 6, centerX - 22, centerY - 3);
            ctx.lineTo(centerX - 25, centerY + 4);
            ctx.quadraticCurveTo(centerX - 15, centerY + 6, centerX - 6, centerY + 4);
            ctx.moveTo(centerX + 6, centerY);
            ctx.quadraticCurveTo(centerX + 12, centerY - 6, centerX + 22, centerY - 3);
            ctx.lineTo(centerX + 25, centerY + 4);
            ctx.quadraticCurveTo(centerX + 15, centerY + 6, centerX + 6, centerY + 4);
            ctx.fill();

            // å›ºå®šèµ·è½æ¶ (JU-87 ç‰¹å¾µ)
            ctx.fillStyle = '#1a202c';
            // å·¦èµ·è½æ¶
            ctx.fillRect(centerX - 20, centerY + 6, 3, 12);
            ctx.fillRect(centerX - 22, centerY + 15, 7, 3);
            // å³èµ·è½æ¶
            ctx.fillRect(centerX + 17, centerY + 6, 3, 12);
            ctx.fillRect(centerX + 15, centerY + 15, 7, 3);

            // èµ·è½æ¶æ•´æµç½©
            ctx.fillStyle = '#4a5568';
            ctx.beginPath();
            ctx.ellipse(centerX - 18, centerY + 8, 4, 6, 0, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(centerX + 18, centerY + 8, 4, 6, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å¼•æ“ç½© (æ¶²å†·å¼•æ“)
            ctx.fillStyle = '#1a202c';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 33, 4, 6, 0, 0, 2 * Math.PI);
            ctx.fill();

            // æ•£ç†±å™¨é€²æ°£å£
            ctx.fillStyle = '#000000';
            ctx.fillRect(centerX - 3, centerY - 30, 6, 2);

            // èºæ—‹æ§³ (ä¸‰è‘‰ç‰‡)
            ctx.fillStyle = '#8b4513';
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#654321';

            // èºæ—‹æ§³ä¸­å¿ƒ
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 38, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // ä¸‰å€‹èºæ—‹æ§³è‘‰ç‰‡
            for (let i = 0; i < 3; i++) {
                const angle = (i * 120) * Math.PI / 180;
                const x1 = centerX + Math.cos(angle) * 9;
                const y1 = centerY - 38 + Math.sin(angle) * 9;
                const x2 = centerX + Math.cos(angle) * 2;
                const y2 = centerY - 38 + Math.sin(angle) * 2;

                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(x1, y1);
                ctx.stroke();
            }

            // é§•é§›è‰™ (å¤§å‹ç»ç’ƒç½©)
            ctx.fillStyle = 'rgba(147, 197, 253, 0.8)';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 15, 5, 12, 0, 0, 2 * Math.PI);
            ctx.fill();

            // é§•é§›è‰™æ¡†æ¶
            ctx.strokeStyle = '#1a202c';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 15, 5, 12, 0, 0, 2 * Math.PI);
            ctx.stroke();

            // å¾Œåº§æ©Ÿæ§æ‰‹ä½ç½®
            ctx.fillStyle = 'rgba(147, 197, 253, 0.6)';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 8, 3, 8, 0, 0, 2 * Math.PI);
            ctx.fill();

            // ä¿¯è¡ç…è»Š (JU-87 è‘—åç‰¹å¾µ)
            ctx.fillStyle = '#2d3748';
            // å·¦ç¿¼ä¿¯è¡ç…è»Š
            ctx.fillRect(centerX - 25, centerY - 8, 8, 3);
            ctx.fillRect(centerX - 25, centerY + 5, 8, 3);
            // å³ç¿¼ä¿¯è¡ç…è»Š
            ctx.fillRect(centerX + 17, centerY - 8, 8, 3);
            ctx.fillRect(centerX + 17, centerY + 5, 8, 3);

            // ç‚¸å½ˆæ›æ¶
            ctx.fillStyle = '#1a202c';
            ctx.fillRect(centerX - 2, centerY + 18, 4, 6);

            // ç‚¸å½ˆ (å¯é¸è£å‚™)
            ctx.fillStyle = '#4a5568';
            ctx.beginPath();
            ctx.roundRect(centerX - 3, centerY + 22, 6, 12, 2);
            ctx.fill();

            // å‚ç›´å°¾ç¿¼
            ctx.fillStyle = '#4a5568';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + 25);
            ctx.lineTo(centerX - 5, centerY + 38);
            ctx.lineTo(centerX + 5, centerY + 38);
            ctx.closePath();
            ctx.fill();

            // æ°´å¹³å°¾ç¿¼
            ctx.fillStyle = '#2d3748';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 27, 10, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å¾·åœ‹åå­—æ¨™è¨˜
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(centerX - 1, centerY - 8, 2, 6);
            ctx.fillRect(centerX - 3, centerY - 6, 6, 2);
            ctx.fillStyle = '#000000';
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 0.5;
            ctx.strokeRect(centerX - 1, centerY - 8, 2, 6);
            ctx.strokeRect(centerX - 3, centerY - 6, 6, 2);

            // æ©Ÿç¿¼åå­—æ¨™è¨˜
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(centerX - 16, centerY + 1, 2, 4);
            ctx.fillRect(centerX - 18, centerY + 2, 6, 2);
            ctx.fillRect(centerX + 14, centerY + 1, 2, 4);
            ctx.fillRect(centerX + 12, centerY + 2, 6, 2);
        }

        // Blenheim è½Ÿç‚¸æ©Ÿç¹ªè£½å‡½æ•¸ - è©³ç´°ç‰ˆæœ¬
        function drawBlenheimPNG(ctx, width, height) {
            const centerX = width / 2;
            const centerY = height / 2;

            // ä¸»æ©Ÿèº« (è‹±åœ‹çš‡å®¶ç©ºè»æ£•è‰²)
            ctx.fillStyle = '#8b4513';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 35);
            ctx.quadraticCurveTo(centerX - 7, centerY - 30, centerX - 6, centerY + 10);
            ctx.quadraticCurveTo(centerX - 5, centerY + 30, centerX, centerY + 35);
            ctx.quadraticCurveTo(centerX + 5, centerY + 30, centerX + 6, centerY + 10);
            ctx.quadraticCurveTo(centerX + 7, centerY - 30, centerX, centerY - 35);
            ctx.fill();

            // æ©Ÿèº«ç´°ç¯€ (äº®æ£•è‰²)
            ctx.fillStyle = '#a0522d';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 33);
            ctx.quadraticCurveTo(centerX - 5, centerY - 28, centerX - 4, centerY + 10);
            ctx.quadraticCurveTo(centerX - 3, centerY + 28, centerX, centerY + 33);
            ctx.quadraticCurveTo(centerX + 3, centerY + 28, centerX + 4, centerY + 10);
            ctx.quadraticCurveTo(centerX + 5, centerY - 28, centerX, centerY - 33);
            ctx.fill();

            // å·¦å¼•æ“è‰™ (é›™å¼•æ“è¨­è¨ˆ)
            ctx.fillStyle = '#654321';
            ctx.beginPath();
            ctx.ellipse(centerX - 15, centerY - 8, 6, 12, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å³å¼•æ“è‰™
            ctx.fillStyle = '#654321';
            ctx.beginPath();
            ctx.ellipse(centerX + 15, centerY - 8, 6, 12, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å¼•æ“è‰™ç´°ç¯€
            ctx.fillStyle = '#8b4513';
            ctx.beginPath();
            ctx.ellipse(centerX - 15, centerY - 8, 4, 8, 0, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(centerX + 15, centerY - 8, 4, 8, 0, 0, 2 * Math.PI);
            ctx.fill();

            // ä¸»æ©Ÿç¿¼ (é€£æ¥å¼•æ“è‰™)
            ctx.fillStyle = '#654321';
            ctx.beginPath();
            ctx.moveTo(centerX - 25, centerY - 5);
            ctx.lineTo(centerX - 20, centerY - 15);
            ctx.lineTo(centerX - 6, centerY - 12);
            ctx.lineTo(centerX + 6, centerY - 12);
            ctx.lineTo(centerX + 20, centerY - 15);
            ctx.lineTo(centerX + 25, centerY - 5);
            ctx.lineTo(centerX + 20, centerY + 5);
            ctx.lineTo(centerX + 6, centerY + 2);
            ctx.lineTo(centerX - 6, centerY + 2);
            ctx.lineTo(centerX - 20, centerY + 5);
            ctx.closePath();
            ctx.fill();

            // æ©Ÿç¿¼ç´°ç¯€
            ctx.fillStyle = '#8b4513';
            ctx.beginPath();
            ctx.moveTo(centerX - 20, centerY - 10);
            ctx.lineTo(centerX + 20, centerY - 10);
            ctx.lineTo(centerX + 15, centerY + 3);
            ctx.lineTo(centerX - 15, centerY + 3);
            ctx.closePath();
            ctx.fill();

            // å·¦å¼•æ“èºæ—‹æ§³
            ctx.fillStyle = '#8b4513';
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#654321';

            // å·¦èºæ—‹æ§³ä¸­å¿ƒ
            ctx.beginPath();
            ctx.ellipse(centerX - 15, centerY - 20, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å·¦èºæ—‹æ§³è‘‰ç‰‡
            for (let i = 0; i < 3; i++) {
                const angle = (i * 120) * Math.PI / 180;
                const x1 = centerX - 15 + Math.cos(angle) * 8;
                const y1 = centerY - 20 + Math.sin(angle) * 8;
                const x2 = centerX - 15 + Math.cos(angle) * 2;
                const y2 = centerY - 20 + Math.sin(angle) * 2;

                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(x1, y1);
                ctx.stroke();
            }

            // å³å¼•æ“èºæ—‹æ§³
            ctx.beginPath();
            ctx.ellipse(centerX + 15, centerY - 20, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å³èºæ—‹æ§³è‘‰ç‰‡
            for (let i = 0; i < 3; i++) {
                const angle = (i * 120) * Math.PI / 180;
                const x1 = centerX + 15 + Math.cos(angle) * 8;
                const y1 = centerY - 20 + Math.sin(angle) * 8;
                const x2 = centerX + 15 + Math.cos(angle) * 2;
                const y2 = centerY - 20 + Math.sin(angle) * 2;

                ctx.beginPath();
                ctx.moveTo(x2, y2);
                ctx.lineTo(x1, y1);
                ctx.stroke();
            }

            // é§•é§›è‰™ (å‰éƒ¨é€æ˜)
            ctx.fillStyle = 'rgba(147, 197, 253, 0.8)';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 25, 4, 8, 0, 0, 2 * Math.PI);
            ctx.fill();

            // é§•é§›è‰™æ¡†æ¶
            ctx.strokeStyle = '#654321';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.ellipse(centerX, centerY - 25, 4, 8, 0, 0, 2 * Math.PI);
            ctx.stroke();

            // æ©Ÿèº«çª—æˆ¶
            ctx.fillStyle = 'rgba(147, 197, 253, 0.6)';
            const windowPositions = [-10, 0, 10];
            windowPositions.forEach(pos => {
                ctx.beginPath();
                ctx.ellipse(centerX + 5, centerY + pos, 2, 3, 0, 0, 2 * Math.PI);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(centerX - 5, centerY + pos, 2, 3, 0, 0, 2 * Math.PI);
                ctx.fill();
            });

            // æ©Ÿè…¹ç‚¸å½ˆè‰™
            ctx.fillStyle = '#654321';
            ctx.beginPath();
            ctx.roundRect(centerX - 4, centerY + 15, 8, 10, 2);
            ctx.fill();

            // ç‚¸å½ˆè‰™é–€
            ctx.strokeStyle = '#8b4513';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(centerX - 3, centerY + 20);
            ctx.lineTo(centerX + 3, centerY + 20);
            ctx.stroke();

            // å‚ç›´å°¾ç¿¼
            ctx.fillStyle = '#8b4513';
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + 30);
            ctx.lineTo(centerX - 5, centerY + 42);
            ctx.lineTo(centerX + 5, centerY + 42);
            ctx.closePath();
            ctx.fill();

            // æ°´å¹³å°¾ç¿¼
            ctx.fillStyle = '#654321';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 32, 12, 4, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å°¾ç¿¼ç´°ç¯€
            ctx.fillStyle = '#8b4513';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 32, 10, 3, 0, 0, 2 * Math.PI);
            ctx.fill();

            // è‹±åœ‹çš‡å®¶ç©ºè»åœ“å½¢æ¨™è¨˜ (å·¦ç¿¼)
            ctx.fillStyle = '#1e40af'; // è—è‰²å¤–åœˆ
            ctx.beginPath();
            ctx.ellipse(centerX - 18, centerY - 5, 4, 4, 0, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#ffffff'; // ç™½è‰²ä¸­åœˆ
            ctx.beginPath();
            ctx.ellipse(centerX - 18, centerY - 5, 2.5, 2.5, 0, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#dc2626'; // ç´…è‰²ä¸­å¿ƒ
            ctx.beginPath();
            ctx.ellipse(centerX - 18, centerY - 5, 1, 1, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å³ç¿¼æ¨™è¨˜
            ctx.fillStyle = '#1e40af';
            ctx.beginPath();
            ctx.ellipse(centerX + 18, centerY - 5, 4, 4, 0, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.ellipse(centerX + 18, centerY - 5, 2.5, 2.5, 0, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = '#dc2626';
            ctx.beginPath();
            ctx.ellipse(centerX + 18, centerY - 5, 1, 1, 0, 0, 2 * Math.PI);
            ctx.fill();

            // æ©Ÿèº«ç·¨è™Ÿå€åŸŸ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.roundRect(centerX - 3, centerY + 5, 6, 4, 1);
            ctx.fill();

            // èµ·è½æ¶ (æ”¶æ”¾å¼)
            ctx.fillStyle = '#654321';
            ctx.fillRect(centerX - 12, centerY + 8, 2, 6);
            ctx.fillRect(centerX + 10, centerY + 8, 2, 6);

            // è¼ªå­
            ctx.fillStyle = '#1a202c';
            ctx.beginPath();
            ctx.ellipse(centerX - 11, centerY + 16, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();
            ctx.beginPath();
            ctx.ellipse(centerX + 11, centerY + 16, 2, 2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å°¾è¼ª
            ctx.fillStyle = '#654321';
            ctx.fillRect(centerX - 1, centerY + 35, 2, 4);
            ctx.fillStyle = '#1a202c';
            ctx.beginPath();
            ctx.ellipse(centerX, centerY + 41, 1.5, 1.5, 0, 0, 2 * Math.PI);
            ctx.fill();
        }

        function preload() {
            // å‰µå»ºçœŸå¯¦çš„é£›æ©Ÿ PNG æ•¸æ“š
            createRealPNGData();

            // è¼‰å…¥çœŸå¯¦çš„é£›æ©Ÿ PNG æª”æ¡ˆ
            for (var planeType in planeConfigs) {
                var config = planeConfigs[planeType];
                if (config.pngData) {
                    game.load.image(config.key, config.pngData);
                } else {
                    game.load.image(config.key, config.file);
                }
            }

            // ç›£è½è¼‰å…¥äº‹ä»¶
            game.load.onFileComplete.add(fileComplete, this);
            game.load.onLoadComplete.add(loadComplete, this);
            game.load.onFileError.add(fileError, this);
        }

        function fileComplete(progress, cacheKey, success, totalLoaded, totalFiles) {
            if (success) {
                assetsLoaded[cacheKey] = true;
                console.log('æˆåŠŸè¼‰å…¥:', cacheKey);
            }
        }

        function fileError(key, file) {
            console.log('æª”æ¡ˆè¼‰å…¥å¤±æ•—:', key);
            assetsLoaded[key] = false;
        }

        function loadComplete() {
            loadingComplete = true;
            console.log('æ‰€æœ‰æª”æ¡ˆè¼‰å…¥å®Œæˆ');
        }

        function create() {
            // è¨­ç½®èƒŒæ™¯é¡è‰²
            game.stage.backgroundColor = '#87CEEB';

            // å‰µå»ºç©å®¶é£›æ©Ÿ
            createPlayer();

            // å‰µå»ºæ•µæ©Ÿç¾¤çµ„
            enemies = game.add.group();
            enemies.enableBody = true;
            enemies.physicsBodyType = Phaser.Physics.ARCADE;

            // å‰µå»ºå­å½ˆç¾¤çµ„
            bullets = game.add.group();
            bullets.enableBody = true;
            bullets.physicsBodyType = Phaser.Physics.ARCADE;

            // æ§åˆ¶è¨­å®š
            cursors = game.input.keyboard.createCursorKeys();
            fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
            restartButton = game.input.keyboard.addKey(Phaser.Keyboard.R);
            
            // æ•¸å­—éµè¨­å®š
            numberKeys[1] = game.input.keyboard.addKey(Phaser.Keyboard.ONE);
            numberKeys[2] = game.input.keyboard.addKey(Phaser.Keyboard.TWO);
            numberKeys[3] = game.input.keyboard.addKey(Phaser.Keyboard.THREE);
            numberKeys[4] = game.input.keyboard.addKey(Phaser.Keyboard.FOUR);
            numberKeys[5] = game.input.keyboard.addKey(Phaser.Keyboard.FIVE);
            numberKeys[6] = game.input.keyboard.addKey(Phaser.Keyboard.SIX);
            numberKeys[7] = game.input.keyboard.addKey(Phaser.Keyboard.SEVEN);

            // åˆ†æ•¸æ–‡å­—
            scoreText = game.add.text(16, 16, 'Score: 0', {
                fontSize: '32px',
                fill: '#000'
            });

            // é£›æ©Ÿè³‡è¨Šæ–‡å­—
            planeInfoText = game.add.text(16, 60, 'ç•¶å‰é£›æ©Ÿ: ' + planeConfigs[currentPlane].name, {
                fontSize: '20px',
                fill: '#000'
            });

            // ç´ æç‹€æ…‹æ–‡å­—
            var statusText = game.add.text(16, 90, 'ç´ æç‹€æ…‹: æª¢æŸ¥ä¸­...', {
                fontSize: '16px',
                fill: '#000'
            });

            // æª¢æŸ¥ç´ æè¼‰å…¥ç‹€æ…‹
            setTimeout(function() {
                var loadedCount = 0;
                var totalCount = Object.keys(planeConfigs).length;
                
                for (var planeType in planeConfigs) {
                    var config = planeConfigs[planeType];
                    if (game.cache.checkImageKey(config.key)) {
                        loadedCount++;
                    }
                }
                
                if (loadedCount > 0) {
                    statusText.text = 'ç´ æç‹€æ…‹: ' + loadedCount + '/' + totalCount + ' å€‹çœŸå¯¦ PNG è¼‰å…¥æˆåŠŸ';
                    statusText.fill = '#27ae60';
                } else {
                    statusText.text = 'ç´ æç‹€æ…‹: ä½¿ç”¨å¾Œå‚™åœ–å½¢ï¼ˆéœ€è¦ä¸‹è¼‰çœŸå¯¦ PNGï¼‰';
                    statusText.fill = '#e74c3c';
                }
            }, 1000);

            // æ•µæ©Ÿç”Ÿæˆè¨ˆæ™‚å™¨
            enemyTimer = game.time.events.loop(Phaser.Timer.SECOND * 2, createEnemy, this);

            // è¨­ç½®é£›æ©Ÿé¸æ“‡å™¨äº‹ä»¶
            setupPlaneSelector();
        }

        function setupPlaneSelector() {
            var planeOptions = document.querySelectorAll('.plane-option');
            planeOptions.forEach(function(option) {
                option.addEventListener('click', function() {
                    planeOptions.forEach(function(opt) {
                        opt.classList.remove('selected');
                    });
                    
                    this.classList.add('selected');
                    var planeType = this.getAttribute('data-plane');
                    switchPlane(planeType);
                });
            });
        }

        function createPlayer() {
            if (player) {
                player.destroy();
            }

            var config = planeConfigs[currentPlane];
            
            // å˜—è©¦ä½¿ç”¨çœŸå¯¦çš„ PNG åœ–ç‰‡
            if (game.cache.checkImageKey(config.key)) {
                // ä½¿ç”¨çœŸå¯¦çš„ PNG ç´ æ
                player = game.add.sprite(400, 500, config.key);
                player.anchor.setTo(0.5, 0.5);
                player.scale.setTo(config.scale, config.scale);
                
                // æˆåŠŸè¼‰å…¥çœŸå¯¦ç´ æçš„æç¤º
                console.log('ä½¿ç”¨çœŸå¯¦ç´ æ:', config.name);
            } else {
                // ä½¿ç”¨å¾Œå‚™åœ–å½¢
                player = game.add.graphics(400, 500);
                createFallbackPlane(player, currentPlane);
                
                console.log('ä½¿ç”¨å¾Œå‚™åœ–å½¢:', config.name);
            }

            // å•Ÿç”¨ç‰©ç†
            game.physics.arcade.enable(player);
            player.body.collideWorldBounds = true;
        }

        function createFallbackPlane(graphics, planeType) {
            // æ ¹æ“šé£›æ©Ÿé¡å‹å‰µå»ºä¸åŒçš„å¾Œå‚™åœ–å½¢
            if (planeType === 'b17') {
                // B-17 å¾Œå‚™åœ–å½¢ï¼ˆè—è‰²ï¼‰
                graphics.beginFill(0x2980b9);
                graphics.drawRoundedRect(-6, -35, 12, 70, 3);
                graphics.drawRoundedRect(-33, -7, 66, 15, 4);
                graphics.endFill();
            } else if (planeType === 'bf109') {
                // BF-109 å¾Œå‚™åœ–å½¢ï¼ˆç´…è‰²ï¼‰
                graphics.beginFill(0xe74c3c);
                graphics.drawRoundedRect(-4, -25, 8, 50, 2);
                graphics.drawRoundedRect(-20, -5, 40, 10, 3);
                graphics.endFill();
            } else if (planeType === 'biplane') {
                // é›™ç¿¼æ©Ÿå¾Œå‚™åœ–å½¢ï¼ˆé‡‘è‰²ï¼‰
                graphics.beginFill(0xf1c40f);
                graphics.drawRoundedRect(-3, -25, 6, 50, 2);
                graphics.drawRoundedRect(-25, -15, 50, 8, 3);
                graphics.drawRoundedRect(-25, 5, 50, 8, 3);
                graphics.endFill();
            } else if (planeType === 'tbm3') {
                // TBM-3 å¾Œå‚™åœ–å½¢ï¼ˆç¶ è‰²ï¼‰
                graphics.beginFill(0x27ae60);
                graphics.drawRoundedRect(-5, -30, 10, 60, 3);
                graphics.drawRoundedRect(-28, -8, 56, 12, 4);
                graphics.endFill();
            } else if (planeType === 'hawker') {
                // Hawker å¾Œå‚™åœ–å½¢ï¼ˆç´«è‰²ï¼‰
                graphics.beginFill(0x8e44ad);
                graphics.drawRoundedRect(-4, -28, 8, 56, 2);
                graphics.drawRoundedRect(-22, -6, 44, 12, 3);
                graphics.endFill();
            } else if (planeType === 'ju87') {
                // JU-87 å¾Œå‚™åœ–å½¢ï¼ˆç°è‰²ï¼‰
                graphics.beginFill(0x4a5568);
                graphics.drawRoundedRect(-5, -30, 10, 60, 3);
                graphics.drawRoundedRect(-30, -8, 60, 12, 4);
                graphics.endFill();
            } else if (planeType === 'blenheim') {
                // Blenheim å¾Œå‚™åœ–å½¢ï¼ˆæ£•è‰²ï¼‰
                graphics.beginFill(0x8b4513);
                graphics.drawRoundedRect(-6, -35, 12, 70, 3);
                graphics.drawRoundedRect(-25, -8, 50, 12, 4);
                graphics.endFill();
            }
        }

        function switchPlane(planeType) {
            currentPlane = planeType;
            createPlayer();
            planeInfoText.text = 'ç•¶å‰é£›æ©Ÿ: ' + planeConfigs[currentPlane].name;
        }

        function createEnemy() {
            if (gameOver) return;

            var enemy = game.add.graphics(Math.random() * 750, -50);
            enemy.beginFill(0x95a5a6);
            enemy.drawRoundedRect(-4, -20, 8, 40, 2);
            enemy.drawRoundedRect(-15, -3, 30, 6, 2);
            enemy.endFill();

            enemies.add(enemy);
            game.physics.arcade.enable(enemy);
            enemy.body.velocity.y = 100 + Math.random() * 100;
            enemy.body.velocity.x = (Math.random() - 0.5) * 100;
            enemy.outOfBoundsKill = true;
            enemy.checkWorldBounds = true;
        }

        function update() {
            if (gameOver) return;

            var config = planeConfigs[currentPlane];

            // æ•¸å­—éµåˆ‡æ›é£›æ©Ÿ
            if (numberKeys[1].isDown) switchPlane('b17');
            if (numberKeys[2].isDown) switchPlane('bf109');
            if (numberKeys[3].isDown) switchPlane('biplane');
            if (numberKeys[4].isDown) switchPlane('tbm3');
            if (numberKeys[5].isDown) switchPlane('hawker');
            if (numberKeys[6].isDown) switchPlane('ju87');
            if (numberKeys[7].isDown) switchPlane('blenheim');

            // ç©å®¶ç§»å‹•
            if (cursors.left.isDown) {
                player.body.velocity.x = -config.speed;
            } else if (cursors.right.isDown) {
                player.body.velocity.x = config.speed;
            } else {
                player.body.velocity.x = 0;
            }

            if (cursors.up.isDown) {
                player.body.velocity.y = -config.speed;
            } else if (cursors.down.isDown) {
                player.body.velocity.y = config.speed;
            } else {
                player.body.velocity.y = 0;
            }

            if (fireButton.isDown) {
                fireBullet();
            }

            if (restartButton.isDown) {
                restart();
            }

            // ç¢°æ’æª¢æ¸¬
            game.physics.arcade.overlap(bullets, enemies, bulletHitEnemy, null, this);
            game.physics.arcade.overlap(player, enemies, enemyHitPlayer, null, this);
        }

        function fireBullet() {
            var config = planeConfigs[currentPlane];
            
            if (game.time.now > bulletTime) {
                var bullet = game.add.graphics(player.x, player.y - 40);
                bullet.beginFill(0xf1c40f);
                bullet.drawEllipse(0, 0, 6, 14);
                bullet.endFill();
                
                bullets.add(bullet);
                game.physics.arcade.enable(bullet);
                bullet.body.velocity.y = -400;
                bullet.outOfBoundsKill = true;
                bullet.checkWorldBounds = true;
                
                bulletTime = game.time.now + config.fireRate;
            }
        }

        function bulletHitEnemy(bullet, enemy) {
            bullet.destroy();
            enemy.destroy();
            score += 10;
            scoreText.text = 'Score: ' + score;
            
            var explosion = game.add.graphics(enemy.x, enemy.y);
            explosion.beginFill(0xff6600);
            explosion.drawCircle(0, 0, 30);
            explosion.endFill();
            game.add.tween(explosion).to({alpha: 0}, 500, Phaser.Easing.Linear.None, true);
            game.time.events.add(500, function() { explosion.destroy(); });
        }

        function enemyHitPlayer(player, enemy) {
            enemy.destroy();
            gameOver = true;
            
            var gameOverText = game.add.text(400, 300, 'Game Over!\nPress R to restart', {
                fontSize: '32px',
                fill: '#ff0000',
                align: 'center'
            });
            gameOverText.anchor.setTo(0.5, 0.5);
        }

        function restart() {
            score = 0;
            gameOver = false;
            scoreText.text = 'Score: 0';
            
            enemies.removeAll(true);
            bullets.removeAll(true);
            
            player.x = 400;
            player.y = 500;
            if (player.body) {
                player.body.velocity.setTo(0, 0);
            }
            
            game.world.children.forEach(function(child) {
                if (child.text && child.text.includes('Game Over')) {
                    child.destroy();
                }
            });
        }
    </script>
</body>
</html>
