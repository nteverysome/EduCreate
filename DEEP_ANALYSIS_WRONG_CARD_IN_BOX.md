# ğŸ”¥ æ·±åº¦åˆ†æï¼šç‚ºä»€éº¼å³å®¹å™¨æ ¼å­å…§çš„å¡ç‰‡ä¸æ˜¯ç”¨æˆ¶ä¹‹å‰æ”¾ç½®çš„å¡ç‰‡ï¼Ÿ

## ğŸ“Š å•é¡Œç¾è±¡

**ç”¨æˆ¶æ“ä½œæµç¨‹**ï¼š
1. ç¬¬1é ï¼šæ‹–æ”¾å¡ç‰‡åˆ°ç©ºç™½æ¡†ï¼ˆä¾‹å¦‚ï¼špairId=1 çš„å¡ç‰‡æ”¾å…¥ pairId=1 çš„ç©ºç™½æ¡†ï¼‰
2. æäº¤ç­”æ¡ˆ
3. é€²å…¥ç¬¬2é 
4. è¿”å›ç¬¬1é 
5. **çµæœ**ï¼šå³å®¹å™¨æ ¼å­å…§çš„å¡ç‰‡ä¸æ˜¯ç”¨æˆ¶ä¹‹å‰æ”¾ç½®çš„å¡ç‰‡

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### å•é¡Œéˆæ¢

#### **ç¬¬1éšæ®µï¼šä¿å­˜éšæ®µ**
```javascript
// onMatchSuccess ä¸­ä¿å­˜çš„æ•¸æ“š
this.allPagesCardPositions[0][1] = {
    isMatched: true,
    emptyBoxPairId: 1,      // âœ… ä¿å­˜çš„æ˜¯ç©ºç™½æ¡†çš„ pairId
    relativeX: 0,
    relativeY: 0
};
```

**ä¿å­˜çš„æ˜¯**ï¼špairId=1 çš„å¡ç‰‡æ”¾å…¥ pairId=1 çš„ç©ºç™½æ¡†

#### **ç¬¬2éšæ®µï¼šé é¢è¿”å›**
ç•¶è¿”å›ç¬¬1é æ™‚ï¼Œ`updateLayout()` é‡æ–°å‰µå»ºæ‰€æœ‰å¡ç‰‡å’Œç©ºç™½æ¡†ã€‚

**é—œéµå•é¡Œ**ï¼šç©ºç™½æ¡†çš„å‰µå»ºé †åºå¯èƒ½æ”¹è®Šï¼

#### **ç¬¬3éšæ®µï¼šæ¢å¾©éšæ®µ**
```javascript
// restoreCardPositions ä¸­çš„æ¢å¾©é‚è¼¯
const emptyBox = this.rightEmptyBoxes.find(box => 
    box.getData('pairId') === savedPos.emptyBoxPairId  // å°‹æ‰¾ pairId=1 çš„ç©ºç™½æ¡†
);

if (emptyBox) {
    emptyBox.add(card);  // å°‡å¡ç‰‡æ·»åŠ åˆ°æ‰¾åˆ°çš„ç©ºç™½æ¡†
}
```

**å•é¡Œ**ï¼šæ‰¾åˆ°çš„ç©ºç™½æ¡†å¯èƒ½ä¸æ˜¯ç”¨æˆ¶åŸä¾†æ”¾ç½®å¡ç‰‡çš„é‚£å€‹ç©ºç™½æ¡†ï¼

### å…·é«”å ´æ™¯ç¤ºä¾‹

```
ã€ç¬¬1é åˆå§‹ç‹€æ…‹ã€‘
ç©ºç™½æ¡†å‰µå»ºé †åº: [pairId: 1, 2, 3, 4]
ç©ºç™½æ¡†ä½ç½®: [y: 160, 276, 392, 508]

ã€ç”¨æˆ¶æ“ä½œã€‘
æ‹–æ”¾å¡ç‰‡ pairId=1 åˆ°ç¬¬1å€‹ç©ºç™½æ¡† (pairId=1, y=160)
ä¿å­˜: {pairId: 1, emptyBoxPairId: 1, relativeX: 0, relativeY: 0}

ã€è¿”å›ç¬¬1é  - ç©ºç™½æ¡†é‡æ–°å‰µå»ºã€‘
æ–°çš„ç©ºç™½æ¡†å‰µå»ºé †åº: [pairId: 2, 1, 3, 4]  âŒ é †åºæ”¹è®Šäº†ï¼
æ–°çš„ç©ºç™½æ¡†ä½ç½®: [y: 160, 276, 392, 508]

ã€æ¢å¾©å¡ç‰‡ã€‘
âœ… æ‰¾åˆ° pairId=1 çš„ç©ºç™½æ¡†ï¼ˆç¾åœ¨æ˜¯ç¬¬2å€‹ï¼Œy=276ï¼‰
âŒ å°‡å¡ç‰‡æ”¾å…¥ç¬¬2å€‹ç©ºç™½æ¡†ï¼ˆy=276ï¼‰
âŒ çµæœï¼šå¡ç‰‡å‡ºç¾åœ¨éŒ¯èª¤çš„ä½ç½®ï¼
```

## ğŸ¯ çœŸæ­£çš„æ ¹æœ¬åŸå› 

**v170.0 çš„ä¿®å¾©æœ‰ä¸€å€‹è‡´å‘½ç¼ºé™·**ï¼š

å®ƒå‡è¨­ç©ºç™½æ¡†çš„ `pairId` åœ¨é é¢è¿”å›æ™‚ä¿æŒä¸€è‡´ï¼Œä½†å¯¦éš›ä¸Šï¼š

1. **ç©ºç™½æ¡†æ˜¯é€šé `shuffledAnswers` å‰µå»ºçš„**
2. **`shuffledAnswers` æ˜¯é€šé Fisher-Yates ç®—æ³•æ´—ç‰Œå¾—åˆ°çš„**
3. **å³ä½¿ v169.0 ä¿å­˜äº†æ´—ç‰Œé †åºï¼Œä½†æ´—ç‰Œé †åºå¯èƒ½åœ¨æŸäº›æƒ…æ³ä¸‹æ”¹è®Š**
4. **å°è‡´ç©ºç™½æ¡†çš„å‰µå»ºé †åºæ”¹è®Šï¼ŒpairId å°æ‡‰çš„ä½ç½®ä¹Ÿæ”¹è®Š**

## âŒ v170.0 çš„å•é¡Œ

```javascript
// v170.0 çš„é‚è¼¯
const emptyBox = this.rightEmptyBoxes.find(box => 
    box.getData('pairId') === savedPos.emptyBoxPairId
);
```

**å•é¡Œ**ï¼š
- âœ… æ‰¾åˆ°äº†æ­£ç¢ºçš„ pairId çš„ç©ºç™½æ¡†
- âŒ ä½†é€™å€‹ç©ºç™½æ¡†å¯èƒ½åœ¨ä¸åŒçš„ä½ç½®
- âŒ ç”¨æˆ¶åŸä¾†æ”¾ç½®å¡ç‰‡çš„ä½ç½®å¯èƒ½æ˜¯å¦ä¸€å€‹ç©ºç™½æ¡†

## âœ… æ­£ç¢ºçš„è§£æ±ºæ–¹æ¡ˆ

**ä¸æ‡‰è©²é€šé pairId æ‰¾ç©ºç™½æ¡†ï¼Œè€Œæ‡‰è©²é€šéä½ç½®æ‰¾ç©ºç™½æ¡†ï¼**

### ä¿®å¾©æ€è·¯

ä¿å­˜çš„æ‡‰è©²æ˜¯ï¼š
1. **ç©ºç™½æ¡†åœ¨ç•¶å‰é çš„ç´¢å¼•ä½ç½®**ï¼ˆç¬¬1å€‹ã€ç¬¬2å€‹ã€ç¬¬3å€‹...ï¼‰
2. **è€Œä¸æ˜¯ç©ºç™½æ¡†çš„ pairId**

```javascript
// æ­£ç¢ºçš„ä¿å­˜é‚è¼¯
const emptyBoxIndex = this.rightEmptyBoxes.findIndex(box => 
    box === rightCard  // æ‰¾åˆ°å¡ç‰‡æ‰€åœ¨çš„ç©ºç™½æ¡†
);

this.allPagesCardPositions[this.currentPage][pairIdForSave] = {
    isMatched: true,
    emptyBoxIndex: emptyBoxIndex,  // âœ… ä¿å­˜ç©ºç™½æ¡†çš„ç´¢å¼•ä½ç½®
    relativeX: actualRelativeX,
    relativeY: actualRelativeY
};
```

### æ¢å¾©é‚è¼¯

```javascript
// æ­£ç¢ºçš„æ¢å¾©é‚è¼¯
if (savedPos.isMatched && savedPos.emptyBoxIndex !== undefined) {
    const emptyBox = this.rightEmptyBoxes[savedPos.emptyBoxIndex];  // é€šéç´¢å¼•æ‰¾ç©ºç™½æ¡†
    
    if (emptyBox) {
        emptyBox.add(card);
        card.setPosition(savedPos.relativeX, savedPos.relativeY);
        // ...
    }
}
```

## ğŸ“ v171.0 ä¿®å¾©è¨ˆåŠƒ

### ä¿®æ”¹ 1ï¼šonMatchSuccess å‡½æ•¸
- æ”¹ç‚ºä¿å­˜ `emptyBoxIndex` è€Œä¸æ˜¯ `emptyBoxPairId`

### ä¿®æ”¹ 2ï¼šrestoreCardPositions å‡½æ•¸
- æ”¹ç‚ºé€šé `emptyBoxIndex` æ‰¾ç©ºç™½æ¡†

### ä¿®æ”¹ 3ï¼šé©—è­‰
- ç¢ºä¿ç©ºç™½æ¡†çš„ç´¢å¼•ä½ç½®åœ¨é é¢è¿”å›æ™‚ä¿æŒä¸€è‡´

## ğŸ¯ çµè«–

**v170.0 çš„ä¿®å¾©æ–¹å‘æ˜¯å°çš„ï¼Œä½†å¯¦ç¾æœ‰ç¼ºé™·**ã€‚

çœŸæ­£çš„å•é¡Œä¸æ˜¯ pairId ä¸ä¸€è‡´ï¼Œè€Œæ˜¯**ç©ºç™½æ¡†çš„ä½ç½®æ”¹è®Šäº†**ã€‚

æ‡‰è©²é€šé**ç´¢å¼•ä½ç½®**è€Œä¸æ˜¯ **pairId** ä¾†æ¢å¾©å¡ç‰‡ä½ç½®ã€‚

