# æ··åˆæ¨¡å¼å¡ç‰‡å‹•æ…‹èª¿æ•´å°ºå¯¸ç­–ç•¥ - å®Œæ•´åˆ†æ

## ğŸ“Š æ ¸å¿ƒæ¶æ§‹

æ··åˆæ¨¡å¼çš„å¡ç‰‡å‹•æ…‹èª¿æ•´å°ºå¯¸æ¡ç”¨**å¤šå±¤æ¬¡éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼Œå¾ä¸Šåˆ°ä¸‹åˆ†ç‚º 6 å€‹å±¤ç´šï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ 1 å±¤ï¼šè¨­å‚™æª¢æ¸¬å±¤                      â”‚
â”‚  (Device Detection)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 2 å±¤ï¼šå®¹å™¨é…ç½®å±¤                      â”‚
â”‚  (Container Configuration)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 3 å±¤ï¼šå¯ç”¨ç©ºé–“è¨ˆç®—å±¤                  â”‚
â”‚  (Available Space Calculation)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 4 å±¤ï¼šåˆ—æ•¸è¨ˆç®—å±¤                      â”‚
â”‚  (Column Count Calculation)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 5 å±¤ï¼šå¡ç‰‡å°ºå¯¸è¨ˆç®—å±¤                  â”‚
â”‚  (Card Size Calculation)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 6 å±¤ï¼šç‰¹æ®Šè™•ç†å±¤                      â”‚
â”‚  (Special Handling)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ç¬¬ 1 å±¤ï¼šè¨­å‚™æª¢æ¸¬å±¤

### è¨­å‚™é¡å‹åˆ†é¡

æ ¹æ“šè¢å¹•å¯¬åº¦å’Œæ–¹å‘è‡ªå‹•æª¢æ¸¬ï¼š

| è¨­å‚™é¡å‹ | å¯¬åº¦ç¯„åœ | é«˜åº¦ç¯„åœ | ä½ˆå±€æ¨¡å¼ | åˆ—æ•¸ |
|---------|---------|---------|---------|------|
| **æ‰‹æ©Ÿç›´å‘** | < 768px | > 768px | ç·Šæ¹Š | å›ºå®š 5 |
| **æ‰‹æ©Ÿæ©«å‘** | > 768px | < 500px | ç·Šæ¹Š | å›ºå®š 5 |
| **å¹³æ¿ç›´å‘** | 768px | 1024px | æ¡Œé¢ | å‹•æ…‹ |
| **å¹³æ¿æ©«å‘** | 1024px | 768px | æ¡Œé¢ | å‹•æ…‹ |
| **æ¡Œé¢ç‰ˆ** | > 1024px | > 768px | æ¡Œé¢ | å‹•æ…‹ |

### æª¢æ¸¬ä»£ç¢¼

```javascript
function getDeviceType(width, height) {
    const aspectRatio = width / height;
    
    if (width < 768) {
        return height > width ? 'mobile-portrait' : 'mobile-landscape';
    } else if (width < 1024) {
        return height > width ? 'tablet-portrait' : 'tablet-landscape';
    } else {
        return 'desktop';
    }
}

// æª¢æ¸¬å…¨è¢å¹•ç‹€æ…‹
const isFullscreen = !!(
    document.fullscreenElement ||
    (document as any).webkitFullscreenElement ||
    (document as any).mozFullScreenElement ||
    (document as any).msFullscreenElement
);
```

---

## ğŸ›ï¸ ç¬¬ 2 å±¤ï¼šå®¹å™¨é…ç½®å±¤

### è¨­å‚™é…ç½®è¡¨

```javascript
const CONTAINER_CONFIG = {
    'mobile-portrait': {
        topButtonArea: 40,      // é ‚éƒ¨æŒ‰éˆ•å€åŸŸ
        bottomButtonArea: 40,   // åº•éƒ¨æŒ‰éˆ•å€åŸŸ
        sideMargin: 20,         // å·¦å³é‚Šè·
        cols: 5,                // å›ºå®š 5 åˆ—
        mode: 'compact',        // ç·Šæ¹Šæ¨¡å¼
        minCardSize: 150        // æœ€å°å¡ç‰‡å°ºå¯¸
    },
    'mobile-landscape': {
        topButtonArea: 30,
        bottomButtonArea: 30,
        sideMargin: 15,
        cols: 5,
        mode: 'compact',
        minCardSize: 150
    },
    'tablet-portrait': {
        topButtonArea: 60,
        bottomButtonArea: 60,
        sideMargin: 30,
        cols: 'dynamic',        // å‹•æ…‹è¨ˆç®—
        mode: 'desktop',
        minCardSize: 150
    },
    'tablet-landscape': {
        topButtonArea: 50,
        bottomButtonArea: 50,
        sideMargin: 40,
        cols: 'dynamic',
        mode: 'desktop',
        minCardSize: 150
    },
    'desktop': {
        topButtonArea: 80,
        bottomButtonArea: 80,
        sideMargin: 50,
        cols: 'dynamic',
        mode: 'desktop',
        minCardSize: 150
    }
};
```

### å…¨è¢å¹•æ¨¡å¼èª¿æ•´

å…¨è¢å¹•æ¨¡å¼ä¸‹ï¼Œé‚Šè·å’Œæœ€å°å¡ç‰‡å°ºå¯¸æœƒå‹•æ…‹èª¿æ•´ï¼š

```javascript
if (isFullscreen) {
    config.topButtonArea *= 0.5;      // æ¸›å°‘ 50%
    config.bottomButtonArea *= 0.5;
    config.sideMargin *= 0.75;
    config.minCardSize *= 0.8;        // å…è¨±æ›´å°çš„å¡ç‰‡
}
```

---

## ğŸ“ ç¬¬ 3 å±¤ï¼šå¯ç”¨ç©ºé–“è¨ˆç®—å±¤

### è¨ˆç®—å…¬å¼

```javascript
// å¯ç”¨å¯¬åº¦ = è¢å¹•å¯¬åº¦ - å·¦å³é‚Šè·
const availableWidth = width - sideMargin * 2;

// å¯ç”¨é«˜åº¦ = è¢å¹•é«˜åº¦ - é ‚éƒ¨æŒ‰éˆ• - åº•éƒ¨æŒ‰éˆ•
const availableHeight = height - topButtonArea - bottomButtonArea;

// æ°´å¹³é–“è·ï¼ˆ15-30pxï¼ŒåŸºæ–¼å¯¬åº¦çš„1.5%ï¼‰
const horizontalSpacing = Math.max(15, Math.min(30, width * 0.015));

// å‚ç›´é–“è·ï¼ˆ40-80pxï¼ŒåŸºæ–¼é«˜åº¦çš„4%ï¼‰
const verticalSpacing = Math.max(40, Math.min(80, height * 0.04));
```

### é–“è·å‹•æ…‹èª¿æ•´

é–“è·æœƒæ ¹æ“šå¡ç‰‡æ•¸é‡å‹•æ…‹èª¿æ•´ï¼š

```javascript
function calculateSpacing(baseSpacing, itemCount, minSpacing = 10) {
    if (itemCount <= 5) return baseSpacing;
    const reduction = (itemCount - 5) * 0.5;
    return Math.max(minSpacing, baseSpacing - reduction);
}
```

---

## ğŸ”¢ ç¬¬ 4 å±¤ï¼šåˆ—æ•¸è¨ˆç®—å±¤

### å‹•æ…‹åˆ—æ•¸è¨ˆç®—

```javascript
const aspectRatio = width / height;
const maxPossibleCols = Math.floor(
    (availableWidth + horizontalSpacing) / (minCardSize + horizontalSpacing)
);

let optimalCols;
if (aspectRatio > 2.0) {
    // è¶…å¯¬è¢å¹•ï¼ˆ21:9, 32:9ï¼‰
    optimalCols = Math.min(maxPossibleCols, 10, itemCount);
} else if (aspectRatio > 1.5) {
    // å¯¬è¢å¹•ï¼ˆ16:9, 16:10ï¼‰
    optimalCols = Math.min(maxPossibleCols, 10, itemCount);
} else if (aspectRatio > 1.2) {
    // æ¨™æº–è¢å¹•ï¼ˆ4:3, 3:2ï¼‰
    optimalCols = Math.min(maxPossibleCols, 8, itemCount);
} else {
    // ç›´å‘è¢å¹•ï¼ˆ9:16ï¼‰
    optimalCols = Math.min(maxPossibleCols, 5, itemCount);
}

// è¨ˆç®—è¡Œæ•¸
const optimalRows = Math.ceil(itemCount / optimalCols);
```

---

## ğŸ“ ç¬¬ 5 å±¤ï¼šå¡ç‰‡å°ºå¯¸è¨ˆç®—å±¤

### æ­£æ–¹å½¢æ¨¡å¼ï¼ˆæœ‰åœ–ç‰‡ï¼‰

```javascript
// æ–¹æ³•1ï¼šåŸºæ–¼é«˜åº¦è¨ˆç®—
// totalUnitHeight = squareSize + (squareSize * 0.4) = squareSize * 1.4
const availableHeightPerRow = (availableHeight - verticalSpacing * (optimalRows + 1)) / optimalRows;
const squareSizeByHeight = availableHeightPerRow / 1.4;

// æ–¹æ³•2ï¼šåŸºæ–¼å¯¬åº¦è¨ˆç®—
const squareSizeByWidth = (availableWidth - horizontalSpacing * (optimalCols + 1)) / optimalCols;

// å–è¼ƒå°å€¼ï¼Œç¢ºä¿å¡ç‰‡ä¸æœƒè¶…å‡ºé‚Šç•Œ
let squareSize = Math.min(squareSizeByHeight, squareSizeByWidth);

// æ‡‰ç”¨æœ€å°/æœ€å¤§é™åˆ¶
const minSquareSize = isFullscreen ? minCardSize : 150;
const maxSquareSize = 300;
squareSize = Math.max(minSquareSize, Math.min(maxSquareSize, squareSize));

finalCardWidth = squareSize;
finalCardHeight = squareSize;
```

### é•·æ–¹å½¢æ¨¡å¼ï¼ˆç„¡åœ–ç‰‡ï¼‰

```javascript
// å¡ç‰‡å¯¬åº¦ï¼šå……åˆ†åˆ©ç”¨å¯ç”¨å¯¬åº¦
finalCardWidth = (availableWidth - horizontalSpacing * (optimalCols + 1)) / optimalCols;

// å¡ç‰‡é«˜åº¦ï¼šå–®å…ƒç¸½é«˜åº¦çš„ 60%
const availableHeightPerRow = (availableHeight - verticalSpacing * (optimalRows + 1)) / optimalRows;
finalCardHeight = (availableHeightPerRow - verticalSpacing) / 1.4;

// æ‡‰ç”¨æœ€å°/æœ€å¤§é™åˆ¶
const minCardWidth = isFullscreen ? minCardSize : 200;
const minCardHeight = isFullscreen ? (minCardSize * 0.5) : 100;
const maxCardSize = 300;

finalCardWidth = Math.max(minCardWidth, Math.min(maxCardSize, finalCardWidth));
finalCardHeight = Math.max(minCardHeight, Math.min(maxCardSize, finalCardHeight));
```

---

## âš™ï¸ ç¬¬ 6 å±¤ï¼šç‰¹æ®Šè™•ç†å±¤

### ä¸­æ–‡æ–‡å­—é«˜åº¦è¨ˆç®—

```javascript
// æ­£æ–¹å½¢æ¨¡å¼ï¼šä¸­æ–‡æ–‡å­—é«˜åº¦ = å¡ç‰‡é«˜åº¦ Ã— 0.4
chineseTextHeight = squareSize * 0.4;

// é•·æ–¹å½¢æ¨¡å¼ï¼šä¸­æ–‡æ–‡å­—é«˜åº¦ = å›ºå®š 30px
chineseTextHeight = 30;

// ç¸½å–®å…ƒé«˜åº¦ = å¡ç‰‡é«˜åº¦ + æ–‡å­—é«˜åº¦ + å‚ç›´é–“è·
totalUnitHeight = cardHeight + chineseTextHeight + verticalSpacing;
```

### è¡Œæ•¸è¶…é™è™•ç†

```javascript
// å¦‚æœè¡Œæ•¸è¶…éæœ€å¤§å¯èƒ½è¡Œæ•¸ï¼Œå¢åŠ åˆ—æ•¸
while (optimalRows > maxPossibleRows && optimalCols < itemCount) {
    optimalCols++;
    optimalRows = Math.ceil(itemCount / optimalCols);
}
```

### å¡ç‰‡å°ºå¯¸éå°è™•ç†

```javascript
// å¦‚æœå¡ç‰‡å°ºå¯¸å°æ–¼æœ€å°å€¼ï¼Œå˜—è©¦å¢åŠ åˆ—æ•¸
if (squareSize < minSquareSize && optimalCols < itemCount) {
    optimalCols++;
    optimalRows = Math.ceil(itemCount / optimalCols);
    // é‡æ–°è¨ˆç®—å¡ç‰‡å°ºå¯¸
}
```

---

## ğŸ”„ å®Œæ•´è¨ˆç®—æµç¨‹

```
è¼¸å…¥ï¼šwidth, height, itemCount, hasImages, isFullscreen
  â†“
1. æª¢æ¸¬è¨­å‚™é¡å‹ â†’ deviceType
  â†“
2. ç²å–å®¹å™¨é…ç½® â†’ config
  â†“
3. è¨ˆç®—å¯ç”¨ç©ºé–“ â†’ availableWidth, availableHeight
  â†“
4. è¨ˆç®—é–“è· â†’ horizontalSpacing, verticalSpacing
  â†“
5. è¨ˆç®—åˆ—æ•¸ â†’ optimalCols
  â†“
6. è¨ˆç®—è¡Œæ•¸ â†’ optimalRows
  â†“
7. æ ¹æ“šå¡ç‰‡é¡å‹è¨ˆç®—å°ºå¯¸ â†’ cardWidth, cardHeight
  â†“
8. æ‡‰ç”¨æœ€å°/æœ€å¤§é™åˆ¶ â†’ finalCardWidth, finalCardHeight
  â†“
è¼¸å‡ºï¼š{ cardWidth, cardHeight, cols, rows, spacing }
```

---

## ğŸ“Š é—œéµåƒæ•¸å°ç…§è¡¨

| åƒæ•¸ | æ‰‹æ©Ÿç›´å‘ | æ‰‹æ©Ÿæ©«å‘ | å¹³æ¿ç›´å‘ | å¹³æ¿æ©«å‘ | æ¡Œé¢ |
|------|---------|---------|---------|---------|------|
| é ‚éƒ¨æŒ‰éˆ• | 40px | 30px | 60px | 50px | 80px |
| åº•éƒ¨æŒ‰éˆ• | 40px | 30px | 60px | 50px | 80px |
| å·¦å³é‚Šè· | 20px | 15px | 30px | 40px | 50px |
| åˆ—æ•¸ | 5 | 5 | å‹•æ…‹ | å‹•æ…‹ | å‹•æ…‹ |
| æœ€å°å¡ç‰‡ | 150px | 150px | 150px | 150px | 150px |
| æ¨¡å¼ | ç·Šæ¹Š | ç·Šæ¹Š | æ¡Œé¢ | æ¡Œé¢ | æ¡Œé¢ |

---

## âœ… é©—è­‰æª¢æŸ¥æ¸…å–®

- [ ] å¡ç‰‡å¯¬åº¦ â‰¥ æœ€å°å¯¬åº¦
- [ ] å¡ç‰‡é«˜åº¦ â‰¥ æœ€å°é«˜åº¦
- [ ] å¡ç‰‡å¯¬åº¦ â‰¤ æœ€å¤§å¯¬åº¦
- [ ] å¡ç‰‡é«˜åº¦ â‰¤ æœ€å¤§é«˜åº¦
- [ ] æ‰€æœ‰å¡ç‰‡éƒ½åœ¨å®¹å™¨å…§
- [ ] é–“è·åˆç†ï¼ˆä¸éå¤§ä¹Ÿä¸éå°ï¼‰
- [ ] æ–‡å­—èƒ½æ­£ç¢ºé¡¯ç¤º
- [ ] åœ–ç‰‡èƒ½æ­£ç¢ºé¡¯ç¤º
- [ ] åœ¨æ‰€æœ‰è¨­å‚™ä¸Šéƒ½èƒ½æ­£å¸¸å·¥ä½œ

