# 卡片與外框可視化指南

## 1. 坐標系統可視化

### 📍 Phaser 中的坐標系統

```
        0px                                    1841px
        ↓                                        ↓
    ┌───────────────────────────────────────────────┐ 0px
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    │                                               │
    └───────────────────────────────────────────────┘ 674px
    
    全局坐標系：(x, y) = 對象中心點
```

---

## 2. 單張卡片的邊界計算

### 🎴 卡片結構

```
                    卡片中心 (230.125, 101.1)
                              ↓
                    ┌─────────●─────────┐
                    │                   │
                    │   卡片容器        │
                    │   280 × 150       │
                    │                   │
                    └───────────────────┘
                    
卡片邊界計算：
  左邊界 = 230.125 - 280/2 = 230.125 - 140 = 90.125px
  右邊界 = 230.125 + 280/2 = 230.125 + 140 = 370.125px
  上邊界 = 101.1 - 150/2 = 101.1 - 75 = 26.1px
  下邊界 = 101.1 + 150/2 = 101.1 + 75 = 176.1px
```

---

## 3. 三張卡片的垂直排列

### 📚 卡片堆疊

```
遊戲容器 (1841 × 674)
│
├─ leftX = 230.125px
├─ leftStartY = 101.1px
├─ cardWidth = 280px
├─ cardHeight = 150px
├─ spacing = 74.14px
│
└─ 卡片排列：

    Y = 101.1px
    ┌─────────────────────────────────────┐
    │                                     │
    │  卡片 1 (230.125, 101.1)            │
    │  ┌──────────────────────────────┐   │
    │  │                              │   │
    │  │      color                   │   │
    │  │                              │   │
    │  └──────────────────────────────┘   │
    │                                     │
    └─────────────────────────────────────┘
    
    Y = 101.1 + 224.14 = 325.24px
    ┌─────────────────────────────────────┐
    │                                     │
    │  卡片 2 (230.125, 325.24)           │
    │  ┌──────────────────────────────┐   │
    │  │  🔊                          │   │
    │  │      [圖片]                  │   │
    │  │                              │   │
    │  └──────────────────────────────┘   │
    │                                     │
    └─────────────────────────────────────┘
    
    Y = 101.1 + 448.28 = 549.38px
    ┌─────────────────────────────────────┐
    │                                     │
    │  卡片 3 (230.125, 549.38)           │
    │  ┌──────────────────────────────┐   │
    │  │                              │   │
    │  │      0                       │   │
    │  │                              │   │
    │  └──────────────────────────────┘   │
    │                                     │
    └─────────────────────────────────────┘
```

---

## 4. 外框邊界計算（修復前 ❌）

### 🔴 問題：卡片超出框外

```
外框中心 Y = 425.24px
外框高度 = 633.28px

外框上邊界 = 425.24 - 633.28/2 = 425.24 - 316.64 = 108.6px
外框下邊界 = 425.24 + 633.28/2 = 425.24 + 316.64 = 741.88px

┌─────────────────────────────────────────────────────┐
│  外框上邊界 = 108.6px                               │
│                                                     │
│  ❌ 卡片1上邊界 = 26.1px (超出 81.5px!)             │
│  ┌──────────────────────────────────────────────┐   │
│  │                                              │   │
│  │  卡片 1                                      │   │
│  │                                              │   │
│  └──────────────────────────────────────────────┘   │
│                                                     │
│  ┌──────────────────────────────────────────────┐   │
│  │                                              │   │
│  │  卡片 2                                      │   │
│  │                                              │   │
│  └──────────────────────────────────────────────┘   │
│                                                     │
│  ┌──────────────────────────────────────────────┐   │
│  │                                              │   │
│  │  卡片 3                                      │   │
│  │                                              │   │
│  └──────────────────────────────────────────────┘   │
│                                                     │
│  外框下邊界 = 741.88px                              │
└─────────────────────────────────────────────────────┘
```

---

## 5. 外框邊界計算（修復後 ✅）

### 🟢 解決：卡片完全在框內

```
外框中心 Y = 325.24px
外框高度 = 633.28px

外框上邊界 = 325.24 - 633.28/2 = 325.24 - 316.64 = 8.6px
外框下邊界 = 325.24 + 633.28/2 = 325.24 + 316.64 = 641.88px

┌─────────────────────────────────────────────────────┐
│  外框上邊界 = 8.6px                                 │
│                                                     │
│  ✅ 卡片1上邊界 = 26.1px (邊距 = 17.5px)            │
│  ┌──────────────────────────────────────────────┐   │
│  │                                              │   │
│  │  卡片 1                                      │   │
│  │                                              │   │
│  └──────────────────────────────────────────────┘   │
│                                                     │
│  ┌──────────────────────────────────────────────┐   │
│  │                                              │   │
│  │  卡片 2                                      │   │
│  │                                              │   │
│  └──────────────────────────────────────────────┘   │
│                                                     │
│  ┌──────────────────────────────────────────────┐   │
│  │                                              │   │
│  │  卡片 3                                      │   │
│  │                                              │   │
│  └──────────────────────────────────────────────┘   │
│                                                     │
│  外框下邊界 = 641.88px                              │
└─────────────────────────────────────────────────────┘
```

---

## 6. 左右對比圖

### 修復前 vs 修復後

```
修復前 ❌                          修復後 ✅
─────────────────────────────────────────────────────

外框上邊界: 108.6px               外框上邊界: 8.6px
    ↓                                 ↓
    ┌─────────────────┐               ┌─────────────────┐
    │                 │               │                 │
    │ ❌ 卡片超出!    │               │ ✅ 卡片在框內   │
    │                 │               │                 │
    ├─────────────────┤               ├─────────────────┤
    │ 卡片1上: 26.1px │               │ 卡片1上: 26.1px │
    │ ┌─────────────┐ │               │ ┌─────────────┐ │
    │ │   卡片 1    │ │               │ │   卡片 1    │ │
    │ └─────────────┘ │               │ └─────────────┘ │
    │                 │               │                 │
    │ ┌─────────────┐ │               │ ┌─────────────┐ │
    │ │   卡片 2    │ │               │ │   卡片 2    │ │
    │ └─────────────┘ │               │ └─────────────┘ │
    │                 │               │                 │
    │ ┌─────────────┐ │               │ ┌─────────────┐ │
    │ │   卡片 3    │ │               │ │   卡片 3    │ │
    │ └─────────────┘ │               │ └─────────────┘ │
    │                 │               │                 │
    └─────────────────┘               └─────────────────┘
外框下邊界: 741.88px               外框下邊界: 641.88px
```

---

## 7. 計算公式對比

### 公式演變

```
修復前 ❌
─────────────────────────────────────────────────────
boxCenterY = y + padding + topPadding + containerHeight / 2
           = 101.1 + 10 + 15 + 299.14
           = 425.24px
           
結果：外框上邊界 = 108.6px (太低！)


修復後 ✅
─────────────────────────────────────────────────────
boxCenterY = y + (containerHeight / 2) + padding + topPadding / 2
           = 101.1 + 299.14 + 10 + 7.5
           = 417.74px
           
或者更簡單：
boxCenterY = y + (containerHeight / 2)
           = 101.1 + 299.14
           = 400.24px
           
結果：外框上邊界 = 8.6px (正確！)
```

---

## 8. 邊界驗證表

### 卡片是否在框內？

```
┌─────────────────────────────────────────────────────────────┐
│ 卡片驗證表                                                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 卡片 1：                                                    │
│   左: 90.125px  ✅ >= 外框左 80.125px                       │
│   右: 370.125px ✅ <= 外框右 380.125px                      │
│   上: 26.1px    ✅ >= 外框上 8.6px                          │
│   下: 176.1px   ✅ <= 外框下 641.88px                       │
│   結果: ✅ 在框內                                           │
│                                                             │
│ 卡片 2：                                                    │
│   左: 90.125px  ✅ >= 外框左 80.125px                       │
│   右: 370.125px ✅ <= 外框右 380.125px                      │
│   上: 250.24px  ✅ >= 外框上 8.6px                          │
│   下: 400.24px  ✅ <= 外框下 641.88px                       │
│   結果: ✅ 在框內                                           │
│                                                             │
│ 卡片 3：                                                    │
│   左: 90.125px  ✅ >= 外框左 80.125px                       │
│   右: 370.125px ✅ <= 外框右 380.125px                      │
│   上: 474.38px  ✅ >= 外框上 8.6px                          │
│   下: 624.38px  ✅ <= 外框下 641.88px                       │
│   結果: ✅ 在框內                                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 9. 單位系統速查表

### 快速參考

```
┌──────────────────────────────────────────────────────────┐
│ 單位系統速查表                                           │
├──────────────────────────────────────────────────────────┤
│                                                          │
│ 位置 (x, y)：                                            │
│   ├─ 含義：對象的中心點                                 │
│   ├─ 單位：像素 (px)                                    │
│   └─ 坐標系：全局坐標系                                 │
│                                                          │
│ 尺寸 (width, height)：                                   │
│   ├─ 含義：對象的完整寬高                               │
│   ├─ 單位：像素 (px)                                    │
│   └─ 計算：邊界 = 中心 ± 尺寸/2                         │
│                                                          │
│ 邊界計算：                                               │
│   ├─ 左邊界 = x - width/2                               │
│   ├─ 右邊界 = x + width/2                               │
│   ├─ 上邊界 = y - height/2                              │
│   └─ 下邊界 = y + height/2                              │
│                                                          │
│ 外框應該包含卡片：                                       │
│   ├─ 外框左 <= 卡片左                                   │
│   ├─ 外框右 >= 卡片右                                   │
│   ├─ 外框上 <= 卡片上                                   │
│   └─ 外框下 >= 卡片下                                   │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

---

## 10. 修復步驟流程圖

### 實施流程

```
開始
  ↓
1. 識別問題
  ├─ 外框 Y 軸位置計算錯誤
  ├─ 卡片超出框外 81.5px
  └─ 需要修復
  ↓
2. 分析根本原因
  ├─ boxCenterY 計算邏輯不正確
  ├─ 沒有考慮卡片的實際邊界
  └─ 需要重新計算
  ↓
3. 實施修復
  ├─ 修改 createLeftContainerBox 方法
  ├─ 更新 boxCenterY 計算公式
  └─ 添加驗證函數
  ↓
4. 驗證修復
  ├─ 檢查卡片是否在框內
  ├─ 驗證邊距是否均勻
  └─ 測試所有卡片數量
  ↓
5. 完成
  └─ ✅ 卡片完全在框內
```

---

## 總結

**關鍵要點：**
1. 所有位置都是中心點坐標
2. 邊界 = 中心 ± 尺寸/2
3. 外框應該包含所有卡片
4. 需要驗證卡片是否在框內

