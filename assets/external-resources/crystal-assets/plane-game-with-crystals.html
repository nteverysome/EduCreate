<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✈️💎 飛機遊戲 + 水晶收集</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@2.6.2/build/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        #game-container {
            margin: 20px auto;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <h1>✈️💎 飛機遊戲 + 水晶收集演示</h1>
    
    <div class="info">
        <h3>🎮 遊戲說明</h3>
        <p><strong>操作</strong>: 方向鍵移動飛機，空白鍵發射子彈</p>
        <p><strong>目標</strong>: 收集水晶獲得分數，擊敗敵人保護自己</p>
        <p><strong>水晶</strong>: 簡約水晶 +10 分，光澤水晶 +25 分</p>
    </div>
    
    <div id="game-container"></div>

    <script>
        // Phaser 2 遊戲設定
        var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'game-container', {
            preload: preload,
            create: create,
            update: update
        });

        var player;
        var crystals;
        var enemies;
        var bullets;
        var cursors;
        var fireButton;
        var score = 0;
        var scoreText;
        var crystalSpawnTimer = 0;
        var enemySpawnTimer = 0;

        function preload() {
            // 載入飛機素材 (使用簡單的幾何圖形代替)
            game.load.image('player', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==');
            game.load.image('enemy', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==');
            game.load.image('bullet', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==');
            
            // 載入水晶素材
            for (var i = 1; i <= 10; i++) {
                game.load.image('simple-crystal-' + i, '../crystal-assets/PNG/simple/' + i + '.png');
            }
            for (var i = 1; i <= 10; i++) {
                game.load.image('shiny-crystal-' + i, '../crystal-assets/PNG/shiny/' + i + '.png');
            }
            
            console.log('🎮 開始載入飛機遊戲 + 水晶素材...');
        }

        function create() {
            // 設置背景
            game.stage.backgroundColor = '#1a1a2e';
            
            // 創建玩家飛機
            player = game.add.sprite(100, 300, 'player');
            player.width = 40;
            player.height = 30;
            player.tint = 0x00ff00; // 綠色飛機
            game.physics.arcade.enable(player);
            player.body.collideWorldBounds = true;
            
            // 創建群組
            crystals = game.add.group();
            crystals.enableBody = true;
            crystals.physicsBodyType = Phaser.Physics.ARCADE;
            
            enemies = game.add.group();
            enemies.enableBody = true;
            enemies.physicsBodyType = Phaser.Physics.ARCADE;
            
            bullets = game.add.group();
            bullets.enableBody = true;
            bullets.physicsBodyType = Phaser.Physics.ARCADE;
            
            // 控制設定
            cursors = game.input.keyboard.createCursorKeys();
            fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
            
            // 分數文字
            scoreText = game.add.text(16, 16, 'Score: 0', {
                fontSize: '32px',
                fill: '#ffffff'
            });
            
            // 水晶收集說明
            var crystalInfo = game.add.text(16, 60, '💎 簡約水晶: +10 分 | ✨ 光澤水晶: +25 分', {
                fontSize: '16px',
                fill: '#ffeb3b'
            });
            
            console.log('✅ 飛機遊戲 + 水晶收集系統初始化完成！');
        }

        function update() {
            // 玩家移動
            player.body.velocity.setTo(0, 0);
            
            if (cursors.left.isDown) {
                player.body.velocity.x = -200;
            } else if (cursors.right.isDown) {
                player.body.velocity.x = 200;
            }
            
            if (cursors.up.isDown) {
                player.body.velocity.y = -200;
            } else if (cursors.down.isDown) {
                player.body.velocity.y = 200;
            }
            
            // 發射子彈
            if (fireButton.isDown) {
                fireBullet();
            }
            
            // 生成水晶
            crystalSpawnTimer += game.time.elapsed;
            if (crystalSpawnTimer > 2000) { // 每2秒生成一個水晶
                spawnCrystal();
                crystalSpawnTimer = 0;
            }
            
            // 生成敵人
            enemySpawnTimer += game.time.elapsed;
            if (enemySpawnTimer > 3000) { // 每3秒生成一個敵人
                spawnEnemy();
                enemySpawnTimer = 0;
            }
            
            // 碰撞檢測
            game.physics.arcade.overlap(player, crystals, collectCrystal, null, this);
            game.physics.arcade.overlap(bullets, enemies, hitEnemy, null, this);
            game.physics.arcade.overlap(player, enemies, hitPlayer, null, this);
            
            // 清理超出邊界的物件
            crystals.forEachAlive(function(crystal) {
                if (crystal.x < -50) {
                    crystal.kill();
                }
            });
            
            enemies.forEachAlive(function(enemy) {
                if (enemy.x < -50) {
                    enemy.kill();
                }
            });
            
            bullets.forEachAlive(function(bullet) {
                if (bullet.x > 850) {
                    bullet.kill();
                }
            });
        }
        
        function fireBullet() {
            if (game.time.now > bulletTime) {
                var bullet = bullets.create(player.x + 40, player.y + 15, 'bullet');
                bullet.width = 10;
                bullet.height = 5;
                bullet.tint = 0xffff00; // 黃色子彈
                bullet.body.velocity.x = 400;
                bulletTime = game.time.now + 200;
            }
        }
        var bulletTime = 0;
        
        function spawnCrystal() {
            var crystalTypes = ['simple', 'shiny'];
            var crystalType = crystalTypes[Math.floor(Math.random() * crystalTypes.length)];
            var crystalNumber = Math.floor(Math.random() * 10) + 1;
            var crystalKey = crystalType + '-crystal-' + crystalNumber;
            
            var crystal = crystals.create(800, Math.random() * 500 + 50, crystalKey);
            crystal.anchor.setTo(0.5, 0.5);
            crystal.scale.setTo(0.3, 0.3);
            crystal.body.velocity.x = -100;
            crystal.crystalType = crystalType;
            
            // 移除旋轉動畫，保持水晶靜止
            
            // 添加發光效果
            var glowTween = game.add.tween(crystal).to({alpha: 0.7}, 1000, Phaser.Easing.Sinusoidal.InOut, true, 0, -1, true);
        }
        
        function spawnEnemy() {
            var enemy = enemies.create(800, Math.random() * 500 + 50, 'enemy');
            enemy.width = 30;
            enemy.height = 25;
            enemy.tint = 0xff0000; // 紅色敵人
            enemy.body.velocity.x = -150;
        }
        
        function collectCrystal(player, crystal) {
            crystal.kill();
            
            // 根據水晶類型給予不同分數
            var points = crystal.crystalType === 'simple' ? 10 : 25;
            score += points;
            scoreText.text = 'Score: ' + score;
            
            // 收集效果
            var collectText = game.add.text(crystal.x, crystal.y, '+' + points, {
                fontSize: '20px',
                fill: crystal.crystalType === 'simple' ? '#00ff00' : '#ffaa00'
            });
            collectText.anchor.setTo(0.5, 0.5);
            
            var textTween = game.add.tween(collectText).to({y: collectText.y - 50, alpha: 0}, 1000, Phaser.Easing.Quadratic.Out, true);
            textTween.onComplete.add(function() {
                collectText.destroy();
            });
            
            console.log('💎 收集水晶！類型:', crystal.crystalType, '分數:', points);
        }
        
        function hitEnemy(bullet, enemy) {
            bullet.kill();
            enemy.kill();
            score += 5;
            scoreText.text = 'Score: ' + score;
        }
        
        function hitPlayer(player, enemy) {
            enemy.kill();
            // 簡單的重置遊戲
            score = Math.max(0, score - 20);
            scoreText.text = 'Score: ' + score;
            
            // 玩家閃爍效果
            var blinkTween = game.add.tween(player).to({alpha: 0.5}, 100, Phaser.Easing.Linear.None, true, 0, 5, true);
            blinkTween.onComplete.add(function() {
                player.alpha = 1;
            });
        }
    </script>
</body>
</html>
