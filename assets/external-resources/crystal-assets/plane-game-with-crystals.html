<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœˆï¸ğŸ’ é£›æ©ŸéŠæˆ² + æ°´æ™¶æ”¶é›†</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@2.6.2/build/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        #game-container {
            margin: 20px auto;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <h1>âœˆï¸ğŸ’ é£›æ©ŸéŠæˆ² + æ°´æ™¶æ”¶é›†æ¼”ç¤º</h1>
    
    <div class="info">
        <h3>ğŸ® éŠæˆ²èªªæ˜</h3>
        <p><strong>æ“ä½œ</strong>: æ–¹å‘éµç§»å‹•é£›æ©Ÿï¼Œç©ºç™½éµç™¼å°„å­å½ˆ</p>
        <p><strong>ç›®æ¨™</strong>: æ”¶é›†æ°´æ™¶ç²å¾—åˆ†æ•¸ï¼Œæ“Šæ•—æ•µäººä¿è­·è‡ªå·±</p>
        <p><strong>æ°´æ™¶</strong>: ç°¡ç´„æ°´æ™¶ +10 åˆ†ï¼Œå…‰æ¾¤æ°´æ™¶ +25 åˆ†</p>
    </div>
    
    <div id="game-container"></div>

    <script>
        // Phaser 2 éŠæˆ²è¨­å®š
        var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'game-container', {
            preload: preload,
            create: create,
            update: update
        });

        var player;
        var crystals;
        var enemies;
        var bullets;
        var cursors;
        var fireButton;
        var score = 0;
        var scoreText;
        var crystalSpawnTimer = 0;
        var enemySpawnTimer = 0;

        function preload() {
            // è¼‰å…¥é£›æ©Ÿç´ æ (ä½¿ç”¨ç°¡å–®çš„å¹¾ä½•åœ–å½¢ä»£æ›¿)
            game.load.image('player', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==');
            game.load.image('enemy', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==');
            game.load.image('bullet', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==');
            
            // è¼‰å…¥æ°´æ™¶ç´ æ
            for (var i = 1; i <= 10; i++) {
                game.load.image('simple-crystal-' + i, '../crystal-assets/PNG/simple/' + i + '.png');
            }
            for (var i = 1; i <= 10; i++) {
                game.load.image('shiny-crystal-' + i, '../crystal-assets/PNG/shiny/' + i + '.png');
            }
            
            console.log('ğŸ® é–‹å§‹è¼‰å…¥é£›æ©ŸéŠæˆ² + æ°´æ™¶ç´ æ...');
        }

        function create() {
            // è¨­ç½®èƒŒæ™¯
            game.stage.backgroundColor = '#1a1a2e';
            
            // å‰µå»ºç©å®¶é£›æ©Ÿ
            player = game.add.sprite(100, 300, 'player');
            player.width = 40;
            player.height = 30;
            player.tint = 0x00ff00; // ç¶ è‰²é£›æ©Ÿ
            game.physics.arcade.enable(player);
            player.body.collideWorldBounds = true;
            
            // å‰µå»ºç¾¤çµ„
            crystals = game.add.group();
            crystals.enableBody = true;
            crystals.physicsBodyType = Phaser.Physics.ARCADE;
            
            enemies = game.add.group();
            enemies.enableBody = true;
            enemies.physicsBodyType = Phaser.Physics.ARCADE;
            
            bullets = game.add.group();
            bullets.enableBody = true;
            bullets.physicsBodyType = Phaser.Physics.ARCADE;
            
            // æ§åˆ¶è¨­å®š
            cursors = game.input.keyboard.createCursorKeys();
            fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
            
            // åˆ†æ•¸æ–‡å­—
            scoreText = game.add.text(16, 16, 'Score: 0', {
                fontSize: '32px',
                fill: '#ffffff'
            });
            
            // æ°´æ™¶æ”¶é›†èªªæ˜
            var crystalInfo = game.add.text(16, 60, 'ğŸ’ ç°¡ç´„æ°´æ™¶: +10 åˆ† | âœ¨ å…‰æ¾¤æ°´æ™¶: +25 åˆ†', {
                fontSize: '16px',
                fill: '#ffeb3b'
            });
            
            console.log('âœ… é£›æ©ŸéŠæˆ² + æ°´æ™¶æ”¶é›†ç³»çµ±åˆå§‹åŒ–å®Œæˆï¼');
        }

        function update() {
            // ç©å®¶ç§»å‹•
            player.body.velocity.setTo(0, 0);
            
            if (cursors.left.isDown) {
                player.body.velocity.x = -200;
            } else if (cursors.right.isDown) {
                player.body.velocity.x = 200;
            }
            
            if (cursors.up.isDown) {
                player.body.velocity.y = -200;
            } else if (cursors.down.isDown) {
                player.body.velocity.y = 200;
            }
            
            // ç™¼å°„å­å½ˆ
            if (fireButton.isDown) {
                fireBullet();
            }
            
            // ç”Ÿæˆæ°´æ™¶
            crystalSpawnTimer += game.time.elapsed;
            if (crystalSpawnTimer > 2000) { // æ¯2ç§’ç”Ÿæˆä¸€å€‹æ°´æ™¶
                spawnCrystal();
                crystalSpawnTimer = 0;
            }
            
            // ç”Ÿæˆæ•µäºº
            enemySpawnTimer += game.time.elapsed;
            if (enemySpawnTimer > 3000) { // æ¯3ç§’ç”Ÿæˆä¸€å€‹æ•µäºº
                spawnEnemy();
                enemySpawnTimer = 0;
            }
            
            // ç¢°æ’æª¢æ¸¬
            game.physics.arcade.overlap(player, crystals, collectCrystal, null, this);
            game.physics.arcade.overlap(bullets, enemies, hitEnemy, null, this);
            game.physics.arcade.overlap(player, enemies, hitPlayer, null, this);
            
            // æ¸…ç†è¶…å‡ºé‚Šç•Œçš„ç‰©ä»¶
            crystals.forEachAlive(function(crystal) {
                if (crystal.x < -50) {
                    crystal.kill();
                }
            });
            
            enemies.forEachAlive(function(enemy) {
                if (enemy.x < -50) {
                    enemy.kill();
                }
            });
            
            bullets.forEachAlive(function(bullet) {
                if (bullet.x > 850) {
                    bullet.kill();
                }
            });
        }
        
        function fireBullet() {
            if (game.time.now > bulletTime) {
                var bullet = bullets.create(player.x + 40, player.y + 15, 'bullet');
                bullet.width = 10;
                bullet.height = 5;
                bullet.tint = 0xffff00; // é»ƒè‰²å­å½ˆ
                bullet.body.velocity.x = 400;
                bulletTime = game.time.now + 200;
            }
        }
        var bulletTime = 0;
        
        function spawnCrystal() {
            var crystalTypes = ['simple', 'shiny'];
            var crystalType = crystalTypes[Math.floor(Math.random() * crystalTypes.length)];
            var crystalNumber = Math.floor(Math.random() * 10) + 1;
            var crystalKey = crystalType + '-crystal-' + crystalNumber;
            
            var crystal = crystals.create(800, Math.random() * 500 + 50, crystalKey);
            crystal.anchor.setTo(0.5, 0.5);
            crystal.scale.setTo(0.3, 0.3);
            crystal.body.velocity.x = -100;
            crystal.crystalType = crystalType;
            
            // ç§»é™¤æ—‹è½‰å‹•ç•«ï¼Œä¿æŒæ°´æ™¶éœæ­¢
            
            // æ·»åŠ ç™¼å…‰æ•ˆæœ
            var glowTween = game.add.tween(crystal).to({alpha: 0.7}, 1000, Phaser.Easing.Sinusoidal.InOut, true, 0, -1, true);
        }
        
        function spawnEnemy() {
            var enemy = enemies.create(800, Math.random() * 500 + 50, 'enemy');
            enemy.width = 30;
            enemy.height = 25;
            enemy.tint = 0xff0000; // ç´…è‰²æ•µäºº
            enemy.body.velocity.x = -150;
        }
        
        function collectCrystal(player, crystal) {
            crystal.kill();
            
            // æ ¹æ“šæ°´æ™¶é¡å‹çµ¦äºˆä¸åŒåˆ†æ•¸
            var points = crystal.crystalType === 'simple' ? 10 : 25;
            score += points;
            scoreText.text = 'Score: ' + score;
            
            // æ”¶é›†æ•ˆæœ
            var collectText = game.add.text(crystal.x, crystal.y, '+' + points, {
                fontSize: '20px',
                fill: crystal.crystalType === 'simple' ? '#00ff00' : '#ffaa00'
            });
            collectText.anchor.setTo(0.5, 0.5);
            
            var textTween = game.add.tween(collectText).to({y: collectText.y - 50, alpha: 0}, 1000, Phaser.Easing.Quadratic.Out, true);
            textTween.onComplete.add(function() {
                collectText.destroy();
            });
            
            console.log('ğŸ’ æ”¶é›†æ°´æ™¶ï¼é¡å‹:', crystal.crystalType, 'åˆ†æ•¸:', points);
        }
        
        function hitEnemy(bullet, enemy) {
            bullet.kill();
            enemy.kill();
            score += 5;
            scoreText.text = 'Score: ' + score;
        }
        
        function hitPlayer(player, enemy) {
            enemy.kill();
            // ç°¡å–®çš„é‡ç½®éŠæˆ²
            score = Math.max(0, score - 20);
            scoreText.text = 'Score: ' + score;
            
            // ç©å®¶é–ƒçˆæ•ˆæœ
            var blinkTween = game.add.tween(player).to({alpha: 0.5}, 100, Phaser.Easing.Linear.None, true, 0, 5, true);
            blinkTween.onComplete.add(function() {
                player.alpha = 1;
            });
        }
    </script>
</body>
</html>
