<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœˆï¸â˜ï¸ é£›æ©ŸéŠæˆ² + å‹•æ…‹é›²æœµèƒŒæ™¯</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@2.6.2/build/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #87CEEB 0%, #4682B4 100%);
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        #game-container {
            margin: 20px auto;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .controls {
            margin-top: 20px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .controls button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .controls button:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <h1>âœˆï¸â˜ï¸ é£›æ©ŸéŠæˆ² + å‹•æ…‹é›²æœµèƒŒæ™¯æ¼”ç¤º</h1>
    
    <div class="info">
        <h3>ğŸ® éŠæˆ²èªªæ˜</h3>
        <p><strong>æ“ä½œ</strong>: æ–¹å‘éµç§»å‹•é£›æ©Ÿï¼Œç©ºç™½éµç™¼å°„å­å½ˆ</p>
        <p><strong>èƒŒæ™¯</strong>: å‹•æ…‹é›²æœµå‹•ç•«ï¼Œé–ƒé›»ç‰¹æ•ˆï¼Œä¸‰ç¨®å¤©æ°£æ¨¡å¼</p>
        <p><strong>ç‰¹è‰²</strong>: 125å€‹é›²æœµå‹•ç•«å¹€ï¼ŒçœŸå¯¦çš„å¤©æ°£è®ŠåŒ–æ•ˆæœ</p>
    </div>
    
    <div id="game-container"></div>
    
    <div class="controls">
        <h3>ğŸŒ¤ï¸ å¤©æ°£æ§åˆ¶</h3>
        <button onclick="setWeather('sunny')">â˜€ï¸ æ™´å¤©æ¨¡å¼</button>
        <button onclick="setWeather('cloudy')">ğŸŒ«ï¸ é™°å¤©æ¨¡å¼</button>
        <button onclick="setWeather('stormy')">â›ˆï¸ æš´é¢¨é›¨æ¨¡å¼</button>
        <button onclick="toggleLightning()">âš¡ åˆ‡æ›é–ƒé›»</button>
    </div>

    <script>
        // Phaser 2 éŠæˆ²è¨­å®š
        var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'game-container', {
            preload: preload,
            create: create,
            update: update
        });

        var player;
        var clouds;
        var lightning;
        var bullets;
        var cursors;
        var fireButton;
        var currentWeather = 'sunny';
        var lightningEnabled = true;
        var cloudSpawnTimer = 0;
        var lightningTimer = 0;

        function preload() {
            // è¼‰å…¥é£›æ©Ÿç´ æ (ä½¿ç”¨ç°¡å–®çš„å¹¾ä½•åœ–å½¢ä»£æ›¿)
            game.load.image('player', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==');
            game.load.image('bullet', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==');
            
            // è¼‰å…¥é›²æœµå‹•ç•« (è¼‰å…¥éƒ¨åˆ†å½¢ç‹€ä½œç‚ºæ¼”ç¤º)
            for (var shape = 1; shape <= 3; shape++) {
                for (var frame = 1; frame <= 5; frame++) {
                    var filename = 'cloud_shape' + shape + '_' + frame + '.png';
                    game.load.image('white-cloud-' + shape + '-' + frame, 'PNG/Clouds_white/Shape' + shape + '/' + filename);
                    game.load.image('gray-cloud-' + shape + '-' + frame, 'PNG/Clouds_gray/Shape' + shape + '/' + filename);
                    game.load.image('black-cloud-' + shape + '-' + frame, 'PNG/Clouds_black/Shape' + shape + '/' + filename);
                }
            }
            
            // è¼‰å…¥é–ƒé›»å‹•ç•«
            for (var i = 1; i <= 5; i++) {
                game.load.image('lightning-' + i, 'PNG/Lightning/lightning' + i + '.png');
            }
            
            console.log('ğŸ® é–‹å§‹è¼‰å…¥é£›æ©ŸéŠæˆ² + é›²æœµèƒŒæ™¯...');
        }

        function create() {
            // è¨­ç½®èƒŒæ™¯
            game.stage.backgroundColor = '#87CEEB';
            
            // å‰µå»ºç©å®¶é£›æ©Ÿ
            player = game.add.sprite(100, 300, 'player');
            player.width = 40;
            player.height = 30;
            player.tint = 0x00ff00; // ç¶ è‰²é£›æ©Ÿ
            game.physics.arcade.enable(player);
            player.body.collideWorldBounds = true;
            
            // å‰µå»ºç¾¤çµ„
            clouds = game.add.group();
            clouds.enableBody = true;
            clouds.physicsBodyType = Phaser.Physics.ARCADE;
            
            bullets = game.add.group();
            bullets.enableBody = true;
            bullets.physicsBodyType = Phaser.Physics.ARCADE;
            
            // æ§åˆ¶è¨­å®š
            cursors = game.input.keyboard.createCursorKeys();
            fireButton = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
            
            // éŠæˆ²è³‡è¨Š
            var infoText = game.add.text(16, 16, 'âœˆï¸ é£›æ©ŸéŠæˆ² + å‹•æ…‹é›²æœµèƒŒæ™¯', {
                fontSize: '20px',
                fill: '#ffffff'
            });
            
            var weatherText = game.add.text(16, 50, 'ğŸŒ¤ï¸ ç•¶å‰å¤©æ°£: æ™´å¤©', {
                fontSize: '16px',
                fill: '#ffeb3b'
            });
            
            console.log('âœ… é£›æ©ŸéŠæˆ² + é›²æœµèƒŒæ™¯ç³»çµ±åˆå§‹åŒ–å®Œæˆï¼');
        }

        function update() {
            // ç©å®¶ç§»å‹•
            player.body.velocity.setTo(0, 0);
            
            if (cursors.left.isDown) {
                player.body.velocity.x = -200;
            } else if (cursors.right.isDown) {
                player.body.velocity.x = 200;
            }
            
            if (cursors.up.isDown) {
                player.body.velocity.y = -200;
            } else if (cursors.down.isDown) {
                player.body.velocity.y = 200;
            }
            
            // ç™¼å°„å­å½ˆ
            if (fireButton.isDown) {
                fireBullet();
            }
            
            // ç”Ÿæˆé›²æœµ
            cloudSpawnTimer += game.time.elapsed;
            if (cloudSpawnTimer > 3000) { // æ¯3ç§’ç”Ÿæˆä¸€å€‹é›²æœµ
                spawnCloud();
                cloudSpawnTimer = 0;
            }
            
            // é–ƒé›»æ•ˆæœ
            if (lightningEnabled && currentWeather === 'stormy') {
                lightningTimer += game.time.elapsed;
                if (lightningTimer > 5000) { // æ¯5ç§’é–ƒé›»
                    createLightning();
                    lightningTimer = 0;
                }
            }
            
            // æ¸…ç†è¶…å‡ºé‚Šç•Œçš„ç‰©ä»¶
            clouds.forEachAlive(function(cloud) {
                if (cloud.x < -100) {
                    cloud.kill();
                }
            });
            
            bullets.forEachAlive(function(bullet) {
                if (bullet.x > 850) {
                    bullet.kill();
                }
            });
        }
        
        function fireBullet() {
            if (game.time.now > bulletTime) {
                var bullet = bullets.create(player.x + 40, player.y + 15, 'bullet');
                bullet.width = 10;
                bullet.height = 5;
                bullet.tint = 0xffff00; // é»ƒè‰²å­å½ˆ
                bullet.body.velocity.x = 400;
                bulletTime = game.time.now + 200;
            }
        }
        var bulletTime = 0;
        
        function spawnCloud() {
            var cloudType = getCloudTypeByWeather();
            var shape = Math.floor(Math.random() * 3) + 1; // 1-3
            var frames = [];
            
            for (var i = 1; i <= 5; i++) {
                frames.push(cloudType + '-cloud-' + shape + '-' + i);
            }
            
            var cloud = clouds.create(800, Math.random() * 400 + 50, frames[0]);
            cloud.anchor.setTo(0.5, 0.5);
            cloud.scale.setTo(0.6, 0.6);
            cloud.body.velocity.x = -50;
            cloud.alpha = 0.8;
            
            // å‰µå»ºé›²æœµå‹•ç•«
            var animKey = cloudType + '-cloud-anim-' + shape + '-' + Math.floor(Math.random() * 1000);
            try {
                cloud.animations.add(animKey, frames, 2, true);
                cloud.animations.play(animKey);
            } catch (error) {
                console.log('å‹•ç•«å‰µå»ºå¤±æ•—:', error);
                // å¦‚æœå‹•ç•«å¤±æ•—ï¼Œè‡³å°‘é¡¯ç¤ºéœæ…‹é›²æœµ
                cloud.loadTexture(frames[0]);
            }
        }
        
        function getCloudTypeByWeather() {
            switch(currentWeather) {
                case 'sunny': return 'white';
                case 'cloudy': return 'gray';
                case 'stormy': return 'black';
                default: return 'white';
            }
        }
        
        function createLightning() {
            var frames = [];
            for (var i = 1; i <= 5; i++) {
                frames.push('lightning-' + i);
            }
            
            var lightning = game.add.sprite(Math.random() * 600 + 100, Math.random() * 200 + 50, frames[0]);
            lightning.anchor.setTo(0.5, 0.5);
            lightning.scale.setTo(1.5, 1.5);
            lightning.alpha = 0.9;
            
            // å‰µå»ºé–ƒé›»å‹•ç•«
            var animKey = 'lightning-anim-' + Math.floor(Math.random() * 1000);
            try {
                lightning.animations.add(animKey, frames, 10, false);
                lightning.animations.play(animKey);

                // å‹•ç•«å®Œæˆå¾ŒéŠ·æ¯€
                lightning.animations.currentAnim.onComplete.add(function() {
                    lightning.destroy();
                });
            } catch (error) {
                console.log('é–ƒé›»å‹•ç•«å‰µå»ºå¤±æ•—:', error);
                // å¦‚æœå‹•ç•«å¤±æ•—ï¼Œ3ç§’å¾ŒéŠ·æ¯€
                game.time.events.add(3000, function() {
                    lightning.destroy();
                });
            }
            
            // é–ƒé›»éŸ³æ•ˆæ¨¡æ“¬ (æ”¹è®ŠèƒŒæ™¯è‰²)
            game.stage.backgroundColor = '#ffffff';
            game.time.events.add(100, function() {
                game.stage.backgroundColor = getBackgroundColor();
            });
        }
        
        function getBackgroundColor() {
            switch(currentWeather) {
                case 'sunny': return '#87CEEB';
                case 'cloudy': return '#708090';
                case 'stormy': return '#2F4F4F';
                default: return '#87CEEB';
            }
        }
        
        // å…¨åŸŸå‡½æ•¸ä¾›æŒ‰éˆ•èª¿ç”¨
        window.setWeather = function(weather) {
            currentWeather = weather;
            game.stage.backgroundColor = getBackgroundColor();
            
            // æ›´æ–°å¤©æ°£æ–‡å­—
            var weatherNames = {
                'sunny': 'æ™´å¤©',
                'cloudy': 'é™°å¤©', 
                'stormy': 'æš´é¢¨é›¨'
            };
            
            console.log('ğŸŒ¤ï¸ å¤©æ°£åˆ‡æ›ç‚º:', weatherNames[weather]);
        };
        
        window.toggleLightning = function() {
            lightningEnabled = !lightningEnabled;
            console.log('âš¡ é–ƒé›»æ•ˆæœ:', lightningEnabled ? 'é–‹å•Ÿ' : 'é—œé–‰');
        };
    </script>
</body>
</html>
