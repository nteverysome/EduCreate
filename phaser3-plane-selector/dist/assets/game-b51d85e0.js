import{P as e}from"./phaser-51c66cbb.js";import{P as t,a as s}from"./planes-9c241b37.js";class i{constructor(t){this.keys={},this.inputBuffer=new Map,this.debounceDelay=100,this.keyComboBuffer=[],this.comboTimeout=1e3,this.scene=t,this.eventEmitter=new e.Events.EventEmitter,this.inputState={movement:{up:!1,down:!1,left:!1,right:!1},actions:{fire:!1,restart:!1},planeSelection:{}},this.setupKeyboard(),this.setupMouse(),this.setupGamepad()}setupKeyboard(){if(this.scene.input.keyboard){this.cursors=this.scene.input.keyboard.createCursorKeys(),this.keys.fire=this.scene.input.keyboard.addKey(P.FIRE),this.keys.restart=this.scene.input.keyboard.addKey(P.RESTART);for(let e=1;e<=7;e++){const t=`PLANE_${e}`;this.keys[t]=this.scene.input.keyboard.addKey(`DIGIT${e}`)}this.keys.w=this.scene.input.keyboard.addKey("W"),this.keys.a=this.scene.input.keyboard.addKey("A"),this.keys.s=this.scene.input.keyboard.addKey("S"),this.keys.d=this.scene.input.keyboard.addKey("D"),this.setupKeyboardEvents()}}setupKeyboardEvents(){for(let e=1;e<=7;e++){const t=`PLANE_${e}`;this.keys[t]&&this.keys[t].on("down",()=>{this.canProcessInput(t)&&(this.eventEmitter.emit(E.PLANE_SELECTED,e-1),this.recordInput(t))})}this.keys.restart?.on("down",()=>{this.canProcessInput("restart")&&(this.eventEmitter.emit("restart-game"),this.recordInput("restart"))}),this.scene.input.keyboard?.on("keydown",e=>{this.handleKeyCombo(e.code)})}setupMouse(){this.scene.input.on("pointerdown",e=>{e.leftButtonDown()&&(this.inputState.actions.fire=!0,this.eventEmitter.emit("fire-weapon"))}),this.scene.input.on("pointerup",e=>{e.leftButtonDown()||(this.inputState.actions.fire=!1)}),this.scene.input.on("pointermove",e=>{e.isDown&&this.eventEmitter.emit("mouse-move",{x:e.x,y:e.y,worldX:e.worldX,worldY:e.worldY})})}setupGamepad(){this.scene.input.gamepad?.on("connected",e=>{console.log(`🎮 遊戲手把已連接: ${e.id}`),this.setupGamepadControls(e)})}setupGamepadControls(e){e.on("down",(e,t,s)=>{switch(e){case 0:this.inputState.actions.fire=!0,this.eventEmitter.emit("fire-weapon");break;case 1:this.eventEmitter.emit("special-ability");break;case 9:this.eventEmitter.emit("restart-game")}}),e.on("up",(e,t,s)=>{if(0===e)this.inputState.actions.fire=!1})}update(){this.updateMovementState(),this.updateActionState(),this.cleanupInputBuffer()}updateMovementState(){this.inputState.movement.up=this.cursors.up.isDown||this.keys.w?.isDown||!1,this.inputState.movement.down=this.cursors.down.isDown||this.keys.s?.isDown||!1,this.inputState.movement.left=this.cursors.left.isDown||this.keys.a?.isDown||!1,this.inputState.movement.right=this.cursors.right.isDown||this.keys.d?.isDown||!1;const e=this.scene.input.gamepad?.getPad(0);if(e){const t=e.leftStick;t.x<-.5&&(this.inputState.movement.left=!0),t.x>.5&&(this.inputState.movement.right=!0),t.y<-.5&&(this.inputState.movement.up=!0),t.y>.5&&(this.inputState.movement.down=!0)}}updateActionState(){this.inputState.actions.fire=this.keys.fire?.isDown||!1,this.inputState.actions.restart=this.keys.restart?.isDown||!1}canProcessInput(e){return Date.now()-(this.inputBuffer.get(e)||0)>this.debounceDelay}recordInput(e){this.inputBuffer.set(e,Date.now())}cleanupInputBuffer(){const e=Date.now();for(const[t,s]of this.inputBuffer.entries())e-s>10*this.debounceDelay&&this.inputBuffer.delete(t)}handleKeyCombo(e){this.keyComboBuffer.push(e),this.checkSpecialCombos(),this.scene.time.delayedCall(this.comboTimeout,()=>{this.keyComboBuffer=[]})}checkSpecialCombos(){const e=this.keyComboBuffer.join("-"),t={"KeyG-KeyO-KeyD":"god-mode","KeyF-KeyA-KeyS-KeyT":"fast-mode","KeyS-KeyL-KeyO-KeyW":"slow-mode"};for(const[s,i]of Object.entries(t))if(e.includes(s)){this.eventEmitter.emit(`cheat-${i}`),this.keyComboBuffer=[];break}}getInputState(){return{...this.inputState}}getMovementVector(){let e=0,t=0;if(this.inputState.movement.left&&(e-=1),this.inputState.movement.right&&(e+=1),this.inputState.movement.up&&(t-=1),this.inputState.movement.down&&(t+=1),0!==e&&0!==t){const s=Math.sqrt(e*e+t*t);e/=s,t/=s}return{x:e,y:t}}isActionPressed(e){return this.inputState.actions[e]}on(e,t,s){this.eventEmitter.on(e,t,s)}off(e,t,s){this.eventEmitter.off(e,t,s)}destroy(){this.eventEmitter.removeAllListeners(),this.inputBuffer.clear(),this.keyComboBuffer=[]}}const a=[{id:"b17",name:"B-17 Flying Fortress",displayName:"B-17 轟炸機",description:"四引擎重型轟炸機，擁有強大的火力和防護",type:"bomber",speed:250,fireRate:300,health:150,damage:25,scale:.8,color:"#1e3a8a",assetPath:"assets/planes/B-17/Type-1/B-17.png",soundPath:"assets/sounds/heavy-engine.mp3",abilities:[{id:"heavy-bombardment",name:"重型轟炸",description:"發射多發重型炸彈",cooldown:5e3,effect:{type:"multi-shot",duration:2e3,multiplier:3}}]},{id:"bf109",name:"Messerschmitt BF-109E",displayName:"BF-109E 戰鬥機",description:"德國單引擎戰鬥機，機動性極佳",type:"fighter",speed:350,fireRate:150,health:80,damage:20,scale:.7,color:"#dc2626",assetPath:"assets/planes/BF-109E/Type-1/BF109E.png",soundPath:"assets/sounds/fighter-engine.mp3",abilities:[{id:"speed-boost",name:"加速衝刺",description:"短時間內大幅提升速度",cooldown:8e3,effect:{type:"speed-boost",duration:3e3,multiplier:1.5}}]},{id:"biplane",name:"Biplane Fighter",displayName:"雙翼戰鬥機",description:"經典雙翼設計，操控靈活",type:"biplane",speed:200,fireRate:400,health:60,damage:15,scale:.6,color:"#d97706",assetPath:"assets/planes/Bipolar Plane/Type_1/Biploar_type1_5.png",soundPath:"assets/sounds/vintage-engine.mp3",abilities:[{id:"agile-maneuver",name:"敏捷機動",description:"提升機動性和閃避能力",cooldown:6e3,effect:{type:"speed-boost",duration:4e3,multiplier:1.3}}]},{id:"tbm3",name:"TBM-3 Avenger",displayName:"TBM-3 魚雷轟炸機",description:"美國海軍艦載轟炸機",type:"torpedo",speed:280,fireRate:250,health:120,damage:30,scale:.75,color:"#065f46",assetPath:"assets/planes/TBM3/Type_1/TBM-3.png",soundPath:"assets/sounds/naval-engine.mp3",abilities:[{id:"torpedo-strike",name:"魚雷攻擊",description:"發射威力強大的魚雷",cooldown:1e4,effect:{type:"damage-boost",duration:1e3,multiplier:3}}]},{id:"hawker",name:"Hawker Tempest MKII",displayName:"Hawker Tempest MKII",description:"英國高速戰鬥機",type:"fighter",speed:400,fireRate:100,health:90,damage:22,scale:.7,color:"#1e40af",assetPath:"assets/planes/Hawker Tempest MKII/Type_1/Hawker_type1.png",soundPath:"assets/sounds/british-engine.mp3",abilities:[{id:"rapid-fire",name:"快速射擊",description:"大幅提升射擊頻率",cooldown:7e3,effect:{type:"damage-boost",duration:5e3,multiplier:2}}]},{id:"ju87",name:"Junkers JU-87B2 Stuka",displayName:"JU-87B2 俯衝轟炸機",description:"德國俯衝轟炸機，精確打擊",type:"dive-bomber",speed:220,fireRate:350,health:100,damage:35,scale:.75,color:"#4a5568",assetPath:"assets/planes/JU-87B2/Type_1/JU87B2.png",soundPath:"assets/sounds/stuka-engine.mp3",abilities:[{id:"dive-bomb",name:"俯衝轟炸",description:"精確的俯衝攻擊",cooldown:8e3,effect:{type:"damage-boost",duration:2e3,multiplier:2.5}}]},{id:"blenheim",name:"Bristol Blenheim",displayName:"Blenheim 轟炸機",description:"英國雙引擎中型轟炸機",type:"bomber",speed:260,fireRate:280,health:110,damage:28,scale:.8,color:"#8b4513",assetPath:"assets/planes/Blenheim/Type_1/Blenheim.png",soundPath:"assets/sounds/twin-engine.mp3",abilities:[{id:"formation-strike",name:"編隊攻擊",description:"召喚僚機協同攻擊",cooldown:12e3,effect:{type:"multi-shot",duration:3e3,multiplier:2}}]}];class n extends e.GameObjects.Container{constructor(e,t){super(e,t.x,t.y),this.config={backgroundColor:2899536,borderColor:3426654,borderWidth:2,cornerRadius:10,alpha:.95,padding:15,titleStyle:{fontSize:"18px",color:"#3498db",fontFamily:"Arial",fontStyle:"bold"},...t},this.background=e.add.graphics(),this.add(this.background),this.config.title&&this.createTitle(),this.contentArea=e.add.container(0,this.config.title?30:0),this.add(this.contentArea),this.setSize(this.config.width,this.config.height),this.render(),e.add.existing(this)}createTitle(){this.config.title&&(this.titleText=this.scene.add.text(0,-this.config.height/2+this.config.padding,this.config.title,this.config.titleStyle),this.titleText.setOrigin(.5,0),this.add(this.titleText))}render(){this.background.clear(),this.background.fillStyle(this.config.backgroundColor,this.config.alpha),this.background.fillRoundedRect(-this.config.width/2,-this.config.height/2,this.config.width,this.config.height,this.config.cornerRadius),this.config.borderWidth>0&&(this.background.lineStyle(this.config.borderWidth,this.config.borderColor),this.background.strokeRoundedRect(-this.config.width/2,-this.config.height/2,this.config.width,this.config.height,this.config.cornerRadius)),this.config.title&&(this.background.lineStyle(1,this.config.borderColor,.5),this.background.lineBetween(-this.config.width/2+this.config.padding,-this.config.height/2+35,this.config.width/2-this.config.padding,-this.config.height/2+35))}addContent(e){return this.contentArea.add(e),this}removeContent(e){return this.contentArea.remove(e),this}clearContent(){return this.contentArea.removeAll(),this}setTitle(e){return this.config.title=e,this.titleText?this.titleText.setText(e):this.createTitle(),this.render(),this}setBackgroundColor(e,t){return this.config.backgroundColor=e,void 0!==t&&(this.config.alpha=t),this.render(),this}setBorderColor(e){return this.config.borderColor=e,this.render(),this}resize(e,t){return this.config.width=e,this.config.height=t,this.setSize(e,t),this.render(),this}getContentArea(){return this.contentArea}getContentBounds(){const e=this.config.title?40:0;return{x:-this.config.width/2+this.config.padding,y:-this.config.height/2+this.config.padding+e,width:this.config.width-2*this.config.padding,height:this.config.height-2*this.config.padding-e}}}const o={backgroundColor:2899536,borderColor:3426654,alpha:.95},r={backgroundColor:1710618,borderColor:3355443,alpha:.98};class h extends e.GameObjects.Container{constructor(e){super(e.scene,0,0),this.currentScore=0,this.currentHealth=100,this.maxHealth=100,this.scene=e.scene,this.selectedPlane=e.selectedPlane,this.maxHealth=e.selectedPlane.health,this.currentHealth=this.maxHealth,this.createHUD(),this.updateDisplay(),this.scene.add.existing(this),this.setScrollFactor(0)}createHUD(){const{width:e}=this.scene.cameras.main;this.scorePanel=new n(this.scene,{x:120,y:50,width:200,height:80,title:"🎯 分數",...o}),this.add(this.scorePanel),this.scoreText=this.scene.add.text(0,0,"0",{fontSize:"24px",color:"#f39c12",fontFamily:"Arial",fontStyle:"bold"}),this.scoreText.setOrigin(.5),this.scorePanel.addContent(this.scoreText),this.planeInfoPanel=new n(this.scene,{x:e-150,y:80,width:250,height:120,title:"✈️ 飛機資訊",...o}),this.add(this.planeInfoPanel),this.planeNameText=this.scene.add.text(0,-20,this.selectedPlane.displayName,{fontSize:"16px",color:"#3498db",fontFamily:"Arial",fontStyle:"bold"}),this.planeNameText.setOrigin(.5),this.planeInfoPanel.addContent(this.planeNameText),this.planeStatsText=this.scene.add.text(0,10,this.getPlaneStatsText(),{fontSize:"12px",color:"#ecf0f1",fontFamily:"Arial",align:"center"}),this.planeStatsText.setOrigin(.5),this.planeInfoPanel.addContent(this.planeStatsText),this.createHealthBar()}createHealthBar(){const{height:e}=this.scene.cameras.main,t=this.scene.add.graphics();t.fillStyle(2899536,.8),t.fillRoundedRect(20,e-60,200,30,5),t.lineStyle(2,3426654),t.strokeRoundedRect(20,e-60,200,30,5),this.add(t),this.healthBar=this.scene.add.graphics(),this.add(this.healthBar),this.healthText=this.scene.add.text(120,e-45,"HP: 100/100",{fontSize:"14px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}),this.healthText.setOrigin(.5),this.add(this.healthText);const s=this.scene.add.text(25,e-75,"❤️ 生命值",{fontSize:"12px",color:"#e74c3c",fontFamily:"Arial"});this.add(s)}getPlaneStatsText(){return[`速度: ${this.selectedPlane.speed}`,`射擊: ${this.selectedPlane.fireRate}ms`,`傷害: ${this.selectedPlane.damage}`].join("\n")}updateDisplay(){this.scoreText.setText(this.currentScore.toString()),this.updateHealthBar(),this.healthText.setText(`HP: ${this.currentHealth}/${this.maxHealth}`)}updateHealthBar(){const{height:e}=this.scene.cameras.main,t=this.currentHealth/this.maxHealth,s=196*t;this.healthBar.clear();let i=2600544;t<.6&&(i=15965202),t<.3&&(i=15158332),this.healthBar.fillStyle(i),this.healthBar.fillRoundedRect(22,e-58,s,26,3),t<.2?this.scene.tweens.add({targets:this.healthBar,alpha:.3,duration:300,yoyo:!0,repeat:-1}):(this.healthBar.setAlpha(1),this.scene.tweens.killTweensOf(this.healthBar))}updateScore(e){const t=this.currentScore;this.currentScore=e,e>t?(this.scene.tweens.add({targets:this.scoreText,scaleX:1.3,scaleY:1.3,duration:150,yoyo:!0,ease:"Power2"}),this.scene.tweens.add({targets:{value:t},value:e,duration:500,onUpdate:e=>{this.scoreText.setText(Math.floor(e.getValue()||0).toString())}})):this.updateDisplay()}updateHealth(e){const t=this.currentHealth;if(this.currentHealth=Math.max(0,Math.min(e,this.maxHealth)),this.currentHealth<t){this.scene.cameras.main.shake(200,.01);const e=this.scene.add.rectangle(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2,this.scene.cameras.main.width,this.scene.cameras.main.height,16711680,.3);e.setScrollFactor(0),this.scene.tweens.add({targets:e,alpha:0,duration:300,onComplete:()=>e.destroy()})}this.updateDisplay()}setPlane(e){this.selectedPlane=e,this.maxHealth=e.health,this.currentHealth=this.maxHealth,this.planeNameText.setText(e.displayName),this.planeStatsText.setText(this.getPlaneStatsText()),this.updateDisplay()}showMessage(e,t=2e3){const{width:s,height:i}=this.scene.cameras.main,a=this.scene.add.text(s/2,i/2-100,e,{fontSize:"32px",color:"#f39c12",fontFamily:"Arial",fontStyle:"bold",stroke:"#2c3e50",strokeThickness:4});a.setOrigin(.5),a.setScrollFactor(0),a.setAlpha(0),this.scene.tweens.add({targets:a,alpha:1,scaleX:1.2,scaleY:1.2,duration:300,ease:"Back.easeOut"}),this.scene.time.delayedCall(t,()=>{this.scene.tweens.add({targets:a,alpha:0,scaleX:.8,scaleY:.8,duration:300,onComplete:()=>a.destroy()})})}getCurrentScore(){return this.currentScore}getCurrentHealth(){return this.currentHealth}isHealthLow(){return this.currentHealth/this.maxHealth<.3}}class l extends e.Scene{constructor(){super({key:b.GAME}),this.score=0,this.gameOver=!1,this.bulletTime=0,this.playerHealth=100}init(){console.log("🎮 GameScene: 初始化遊戲場景"),this.selectedPlane={id:"shooter",name:"Shooter",displayName:"射手",description:"高科技射手，火力強大",type:"shooter",speed:350,fireRate:180,health:120,damage:35,scale:1,color:"#ffffff"},console.log(`🎯 使用射手: ${this.selectedPlane.displayName}`)}create(){this.cameras.main,this.planeManager=t.getInstance(this),this.inputManager=new i(this),this.createParallaxBackground(),this.createPlayer(),this.createGroups(),this.createGameHUD(),this.setupInput(),this.setupPhysics(),this.startEnemySpawning(),console.log("🎯 遊戲場景創建完成")}update(e,t){this.gameOver||(this.updateParallaxBackground(),this.inputManager.update(),this.handlePlayerMovement(),this.handleShooting(e),this.cleanupObjects())}createPlayer(){const{height:e}=this.cameras.main;this.player=this.planeManager.createPlaneSprite(this,this.selectedPlane),this.player.setPosition(f.PLAYER.START_X,e/2);const t=`shooter-${this.selectedPlane.id}`;this.anims.exists(t)&&this.player.play(t),console.log(`🎯 創建射手: ${this.selectedPlane.displayName}`),this.physics.add.existing(this.player);const s=this.player.body;s.setCollideWorldBounds(!0),s.setDrag(f.PLAYER.DRAG),s.setMaxVelocity(this.selectedPlane.speed)}createGroups(){this.bullets=this.physics.add.group({defaultKey:"bullet-placeholder",maxSize:f.BULLET.MAX_BULLETS}),this.enemies=this.physics.add.group({defaultKey:"cloud-enemy"})}createGameHUD(){this.gameHUD=new h({scene:this,selectedPlane:this.selectedPlane}),this.playerHealth=this.selectedPlane.health}setupInput(){this.inputManager.on("restart-game",()=>{this.gameOver&&this.restartGame()}),this.inputManager.on("fire-weapon",()=>{})}setupPhysics(){this.physics.add.overlap(this.bullets,this.enemies,(e,t)=>{this.hitEnemy(e,t)}),this.physics.add.overlap(this.player,this.enemies,(e,t)=>{this.hitPlayer(t)})}startEnemySpawning(){this.enemyTimer=this.time.addEvent({delay:f.ENEMY.SPAWN_RATE,callback:this.spawnEnemy,callbackScope:this,loop:!0})}handlePlayerMovement(){const e=this.player.body,t=this.inputManager.getMovementVector();e.setAcceleration(t.x*f.PLAYER.ACCELERATION,t.y*f.PLAYER.ACCELERATION)}handleShooting(e){this.inputManager.isActionPressed("fire")&&e>this.bulletTime&&(this.fireBullet(),this.bulletTime=e+this.selectedPlane.fireRate)}fireBullet(){const e=this.bullets.get(this.player.x+30,this.player.y);if(e){e.setActive(!0),e.setVisible(!0);e.body.setVelocityX(f.BULLET.SPEED)}}spawnEnemy(){const t=e.Math.Between(f.ENEMY.MIN_Y,f.ENEMY.MAX_Y),s=this.enemies.create(f.ENEMY.SPAWN_X,t,"cloud-enemy"),i=s.body;s.setScale(.8),s.setTint(16777215);const a=e.Math.Between(f.ENEMY.MIN_SPEED,f.ENEMY.MAX_SPEED);i.setVelocityX(-a),console.log("☁️ 生成雲朵敵人")}hitEnemy(e,t){e.setActive(!1),e.setVisible(!1),t.destroy(),this.score+=10,this.gameHUD.updateScore(this.score),console.log(`💥 擊散雲朵！分數: ${this.score}`)}hitPlayer(e){console.log("💥 玩家被擊中！"),e.destroy(),this.playerHealth-=20,this.gameHUD.updateHealth(this.playerHealth),this.playerHealth<=0?(this.gameOver=!0,this.enemyTimer.destroy(),this.showGameOver()):this.gameHUD.showMessage("受到傷害！",1e3)}showGameOver(){const{width:e,height:t}=this.cameras.main;this.add.rectangle(e/2,t/2,e,t,0,.7),this.add.text(e/2,t/2-50,"遊戲結束",{fontSize:"48px",color:"#e74c3c",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5),this.add.text(e/2,t/2,`最終分數: ${this.score}`,{fontSize:"24px",color:"#ecf0f1",fontFamily:"Arial"}).setOrigin(.5),this.add.text(e/2,t/2+50,"按 R 鍵重新開始",{fontSize:"18px",color:"#3498db",fontFamily:"Arial"}).setOrigin(.5)}cleanupObjects(){const{width:e}=this.cameras.main;this.bullets.children.entries.forEach(t=>{const s=t;s.x>e+50&&(s.setActive(!1),s.setVisible(!1))}),this.enemies.children.entries.forEach(e=>{const t=e;t.x<-50&&t.destroy()})}restartGame(){console.log("🔄 重新開始遊戲"),this.scene.restart()}createParallaxBackground(){const{width:e,height:t}=this.cameras.main;console.log("🌙 創建月球視差背景"),this.backgroundLayers={sky:this.add.tileSprite(0,0,e,t,"moon-sky").setOrigin(0,0),earth:this.add.tileSprite(0,0,e,t,"moon-earth").setOrigin(0,0),back:this.add.tileSprite(0,0,e,t,"moon-back").setOrigin(0,0),mid:this.add.tileSprite(0,0,e,t,"moon-mid").setOrigin(0,0),front:this.add.tileSprite(0,0,e,t,"moon-front").setOrigin(0,0),floor:this.add.tileSprite(0,0,e,t,"moon-floor").setOrigin(0,0)},this.backgroundLayers.sky.setDepth(-100),this.backgroundLayers.earth.setDepth(-95),this.backgroundLayers.back.setDepth(-90),this.backgroundLayers.mid.setDepth(-85),this.backgroundLayers.front.setDepth(-80),this.backgroundLayers.floor.setDepth(-75),this.backgroundLayers.earth.setAlpha(1),this.backgroundLayers.earth.setVisible(!0),this.backgroundLayers.earth.setTint(16777215),this.backgroundLayers.earth.setScrollFactor(.1),console.log("🌍 地球層設置: 可見度=",this.backgroundLayers.earth.visible,", 透明度=",this.backgroundLayers.earth.alpha),console.log("🔍 地球層詳細信息:",{textureKey:this.backgroundLayers.earth.texture.key,width:this.backgroundLayers.earth.width,height:this.backgroundLayers.earth.height,x:this.backgroundLayers.earth.x,y:this.backgroundLayers.earth.y,depth:this.backgroundLayers.earth.depth,tileScaleX:this.backgroundLayers.earth.tileScaleX,tileScaleY:this.backgroundLayers.earth.tileScaleY}),console.log("✅ 月球視差背景創建完成")}updateParallaxBackground(){this.backgroundLayers&&(this.backgroundLayers.sky.tilePositionX+=.05,this.backgroundLayers.earth.tilePositionX+=.2,this.backgroundLayers.back.tilePositionX+=.3,this.backgroundLayers.mid.tilePositionX+=.5,this.backgroundLayers.front.tilePositionX+=.7,this.backgroundLayers.floor.tilePositionX+=1)}}class c extends e.GameObjects.Container{constructor(e,t){super(e,t.x,t.y),this.isHovered=!1,this.isPressed=!1,this.isDisabled=!1,this.config={backgroundColor:3447003,borderColor:2719929,borderWidth:2,cornerRadius:8,hoverColor:2719929,pressedColor:2051705,disabled:!1,style:{fontSize:"16px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"},...t},this.isDisabled=this.config.disabled||!1,this.background=e.add.graphics(),this.add(this.background),this.label=e.add.text(0,0,this.config.text,this.config.style),this.label.setOrigin(.5),this.add(this.label),this.setSize(this.config.width,this.config.height),this.setInteractive(),this.setupEvents(),this.render(),e.add.existing(this)}setupEvents(){this.isDisabled||(this.on("pointerover",this.onPointerOver,this),this.on("pointerout",this.onPointerOut,this),this.on("pointerdown",this.onPointerDown,this),this.on("pointerup",this.onPointerUp,this),this.on("pointerupoutside",this.onPointerUp,this))}onPointerOver(){this.isDisabled||(this.isHovered=!0,this.render(),this.setScale(1.05),this.scene.sound.play("ui-hover",{volume:.3}))}onPointerOut(){this.isDisabled||(this.isHovered=!1,this.isPressed=!1,this.render(),this.setScale(1))}onPointerDown(){this.isDisabled||(this.isPressed=!0,this.render(),this.setScale(.95),this.scene.sound.play("ui-click",{volume:.5}))}onPointerUp(){this.isDisabled||(this.isPressed&&this.emit("click"),this.isPressed=!1,this.render(),this.setScale(this.isHovered?1.05:1))}render(){this.background.clear();let e=this.config.backgroundColor;this.isDisabled?e=8359053:this.isPressed?e=this.config.pressedColor:this.isHovered&&(e=this.config.hoverColor),this.background.fillStyle(e),this.background.fillRoundedRect(-this.config.width/2,-this.config.height/2,this.config.width,this.config.height,this.config.cornerRadius),this.config.borderWidth>0&&(this.background.lineStyle(this.config.borderWidth,this.config.borderColor),this.background.strokeRoundedRect(-this.config.width/2,-this.config.height/2,this.config.width,this.config.height,this.config.cornerRadius)),this.isDisabled?this.label.setColor("#bdc3c7"):this.label.setColor(this.config.style?.color||"#ffffff")}setText(e){return this.label.setText(e),this}setEnabled(e){return this.isDisabled=!e,this.isDisabled?(this.removeInteractive(),this.setScale(1)):this.setInteractive(),this.render(),this}setStyle(e){return this.label.setStyle(e),this}setBackgroundColor(e){return this.config.backgroundColor=e,this.render(),this}setHoverColor(e){return this.config.hoverColor=e,this}setPressedColor(e){return this.config.pressedColor=e,this}isButtonDisabled(){return this.isDisabled}destroy(e){this.removeAllListeners(),super.destroy(e)}}const d={backgroundColor:3447003,hoverColor:2719929,pressedColor:2051705,borderColor:2719929},p={backgroundColor:9807270,hoverColor:8359053,pressedColor:7109501,borderColor:8359053};class g extends e.GameObjects.Container{constructor(e,t){super(e,t.x,t.y),this.planeButtons=[],this.selectedIndex=0,this.planeGraphics=new Map,this.config={columns:4,spacing:10,...t},this.planeRenderer=new s(e),this.backgroundPanel=new n(e,{x:0,y:0,width:this.config.width,height:this.config.height,title:"🛩️ 選擇您的飛機",...o}),this.add(this.backgroundPanel),this.createPlaneButtons(),this.selectPlane(0),e.add.existing(this)}createPlaneButtons(){const e=this.backgroundPanel.getContentBounds(),t=(e.width-(this.config.columns-1)*this.config.spacing)/this.config.columns,s=Math.ceil(this.config.planes.length/this.config.columns),i=80*s+(s-1)*this.config.spacing,a=e.y+(e.height-i)/2;this.config.planes.forEach((s,i)=>{const n=Math.floor(i/this.config.columns),o=i%this.config.columns,r=e.x+o*(t+this.config.spacing)+t/2,h=a+n*(80+this.config.spacing)+40,l=this.scene.add.graphics();this.planeRenderer.renderPlane(l,s),l.setScale(.6),this.planeGraphics.set(s.id,l);const d=new c(this.scene,{x:r,y:h,width:t,height:80,text:"",...p});d.add(l),l.setPosition(0,-10);const g=this.scene.add.text(0,25,s.displayName,{fontSize:"12px",color:"#ecf0f1",fontFamily:"Arial",align:"center"});g.setOrigin(.5),d.add(g),d.on("click",()=>{this.selectPlane(i),this.emit("plane-selected",s,i)}),this.planeButtons.push(d),this.backgroundPanel.addContent(d)})}selectPlane(e){e<0||e>=this.config.planes.length||(this.planeButtons[this.selectedIndex]&&this.planeButtons[this.selectedIndex].setBackgroundColor(p.backgroundColor),this.selectedIndex=e,this.planeButtons[this.selectedIndex]&&this.planeButtons[this.selectedIndex].setBackgroundColor(d.backgroundColor),console.log(`✈️ 選擇飛機: ${this.config.planes[e].displayName}`))}getSelectedPlane(){return this.config.planes[this.selectedIndex]}getSelectedIndex(){return this.selectedIndex}setPlanes(e){this.config.planes=e,this.planeButtons.forEach(e=>e.destroy()),this.planeButtons=[],this.planeGraphics.clear(),this.backgroundPanel.clearContent(),this.createPlaneButtons(),this.selectPlane(0)}setEnabled(e){this.planeButtons.forEach(t=>{t.setEnabled(e)})}highlightPlane(e,t=1e3){if(e<0||e>=this.planeButtons.length)return;const s=this.planeButtons[e],i=s.scaleX;this.scene.tweens.add({targets:s,scaleX:1.2*i,scaleY:1.2*i,duration:200,yoyo:!0,repeat:2,ease:"Power2"});const a=p.backgroundColor;this.scene.tweens.add({targets:{color:a},color:15965202,duration:100,yoyo:!0,repeat:4,onUpdate:e=>{s.setBackgroundColor(Math.floor(e.getValue()||0))},onComplete:()=>{e!==this.selectedIndex&&s.setBackgroundColor(a)}})}animateIn(){this.setAlpha(0),this.setScale(.8),this.scene.tweens.add({targets:this,alpha:1,scaleX:1,scaleY:1,duration:500,ease:"Back.easeOut"}),this.planeButtons.forEach((e,t)=>{e.setAlpha(0),e.setScale(0),this.scene.tweens.add({targets:e,alpha:1,scaleX:1,scaleY:1,duration:300,delay:50*t,ease:"Back.easeOut"})})}animateOut(){return new Promise(e=>{this.scene.tweens.add({targets:this,alpha:0,scaleX:.8,scaleY:.8,duration:300,ease:"Power2.easeIn",onComplete:()=>e()})})}destroy(e){this.planeButtons.forEach(e=>e.destroy()),this.planeGraphics.forEach(e=>e.destroy()),this.planeGraphics.clear(),this.planeRenderer.destroy(),super.destroy(e)}}class u extends e.Scene{constructor(){super({key:b.MENU}),this.selectedPlaneIndex=0}create(){console.log("🎮 MenuScene: 創建選單場景");const{width:e,height:t}=this.cameras.main;this.add.image(e/2,t/2,"background-placeholder"),this.createTitle(),this.createDirectStartButton()}createDirectStartButton(){const{width:e,height:t}=this.cameras.main,s=this.add.rectangle(e/2,t/2,300,80,5025616).setInteractive().setStrokeStyle(3,4563017),i=this.add.text(e/2,t/2,"🎯 開始射手冒險",{fontSize:"24px",color:"#ffffff",fontFamily:"Arial"}).setOrigin(.5);s.on("pointerover",()=>{s.setFillStyle(4563017),i.setScale(1.1)}),s.on("pointerout",()=>{s.setFillStyle(5025616),i.setScale(1)}),s.on("pointerdown",()=>{console.log("🎯 直接開始射手遊戲"),this.scene.start(b.GAME)})}createTitle(){const{width:e}=this.cameras.main;this.add.text(e/2,60,"� 太空梭森林冒險",{fontSize:"36px",color:"#2c3e50",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5),this.add.text(e/2+2,62,"� 太空梭森林冒險",{fontSize:"36px",color:"#34495e",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5).setDepth(-1),this.add.text(e/2,100,"駕駛太空梭穿越神秘森林",{fontSize:"18px",color:"#7f8c8d",fontFamily:"Arial"}).setOrigin(.5)}createModernPlaneSelector(){const{width:e,height:t}=this.cameras.main;this.planeSelector=new g(this,{x:e/2,y:t/2-20,width:600,height:200,planes:a,columns:4,spacing:10}),this.planeSelector.on("plane-selected",(e,t)=>{this.selectedPlaneIndex=t,this.planeManager.setCurrentPlane(e.id),this.updatePlaneDetailPanel(e)})}createPlaneDetailPanel(){const{width:e,height:t}=this.cameras.main;this.planeDetailPanel=new n(this,{x:e/2,y:t-120,width:500,height:100,title:"✈️ 飛機詳細資訊",...r}),this.updatePlaneDetailPanel(a[0])}updatePlaneDetailPanel(e){this.planeDetailPanel.clearContent();const t=this.add.text(0,-20,e.displayName,{fontSize:"18px",color:"#3498db",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5),s=this.add.text(0,0,e.description,{fontSize:"14px",color:"#ecf0f1",fontFamily:"Arial",align:"center"}).setOrigin(.5),i=this.add.text(0,20,`速度: ${e.speed} | 射擊: ${e.fireRate}ms | 生命: ${e.health} | 傷害: ${e.damage}`,{fontSize:"12px",color:"#f39c12",fontFamily:"Arial"}).setOrigin(.5);this.planeDetailPanel.addContent(t),this.planeDetailPanel.addContent(s),this.planeDetailPanel.addContent(i)}createModernStartButton(){const{width:e,height:t}=this.cameras.main,s=this.add.rectangle(e/2,t-50,200,50,15158332).setStrokeStyle(2,12597547),i=this.add.text(e/2,t-50,"🚀 開始遊戲",{fontSize:"20px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);s.setInteractive().on("pointerdown",()=>this.startGame()).on("pointerover",()=>{s.setFillStyle(12597547),s.setScale(1.1),i.setScale(1.1)}).on("pointerout",()=>{s.setFillStyle(15158332),s.setScale(1),i.setScale(1)})}playEntranceAnimation(){this.planeSelector.animateIn(),this.planeDetailPanel.setAlpha(0),this.planeDetailPanel.setY(this.planeDetailPanel.y+50),this.tweens.add({targets:this.planeDetailPanel,alpha:1,y:this.planeDetailPanel.y-50,duration:600,delay:300,ease:"Power2.easeOut"})}onPlaneSelected(e){console.log("飛機選擇事件:",e)}startGame(){console.log(`🚀 開始遊戲，使用飛機: ${a[this.selectedPlaneIndex].displayName}`),this.scene.start(b.GAME,{selectedPlane:a[this.selectedPlaneIndex]})}}class m extends e.Scene{constructor(){super({key:b.LOADING})}preload(){console.log("📦 LoadingScene: 開始載入資源"),this.createLoadingUI(),this.setupLoadingEvents(),this.loadBasicAssets()}create(){console.log("✅ LoadingScene: 資源載入完成"),this.time.delayedCall(1e3,()=>{this.scene.start(b.MENU)})}createLoadingUI(){const{width:e,height:t}=this.cameras.main;this.add.rectangle(e/2,t/2,e,t,2899536),this.add.text(e/2,t/2-100,"🛩️ Phaser 3 飛機選擇器",{fontSize:"32px",color:"#3498db",fontFamily:"Arial"}).setOrigin(.5),this.loadingText=this.add.text(e/2,t/2+50,"載入中...",{fontSize:"18px",color:"#ecf0f1",fontFamily:"Arial"}).setOrigin(.5),this.progressBox=this.add.graphics(),this.progressBox.fillStyle(3426654),this.progressBox.fillRect(e/2-160,t/2+80,320,20),this.progressBar=this.add.graphics()}setupLoadingEvents(){this.load.on("progress",e=>{this.updateProgressBar(e),this.loadingText.setText(`載入中... ${Math.round(100*e)}%`)}),this.load.on("complete",()=>{this.loadingText.setText("載入完成！"),console.log("📦 所有資源載入完成")}),this.load.on("loaderror",e=>{console.error("❌ 資源載入失敗:",e.key),this.loadingText.setText(`載入失敗: ${e.key}`)})}updateProgressBar(e){const{width:t,height:s}=this.cameras.main;this.progressBar.clear(),this.progressBar.fillStyle(3447003),this.progressBar.fillRect(t/2-158,s/2+82,316*e,16)}loadBasicAssets(){this.loadPlaneAssets(),this.load.image("plane-placeholder",this.createPlaneTexture()),this.load.image("bullet-placeholder",this.createBulletTexture()),this.load.image("enemy-placeholder",this.createEnemyTexture()),this.load.image("background-placeholder",this.createBackgroundTexture());for(let e=0;e<10;e++)this.load.image(`dummy-${e}`,this.createDummyTexture())}loadPlaneAssets(){console.log("🛩️ 開始載入真實飛機圖片...");try{this.load.image(S.PLANES.B17,"assets/planes/b17.png"),this.load.image(S.PLANES.BF109,"assets/planes/bf109.png"),this.load.image(S.PLANES.BIPLANE,"assets/planes/biplane.png"),this.load.image(S.PLANES.TBM3,"assets/planes/tbm3.png"),this.load.image(S.PLANES.HAWKER,"assets/planes/hawker.png"),this.load.image(S.PLANES.JU87,"assets/planes/ju87.png"),this.load.image(S.PLANES.BLENHEIM,"assets/planes/blenheim.png"),this.load.image("cloud-enemy","assets/cloud-enemy.png"),this.load.image("moon-sky","assets/backgrounds/moon_sky.png"),this.load.image("moon-earth","assets/backgrounds/moon_earth.png"),this.load.image("moon-back","assets/backgrounds/moon_back.png"),this.load.image("moon-mid","assets/backgrounds/moon_mid.png"),this.load.image("moon-front","assets/backgrounds/moon_front.png"),this.load.image("moon-floor","assets/backgrounds/moon_floor.png"),this.load.spritesheet("shooter-sprite","assets/shooter-sprite.png",{frameWidth:635,frameHeight:218}),console.log("✅ 雲朵敵人、月球視差背景和射手精靈載入配置完成")}catch(e){console.error("❌ 資源載入配置失敗:",e)}}createPlaneTexture(){const e=document.createElement("canvas");e.width=64,e.height=64;const t=e.getContext("2d");return t.fillStyle="#3498db",t.beginPath(),t.moveTo(32,10),t.lineTo(20,40),t.lineTo(32,35),t.lineTo(44,40),t.closePath(),t.fill(),t.fillStyle="#2980b9",t.fillRect(15,25,34,8),e.toDataURL()}createBulletTexture(){const e=document.createElement("canvas");e.width=8,e.height=16;const t=e.getContext("2d");return t.fillStyle="#f39c12",t.fillRect(2,0,4,16),e.toDataURL()}createEnemyTexture(){const e=document.createElement("canvas");e.width=48,e.height=48;const t=e.getContext("2d");return t.fillStyle="#e74c3c",t.beginPath(),t.moveTo(24,38),t.lineTo(12,8),t.lineTo(24,13),t.lineTo(36,8),t.closePath(),t.fill(),t.fillStyle="#c0392b",t.fillRect(8,18,32,6),e.toDataURL()}createBackgroundTexture(){const e=document.createElement("canvas");e.width=f.SCREEN.WIDTH,e.height=f.SCREEN.HEIGHT;const t=e.getContext("2d"),s=t.createLinearGradient(0,0,0,e.height);return s.addColorStop(0,"#87CEEB"),s.addColorStop(1,"#4682B4"),t.fillStyle=s,t.fillRect(0,0,e.width,e.height),console.log("🌤️ 創建純天空背景，雲朵將作為敵人出現"),e.toDataURL()}createDummyTexture(){const e=document.createElement("canvas");e.width=32,e.height=32;const t=e.getContext("2d");return t.fillStyle="#95a5a6",t.fillRect(0,0,32,32),e.toDataURL()}}const f={SCREEN:{WIDTH:1200,HEIGHT:900,BACKGROUND_COLOR:"#2c3e50"},PHYSICS:{GRAVITY_Y:0,DEBUG:!1},PLAYER:{START_X:150,START_Y:450,MAX_SPEED:400,ACCELERATION:800,DRAG:600},ENEMY:{SPAWN_RATE:2e3,MIN_SPEED:100,MAX_SPEED:300,SPAWN_X:1250,MIN_Y:75,MAX_Y:825},BULLET:{SPEED:600,FIRE_RATE:250,MAX_BULLETS:20},UI:{FONT_FAMILY:"Arial",FONT_SIZE:24,SCORE_COLOR:"#ffffff",HUD_PADDING:20}},y={type:e.AUTO,width:f.SCREEN.WIDTH,height:f.SCREEN.HEIGHT,parent:"game-container",backgroundColor:f.SCREEN.BACKGROUND_COLOR,scene:[m,u,l],physics:{default:"arcade",arcade:{gravity:{x:0,y:f.PHYSICS.GRAVITY_Y},debug:f.PHYSICS.DEBUG}},input:{keyboard:!0,mouse:!0,touch:!0},render:{antialias:!0,pixelArt:!1,roundPixels:!1},audio:{disableWebAudio:!1},scale:{mode:e.Scale.NONE,autoCenter:e.Scale.NO_CENTER,width:1200,height:900}},b={LOADING:"LoadingScene",MENU:"MenuScene",GAME:"GameScene"},S={PLANES:{B17:"plane-b17",BF109:"plane-bf109",BIPLANE:"plane-biplane",TBM3:"plane-tbm3",HAWKER:"plane-hawker",JU87:"plane-ju87",BLENHEIM:"plane-blenheim"},SOUNDS:{SHOOT:"sound-shoot",EXPLOSION:"sound-explosion",ENGINE:"sound-engine",SELECT:"sound-select"},UI:{BUTTON:"ui-button",PANEL:"ui-panel",SELECTOR:"ui-selector"}},P={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT",FIRE:"SPACE",RESTART:"R",PLANE_1:"ONE",PLANE_2:"TWO",PLANE_3:"THREE",PLANE_4:"FOUR",PLANE_5:"FIVE",PLANE_6:"SIX",PLANE_7:"SEVEN"},E={PLANE_SELECTED:"plane-selected",SCORE_UPDATED:"score-updated",GAME_OVER:"game-over",ENEMY_DESTROYED:"enemy-destroyed",PLAYER_HIT:"player-hit"};export{a as A,E as G,S as a,f as b,y as p};
//# sourceMappingURL=game-b51d85e0.js.map
