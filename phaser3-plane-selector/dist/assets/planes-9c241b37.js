import{A as e,G as t,a as l}from"./game-b51d85e0.js";const r=class r{constructor(e){this.currentPlaneId="b17",this.planes=new Map,this.eventEmitter=new Phaser.Events.EventEmitter,this.initializePlanes()}initializePlanes(){e.forEach(e=>{this.validatePlaneConfig(e)?this.planes.set(e.id,e):console.warn(`⚠️ 飛機配置驗證失敗: ${e.id}`)}),console.log(`✅ 飛機管理器初始化完成，載入 ${this.planes.size} 架飛機`)}validatePlaneConfig(e){return e.id&&e.name&&e.displayName?e.speed<=0||e.fireRate<=0||e.health<=0?(console.error("❌ 飛機配置數值無效:",e),!1):e.scale<=0||e.scale>3?(console.error("❌ 飛機縮放比例無效:",e),!1):!!e.color.match(/^#[0-9A-Fa-f]{6}$/)||(console.error("❌ 飛機顏色格式無效:",e),!1):(console.error("❌ 飛機配置缺少必要欄位:",e),!1)}getCurrentPlane(){const t=this.planes.get(this.currentPlaneId);return t||(console.error(`❌ 找不到當前飛機: ${this.currentPlaneId}`),this.planes.values().next().value||e[0])}setCurrentPlane(e){const l=this.getCurrentPlane();if(!this.planes.has(e))return void console.error(`❌ 飛機不存在: ${e}`);this.currentPlaneId=e;const r=this.getCurrentPlane(),a={previousPlane:l,currentPlane:r,timestamp:Date.now()};this.eventEmitter.emit(t.PLANE_SELECTED,a),console.log(`✈️ 切換飛機: ${l.displayName} → ${r.displayName}`)}getAllPlanes(){return Array.from(this.planes.values())}getPlaneById(e){return this.planes.get(e)||null}getPlanesByType(e){return this.getAllPlanes().filter(t=>t.type===e)}createPlaneSprite(e,t){const l=e.add.sprite(0,0,"shooter-sprite",0),r=.5*t.scale*.5;return l.setRotation(Math.PI),l.setScale(r,-r),l.setData("planeConfig",t),l.setData("planeId",t.id),this.createShooterAnimation(e,t.id),console.log(`🎯 射手設置: ${t.displayName} - 縮放: ${r}, 旋轉: 180度, 上下翻轉, 4幀動畫`),l}createShooterAnimation(e,t){const l=`shooter-${t}`;e.anims.exists(l)||(e.anims.create({key:l,frames:e.anims.generateFrameNumbers("shooter-sprite",{start:0,end:3}),frameRate:8,repeat:-1}),console.log(`🎬 創建射手動畫: ${l} (4幀循環)`))}getPlaneTextureKey(e){return{b17:l.PLANES.B17,bf109:l.PLANES.BF109,biplane:l.PLANES.BIPLANE,tbm3:l.PLANES.TBM3,hawker:l.PLANES.HAWKER,ju87:l.PLANES.JU87,blenheim:l.PLANES.BLENHEIM}[e.id]||"plane-placeholder"}getPlaneStats(e){const t=this.getPlaneById(e);return t?{id:t.id,name:t.displayName,type:t.type,performance:{speed:t.speed,fireRate:t.fireRate,health:t.health,damage:t.damage},abilities:t.abilities||[]}:null}getRecommendedPlane(e){const t=this.getAllPlanes();switch(e){case"aggressive":return t.reduce((e,t)=>t.speed+t.damage>e.speed+e.damage?t:e);case"defensive":return t.reduce((e,t)=>t.health+(1e3-t.fireRate)>e.health+(1e3-e.fireRate)?t:e);default:return t.reduce((e,t)=>(t.speed+t.health+t.damage)/3>(e.speed+e.health+e.damage)/3?t:e)}}on(e,t,l){this.eventEmitter.on(e,t,l)}off(e,t,l){this.eventEmitter.off(e,t,l)}emit(e,...t){this.eventEmitter.emit(e,...t)}destroy(){this.eventEmitter.removeAllListeners(),this.planes.clear()}static getInstance(e){return r.instance||(r.instance=new r(e)),r.instance}static destroyInstance(){r.instance&&(r.instance.destroy(),r.instance=null)}};r.instance=null;let a=r;class n{constructor(e){this.textureCache=new Map}renderPlane(e,t){e.clear();const l={width:64,height:64,centerX:32,centerY:32,colors:this.getPlaneColors(t)};switch(t.id){case"b17":this.renderB17(e,l);break;case"bf109":this.renderBF109(e,l);break;case"biplane":this.renderBiplane(e,l);break;case"tbm3":this.renderTBM3(e,l);break;case"hawker":this.renderHawker(e,l);break;case"ju87":this.renderJU87(e,l);break;case"blenheim":this.renderBlenheim(e,l);break;default:this.renderDefaultPlane(e,l)}}createPlaneTexture(e,t){const l=`plane-texture-${t.id}`;if(this.textureCache.has(l))return this.textureCache.get(l);const r=e.add.renderTexture(0,0,64,64),a=e.add.graphics();this.renderPlane(a,t),r.draw(a);const n=r.saveTexture(l);return a.destroy(),r.destroy(),this.textureCache.set(l,n),n}updatePlaneGraphics(e,t){this.renderPlane(e,t)}getPlaneColors(e){const t=e.color;return{primary:t,secondary:this.darkenColor(t,.2),accent:this.lightenColor(t,.3),detail:"#374151"}}darkenColor(e,t){const l=e.replace("#",""),r=Math.max(0,parseInt(l.substr(0,2),16)*(1-t)),a=Math.max(0,parseInt(l.substr(2,2),16)*(1-t)),n=Math.max(0,parseInt(l.substr(4,2),16)*(1-t));return`#${Math.round(r).toString(16).padStart(2,"0")}${Math.round(a).toString(16).padStart(2,"0")}${Math.round(n).toString(16).padStart(2,"0")}`}lightenColor(e,t){const l=e.replace("#",""),r=Math.min(255,parseInt(l.substr(0,2),16)+255*t),a=Math.min(255,parseInt(l.substr(2,2),16)+255*t),n=Math.min(255,parseInt(l.substr(4,2),16)+255*t);return`#${Math.round(r).toString(16).padStart(2,"0")}${Math.round(a).toString(16).padStart(2,"0")}${Math.round(n).toString(16).padStart(2,"0")}`}renderB17(e,t){const{centerX:l,centerY:r,colors:a}=t;e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillRoundedRect(l-4,r-20,8,40,2),e.fillStyle(parseInt(a.accent.replace("#","0x"))),e.fillRoundedRect(l-5,r-10,10,20,1.5),e.fillStyle(parseInt(a.secondary.replace("#","0x")));for(let n=-18;n<18;n+=4)e.fillRect(l-3,r+n,6,1);e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.beginPath(),e.moveTo(l-20,r-4),e.lineTo(l-18,r-6),e.lineTo(l+18,r-6),e.lineTo(l+20,r-4),e.lineTo(l+18,r+4),e.lineTo(l-18,r+4),e.closePath(),e.fillPath(),e.fillStyle(parseInt(a.accent.replace("#","0x"))),e.beginPath(),e.moveTo(l-18,r-5),e.lineTo(l+18,r-5),e.lineTo(l+15,r+3),e.lineTo(l-15,r+3),e.closePath(),e.fillPath();[-14,-7,7,14].forEach(t=>{e.fillStyle(parseInt(a.detail.replace("#","0x"))),e.fillRoundedRect(l+t-2,r-3,4,6,1),e.fillStyle(1120295),e.fillEllipse(l+t,r-4,1.5,1),e.lineStyle(1,16498468),e.strokeEllipse(l+t,r-5,3,.5),e.strokeEllipse(l+t,r-5,.5,3)}),e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillTriangle(l,r-23,l-4,r-18,l+4,r-18),e.fillStyle(9684477,.8),e.fillRoundedRect(l-2.5,r-13,5,8,1.5),e.lineStyle(.5,parseInt(a.detail.replace("#","0x"))),e.strokeRoundedRect(l-2.5,r-13,5,8,1.5),e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillTriangle(l,r+18,l-3,r+23,l+3,r+23),e.fillStyle(parseInt(a.secondary.replace("#","0x"))),e.fillRoundedRect(l-6,r+16,12,3,1),e.fillStyle(9684477,.6);[-8,-3,3,8].forEach(t=>{e.fillEllipse(l+3.5,r+t,1,1.5),e.fillEllipse(l-3.5,r+t,1,1.5)})}renderBF109(e,t){const{centerX:l,centerY:r,colors:a}=t;e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillEllipse(l,r,6,35),e.fillStyle(parseInt(a.secondary.replace("#","0x"))),e.fillEllipse(l,r-2,32,8),e.fillStyle(parseInt(a.detail.replace("#","0x"))),e.fillCircle(l,r-20,4),e.lineStyle(2,parseInt(a.accent.replace("#","0x"))),e.strokeCircle(l,r-24,6),e.fillStyle(9684477,.8),e.fillEllipse(l,r-8,4,8)}renderBiplane(e,t){const{centerX:l,centerY:r,colors:a}=t;e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillRoundedRect(l-2,r-15,4,30,2),e.fillStyle(parseInt(a.secondary.replace("#","0x"))),e.fillRect(l-15,r-10,30,4),e.fillRect(l-15,r+4,30,4),e.lineStyle(1,parseInt(a.detail.replace("#","0x"))),[-10,0,10].forEach(t=>{e.lineBetween(l+t,r-8,l+t,r+6)}),e.fillStyle(parseInt(a.accent.replace("#","0x"))),e.fillEllipse(l,r-20,8,2),e.fillEllipse(l,r-20,2,8)}renderTBM3(e,t){const{centerX:l,centerY:r,colors:a}=t;e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillEllipse(l,r,8,32),e.fillStyle(parseInt(a.secondary.replace("#","0x"))),e.fillEllipse(l,r-2,36,10),e.fillStyle(parseInt(a.detail.replace("#","0x"))),e.fillCircle(l,r-20,5),e.fillRect(l-1,r+8,2,6),e.fillRoundedRect(l-2,r+12,4,8,1)}renderHawker(e,t){const{centerX:l,centerY:r,colors:a}=t;e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillEllipse(l,r,5,30),e.fillStyle(parseInt(a.secondary.replace("#","0x"))),e.fillEllipse(l,r-2,28,8),e.fillStyle(parseInt(a.detail.replace("#","0x"))),e.fillRect(l-2,r-15,4,2),e.lineStyle(1,parseInt(a.accent.replace("#","0x")));for(let n=0;n<4;n++){const t=90*n*Math.PI/180,a=l+6*Math.cos(t),i=r-22+6*Math.sin(t);e.lineBetween(l,r-22,a,i)}}renderJU87(e,t){const{centerX:l,centerY:r,colors:a}=t;e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillEllipse(l,r,6,28),e.fillStyle(parseInt(a.secondary.replace("#","0x"))),e.beginPath(),e.moveTo(l-4,r-2),e.lineTo(l-10,r-6),e.lineTo(l-16,r-2),e.lineTo(l-10,r+4),e.lineTo(l-4,r+2),e.moveTo(l+4,r-2),e.lineTo(l+10,r-6),e.lineTo(l+16,r-2),e.lineTo(l+10,r+4),e.lineTo(l+4,r+2),e.fillPath(),e.fillStyle(parseInt(a.detail.replace("#","0x"))),e.fillRect(l-12,r+4,2,6),e.fillRect(l+10,r+4,2,6)}renderBlenheim(e,t){const{centerX:l,centerY:r,colors:a}=t;e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillEllipse(l,r,6,32),e.fillStyle(parseInt(a.secondary.replace("#","0x"))),e.fillEllipse(l-8,r-4,4,8),e.fillEllipse(l+8,r-4,4,8),e.fillRect(l-12,r-6,24,4),e.lineStyle(1,parseInt(a.accent.replace("#","0x"))),e.strokeCircle(l-8,r-12,4),e.strokeCircle(l+8,r-12,4)}renderDefaultPlane(e,t){const{centerX:l,centerY:r,colors:a}=t;e.fillStyle(parseInt(a.primary.replace("#","0x"))),e.fillTriangle(l,r-15,l-8,r+10,l+8,r+10),e.fillStyle(parseInt(a.secondary.replace("#","0x"))),e.fillRect(l-12,r-2,24,4)}destroy(){this.textureCache.clear()}}export{a as P,n as a};
//# sourceMappingURL=planes-9c241b37.js.map
