
<!-- çˆ¶é é¢ PostMessage ç›£è½å™¨ -->
<script>
console.log('ğŸ“¡ è¼‰å…¥çˆ¶é é¢ PostMessage ç›£è½å™¨');

// çˆ¶é é¢ç›£è½å™¨
window.addEventListener('message', function(event) {
    console.log('ğŸ“¨ çˆ¶é é¢æ”¶åˆ°æ¶ˆæ¯:', event.data);
    
    try {
        if (!event.data || typeof event.data !== 'object') {
            return;
        }
        
        const message = event.data;
        
        // è™•ç†ç›£è½å™¨è¨­ç½®è«‹æ±‚
        if (message.type === 'SETUP_PARENT_LISTENER') {
            console.log('ğŸ”§ è™•ç†ç›£è½å™¨è¨­ç½®è«‹æ±‚');
            
            // éŸ¿æ‡‰ç›£è½å™¨å·²å°±ç·’
            event.source.postMessage({
                type: 'PARENT_LISTENER_READY',
                timestamp: Date.now(),
                parentUserAgent: navigator.userAgent
            }, event.origin);
            
            console.log('âœ… çˆ¶é é¢ç›£è½å™¨å·²å°±ç·’éŸ¿æ‡‰å·²ç™¼é€');
        }
        
        // è™•ç†é€šä¿¡æ¸¬è©¦
        else if (message.type === 'COMMUNICATION_TEST') {
            console.log('ğŸ§ª è™•ç†é€šä¿¡æ¸¬è©¦:', message.testId);
            
            // éŸ¿æ‡‰æ¸¬è©¦
            event.source.postMessage({
                type: 'COMMUNICATION_TEST_RESPONSE',
                testId: message.testId,
                timestamp: Date.now(),
                parentUserAgent: navigator.userAgent,
                receivedAt: Date.now(),
                originalMessage: message
            }, event.origin);
            
            console.log('âœ… é€šä¿¡æ¸¬è©¦éŸ¿æ‡‰å·²ç™¼é€');
        }
        
        // è™•ç†å…¨è¢å¹•è«‹æ±‚
        else if (message.type === 'DUAL_FULLSCREEN_REQUEST') {
            console.log('ğŸ è™•ç†å…¨è¢å¹•è«‹æ±‚:', message.action);
            
            if (message.action === 'ENTER_CSS_FULLSCREEN') {
                // æ·»åŠ  CSS å¼·åˆ¶å…¨è¢å¹•
                document.body.style.position = 'fixed';
                document.body.style.top = '0';
                document.body.style.left = '0';
                document.body.style.width = '100vw';
                document.body.style.height = '100vh';
                document.body.style.zIndex = '9999';
                document.body.style.backgroundColor = '#000';
                
                console.log('âœ… CSS å¼·åˆ¶å…¨è¢å¹•å·²å•Ÿç”¨');
                
            } else if (message.action === 'EXIT_CSS_FULLSCREEN') {
                // ç§»é™¤ CSS å¼·åˆ¶å…¨è¢å¹•
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.left = '';
                document.body.style.width = '';
                document.body.style.height = '';
                document.body.style.zIndex = '';
                document.body.style.backgroundColor = '';
                
                console.log('âœ… CSS å¼·åˆ¶å…¨è¢å¹•å·²é€€å‡º');
            }
        }
        
    } catch (error) {
        console.log('âŒ çˆ¶é é¢æ¶ˆæ¯è™•ç†å¤±æ•—:', error);
    }
});

console.log('âœ… çˆ¶é é¢ PostMessage ç›£è½å™¨å·²è¼‰å…¥');
</script>
