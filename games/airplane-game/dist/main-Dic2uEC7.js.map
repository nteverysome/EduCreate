{"version":3,"file":"main-Dic2uEC7.js","sources":["../src/config/ResponsivePhaserConfig.ts","../src/main.ts"],"sourcesContent":["/**\r\n * 響應式 Phaser 3 配置\r\n * 優化的 Scale Manager 設定，支援全螢幕和多設備自適應\r\n */\r\n\r\nexport interface ResponsiveConfig {\r\n  // 基準尺寸 (Wordwall 標準)\r\n  baseWidth: number;\r\n  baseHeight: number;\r\n  \r\n  // 縮放模式配置\r\n  scaleMode: Phaser.Scale.ScaleModeType;\r\n  autoCenter: Phaser.Scale.CenterType;\r\n  \r\n  // 尺寸限制\r\n  minWidth: number;\r\n  minHeight: number;\r\n  maxWidth: number;\r\n  maxHeight: number;\r\n  \r\n  // 響應式選項\r\n  enableResponsive: boolean;\r\n  smoothScaling: boolean;\r\n  maintainAspectRatio: boolean;\r\n}\r\n\r\nexport class ResponsivePhaserConfig {\r\n  private static readonly DEFAULT_CONFIG: ResponsiveConfig = {\r\n    // Wordwall 標準尺寸\r\n    baseWidth: 1274,\r\n    baseHeight: 739,\r\n    \r\n    // 縮放配置 - 使用 FIT 模式保持穩定性\r\n    scaleMode: Phaser.Scale.FIT,\r\n    autoCenter: Phaser.Scale.CENTER_BOTH,\r\n    \r\n    // 尺寸限制\r\n    minWidth: 320,   // 最小支援手機尺寸\r\n    minHeight: 240,\r\n    maxWidth: 1920,  // 最大支援 1080p\r\n    maxHeight: 1080,\r\n    \r\n    // 響應式選項\r\n    enableResponsive: true,\r\n    smoothScaling: true,\r\n    maintainAspectRatio: true\r\n  };\r\n\r\n  /**\r\n   * 獲取優化後的 Phaser 配置\r\n   */\r\n  public static getOptimizedConfig(customConfig?: Partial<ResponsiveConfig>): Phaser.Types.Core.GameConfig {\r\n    const config = { ...this.DEFAULT_CONFIG, ...customConfig };\r\n    \r\n    return {\r\n      type: Phaser.AUTO,\r\n      width: config.baseWidth,\r\n      height: config.baseHeight,\r\n      parent: 'game-container',\r\n      backgroundColor: 'transparent',\r\n      \r\n      // 優化的縮放配置\r\n      scale: {\r\n        mode: config.scaleMode,\r\n        autoCenter: config.autoCenter,\r\n        width: config.baseWidth,\r\n        height: config.baseHeight,\r\n        \r\n        // 尺寸限制\r\n        min: {\r\n          width: config.minWidth,\r\n          height: config.minHeight\r\n        },\r\n        max: {\r\n          width: config.maxWidth,\r\n          height: config.maxHeight\r\n        },\r\n        \r\n        // 響應式選項\r\n        zoom: 1,\r\n        resizeInterval: 500, // 防抖間隔\r\n      },\r\n      \r\n      // 物理引擎配置\r\n      physics: {\r\n        default: 'arcade',\r\n        arcade: {\r\n          gravity: { x: 0, y: 0 },\r\n          debug: false\r\n        }\r\n      },\r\n      \r\n      // 渲染優化\r\n      render: {\r\n        antialias: true,\r\n        pixelArt: false,\r\n        roundPixels: false,\r\n        transparent: false,\r\n        clearBeforeRender: true,\r\n        preserveDrawingBuffer: false,\r\n        premultipliedAlpha: true,\r\n        failIfMajorPerformanceCaveat: false,\r\n        powerPreference: 'default'\r\n      },\r\n      \r\n      // 音頻配置\r\n      audio: {\r\n        disableWebAudio: false,\r\n        context: false,\r\n        noAudio: false\r\n      },\r\n      \r\n      // 輸入配置\r\n      input: {\r\n        keyboard: true,\r\n        mouse: true,\r\n        touch: true,\r\n        gamepad: false\r\n      },\r\n      \r\n      // DOM 配置\r\n      dom: {\r\n        createContainer: false\r\n      },\r\n      \r\n      // 插件配置\r\n      plugins: {\r\n        global: [],\r\n        scene: []\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 獲取全螢幕優化配置\r\n   */\r\n  public static getFullscreenConfig(): Phaser.Types.Core.GameConfig {\r\n    return this.getOptimizedConfig({\r\n      scaleMode: Phaser.Scale.RESIZE, // 全螢幕時使用 RESIZE 模式\r\n      autoCenter: Phaser.Scale.CENTER_BOTH,\r\n      enableResponsive: true,\r\n      smoothScaling: true\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 獲取移動設備優化配置\r\n   */\r\n  public static getMobileConfig(): Phaser.Types.Core.GameConfig {\r\n    return this.getOptimizedConfig({\r\n      scaleMode: Phaser.Scale.FIT,\r\n      autoCenter: Phaser.Scale.CENTER_BOTH,\r\n      minWidth: 320,\r\n      minHeight: 240,\r\n      maxWidth: 768,\r\n      maxHeight: 1024\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 動態檢測最佳配置\r\n   */\r\n  public static getAdaptiveConfig(): Phaser.Types.Core.GameConfig {\r\n    const viewport = this.getViewportInfo();\r\n    \r\n    // 根據設備類型選擇最佳配置\r\n    switch (viewport.deviceType) {\r\n      case 'mobile':\r\n        return this.getMobileConfig();\r\n      case 'tablet':\r\n        return this.getOptimizedConfig({\r\n          scaleMode: Phaser.Scale.FIT,\r\n          maxWidth: 1024,\r\n          maxHeight: 768\r\n        });\r\n      case 'desktop':\r\n      default:\r\n        return this.getOptimizedConfig();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 獲取視窗信息\r\n   */\r\n  private static getViewportInfo() {\r\n    const width = window.innerWidth;\r\n    const height = window.innerHeight;\r\n    \r\n    let deviceType: 'mobile' | 'tablet' | 'desktop' = 'desktop';\r\n    \r\n    if (width < 768) {\r\n      deviceType = 'mobile';\r\n    } else if (width < 1024) {\r\n      deviceType = 'tablet';\r\n    }\r\n    \r\n    return {\r\n      width,\r\n      height,\r\n      deviceType,\r\n      aspectRatio: width / height,\r\n      isLandscape: width > height,\r\n      isPortrait: height > width\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 配置比較工具\r\n   */\r\n  public static compareConfigs() {\r\n    console.log('📊 Phaser 3 縮放模式比較:');\r\n    console.log('');\r\n    console.log('🔧 FIT 模式 (當前):');\r\n    console.log('  ✅ 保持寬高比，無變形');\r\n    console.log('  ✅ 自動居中，視覺穩定');\r\n    console.log('  ❌ 可能有黑邊');\r\n    console.log('  ❌ 無法充分利用大屏幕');\r\n    console.log('');\r\n    console.log('🔧 RESIZE 模式:');\r\n    console.log('  ✅ 充分利用屏幕空間');\r\n    console.log('  ✅ 無黑邊，完全填滿');\r\n    console.log('  ❌ 可能變形，需要額外處理');\r\n    console.log('  ❌ 複雜度較高');\r\n    console.log('');\r\n    console.log('💡 建議: 保持 FIT 模式 + 響應式管理器');\r\n  }\r\n\r\n  /**\r\n   * 性能監控\r\n   */\r\n  public static monitorPerformance(game: Phaser.Game) {\r\n    if (!game) return;\r\n    \r\n    const stats = {\r\n      fps: 0,\r\n      memory: 0,\r\n      drawCalls: 0\r\n    };\r\n    \r\n    // FPS 監控\r\n    game.loop.on('step', () => {\r\n      stats.fps = Math.round(game.loop.actualFps);\r\n    });\r\n    \r\n    // 記憶體監控 (如果支援)\r\n    if ((performance as any).memory) {\r\n      stats.memory = Math.round((performance as any).memory.usedJSHeapSize / 1024 / 1024);\r\n    }\r\n    \r\n    console.log('📈 性能監控已啟動:', stats);\r\n    \r\n    return stats;\r\n  }\r\n}\r\n\r\nexport default ResponsivePhaserConfig;\r\n","/**\r\n * Airplane Collision Game - Vite + Phaser 3 入口點\r\n * 基於記憶科學的英語詞彙學習遊戲\r\n */\r\n\r\nimport Phaser from 'phaser';\r\nimport { GameConfig } from './types/game';\r\nimport { ResponsivePhaserConfig } from './config/ResponsivePhaserConfig';\r\n\r\n// 直接導入場景（簡化調試）\r\nimport GameScene from './scenes/GameScene';\r\n\r\nconst loadGameScene = async () => {\r\n  console.log('✅ GameScene 直接導入成功');\r\n  return GameScene;\r\n};\r\n\r\n/**\r\n * 初始化 Phaser 遊戲\r\n */\r\nasync function initGame() {\r\n  console.log('🎮 初始化 Airplane Collision Game - Vite 版本');\r\n  \r\n  try {\r\n    console.log('🔧 開始初始化流程...');\r\n\r\n    // 隱藏載入畫面\r\n    const loadingElement = document.getElementById('loading');\r\n    if (loadingElement) {\r\n      loadingElement.style.display = 'none';\r\n      console.log('✅ 載入畫面已隱藏');\r\n    }\r\n\r\n    // 載入遊戲場景\r\n    console.log('📦 載入遊戲場景...');\r\n    const GameScene = await loadGameScene();\r\n    console.log('✅ 遊戲場景載入完成:', GameScene.name);\r\n\r\n    // 默認遊戲配置\r\n    console.log('⚙️ 設置遊戲配置...');\r\n    const defaultConfig: GameConfig = {\r\n      geptLevel: 'elementary',\r\n      enableSound: true,\r\n      enableHapticFeedback: true,\r\n      difficulty: 'medium',\r\n      gameMode: 'practice'\r\n    };\r\n    console.log('✅ 遊戲配置設置完成');\r\n\r\n    // 🚀 使用優化後的響應式 Phaser 配置\r\n    console.log('🎯 獲取響應式 Phaser 配置...');\r\n    const phaserConfig = ResponsivePhaserConfig.getAdaptiveConfig();\r\n    console.log('✅ 響應式配置獲取完成');\r\n\r\n    // 設置場景\r\n    console.log('🎬 設置場景到配置...');\r\n    phaserConfig.scene = GameScene;\r\n    console.log('✅ 場景設置完成');\r\n\r\n    // 顯示配置比較信息\r\n    console.log('📊 顯示配置比較...');\r\n    ResponsivePhaserConfig.compareConfigs();\r\n    console.log('✅ 配置比較完成');\r\n    \r\n    // 創建 Phaser 遊戲實例\r\n    console.log('🎮 創建 Phaser 遊戲實例...');\r\n    const game = new Phaser.Game(phaserConfig);\r\n    console.log('✅ Phaser 遊戲實例創建完成');\r\n\r\n    // 將配置傳遞給場景\r\n    console.log('📋 傳遞配置給場景...');\r\n    game.registry.set('gameConfig', defaultConfig);\r\n    console.log('✅ 配置傳遞完成');\r\n    \r\n    // 設置全局錯誤處理\r\n    game.events.on('error', (error: Error) => {\r\n      console.error('❌ Phaser 遊戲錯誤:', error);\r\n    });\r\n    \r\n    // 遊戲就緒回調\r\n    game.events.once('ready', () => {\r\n      console.log('✅ Airplane Collision Game 初始化完成');\r\n      \r\n      // 向父頁面發送就緒消息\r\n      if (window.parent !== window) {\r\n        window.parent.postMessage({\r\n          type: 'GAME_READY',\r\n          timestamp: Date.now()\r\n        }, '*');\r\n      }\r\n    });\r\n    \r\n    // 將遊戲實例暴露到全局（用於調試）\r\n    if (typeof window !== 'undefined') {\r\n      (window as any).phaserGame = game;\r\n    }\r\n    \r\n    return game;\r\n    \r\n  } catch (error) {\r\n    console.error('❌ 遊戲初始化失敗:', error);\r\n    \r\n    // 顯示錯誤信息\r\n    const gameContainer = document.getElementById('game-container');\r\n    if (gameContainer) {\r\n      gameContainer.innerHTML = `\r\n        <div style=\"\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: center;\r\n          align-items: center;\r\n          height: 100%;\r\n          color: white;\r\n          text-align: center;\r\n          padding: 20px;\r\n        \">\r\n          <h2 style=\"color: #ff6b6b; margin-bottom: 16px;\">⚠️ 遊戲載入失敗</h2>\r\n          <p style=\"margin-bottom: 16px;\">無法初始化 Phaser 遊戲引擎</p>\r\n          <p style=\"font-size: 14px; opacity: 0.7;\">${error instanceof Error ? error.message : '未知錯誤'}</p>\r\n          <button \r\n            onclick=\"location.reload()\" \r\n            style=\"\r\n              margin-top: 20px;\r\n              padding: 10px 20px;\r\n              background: #4CAF50;\r\n              color: white;\r\n              border: none;\r\n              border-radius: 4px;\r\n              cursor: pointer;\r\n            \"\r\n          >\r\n            重新載入\r\n          </button>\r\n        </div>\r\n      `;\r\n    }\r\n    \r\n    throw error;\r\n  }\r\n}\r\n\r\n// 等待 DOM 載入完成後初始化遊戲\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', initGame);\r\n} else {\r\n  initGame();\r\n}\r\n\r\n// 導出初始化函數（用於測試）\r\nexport { initGame };\r\n"],"names":["ResponsivePhaserConfig","getOptimizedConfig","customConfig","config","this","DEFAULT_CONFIG","type","Phaser","AUTO","width","baseWidth","height","baseHeight","parent","backgroundColor","scale","mode","scaleMode","autoCenter","min","minWidth","minHeight","max","maxWidth","maxHeight","zoom","resizeInterval","physics","default","arcade","gravity","x","y","debug","render","antialias","pixelArt","roundPixels","transparent","clearBeforeRender","preserveDrawingBuffer","premultipliedAlpha","failIfMajorPerformanceCaveat","powerPreference","audio","disableWebAudio","context","noAudio","input","keyboard","mouse","touch","gamepad","dom","createContainer","plugins","global","scene","getFullscreenConfig","Scale","RESIZE","CENTER_BOTH","enableResponsive","smoothScaling","getMobileConfig","FIT","getAdaptiveConfig","getViewportInfo","deviceType","window","innerWidth","innerHeight","aspectRatio","isLandscape","isPortrait","compareConfigs","console","log","monitorPerformance","game","stats","fps","memory","drawCalls","loop","on","Math","round","actualFps","performance","usedJSHeapSize","maintainAspectRatio","async","initGame","loadingElement","document","getElementById","style","display","GameScene","loadGameScene","name","defaultConfig","geptLevel","enableSound","enableHapticFeedback","difficulty","gameMode","phaserConfig","Game","registry","set","events","error","once","postMessage","timestamp","Date","now","phaserGame","gameContainer","innerHTML","Error","message","readyState","addEventListener"],"mappings":"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"}