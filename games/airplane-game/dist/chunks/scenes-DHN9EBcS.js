var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{P as s}from"./phaser-CjIEy6U-.js";import{G as i,M as o,C as n}from"./managers-BXLQW2UW.js";class a{constructor(e,s){t(this,"scene"),t(this,"geptManager"),t(this,"promptContainer",null),t(this,"chineseText",null),t(this,"englishText",null),t(this,"backgroundRect",null),t(this,"config"),t(this,"state"),t(this,"accessibilitySettings"),t(this,"wordCache",new Map),t(this,"translationCache",new Map),this.scene=e,this.geptManager=s,this.config=this.getDefaultConfig(),this.state=this.getInitialState(),this.accessibilitySettings=this.getDefaultAccessibilitySettings(),this.initializePromptUI(),console.log("ğŸŒ BilingualManager åˆå§‹åŒ–å®Œæˆ")}getDefaultConfig(){return{position:"top-center",style:{fontSize:24,fontFamily:"Microsoft YaHei, SimHei, Arial, sans-serif",color:"#FFFFFF",backgroundColor:"rgba(0, 0, 0, 0.8)",padding:{x:16,y:8},borderRadius:8,border:"2px solid #FFD700"},animation:{fadeIn:{duration:300,ease:"Power2.easeOut"},fadeOut:{duration:200,ease:"Power2.easeIn"},bounce:{amplitude:10,duration:500}}}}getInitialState(){return{isVisible:!1,currentWord:null,displayMode:"chinese-only",lastUpdateTime:0}}getDefaultAccessibilitySettings(){return{fontSize:"medium",contrast:"normal",enableVoice:!1,enableKeyboardNav:!0,screenReaderMode:!1}}initializePromptUI(){this.scene.scale.width,this.scene.scale.height,this.promptContainer=this.scene.add.container(0,0),this.promptContainer.setDepth(1e3),this.backgroundRect=this.scene.add.rectangle(0,0,200,60,0,.8),this.backgroundRect.setStrokeStyle(2,16766720),this.chineseText=this.scene.add.text(0,-10,"",{fontSize:`${this.config.style.fontSize}px`,fontFamily:this.config.style.fontFamily,color:this.config.style.color,align:"center",fontStyle:"bold"}),this.chineseText.setOrigin(.5),this.englishText=this.scene.add.text(0,15,"",{fontSize:.7*this.config.style.fontSize+"px",fontFamily:"Arial, sans-serif",color:"#CCCCCC",align:"center"}),this.englishText.setOrigin(.5),this.promptContainer.add([this.backgroundRect,this.chineseText,this.englishText]),this.updatePromptPosition(),this.promptContainer.setVisible(!1),this.promptContainer.setAlpha(0)}updatePromptPosition(){if(!this.promptContainer)return;const e=this.scene.scale.width,t=this.scene.scale.height;switch(this.config.position){case"top-center":this.promptContainer.setPosition(e/2,80);break;case"bottom-center":this.promptContainer.setPosition(e/2,t-80)}}showChinesePrompt(e,t){const s=this.getWordFromCache(e);s?(this.state.currentWord=s,this.state.isVisible=!0,this.state.lastUpdateTime=Date.now(),this.chineseText&&this.chineseText.setText(s.chinese),this.englishText&&"both"===this.state.displayMode?this.englishText.setText(`(${s.english})`):this.englishText&&this.englishText.setText(""),this.adjustBackgroundSize(),"floating"===this.config.position&&t&&this.promptContainer?.setPosition(t.x,t.y-60),this.playShowAnimation(),console.log(`ğŸŒ é¡¯ç¤ºä¸­æ–‡æç¤º: ${s.chinese} (${s.english})`)):console.warn(`âš ï¸ æœªæ‰¾åˆ°è©å½™: ${e}`)}hideChinesePrompt(){this.state.isVisible&&(this.state.isVisible=!1,this.state.currentWord=null,this.playHideAnimation(),console.log("ğŸŒ éš±è—ä¸­æ–‡æç¤º"))}updateTargetWord(e){const t=this.getWordFromCache(e);t?(this.state.isVisible&&this.showChinesePrompt(e),console.log(`ğŸ¯ æ›´æ–°ç›®æ¨™è©å½™: ${t.chinese} (${t.english})`)):console.warn(`âš ï¸ æœªæ‰¾åˆ°ç›®æ¨™è©å½™: ${e}`)}getWordFromCache(e){if(this.wordCache.has(e))return this.wordCache.get(e);const t=this.geptManager.findWordByEnglish(e);return t&&(this.wordCache.set(e,t),this.translationCache.set(e,t.chinese)),t}adjustBackgroundSize(){if(!this.backgroundRect||!this.chineseText)return;const e=this.chineseText.getBounds(),t=this.config.style.padding,s=Math.max(e.width+2*t.x,120),i=Math.max(e.height+2*t.y,50);this.backgroundRect.setSize(s,i)}playShowAnimation(){this.promptContainer&&(this.promptContainer.setVisible(!0),this.scene.tweens.add({targets:this.promptContainer,alpha:1,duration:this.config.animation.fadeIn.duration,ease:this.config.animation.fadeIn.ease,onComplete:()=>{this.config.animation.bounce&&this.playBounceAnimation()}}))}playHideAnimation(){this.promptContainer&&this.scene.tweens.add({targets:this.promptContainer,alpha:0,duration:this.config.animation.fadeOut.duration,ease:this.config.animation.fadeOut.ease,onComplete:()=>{this.promptContainer?.setVisible(!1)}})}playBounceAnimation(){if(!this.promptContainer||!this.config.animation.bounce)return;const e=this.promptContainer.y,t=this.config.animation.bounce;this.scene.tweens.add({targets:this.promptContainer,y:e-t.amplitude,duration:t.duration/2,ease:"Power2.easeOut",yoyo:!0,repeat:0})}setDisplayMode(e){this.state.displayMode=e,this.state.isVisible&&this.state.currentWord&&this.showChinesePrompt(this.state.currentWord.english)}applyAccessibilitySettings(e){this.accessibilitySettings={...this.accessibilitySettings,...e},this.updateFontSize(),this.updateContrast(),console.log("â™¿ æ‡‰ç”¨ç„¡éšœç¤™è¨­ç½®:",this.accessibilitySettings)}updateFontSize(){const e={small:18,medium:24,large:30,"extra-large":36}[this.accessibilitySettings.fontSize];this.chineseText&&this.chineseText.setFontSize(e),this.englishText&&this.englishText.setFontSize(.7*e),this.adjustBackgroundSize()}updateContrast(){const e={normal:{bg:0,text:"#FFFFFF",border:16766720},high:{bg:0,text:"#FFFF00",border:16777215},reverse:{bg:16777215,text:"#000000",border:0}}[this.accessibilitySettings.contrast];this.backgroundRect&&(this.backgroundRect.setFillStyle(e.bg,.9),this.backgroundRect.setStrokeStyle(2,e.border)),this.chineseText&&this.chineseText.setColor(e.text),this.englishText&&this.englishText.setColor(e.text)}getChineseTranslation(e){if(this.translationCache.has(e))return this.translationCache.get(e);const t=this.getWordFromCache(e);return t?t.chinese:""}destroy(){this.promptContainer&&(this.promptContainer.destroy(),this.promptContainer=null),this.wordCache.clear(),this.translationCache.clear(),console.log("ğŸ§¹ BilingualManager å·²éŠ·æ¯€")}getState(){return{...this.state}}getStatistics(){return{cacheSize:this.wordCache.size,translationCacheSize:this.translationCache.size,currentLevel:this.geptManager.getCurrentLevel(),isVisible:this.state.isVisible,displayMode:this.state.displayMode}}}class r{constructor(e,s,i){t(this,"scene"),t(this,"geptManager"),t(this,"bilingualManager"),t(this,"uiElements"),t(this,"textConfig"),t(this,"accessibilitySettings"),t(this,"hudContainer",null),t(this,"targetContainer",null),t(this,"currentScore",0),t(this,"currentLives",100),t(this,"currentTarget",null),t(this,"gameStatus","waiting"),this.scene=e,this.geptManager=s,this.bilingualManager=i,this.uiElements=this.initializeUIElements(),this.textConfig=this.getDefaultTextConfig(),this.accessibilitySettings=this.getDefaultAccessibilitySettings(),this.createChineseHUD(),console.log("ğŸ¨ ChineseUIManager åˆå§‹åŒ–å®Œæˆ")}initializeUIElements(){return{scoreText:null,livesText:null,targetText:null,statusText:null,instructionText:null}}getDefaultTextConfig(){return{fontSize:20,fontFamily:"Microsoft YaHei, SimHei, Arial, sans-serif",color:"#FFFFFF",stroke:"#000000",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:4,fill:!0}}}getDefaultAccessibilitySettings(){return{fontSize:"medium",contrast:"normal",enableVoice:!1,enableKeyboardNav:!0,screenReaderMode:!1}}createChineseHUD(){this.createTargetDisplay(),console.log("ğŸ¨ æ¥µç°¡ä¸­æ–‡ HUD å‰µå»ºå®Œæˆï¼ˆåªä¿ç•™çµ±ä¸€æ§åˆ¶å…ƒç´ ï¼‰")}createTargetDisplay(){const e=this.scene.scale.width;this.targetContainer=this.scene.add.container(e/2,120),this.targetContainer.setDepth(998),this.uiElements.targetText=this.scene.add.text(0,0,"ç­‰å¾…è¨­ç½®...",{fontSize:"48px",fontFamily:this.textConfig.fontFamily,color:"#FFFFFF",align:"center",fontStyle:"bold",backgroundColor:"#FFD700",padding:{x:20,y:10}}),this.uiElements.targetText.setOrigin(.5),this.uiElements.targetText.setInteractive(),this.targetContainer.add(this.uiElements.targetText),this.uiElements.targetText.on("pointerdown",(()=>{this.currentTarget&&this.speakEnglish(this.currentTarget.english)})),console.log("ğŸ¯ æ¥µç°¡ç›®æ¨™è©å½™é¡¯ç¤ºå‰µå»ºå®Œæˆ")}getTextStyle(){return{fontSize:`${this.textConfig.fontSize}px`,fontFamily:this.textConfig.fontFamily,color:this.textConfig.color,stroke:this.textConfig.stroke,strokeThickness:this.textConfig.strokeThickness,shadow:this.textConfig.shadow}}updateScore(e){this.currentScore=e}updateLives(e){this.currentLives=e}updateTargetWord(e){this.currentTarget=e,this.uiElements.targetText&&(this.uiElements.targetText.setText(e.chinese),this.speakChinese(e.chinese)),this.bilingualManager.updateTargetWord(e.english),console.log(`ğŸ¯ æ¥µç°¡ç›®æ¨™è©å½™: ${e.chinese}`)}updateGameStatus(e){this.gameStatus=e}showSuccessMessage(e,t){const s=this.scene.scale.width,i=this.scene.scale.height,o=this.scene.add.text(s/2,i/2,`æ­£ç¢ºï¼\n${e.chinese}\n+${t} åˆ†`,{fontSize:"32px",fontFamily:this.textConfig.fontFamily,color:"#00FF00",align:"center",fontStyle:"bold",stroke:"#000000",strokeThickness:3});o.setOrigin(.5),o.setDepth(1001),this.speakEnglish(e.english),this.scene.tweens.add({targets:o,scaleX:1.2,scaleY:1.2,alpha:0,duration:1500,ease:"Power2.easeOut",onComplete:()=>{o.destroy()}}),console.log(`âœ… æˆåŠŸæç¤º: ${e.chinese} +${t}åˆ† ğŸ”Š${e.english}`)}showErrorMessage(e,t){const s=this.scene.scale.width,i=this.scene.scale.height,o=this.scene.add.text(s/2,i/2,`éŒ¯èª¤ï¼\n${e.chinese}\n-${t} ç”Ÿå‘½å€¼`,{fontSize:"28px",fontFamily:this.textConfig.fontFamily,color:"#FF0000",align:"center",fontStyle:"bold",stroke:"#000000",strokeThickness:3});o.setOrigin(.5),o.setDepth(1001),this.scene.tweens.add({targets:o,scaleX:.8,scaleY:.8,alpha:0,duration:1200,ease:"Power2.easeIn",onComplete:()=>{o.destroy()}}),console.log(`âŒ é¡¯ç¤ºéŒ¯èª¤æç¤º: ${e.chinese} -${t}ç”Ÿå‘½å€¼`)}applyAccessibilitySettings(e){this.accessibilitySettings={...this.accessibilitySettings,...e},this.updateAllFontSizes(),this.updateAllContrast(),console.log("â™¿ ChineseUIManager æ‡‰ç”¨ç„¡éšœç¤™è¨­ç½®:",this.accessibilitySettings)}updateAllFontSizes(){const e={small:16,medium:20,large:24,"extra-large":28}[this.accessibilitySettings.fontSize];this.textConfig.fontSize=e,Object.values(this.uiElements).forEach((t=>{t&&t.setFontSize&&t.setFontSize(e)}))}updateAllContrast(){const e={normal:{text:"#FFFFFF",stroke:"#000000"},high:{text:"#FFFF00",stroke:"#000000"},reverse:{text:"#000000",stroke:"#FFFFFF"}}[this.accessibilitySettings.contrast];this.textConfig.color=e.text,this.textConfig.stroke=e.stroke,Object.values(this.uiElements).forEach((t=>{t&&t.setColor&&(t.setColor(e.text),t.setStroke(e.stroke,this.textConfig.strokeThickness))}))}setVisible(e){this.hudContainer&&this.hudContainer.setVisible(e),this.targetContainer&&this.targetContainer.setVisible(e)}speakChinese(e){if("speechSynthesis"in window){const t=new SpeechSynthesisUtterance(e);t.lang="zh-CN",t.rate=.8,t.volume=.7,speechSynthesis.speak(t),console.log(`ğŸ”Š ç™¼ä¸­æ–‡éŸ³: ${e}`)}}speakEnglish(e){if("speechSynthesis"in window){const t=new SpeechSynthesisUtterance(e);t.lang="en-US",t.rate=.8,t.volume=.7,speechSynthesis.speak(t),console.log(`ğŸ”Š ç™¼è‹±æ–‡éŸ³: ${e}`)}}getState(){return{score:this.currentScore,lives:this.currentLives,target:this.currentTarget,status:this.gameStatus,accessibilitySettings:this.accessibilitySettings}}destroy(){this.hudContainer&&(this.hudContainer.destroy(),this.hudContainer=null),this.targetContainer&&(this.targetContainer.destroy(),this.targetContainer=null),Object.keys(this.uiElements).forEach((e=>{this.uiElements[e]=null})),console.log("ğŸ§¹ ChineseUIManager å·²éŠ·æ¯€")}}class l{constructor(){t(this,"updateCount",0),t(this,"totalUpdateTime",0),t(this,"lastReportTime",Date.now()),t(this,"memoryUsage",[])}recordUpdate(e){if(this.updateCount++,this.totalUpdateTime+=e,performance.memory){const e=performance.memory;this.memoryUsage.push(e.usedJSHeapSize/1024/1024),this.memoryUsage.length>100&&this.memoryUsage.shift()}const t=Date.now();t-this.lastReportTime>3e4&&(this.reportPerformance(),this.lastReportTime=t)}reportPerformance(){if(0===this.updateCount)return;const e=this.totalUpdateTime/this.updateCount,t=this.memoryUsage.length>0?this.memoryUsage.reduce(((e,t)=>e+t),0)/this.memoryUsage.length:0;console.log("ğŸ“Š éŸ¿æ‡‰å¼ç®¡ç†å™¨æ€§èƒ½å ±å‘Š:",{"æ›´æ–°æ¬¡æ•¸":this.updateCount,"å¹³å‡æ›´æ–°æ™‚é–“":`${e.toFixed(2)}ms`,"å¹³å‡è¨˜æ†¶é«”ä½¿ç”¨":`${t.toFixed(1)}MB`,"è¨˜æ†¶é«”è¶¨å‹¢":this.getMemoryTrend()}),this.updateCount=0,this.totalUpdateTime=0}getMemoryTrend(){if(this.memoryUsage.length<10)return"æ•¸æ“šä¸è¶³";const e=this.memoryUsage.slice(-10),t=this.memoryUsage.slice(-20,-10);if(0===t.length)return"ç©©å®š";const s=e.reduce(((e,t)=>e+t),0)/e.length-t.reduce(((e,t)=>e+t),0)/t.length;return s>5?"ä¸Šå‡ âš ï¸":s<-5?"ä¸‹é™ âœ…":"ç©©å®š âœ…"}getStats(){return{updateCount:this.updateCount,avgUpdateTime:this.updateCount>0?this.totalUpdateTime/this.updateCount:0,memoryUsage:this.memoryUsage.slice(-10)}}}const h=class e{constructor(s,i){t(this,"scene"),t(this,"config"),t(this,"elements",new Map),t(this,"currentViewport"),t(this,"isAnimating",!1),t(this,"updateThrottleTimer",null),t(this,"lastUpdateTime",0),t(this,"cleanupTimer",null),t(this,"performanceMonitor");try{this.scene=s,this.config={...e.DEFAULT_CONFIG,...i},this.performanceMonitor=new l,this.currentViewport=this.calculateViewportInfo(),this.setupEventListeners(),this.startPeriodicCleanup(),console.log("ğŸ¯ éŸ¿æ‡‰å¼ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ",{baseSize:`${this.config.baseWidth}Ã—${this.config.baseHeight}`,currentViewport:this.currentViewport,throttleMs:this.config.throttleMs})}catch(o){throw console.error("âŒ éŸ¿æ‡‰å¼ç®¡ç†å™¨åˆå§‹åŒ–å¤±æ•—:",o),o}}registerElement(e,t,s,i){try{if(!e||"string"!=typeof e)throw new Error("å…ƒç´  ID å¿…é ˆæ˜¯éç©ºå­—ç¬¦ä¸²");if(!t)throw new Error("å…ƒç´ ä¸èƒ½ç‚ºç©º");if(!["background","gameObject","ui","text"].includes(s))throw new Error(`ä¸æ”¯æ´çš„å…ƒç´ é¡å‹: ${s}`);if(this.elements.has(e)&&console.warn(`âš ï¸ å…ƒç´  ${e} å·²å­˜åœ¨ï¼Œå°‡è¢«è¦†è“‹`),t.destroyed)throw new Error(`å…ƒç´  ${e} å·²è¢«éŠ·æ¯€ï¼Œç„¡æ³•è¨»å†Š`);const o={element:t,type:s,originalX:this.safeGetProperty(t,"x",0),originalY:this.safeGetProperty(t,"y",0),originalScale:this.safeGetProperty(t,"scale",this.safeGetProperty(t,"scaleX",1)),originalSize:t.width&&t.height?{width:t.width,height:t.height}:void 0,anchor:{x:.5,y:.5},constraints:{keepAspectRatio:!0,minScale:this.config.minScale,maxScale:this.config.maxScale},...i};this.elements.set(e,o),console.log(`ğŸ“ è¨»å†ŠéŸ¿æ‡‰å¼å…ƒç´ : ${e} (${s})`)}catch(o){throw console.error(`âŒ è¨»å†ŠéŸ¿æ‡‰å¼å…ƒç´ å¤±æ•— (${e}):`,o),o}}safeGetProperty(e,t,s){try{return e&&void 0!==e[t]?e[t]:s}catch(i){return console.warn(`âš ï¸ ç„¡æ³•ç²å–å±¬æ€§ ${t}ï¼Œä½¿ç”¨é è¨­å€¼:`,s),s}}unregisterElement(e){this.elements.has(e)&&(this.elements.delete(e),console.log(`ğŸ—‘ï¸ ç§»é™¤éŸ¿æ‡‰å¼å…ƒç´ : ${e}`))}calculateViewportInfo(){this.scene.scale.gameSize;const e=this.scene.scale.displaySize,t=e.width,s=e.height,i=Math.min(t/this.config.baseWidth,s/this.config.baseHeight),o=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);let n="desktop";t<768?n="mobile":t<1024&&(n="tablet");const a=t>s?"landscape":"portrait";return{width:t,height:s,scale:Math.max(this.config.minScale,Math.min(this.config.maxScale,i)),isFullscreen:o,deviceType:n,orientation:a}}updateAllElements(e=!0){return new Promise((t=>{const s=Date.now();if(s-this.lastUpdateTime<this.config.throttleMs)return this.updateThrottleTimer&&clearTimeout(this.updateThrottleTimer),void(this.updateThrottleTimer=window.setTimeout((()=>{this.performUpdate(e).then(t)}),this.config.throttleMs));this.lastUpdateTime=s,this.performUpdate(e).then(t)}))}performUpdate(e){return new Promise((t=>{const s=performance.now();if(this.isAnimating&&e)return console.log("â³ å‹•ç•«é€²è¡Œä¸­ï¼Œè·³éæ›´æ–°"),void t();const i=this.calculateViewportInfo();if(!this.hasViewportChanged(i))return console.log("ğŸ“ è¦–çª—æœªè®ŠåŒ–ï¼Œè·³éæ›´æ–°"),void t();console.log("ğŸ”„ é–‹å§‹æ›´æ–°æ‰€æœ‰éŸ¿æ‡‰å¼å…ƒç´ ",{from:this.currentViewport,to:i}),this.currentViewport=i,this.cleanupInvalidElements();const o=()=>{const e=performance.now()-s;this.performanceMonitor.recordUpdate(e),t()};e&&this.config.enableSmoothing?this.animateElements().then(o):(this.updateElementsImmediate(),o())}))}hasViewportChanged(e){return Math.abs(e.width-this.currentViewport.width)>10||Math.abs(e.height-this.currentViewport.height)>10||Math.abs(e.scale-this.currentViewport.scale)>.01||e.isFullscreen!==this.currentViewport.isFullscreen||e.deviceType!==this.currentViewport.deviceType||e.orientation!==this.currentViewport.orientation}updateElementsImmediate(){this.elements.forEach(((e,t)=>{this.updateSingleElement(e,!1)})),console.log(`âœ… ç«‹å³æ›´æ–°å®Œæˆ ${this.elements.size} å€‹å…ƒç´ `)}animateElements(){return new Promise((e=>{this.isAnimating=!0;const t=[];this.elements.forEach(((e,s)=>{const i=this.animateSingleElement(e);t.push(i)})),Promise.all(t).then((()=>{this.isAnimating=!1,console.log(`âœ¨ å‹•ç•«æ›´æ–°å®Œæˆ ${this.elements.size} å€‹å…ƒç´ `),e()}))}))}updateSingleElement(e,t=!1){try{const{element:t,type:s,originalX:i,originalY:o,originalScale:n,constraints:a}=e;if(!t)return void console.warn("âš ï¸ å…ƒç´ ç‚ºç©ºï¼Œè·³éæ›´æ–°");if(t.destroyed)return void console.warn("âš ï¸ å…ƒç´ å·²éŠ·æ¯€ï¼Œè·³éæ›´æ–°");if(!t.active&&t.hasOwnProperty("active"))return void console.warn("âš ï¸ å…ƒç´ æœªæ¿€æ´»ï¼Œè·³éæ›´æ–°");let r=this.currentViewport.scale*n;console.log("ğŸ” ç¸®æ”¾è¨ˆç®—è©³æƒ…:",{elementId:e.id||"unknown",viewportScale:this.currentViewport.scale,originalScale:n,calculatedScale:r,constraints:a});const l=r;a?.minScale&&(r=Math.max(r,a.minScale)),a?.maxScale&&(r=Math.min(r,a.maxScale)),l!==r&&console.log("âš™ï¸ ç´„æŸå·²æ‡‰ç”¨:",{before:l,after:r,minScale:a?.minScale,maxScale:a?.maxScale}),(!isFinite(r)||r<=0)&&(console.warn(`âš ï¸ ç„¡æ•ˆçš„ç¸®æ”¾å€¼: ${r}ï¼Œä½¿ç”¨é è¨­å€¼ 1`),r=1);const h=this.calculateNewPosition(i,"x"),c=this.calculateNewPosition(o,"y");if(!isFinite(h)||!isFinite(c))return void console.warn(`âš ï¸ ç„¡æ•ˆçš„ä½ç½®å€¼: (${h}, ${c})ï¼Œè·³éæ›´æ–°`);switch(s){case"background":this.updateBackgroundElement(t,h,c,r);break;case"gameObject":this.updateGameObjectElement(t,h,c,r);break;case"ui":this.updateUIElement(t,h,c,r);break;case"text":this.updateTextElement(t,h,c,r);break;default:console.warn(`âš ï¸ æœªçŸ¥çš„å…ƒç´ é¡å‹: ${s}`)}}catch(s){console.error("âŒ æ›´æ–°å–®å€‹å…ƒç´ æ™‚ç™¼ç”ŸéŒ¯èª¤:",s)}}animateSingleElement(e){return new Promise((t=>{const{element:s}=e;if(!s||!s.active)return void t();const i=this.currentViewport.scale*e.originalScale,o=this.calculateNewPosition(e.originalX,"x"),n=this.calculateNewPosition(e.originalY,"y");this.scene.tweens.add({targets:s,x:o,y:n,scaleX:i,scaleY:i,duration:this.config.animationDuration,ease:"Power2",onComplete:()=>t()})}))}calculateNewPosition(e,t){return e/("x"===t?this.config.baseWidth:this.config.baseHeight)*("x"===t?this.currentViewport.width:this.currentViewport.height)}updateBackgroundElement(e,t,s,i){try{e.setPosition&&"function"==typeof e.setPosition?e.setPosition(t,s):void 0!==e.x&&void 0!==e.y&&(e.x=t,e.y=s),e.setScale&&"function"==typeof e.setScale?e.setScale(i):void 0!==e.scaleX&&void 0!==e.scaleY&&(e.scaleX=i,e.scaleY=i),e.setSize&&"function"==typeof e.setSize&&this.currentViewport.isFullscreen&&e.setSize(this.currentViewport.width,this.currentViewport.height)}catch(o){console.error("âŒ æ›´æ–°èƒŒæ™¯å…ƒç´ æ™‚ç™¼ç”ŸéŒ¯èª¤:",o)}}updateGameObjectElement(e,t,s,i){console.log("ğŸ¯ æ›´æ–°éŠæˆ²ç‰©ä»¶:",{elementType:e.constructor.name,currentPosition:{x:e.x,y:e.y},currentScale:{x:e.scaleX,y:e.scaleY},newPosition:{x:t,y:s},newScale:i,hasSetPosition:!!e.setPosition,hasSetScale:!!e.setScale}),e.setPosition&&(e.setPosition(t,s),console.log("âœ… ä½ç½®å·²æ›´æ–°:",{x:e.x,y:e.y})),e.setScale&&(e.setScale(i,i),console.log("âœ… ç¸®æ”¾å·²æ›´æ–°ï¼ˆç­‰æ¯”ä¾‹ï¼‰:",{x:e.scaleX,y:e.scaleY}))}updateUIElement(e,t,s,i){e.setPosition&&e.setPosition(t,s),e.setScale&&e.setScale(i)}updateTextElement(e,t,s,i){if(e.setPosition&&e.setPosition(t,s),e.setScale&&e.setScale(i),e.setFontSize){const t=parseInt(e.style.fontSize)||16,s=Math.round(t*i);e.setFontSize(`${s}px`)}}setupEventListeners(){this.scene.scale.on("resize",(()=>{this.updateAllElements(!0)}));const e=()=>{setTimeout((()=>{this.updateAllElements(!0)}),100)};document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),console.log("ğŸ‘‚ éŸ¿æ‡‰å¼äº‹ä»¶ç›£è½å™¨å·²è¨­ç½®")}cleanupInvalidElements(){const e=[];this.elements.forEach(((t,s)=>{t.element&&t.element.active&&!t.element.destroyed||e.push(s)})),e.forEach((e=>{this.elements.delete(e),console.log(`ğŸ—‘ï¸ æ¸…ç†ç„¡æ•ˆéŸ¿æ‡‰å¼å…ƒç´ : ${e}`)})),e.length>0&&console.log(`ğŸ§¹ æ¸…ç†äº† ${e.length} å€‹ç„¡æ•ˆå…ƒç´ `)}startPeriodicCleanup(){this.cleanupTimer&&clearInterval(this.cleanupTimer),this.cleanupTimer=window.setInterval((()=>{this.cleanupInvalidElements()}),3e4)}getViewportInfo(){return{...this.currentViewport}}forceUpdate(e=!0){console.log("ğŸ”„ å¼·åˆ¶æ›´æ–°æ‰€æœ‰éŸ¿æ‡‰å¼å…ƒç´ ");const t=this.calculateViewportInfo();return console.log("ğŸ“ ç•¶å‰è¦–çª—ä¿¡æ¯:",{width:t.width,height:t.height,scale:t.scale,isFullscreen:t.isFullscreen,deviceType:t.deviceType,orientation:t.orientation}),console.log("ğŸ¯ è¨»å†Šçš„å…ƒç´ æ•¸é‡:",this.elements.size),this.updateAllElements(e)}getPerformanceStats(){return{...this.performanceMonitor.getStats(),elementsCount:this.elements.size,currentViewport:this.currentViewport,config:this.config}}getOptimizationSuggestions(){const e=[],t=this.performanceMonitor.getStats();this.elements.size>100&&e.push(`å…ƒç´ æ•¸é‡éå¤š (${this.elements.size})ï¼Œè€ƒæ…®åˆ†çµ„ç®¡ç†`),t.avgUpdateTime>50&&e.push(`å¹³å‡æ›´æ–°æ™‚é–“éé•· (${t.avgUpdateTime.toFixed(2)}ms)ï¼Œè€ƒæ…®å¢åŠ é˜²æŠ–é–“éš”`);return"ä¸Šå‡ âš ï¸"===this.getMemoryTrend()&&e.push("è¨˜æ†¶é«”ä½¿ç”¨å‘ˆä¸Šå‡è¶¨å‹¢ï¼Œæª¢æŸ¥æ˜¯å¦æœ‰è¨˜æ†¶é«”æ´©æ¼"),this.config.throttleMs<50&&e.push("é˜²æŠ–é–“éš”éçŸ­ï¼Œå¯èƒ½å½±éŸ¿æ€§èƒ½"),e}getMemoryTrend(){const e=this.performanceMonitor.getStats().memoryUsage;if(e.length<5)return"æ•¸æ“šä¸è¶³";const t=e.slice(-3),s=e.slice(-6,-3);if(0===s.length)return"ç©©å®š";const i=t.reduce(((e,t)=>e+t),0)/t.length-s.reduce(((e,t)=>e+t),0)/s.length;return i>5?"ä¸Šå‡ âš ï¸":i<-5?"ä¸‹é™ âœ…":"ç©©å®š âœ…"}forceGarbageCollection(){window.gc?(window.gc(),console.log("ğŸ§¹ å¼·åˆ¶åƒåœ¾å›æ”¶å·²åŸ·è¡Œ")):console.log("âš ï¸ ç€è¦½å™¨ä¸æ”¯æ´å¼·åˆ¶åƒåœ¾å›æ”¶")}destroy(){this.updateThrottleTimer&&(clearTimeout(this.updateThrottleTimer),this.updateThrottleTimer=null),this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.elements.clear(),console.log("ğŸ§¹ éŸ¿æ‡‰å¼ç®¡ç†å™¨å·²éŠ·æ¯€ï¼ˆåŒ…å«æ€§èƒ½å„ªåŒ–æ¸…ç†ï¼‰")}};t(h,"DEFAULT_CONFIG",{baseWidth:1274,baseHeight:739,minScale:.3,maxScale:2,aspectRatio:1274/739,enableSmoothing:!0,animationDuration:300,throttleMs:100});let c=h;class d{constructor(e,s,i){t(this,"scene"),t(this,"container"),t(this,"background"),t(this,"healthBar"),t(this,"border"),t(this,"healthText"),t(this,"heartIcon"),t(this,"maxHealth",100),t(this,"currentHealth",100),t(this,"barWidth",200),t(this,"barHeight",20),t(this,"colors",{background:3355443,border:0,healthy:65280,warning:16776960,danger:16737792,critical:16711680}),this.scene=e,this.container=e.add.container(s,i),this.container.setDepth(100),this.createHealthBar(),this.createHeartIcon(),this.createHealthText(),console.log("â¤ï¸ è¡€æ¢çµ„ä»¶å·²å‰µå»º")}createHealthBar(){this.background=this.scene.add.graphics(),this.background.fillStyle(this.colors.background),this.background.fillRoundedRect(0,0,this.barWidth,this.barHeight,5),this.healthBar=this.scene.add.graphics(),this.updateHealthBarColor(),this.healthBar.fillRoundedRect(2,2,this.barWidth-4,this.barHeight-4,3),this.border=this.scene.add.graphics(),this.border.lineStyle(2,this.colors.border),this.border.strokeRoundedRect(0,0,this.barWidth,this.barHeight,5),this.container.add([this.background,this.healthBar,this.border])}createHeartIcon(){this.heartIcon=this.scene.add.graphics(),this.heartIcon.fillStyle(16711680),this.heartIcon.beginPath();const e=this.barHeight/2;this.heartIcon.arc(-27,e-2,4,0,Math.PI,!0),this.heartIcon.arc(-23,e-2,4,0,Math.PI,!0),this.heartIcon.lineTo(-25,e+4),this.heartIcon.closePath(),this.heartIcon.fillPath(),this.container.add(this.heartIcon)}createHealthText(){this.healthText=this.scene.add.text(this.barWidth+10,this.barHeight/2,`${this.currentHealth}/${this.maxHealth}`,{fontSize:"16px",color:"#ffffff",fontStyle:"bold"}),this.healthText.setOrigin(0,.5),this.container.add(this.healthText)}updateHealthBarColor(){const e=this.currentHealth/this.maxHealth*100;let t;t=e>=80?this.colors.healthy:e>=40?this.colors.warning:e>=20?this.colors.danger:this.colors.critical,this.healthBar.clear(),this.healthBar.fillStyle(t);const s=(this.barWidth-4)*this.currentHealth/this.maxHealth;this.healthBar.fillRoundedRect(2,2,s,this.barHeight-4,3)}updateHealth(e,t=!0){const s=this.currentHealth;this.currentHealth=Math.max(0,Math.min(e,this.maxHealth)),console.log(`â¤ï¸ è¡€æ¢æ›´æ–°: ${s} â†’ ${this.currentHealth}`),t&&s!==this.currentHealth?this.animateHealthChange(s,this.currentHealth):(this.updateHealthBarColor(),this.updateHealthText()),this.currentHealth<=20&&this.currentHealth>0&&this.startCriticalHealthEffect()}animateHealthChange(e,t){this.scene.tweens.add({targets:{health:e},health:t,duration:500,ease:"Power2",onUpdate:e=>{const t=Math.round(e.targets[0].health);this.currentHealth=t,this.updateHealthBarColor(),this.updateHealthText()},onComplete:()=>{console.log("â¤ï¸ è¡€æ¢å‹•ç•«å®Œæˆ")}}),t<e&&this.scene.tweens.add({targets:this.container,x:this.container.x+5,duration:50,yoyo:!0,repeat:3,ease:"Power2"})}updateHealthText(){this.healthText.setText(`${this.currentHealth}/${this.maxHealth}`);const e=this.currentHealth/this.maxHealth*100;e<=20?this.healthText.setColor("#ff0000"):e<=40?this.healthText.setColor("#ff6600"):this.healthText.setColor("#ffffff")}startCriticalHealthEffect(){this.scene.tweens.killTweensOf(this.healthBar),this.scene.tweens.add({targets:this.healthBar,alpha:.3,duration:300,yoyo:!0,repeat:-1,ease:"Power2"})}stopCriticalHealthEffect(){this.scene.tweens.killTweensOf(this.healthBar),this.healthBar.setAlpha(1)}setPosition(e,t){this.container.setPosition(e,t)}setVisible(e){this.container.setVisible(e)}destroy(){this.scene.tweens.killTweensOf(this.container),this.scene.tweens.killTweensOf(this.healthBar),this.container.destroy(),console.log("â¤ï¸ è¡€æ¢çµ„ä»¶å·²éŠ·æ¯€")}getCurrentHealth(){return this.currentHealth}getMaxHealth(){return this.maxHealth}getContainer(){return this.container}setMaxHealth(e){this.maxHealth=e,this.updateHealthBarColor(),this.updateHealthText()}}const g=class e{constructor(s,i){t(this,"scene"),t(this,"container"),t(this,"background"),t(this,"icon"),t(this,"tooltip"),t(this,"isFullscreen",!1),t(this,"isHovered",!1),t(this,"isPressed",!1),t(this,"config"),t(this,"errorStats",new Map),t(this,"lastErrorTime",0),t(this,"retryCount",0),t(this,"maxRetries",3);try{this.scene=s,this.config={...e.DEFAULT_CONFIG,...i},this.createButton(),this.setupEvents(),this.updatePosition(),this.checkFullscreenStatus(),this.scene.time.delayedCall(3e3,(()=>{this.showFeatureIntro()})),console.log("ğŸ–¥ï¸ å°ˆæ¥­å…¨è¢å¹•æŒ‰éˆ•å·²å‰µå»ºï¼ˆæ•´åˆéŸ¿æ‡‰å¼ç®¡ç†å™¨ + UXå„ªåŒ–ï¼‰")}catch(o){throw console.error("âŒ å…¨è¢å¹•æŒ‰éˆ•å‰µå»ºå¤±æ•—:",o),o}}createButton(){this.container=this.scene.add.container(0,0),this.container.setDepth(1e3),this.background=this.scene.add.graphics(),this.drawBackground(),this.icon=this.scene.add.graphics(),this.drawIcon(),this.container.add([this.background,this.icon]),this.container.setSize(this.config.size,this.config.size),this.container.setInteractive({useHandCursor:!0,hitArea:new Phaser.Geom.Rectangle(-this.config.size/2,-this.config.size/2,this.config.size,this.config.size),hitAreaCallback:Phaser.Geom.Rectangle.Contains})}drawBackground(){this.background.clear();const{size:e,cornerRadius:t}=this.config,s=this.config.colors;let i=s.background,o=s.border,n=.8;this.isPressed?(i=s.backgroundActive,o=s.borderHover,n=.95):this.isHovered&&(i=s.backgroundHover,o=s.borderHover,n=.9),this.background.fillStyle(i,n),this.background.fillRoundedRect(-e/2,-e/2,e,e,t),this.background.lineStyle(2,o,.6),this.background.strokeRoundedRect(-e/2,-e/2,e,e,t),this.isPressed&&(this.background.lineStyle(1,0,.3),this.background.strokeRoundedRect(-e/2+1,-e/2+1,e-2,e-2,t-1))}drawIcon(){if(this.icon.clear(),this.icon.lineStyle(2,this.config.colors.icon,1),this.isFullscreen){const e=.6*this.config.size/2;this.icon.beginPath(),this.icon.moveTo(6-e,-e),this.icon.lineTo(6-e,6-e),this.icon.lineTo(-e,6-e),this.icon.strokePath(),this.icon.beginPath(),this.icon.moveTo(e,6-e),this.icon.lineTo(e-6,6-e),this.icon.lineTo(e-6,-e),this.icon.strokePath(),this.icon.beginPath(),this.icon.moveTo(-e,e-6),this.icon.lineTo(6-e,e-6),this.icon.lineTo(6-e,e),this.icon.strokePath(),this.icon.beginPath(),this.icon.moveTo(e-6,e),this.icon.lineTo(e-6,e-6),this.icon.lineTo(e,e-6),this.icon.strokePath()}else{const e=.6*this.config.size/2;this.icon.beginPath(),this.icon.moveTo(-e,6-e),this.icon.lineTo(-e,-e),this.icon.lineTo(6-e,-e),this.icon.strokePath(),this.icon.beginPath(),this.icon.moveTo(e-6,-e),this.icon.lineTo(e,-e),this.icon.lineTo(e,6-e),this.icon.strokePath(),this.icon.beginPath(),this.icon.moveTo(-e,e-6),this.icon.lineTo(-e,e),this.icon.lineTo(6-e,e),this.icon.strokePath(),this.icon.beginPath(),this.icon.moveTo(e-6,e),this.icon.lineTo(e,e),this.icon.lineTo(e,e-6),this.icon.strokePath()}}setupEvents(){this.container.on("pointerover",this.onPointerOver,this),this.container.on("pointerout",this.onPointerOut,this),this.container.on("pointerdown",this.onPointerDown,this),this.container.on("pointerup",this.onPointerUp,this),document.addEventListener("fullscreenchange",this.onFullscreenChange.bind(this)),document.addEventListener("webkitfullscreenchange",this.onFullscreenChange.bind(this)),document.addEventListener("mozfullscreenchange",this.onFullscreenChange.bind(this)),document.addEventListener("MSFullscreenChange",this.onFullscreenChange.bind(this)),this.scene.input.keyboard?.on("keydown-F11",(e=>{e.preventDefault(),this.toggleFullscreen(),this.showKeyboardHint("F11 å¿«æ·éµå·²è§¸ç™¼")})),this.scene.input.keyboard?.on("keydown-ESC",(()=>{this.isFullscreen&&(this.exitFullscreen(),this.showKeyboardHint("ESC å¿«æ·éµå·²è§¸ç™¼"))})),this.showInitialHint()}onPointerOver(){this.isHovered||(this.isHovered=!0,this.updateVisuals(),this.playHoverAnimation(),this.showTooltip())}onPointerOut(){this.isHovered&&(this.isHovered=!1,this.isPressed=!1,this.updateVisuals(),this.playNormalAnimation(),this.hideTooltip())}onPointerDown(){this.isPressed=!0,this.updateVisuals(),this.playClickAnimation()}onPointerUp(){this.isPressed&&(this.isPressed=!1,this.updateVisuals(),this.toggleFullscreen())}updateVisuals(){this.drawBackground(),this.drawIcon()}playHoverAnimation(){this.scene.tweens.add({targets:this.container,scaleX:this.config.animations.hoverScale,scaleY:this.config.animations.hoverScale,duration:this.config.animations.duration,ease:"Power2"})}playNormalAnimation(){this.scene.tweens.add({targets:this.container,scaleX:1,scaleY:1,duration:this.config.animations.duration,ease:"Power2"})}playClickAnimation(){this.scene.tweens.add({targets:this.container,scaleX:this.config.animations.clickScale,scaleY:this.config.animations.clickScale,duration:this.config.animations.duration/2,ease:"Power2",yoyo:!0})}showTooltip(){if(this.tooltip)return;const e=this.isFullscreen?"é€€å‡ºå…¨è¢å¹• (F11)":"é€²å…¥å…¨è¢å¹• (F11)",t=this.scene.add.graphics();t.fillStyle(0,.8),t.fillRoundedRect(-50,-15,100,30,4);const s=this.scene.add.text(0,0,e,{fontSize:"12px",color:"#ffffff",align:"center"}).setOrigin(.5);this.tooltip=this.scene.add.container(this.container.x-60,this.container.y-40),this.tooltip.add([t,s]),this.tooltip.setDepth(1001),this.tooltip.setAlpha(0),this.scene.tweens.add({targets:this.tooltip,alpha:1,duration:200,ease:"Power2"})}hideTooltip(){this.tooltip&&this.scene.tweens.add({targets:this.tooltip,alpha:0,duration:200,ease:"Power2",onComplete:()=>{this.tooltip?.destroy(),this.tooltip=void 0}})}onHover(){this.background.clear(),this.background.fillStyle(this.config.colors.backgroundHover,.9),this.background.fillRoundedRect(-this.config.size/2,-this.config.size/2,this.config.size,this.config.size,this.config.cornerRadius),this.background.lineStyle(2,this.config.colors.iconHover,.8),this.background.strokeRoundedRect(-this.config.size/2,-this.config.size/2,this.config.size,this.config.size,this.config.cornerRadius),this.icon.clear(),this.icon.lineStyle(2,this.config.colors.iconHover,1),this.drawIcon(),this.container.setScale(1.1)}onOut(){this.background.clear(),this.background.fillStyle(this.config.colors.background,.7),this.background.fillRoundedRect(-this.config.size/2,-this.config.size/2,this.config.size,this.config.size,this.config.cornerRadius),this.background.lineStyle(2,16777215,.3),this.background.strokeRoundedRect(-this.config.size/2,-this.config.size/2,this.config.size,this.config.size,this.config.cornerRadius),this.icon.clear(),this.icon.lineStyle(2,this.config.colors.icon,1),this.drawIcon(),this.container.setScale(1)}async toggleFullscreen(){try{this.isFullscreen?await this.exitFullscreen():await this.enterFullscreen()}catch(e){this.handleFullscreenError(e)}}async enterFullscreen(){const e=document.documentElement;if(!this.isFullscreenSupported())throw new Error("ç€è¦½å™¨ä¸æ”¯æ´å…¨è¢å¹• API");e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.mozRequestFullScreen?await e.mozRequestFullScreen():e.msRequestFullscreen&&await e.msRequestFullscreen(),console.log("ğŸ–¥ï¸ æˆåŠŸé€²å…¥å…¨è¢å¹•æ¨¡å¼"),this.onFullscreenEnter()}async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen(),console.log("ğŸ–¥ï¸ æˆåŠŸé€€å‡ºå…¨è¢å¹•æ¨¡å¼"),this.onFullscreenExit()}isFullscreenSupported(){const e=document.documentElement;return!!(e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen)}handleFullscreenError(e){console.error("âŒ å…¨è¢å¹•æ“ä½œå¤±æ•—:",e);let t="å…¨è¢å¹•æ“ä½œå¤±æ•—",s="unknown";"NotAllowedError"===e.name?(console.warn("âš ï¸ å…¨è¢å¹•è¢«ç”¨æˆ¶æˆ–ç€è¦½å™¨æ”¿ç­–é˜»æ­¢"),t="å…¨è¢å¹•åŠŸèƒ½è¢«é˜»æ­¢ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®šæˆ–å˜—è©¦ç”¨æˆ¶æ‰‹å‹•è§¸ç™¼",s="permission"):"TypeError"===e.name?(console.warn("âš ï¸ ç€è¦½å™¨ä¸æ”¯æ´å…¨è¢å¹• API"),t="æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å…¨è¢å¹•åŠŸèƒ½ï¼Œè«‹å˜—è©¦æ›´æ–°ç€è¦½å™¨",s="unsupported"):"InvalidStateError"===e.name?(console.warn("âš ï¸ å…¨è¢å¹•ç‹€æ…‹ç„¡æ•ˆ"),t="å…¨è¢å¹•ç‹€æ…‹ç•°å¸¸ï¼Œè«‹é‡æ–°æ•´ç†é é¢",s="state"):"SecurityError"===e.name?(console.warn("âš ï¸ å…¨è¢å¹•å®‰å…¨é™åˆ¶"),t="å®‰å…¨é™åˆ¶é˜»æ­¢å…¨è¢å¹•ï¼Œè«‹ç¢ºä¿åœ¨å®‰å…¨ç’°å¢ƒä¸‹æ“ä½œ",s="security"):(console.warn("âš ï¸ å…¨è¢å¹•æ“ä½œé‡åˆ°æœªçŸ¥éŒ¯èª¤"),t="å…¨è¢å¹•æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–é‡æ–°æ•´ç†é é¢",s="unknown"),this.showErrorMessage(t,s),this.recordError(s,e.message)}recordError(e,t){const s=this.errorStats.get(e)||0;this.errorStats.set(e,s+1),this.lastErrorTime=Date.now(),console.log(`ğŸ“Š éŒ¯èª¤çµ±è¨ˆ - ${e}: ${s+1} æ¬¡`),s>=2&&this.showFrequentErrorAdvice(e)}showFrequentErrorAdvice(e){let t="";switch(e){case"permission":t="å»ºè­°ï¼šåœ¨ç”¨æˆ¶æ‰‹å‹¢å¾Œå†å˜—è©¦å…¨è¢å¹•ï¼Œæˆ–æª¢æŸ¥ç€è¦½å™¨æ¬Šé™è¨­å®š";break;case"unsupported":t="å»ºè­°ï¼šä½¿ç”¨æ”¯æ´å…¨è¢å¹• API çš„ç¾ä»£ç€è¦½å™¨";break;case"state":t="å»ºè­°ï¼šé‡æ–°æ•´ç†é é¢æˆ–ç­‰å¾…ä¸€æ®µæ™‚é–“å¾Œå†è©¦";break;case"security":t="å»ºè­°ï¼šç¢ºä¿åœ¨ HTTPS ç’°å¢ƒä¸‹ä½¿ç”¨ï¼Œæˆ–æª¢æŸ¥ç€è¦½å™¨å®‰å…¨è¨­å®š";break;default:t="å»ºè­°ï¼šé‡æ–°æ•´ç†é é¢æˆ–è¯ç¹«æŠ€è¡“æ”¯æ´"}console.log(`ğŸ’¡ ${t}`),this.showKeyboardHint(t)}attemptRecovery(){this.retryCount>=this.maxRetries?console.log("âš ï¸ å·²é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸ï¼Œåœæ­¢è‡ªå‹•æ¢å¾©"):(this.retryCount++,console.log(`ğŸ”„ å˜—è©¦è‡ªå‹•æ¢å¾© (${this.retryCount}/${this.maxRetries})`),this.checkFullscreenStatus(),this.updateVisuals(),setTimeout((()=>{this.retryCount<this.maxRetries&&console.log("ğŸ”„ æº–å‚™é‡æ–°å˜—è©¦å…¨è¢å¹•æ“ä½œ")}),2e3))}resetErrorState(){this.errorStats.clear(),this.retryCount=0,this.lastErrorTime=0,console.log("ğŸ”„ éŒ¯èª¤ç‹€æ…‹å·²é‡ç½®")}getErrorStats(){const e={};return this.errorStats.forEach(((t,s)=>{e[s]=t})),e}showErrorMessage(e,t="unknown"){const s=this.scene.add.container(this.container.x-80,this.container.y-60),i=this.scene.add.graphics();i.fillStyle(16729156,.9),i.fillRoundedRect(-70,-20,140,40,6);const o=this.scene.add.text(0,0,e,{fontSize:"11px",color:"#ffffff",align:"center",wordWrap:{width:130}}).setOrigin(.5);s.add([i,o]),s.setDepth(1002),this.scene.time.delayedCall(3e3,(()=>{s.destroy()}))}onFullscreenEnter(){setTimeout((()=>{this.scene.scale.refresh(),this.updatePosition(),this.triggerResponsiveUpdate()}),100),console.log("ğŸ® éŠæˆ²å·²é€²å…¥å…¨è¢å¹•æ¨¡å¼")}onFullscreenExit(){setTimeout((()=>{this.scene.scale.refresh(),this.updatePosition(),this.triggerResponsiveUpdate()}),100),console.log("ğŸ® éŠæˆ²å·²é€€å‡ºå…¨è¢å¹•æ¨¡å¼")}triggerResponsiveUpdate(){const e=this.scene;e.responsiveManager&&"function"==typeof e.responsiveManager.forceUpdate?(console.log("ğŸ”„ è§¸ç™¼éŸ¿æ‡‰å¼ç®¡ç†å™¨å…¨åŸŸæ›´æ–°ï¼ˆå¸¶å¹³æ»‘å‹•ç•«ï¼‰"),e.responsiveManager.forceUpdate(!0)):console.log("âš ï¸ éŸ¿æ‡‰å¼ç®¡ç†å™¨æœªæ‰¾åˆ°ï¼Œè·³éæ›´æ–°")}showKeyboardHint(e){const t=this.scene.add.container(this.container.x-80,this.container.y-80),s=this.scene.add.graphics();s.fillStyle(5025616,.9),s.fillRoundedRect(-60,-15,120,30,6);const i=this.scene.add.text(0,0,e,{fontSize:"11px",color:"#ffffff",align:"center"}).setOrigin(.5);t.add([s,i]),t.setDepth(1003),t.setAlpha(0),this.scene.tweens.add({targets:t,alpha:1,duration:200,ease:"Power2",onComplete:()=>{this.scene.time.delayedCall(2e3,(()=>{this.scene.tweens.add({targets:t,alpha:0,duration:300,ease:"Power2",onComplete:()=>t.destroy()})}))}})}showInitialHint(){this.scene.time.delayedCall(5e3,(()=>{this.isFullscreen||this.showKeyboardHint("æŒ‰ F11 é€²å…¥å…¨è¢å¹•")})),this.scene.time.delayedCall(15e3,(()=>{this.isFullscreen||this.showAdvancedHints()}))}showAdvancedHints(){const e=["ğŸ’¡ å…¨è¢å¹•æ¨¡å¼å¯ç²å¾—æ›´å¥½çš„éŠæˆ²é«”é©—","ğŸ® æ”¯æ´éµç›¤å¿«æ·éµ F11 å’Œ ESC","ğŸ“± åœ¨ä¸åŒè¨­å‚™ä¸Šéƒ½èƒ½å®Œç¾é©é…","âœ¨ äº«å—æ²‰æµ¸å¼çš„å¤ªç©ºå†’éšª"],t=e[Math.floor(Math.random()*e.length)];this.showKeyboardHint(t)}showSmartHints(){const e=this.scene;e.score&&e.score>100?this.showKeyboardHint("ğŸ† åˆ†æ•¸ä¸éŒ¯ï¼å…¨è¢å¹•æ¨¡å¼é«”é©—æ›´ä½³"):e.gameStarted&&this.showKeyboardHint("ğŸ¯ éŠæˆ²é€²è¡Œä¸­ï¼Œè©¦è©¦å…¨è¢å¹•æ¨¡å¼")}analyzeUserBehavior(){this.isHovered&&this.scene.time.delayedCall(3e3,(()=>{this.isHovered&&!this.isFullscreen&&this.showKeyboardHint("é»æ“Šé€²å…¥å…¨è¢å¹•ï¼Œæˆ–æŒ‰ F11")})),this.errorStats.size>0&&this.showTroubleshootingTips()}showTroubleshootingTips(){const e=["ğŸ”§ å¦‚æœå…¨è¢å¹•ç„¡æ³•ä½¿ç”¨ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®š","ğŸ”„ å˜—è©¦é‡æ–°æ•´ç†é é¢å¾Œå†è©¦","ğŸŒ å»ºè­°ä½¿ç”¨ Chrome æˆ– Firefox ç€è¦½å™¨","ğŸ”’ ç¢ºä¿åœ¨å®‰å…¨çš„ HTTPS ç’°å¢ƒä¸‹ä½¿ç”¨"],t=e[Math.floor(Math.random()*e.length)];this.showKeyboardHint(t)}showFeatureIntro(){const e=this.scene.add.container(this.container.x-120,this.container.y-100),t=this.scene.add.graphics();t.fillStyle(2201331,.95),t.fillRoundedRect(-100,-40,200,80,8);const s=this.scene.add.text(0,-15,"ğŸ–¥ï¸ å…¨è¢å¹•åŠŸèƒ½",{fontSize:"14px",color:"#ffffff",fontStyle:"bold",align:"center"}).setOrigin(.5),i=this.scene.add.text(0,10,"é»æ“ŠæŒ‰éˆ•æˆ–æŒ‰ F11\nç²å¾—æœ€ä½³éŠæˆ²é«”é©—",{fontSize:"11px",color:"#ffffff",align:"center"}).setOrigin(.5);e.add([t,s,i]),e.setDepth(1004),e.setAlpha(0),this.scene.tweens.add({targets:e,alpha:1,duration:300,ease:"Power2",onComplete:()=>{this.scene.time.delayedCall(4e3,(()=>{this.scene.tweens.add({targets:e,alpha:0,duration:500,ease:"Power2",onComplete:()=>e.destroy()})}))}})}onFullscreenChange(){this.checkFullscreenStatus(),this.drawIcon(),console.log("ğŸ–¥ï¸ å…¨è¢å¹•ç‹€æ…‹è®ŠåŒ–:",{isFullscreen:this.isFullscreen,windowSize:{width:window.innerWidth,height:window.innerHeight},gameSize:{width:this.scene.scale.gameSize.width,height:this.scene.scale.gameSize.height}}),setTimeout((()=>{this.scene.scale.refresh();const e=this.scene;e.responsiveManager?(console.log("ğŸ”„ è§¸ç™¼éŸ¿æ‡‰å¼ç®¡ç†å™¨å¼·åˆ¶æ›´æ–°..."),e.responsiveManager.forceUpdate(!0),console.log("âœ… éŸ¿æ‡‰å¼ç®¡ç†å™¨æ›´æ–°å®Œæˆ")):console.warn("âš ï¸ éŸ¿æ‡‰å¼ç®¡ç†å™¨ä¸å­˜åœ¨"),this.updatePosition(),console.log("ğŸ¯ å…¨è¢å¹•è‡ªé©æ‡‰è™•ç†å®Œæˆ")}),150)}checkFullscreenStatus(){this.isFullscreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}updatePosition(){const e=this.scene.scale.gameSize,t=e.width-this.config.size/2-16,s=e.height-this.config.size/2-16;this.container.setPosition(t,s)}destroy(){document.removeEventListener("fullscreenchange",this.onFullscreenChange.bind(this)),document.removeEventListener("webkitfullscreenchange",this.onFullscreenChange.bind(this)),document.removeEventListener("mozfullscreenchange",this.onFullscreenChange.bind(this)),document.removeEventListener("MSFullscreenChange",this.onFullscreenChange.bind(this)),this.container.destroy(),console.log("ğŸ—‘ï¸ å…¨è¢å¹•æŒ‰éˆ•å·²éŠ·æ¯€")}};t(g,"DEFAULT_CONFIG",{size:48,cornerRadius:8,colors:{background:0,backgroundHover:3355443,backgroundActive:5592405,icon:16777215,iconHover:65416,border:6710886,borderHover:65416},animations:{hoverScale:1.1,clickScale:.95,duration:150}});let u=g;class p extends s.Scene{constructor(){super({key:"GameScene"}),t(this,"gameConfig"),t(this,"gameState",{isPlaying:!1,isPaused:!1,currentScore:0,currentHealth:100,wordsLearned:0,accuracy:0}),t(this,"player"),t(this,"shooterContainer"),t(this,"clouds"),t(this,"cursors"),t(this,"backgroundLayers",[]),t(this,"scoreText"),t(this,"healthBar"),t(this,"targetWordText"),t(this,"accuracyText"),t(this,"wordsLearnedText"),t(this,"geptManager"),t(this,"collisionSystem"),t(this,"memoryEngine"),t(this,"bilingualManager"),t(this,"chineseUIManager"),t(this,"responsiveManager"),t(this,"fullscreenButton"),t(this,"useBackupCloudTexture",!1),t(this,"cloudSpawnTimer"),t(this,"currentTargetWord"),t(this,"targetWordSetTime",0),t(this,"totalCollisions",0),t(this,"correctCollisions",0),t(this,"wrongCollisions",0),t(this,"showStartScreen",!0),t(this,"gameStarted",!1),t(this,"startScreen"),t(this,"playButton")}init(){console.log("ğŸ® åˆå§‹åŒ–éŠæˆ²å ´æ™¯"),this.gameConfig=this.registry.get("gameConfig")||{geptLevel:"elementary",enableSound:!0,enableHapticFeedback:!0,difficulty:"medium",gameMode:"practice"},console.log("ğŸ“‹ éŠæˆ²é…ç½®:",this.gameConfig),this.initializeManagers()}initializeManagers(){try{console.log("ğŸ”§ é–‹å§‹åˆå§‹åŒ–ç®¡ç†å™¨ç³»çµ±..."),console.log("ğŸ“š åˆå§‹åŒ– GEPT ç®¡ç†å™¨..."),this.geptManager=new i,this.geptManager.setLevel(this.gameConfig.geptLevel),console.log("âœ… GEPT ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ"),console.log("ğŸ§  åˆå§‹åŒ–è¨˜æ†¶å¢å¼·å¼•æ“..."),this.memoryEngine=new o,console.log("âœ… è¨˜æ†¶å¢å¼·å¼•æ“åˆå§‹åŒ–å®Œæˆ"),console.log("ğŸ’¥ åˆå§‹åŒ–ç¢°æ’æª¢æ¸¬ç³»çµ±..."),this.collisionSystem=new n(this,this.gameConfig.geptLevel,{enableParticles:!0,enableScreenShake:!0,enableSoundEffects:this.gameConfig.enableSound,enableVisualFeedback:!0,particleIntensity:"medium",soundVolume:.7}),console.log("âœ… ç¢°æ’æª¢æ¸¬ç³»çµ±åˆå§‹åŒ–å®Œæˆ"),console.log("ğŸŒ åˆå§‹åŒ–é›™èªç®¡ç†å™¨..."),this.bilingualManager=new a(this,this.geptManager),console.log("âœ… é›™èªç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ"),console.log("ğŸˆ³ åˆå§‹åŒ–ä¸­æ–‡ UI ç®¡ç†å™¨..."),this.chineseUIManager=new r(this,this.geptManager,this.bilingualManager),console.log("âœ… ä¸­æ–‡ UI ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ"),console.log("ğŸ“± åˆå§‹åŒ–éŸ¿æ‡‰å¼ç®¡ç†å™¨..."),this.responsiveManager=new c(this,{baseWidth:1274,baseHeight:739,enableSmoothing:!0,animationDuration:300}),console.log("âœ… éŸ¿æ‡‰å¼ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ"),console.log("ğŸ‰ æ‰€æœ‰ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆï¼ˆåŒ…å«é›™èªç³»çµ± + éŸ¿æ‡‰å¼ç®¡ç†å™¨ï¼‰")}catch(e){throw console.error("âŒ ç®¡ç†å™¨åˆå§‹åŒ–å¤±æ•—:",e),e}}preload(){console.log("ğŸ¨ è¼‰å…¥éŠæˆ²è³‡æº"),this.loadMoonBackground(),console.log("ğŸš€ è¼‰å…¥ç©å®¶å¤ªç©ºèˆ¹ç²¾éˆè¡¨..."),this.load.spritesheet("player_spaceship","assets/sprite_player_spaceship_up_down.png",{frameWidth:Math.floor(350),frameHeight:150}),this.load.spritesheet("random_shooter","assets/random_shooter-sheet.png",{frameWidth:64,frameHeight:64}),this.load.image("player_spaceship_image","assets/sprite_player_spaceship_up_down.png"),this.load.image("complete_spaceship","assets/complete_spaceship.png"),console.log("âœ… å¤ªç©ºèˆ¹è³‡æºè¼‰å…¥é…ç½®å®Œæˆ"),console.log("âœˆï¸ å‰µå»ºç©å®¶é£›æ©Ÿç´‹ç† - æ¢å¾©åŸç‰ˆ + å¢å¼·");try{const e=this.add.graphics();e.fillStyle(26367),e.fillTriangle(16,0,0,32,32,32),e.lineStyle(2,16777215,1),e.strokeTriangle(16,0,0,32,32,32),e.generateTexture("player-plane",32,32),e.destroy(),console.log("âœ… å‚™ç”¨é£›æ©Ÿç´‹ç†å‰µå»ºå®Œæˆ")}catch(s){console.error("âŒ å‚™ç”¨é£›æ©Ÿç´‹ç†å‰µå»ºå¤±æ•—:",s)}this.load.image("cloud-word","assets/images/cloud_shape3_3.png"),this.load.on("filecomplete-image-cloud-word",(()=>{console.log("âœ… é›²æœµåœ–ç‰‡è¼‰å…¥æˆåŠŸ")})),this.load.on("loaderror",(e=>{"cloud-word"===e.key&&(console.log("âš ï¸ é›²æœµåœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨æ·ºè—è‰²å‚™ç”¨ç´‹ç†ï¼ˆé˜²æ­¢ç™½è‰²é–ƒçˆï¼‰"),this.useBackupCloudTexture=!0)}));const e=this.add.graphics();e.fillStyle(15135743),e.fillEllipse(32,16,60,28),e.lineStyle(2,4886754),e.strokeEllipse(32,16,60,28),e.generateTexture("cloud-word-fallback",64,32),e.destroy(),console.log("â˜ï¸ å‚™ç”¨é›²æœµç´‹ç†å·²å‰µå»ºï¼ˆæ·ºè—è‰²ï¼Œé˜²æ­¢ç™½è‰²é–ƒçˆï¼‰");const t=this.add.graphics();t.fillStyle(16777215),t.fillCircle(2,2,2),t.generateTexture("star",4,4),t.destroy(),this.load.on("complete",(()=>{console.log("âœ… ç°¡åŒ–è³‡æºè¼‰å…¥å®Œæˆ - æº–å‚™æ¸¬è©¦å…¨è¢å¹•æŒ‰éˆ•")})),console.log("ğŸ¨ ç°¡åŒ–éŠæˆ²è³‡æºè¼‰å…¥æ’ç¨‹å®Œæˆï¼ˆå°ˆæ³¨æ¸¬è©¦å…¨è¢å¹•æŒ‰éˆ•ï¼‰")}createSpaceshipAnimation(){if(console.log("ğŸš€ å‰µå»ºæ–°å¤ªç©ºèˆ¹å‹•ç•«é…ç½®"),this.textures.exists("player_spaceship")){console.log("âœ¨ ä½¿ç”¨æ–°çš„ç©å®¶å¤ªç©ºèˆ¹ç²¾éˆè¡¨");const e=this.textures.get("player_spaceship");console.log("ğŸ” ç²¾éˆè¡¨è©³ç´°ä¿¡æ¯:",{key:"player_spaceship",width:e.source[0].width,height:e.source[0].height,frameTotal:e.frameTotal,frames:Object.keys(e.frames)}),this.anims.create({key:"spaceship_fly",frames:this.anims.generateFrameNumbers("player_spaceship",{start:0,end:6}),frameRate:10,repeat:-1,yoyo:!1}),console.log("âœ… å¤ªç©ºèˆ¹é£›è¡Œå‹•ç•«å‰µå»ºå®Œæˆ: spaceship_fly (7å¹€å‹•ç•«ï¼Œ292x512)")}else this.textures.exists("random_shooter")?(console.log("ğŸ”„ å‚™ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨åŸå§‹ç²¾éˆè¡¨"),this.anims.create({key:"spaceship_fly",frames:this.anims.generateFrameNumbers("random_shooter",{start:0,end:3}),frameRate:6,repeat:-1,yoyo:!1}),console.log("âœ… å‚™ç”¨å¤ªç©ºèˆ¹å‹•ç•«å‰µå»ºå®Œæˆ: spaceship_fly (åŸå§‹ç²¾éˆè¡¨)")):console.warn("âš ï¸ æ²’æœ‰å¯ç”¨çš„å¤ªç©ºèˆ¹ç²¾éˆè¡¨ï¼Œè·³éå‹•ç•«å‰µå»º")}createSpaceshipSprite(){const e=[];for(let t=0;t<4;t++){const i=this.add.graphics(),o=200+10*t,n=s.Display.Color.HSVToRGB(o/360,.8,.9);i.fillStyle(n.color),i.fillEllipse(32,32,24,40),i.fillTriangle(8,20,20,32,8,44),i.fillTriangle(56,20,44,32,56,44),i.fillStyle(65535),i.fillEllipse(32,28,8,12);const a=.5+.2*t;i.fillStyle(s.Display.Color.GetColor(255,100+30*t,0)),i.fillEllipse(32,50+t,6,8*a),i.generateTexture(`spaceship_${t}`,64,64),i.destroy(),e.push({key:`spaceship_${t}`})}this.anims.create({key:"spaceship_backup_anim",frames:e,frameRate:8,repeat:-1})}createDynamicSprite(){const e=[];for(let t=0;t<8;t++){const i=this.add.graphics(),o=45*t%360,n=s.Display.Color.HSVToRGB(o/360,.8,.9);i.fillStyle(n.color),i.fillCircle(32,32,28),i.lineStyle(3,16777215),i.strokeCircle(32,32,28),i.generateTexture(`enemy_circle_${t}`,64,64),i.destroy(),e.push({key:`enemy_circle_${t}`})}this.anims.create({key:"enemy_circle_anim",frames:e,frameRate:10,repeat:-1})}loadMoonBackground(){console.log("ğŸŒ™ è¼‰å…¥æœˆäº®ä¸»é¡ŒèƒŒæ™¯");try{this.load.image("moon-sky","assets/backgrounds/moon/moon_sky.png"),this.load.image("moon-back","assets/backgrounds/moon/moon_back.png"),this.load.image("moon-mid","assets/backgrounds/moon/moon_mid.png"),this.load.image("moon-earth","assets/backgrounds/moon/moon_earth.png"),this.load.image("moon-front","assets/backgrounds/moon/moon_front.png"),this.load.image("moon-floor","assets/backgrounds/moon/moon_floor.png"),console.log("ğŸŒ™ çœŸå¯¦æœˆäº®èƒŒæ™¯åœ–ç‰‡è¼‰å…¥æ’ç¨‹å®Œæˆï¼ˆç›¸å°è·¯å¾‘ï¼‰")}catch(e){console.warn("âš ï¸ æœˆäº®èƒŒæ™¯è¼‰å…¥å¤±æ•—ï¼Œå°‡ä½¿ç”¨å‚™ç”¨èƒŒæ™¯:",e)}}create(){console.log("ğŸ—ï¸ å‰µå»ºéŠæˆ²å ´æ™¯"),this.createSpaceshipAnimation(),this.createParallaxBackground(),this.createPlayer(),this.createClouds(),this.createGameHUD(),this.setupInput(),this.setupPhysics(),this.setRandomTargetWord(),console.log("âœ… éŠæˆ²å ´æ™¯å‰µå»ºå®Œæˆ"),console.log("ğŸš€ è·³éé–‹å§‹ç•«é¢ï¼Œç›´æ¥é–‹å§‹éŠæˆ²"),this.showStartScreen=!1,this.gameStarted=!0,this.time.delayedCall(1e3,(()=>{console.log("ğŸ® å»¶é²å•Ÿå‹•éŠæˆ²..."),this.startGame()}))}updateClouds(){const e=this.clouds.children.entries.length;Math.floor(Date.now()/1e3)%5==0&&console.log("ğŸ”„ é›²æœµæ›´æ–°æª¢æŸ¥ - ç¸½æ•¸:",e),this.clouds.children.entries.forEach(((e,t)=>{if(Math.floor(Date.now()/1e3)%5==0&&console.log(`â˜ï¸ é›²æœµ ${t}: x=${Math.round(e.x)}, y=${Math.round(e.y)}, velocity=${e.body?.velocity?.x||"N/A"}`),e.x<-100){const t=e.getData("wordText");t&&t.destroy(),e.destroy(),console.log("ğŸ—‘ï¸ æ¸…ç†é›¢é–‹è¢å¹•çš„é›²æœµ - ä½ç½®:",e.x)}}))}createStartScreen(){console.log("ğŸ® å‰µå»º Wordwall é¢¨æ ¼é–‹å§‹ç•«é¢"),console.log("ğŸ” ç•¶å‰ç‹€æ…‹ - showStartScreen:",this.showStartScreen,"gameStarted:",this.gameStarted);const e=this.add.rectangle(637,369.5,1274,739,0,.7);e.setDepth(1e3),e.setInteractive(),e.on("pointerdown",(()=>{console.log("ğŸ–±ï¸ é®ç½©é»æ“Šæª¢æ¸¬ï¼Œé–‹å§‹éŠæˆ²"),this.showStartScreen&&(this.hideStartScreen(),this.startGame())})),this.startScreen=this.add.container(634,336),this.startScreen.setDepth(1001);const t=this.add.text(0,-150,"ğŸ›©ï¸ é£›æ©Ÿè‹±èªå­¸ç¿’éŠæˆ²",{fontSize:"48px",fontFamily:"Arial, sans-serif",color:"#FFFFFF",align:"center",fontStyle:"bold"}).setOrigin(.5),i=this.add.text(0,-80,"é§•é§›é£›æ©Ÿæ”¶é›†ç›®æ¨™è‹±æ–‡å–®å­—\né¿é–‹å…¶ä»–å–®å­—ï¼Œå­¸ç¿’æ›´æœ‰æ•ˆï¼",{fontSize:"24px",fontFamily:"Arial, sans-serif",color:"#CCCCCC",align:"center",lineSpacing:10}).setOrigin(.5),o=this.add.circle(0,50,80,5025616);o.setStrokeStyle(4,16777215);const n=this.add.text(0,50,"PLAY",{fontSize:"32px",fontFamily:"Arial, sans-serif",color:"#FFFFFF",fontStyle:"bold"}).setOrigin(.5);this.startScreen.add([t,i,o,n]),this.responsiveManager.registerElement("startScreen",this.startScreen,"ui",{anchor:{x:.5,y:.5},constraints:{keepAspectRatio:!0,minScale:.6,maxScale:1.2}}),o.setInteractive(new s.Geom.Circle(0,0,100),s.Geom.Circle.Contains),n.setInteractive({useHandCursor:!0});const a=()=>{console.log("ğŸ® é»æ“Š Play æŒ‰éˆ•ï¼Œé–‹å§‹éŠæˆ²"),this.hideStartScreen(),this.startGame()};o.on("pointerdown",a),n.on("pointerdown",a),this.input.on("pointerdown",(e=>{console.log("ğŸ–±ï¸ æª¢æ¸¬åˆ°é»æ“Šäº‹ä»¶ï¼ŒshowStartScreen:",this.showStartScreen),this.showStartScreen?(console.log("ğŸ® å…¨ç•«é¢é»æ“Šæª¢æ¸¬ï¼Œé–‹å§‹éŠæˆ²"),this.hideStartScreen(),this.startGame()):console.log("âš ï¸ é–‹å§‹ç•«é¢å·²éš±è—ï¼Œå¿½ç•¥é»æ“Š")})),o.on("pointerover",(()=>{o.setFillStyle(4563017),o.setScale(1.1)})),o.on("pointerout",(()=>{o.setFillStyle(5025616),o.setScale(1)})),console.log("âœ… Wordwall é¢¨æ ¼é–‹å§‹ç•«é¢å‰µå»ºå®Œæˆ")}hideStartScreen(){this.startScreen&&(this.responsiveManager.unregisterElement("startScreen"),this.startScreen.destroy(),this.startScreen=void 0),this.children.list.forEach((e=>{1e3===e.depth&&e.destroy()})),this.showStartScreen=!1,this.gameStarted=!0,console.log("ğŸ® é–‹å§‹ç•«é¢å·²éš±è—ï¼ŒéŠæˆ²é–‹å§‹")}createParallaxBackground(){console.log("ğŸŒŒ å‰µå»ºè¦–å·®èƒŒæ™¯");this.add.rectangle(637,369.5,1274,739,0).setDepth(-20),this.createMoonBackgroundLayers(),this.createStarField(),console.log("ğŸŒŒ è¦–å·®èƒŒæ™¯å‰µå»ºå®Œæˆ")}createMoonBackgroundLayers(){const e=[],t=this.textures.exists("moon-sky"),s=this.textures.exists("moon-back"),i=this.textures.exists("moon-mid"),o=this.textures.exists("moon-earth"),n=this.textures.exists("moon-front"),a=this.textures.exists("moon-floor");if(t||s||i||o||n||a){if(console.log("ğŸŒ™ ä½¿ç”¨çœŸå¯¦æœˆäº®ä¸»é¡ŒèƒŒæ™¯åœ–ç‰‡"),t){const t=this.add.tileSprite(0,0,1274,739,"moon-sky");t.setOrigin(0,0),t.setDepth(-20),e.push(t)}if(s){const t=this.add.tileSprite(0,0,1274,739,"moon-back");t.setOrigin(0,0),t.setDepth(-18),e.push(t)}if(o){console.log("ğŸŒ é‡æ–°åˆ†æåƒè€ƒåœ–ç‰‡ï¼Œä¿®æ­£åœ°çƒå¤§å°å’Œä½ç½®");const e=this.add.image(1220,277,"moon-earth");e.setDepth(100),e.setScale(.45),e.setAlpha(1),console.log("ğŸŒ åœ°çƒç¬¬ä¸‰æ¬¡å¾€ä¸Šç§»å‹•1/10å®Œæˆ:",{x:e.x,y:e.y,scale:e.scale,calculatedWidth:"3800*0.45=1710px",position:"ç¬¬ä¸‰æ¬¡å¾€ä¸Šç§»å‹• (1220, 277)",depth:e.depth})}if(i){const t=this.add.tileSprite(0,0,1274,739,"moon-mid");t.setOrigin(0,0),t.setDepth(-14),e.push(t)}if(n){const t=this.add.tileSprite(0,0,1274,739,"moon-front");t.setOrigin(0,0),t.setDepth(-12),e.push(t)}if(a){const t=this.add.tileSprite(0,0,1274,739,"moon-floor");t.setOrigin(0,0),t.setDepth(-10),e.push(t)}}else{console.log("ğŸŒŒ ä½¿ç”¨å‚™ç”¨æ¼¸å±¤èƒŒæ™¯");const t=this.add.graphics();t.fillGradientStyle(657966,657966,1710670,1710670),t.fillRect(0,0,800,600),t.generateTexture("fallback-bg-1",800,600),t.destroy();const s=this.add.graphics();s.fillGradientStyle(1710670,1710670,2763374,2763374),s.fillRect(0,0,800,600),s.generateTexture("fallback-bg-2",800,600),s.destroy();const i=this.add.tileSprite(0,0,800,600,"fallback-bg-1");i.setOrigin(0,0),i.setDepth(-15),i.setAlpha(.7),e.push(i);const o=this.add.tileSprite(0,0,800,600,"fallback-bg-2");o.setOrigin(0,0),o.setDepth(-13),o.setAlpha(.5),e.push(o)}this.backgroundLayers=e,this.registerBackgroundLayersToResponsiveManager()}createStarField(){console.log("â­ å‰µå»ºæ˜Ÿç©ºèƒŒæ™¯");for(let e=0;e<150;e++){const e=s.Math.Between(0,1268),t=s.Math.Between(0,500),i=this.add.image(e,t,"star"),o=s.Math.FloatBetween(.2,.8),n=s.Math.FloatBetween(.6,1);i.setScale(o),i.setAlpha(n),i.setDepth(-19),this.tweens.add({targets:i,alpha:.4*n,duration:s.Math.Between(3e3,6e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createPlayer(){console.log("ğŸ¯ å‰µå»ºç©å®¶å°„æ‰‹è§’è‰² - æ¢å¾©åŸç‰ˆå¤ªç©ºèˆ¹é‚è¼¯");const e=this.textures.exists("player_spaceship_image"),t=this.textures.exists("player_spaceship"),s=this.textures.exists("random_shooter"),i=this.textures.exists("complete_spaceship"),o=this.textures.exists("player-plane");if(console.log("ğŸ” æª¢æŸ¥å¯ç”¨è³‡æº:",{player_spaceship_image:e,player_spaceship:t,random_shooter:s,complete_spaceship:i,"player-plane":o}),t)console.log("ğŸš€ ä½¿ç”¨æ–°çš„ç©å®¶å¤ªç©ºèˆ¹ç²¾éˆè¡¨ - å‰µå»ºä¸€è‰˜å¤ªç©ºèˆ¹"),this.player=this.physics.add.sprite(150,336,"player_spaceship"),this.player.setOrigin(.5,.5),this.player.play("spaceship_fly"),console.log("âœ… å¤ªç©ºèˆ¹å‰µå»ºå®Œæˆï¼š1å€‹ç²¾éˆ + 7å¹€é£›è¡Œå‹•ç•« (292x512)");else if(e)console.log("ğŸš€ å‚™ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨æ–°çš„ç©å®¶å¤ªç©ºèˆ¹åœ–ç‰‡ï¼ˆæ™®é€šåœ–ç‰‡æ¨¡å¼ï¼‰"),this.player=this.physics.add.sprite(150,336,"player_spaceship_image"),console.log("âœ… æ–°å¤ªç©ºèˆ¹åœ–ç‰‡è¼‰å…¥ä¸­ï¼ˆéœæ…‹æ¨¡å¼ï¼‰");else if(s)console.log("ğŸ”„ å‚™ç”¨æ–¹æ¡ˆ1ï¼šä½¿ç”¨åŸå§‹ç²¾éˆè¡¨å‰µå»ºå¤ªç©ºèˆ¹å‹•ç•«"),this.player=this.physics.add.sprite(150,336,"random_shooter"),this.player.play("spaceship_fly"),console.log("âœ… å¤ªç©ºèˆ¹å‹•ç•«æ’­æ”¾ä¸­ï¼šspaceship_fly (åŸå§‹ç²¾éˆè¡¨)");else if(i)console.log("ğŸš€ å‚™ç”¨æ–¹æ¡ˆ2ï¼šä½¿ç”¨ç”¨æˆ¶æä¾›çš„å®Œæ•´å¤ªç©ºèˆ¹åœ–ç‰‡"),this.player=this.physics.add.sprite(150,336,"complete_spaceship"),this.createEngineFlameEffect();else{if(!o){console.log("âŒ æ²’æœ‰å¯ç”¨çš„é£›æ©Ÿè³‡æºï¼Œå‰µå»ºç·Šæ€¥å‚™ç”¨");const e=this.add.rectangle(150,336,40,40,16711680);return e.setDepth(200),this.physics.world.enable(e),this.player=e,void console.log("ğŸš¨ ä½¿ç”¨ç·Šæ€¥ç´…è‰²çŸ©å½¢ä½œç‚ºé£›æ©Ÿ")}console.log("ğŸ”§ å‚™ç”¨æ–¹æ¡ˆ3ï¼šä½¿ç”¨è—è‰²ä¸‰è§’å½¢é£›æ©Ÿ"),this.player=this.physics.add.sprite(150,336,"player-plane")}this.setupSpaceshipProperties(),this.responsiveManager.registerElement("player",this.player,"gameObject",{anchor:{x:.5,y:.5},constraints:{keepAspectRatio:!0,minScale:.1,maxScale:2}}),console.log("ğŸ“ ç©å®¶å¤ªç©ºèˆ¹å·²è¨»å†Šåˆ°éŸ¿æ‡‰å¼ç®¡ç†å™¨")}setupSpaceshipProperties(){console.log("âš™ï¸ è¨­ç½®å¤ªç©ºèˆ¹çµ±ä¸€å±¬æ€§ - æ¢å¾©åŸç‰ˆ");try{this.player.setScale(.4),this.player.setCollideWorldBounds(!0),this.player.setDepth(10),this.player.setAlpha(1),this.player.setVisible(!0),console.log("âœ… å¤ªç©ºèˆ¹å±¬æ€§è¨­ç½®å®Œæˆ: ä¸­å¿ƒéŒ¨é» + 0.8å€ç¸®æ”¾ + æ·±åº¦10")}catch(t){console.error("âŒ å¤ªç©ºèˆ¹å±¬æ€§è¨­ç½®å¤±æ•—:",t)}this.tweens.add({targets:this.player,scaleX:{from:.4,to:.42},scaleY:{from:.4,to:.42},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),console.log("âœ… å¤ªç©ºèˆ¹å±¬æ€§è¨­ç½®å®Œæˆ: ä¸­å¿ƒéŒ¨é» + 0.4å€ç¸®æ”¾ï¼ˆ50%å¤§å°ï¼‰+ ä¿æŒåŸå§‹æ–¹å‘ï¼ˆç„¡æ—‹è½‰ç¿»è½‰ï¼‰+ è„ˆå‹•æ•ˆæœ"),console.log("ğŸ¯ ç©å®¶é£›æ©Ÿå‰µå»ºå®Œæˆ - è©³ç´°ç‹€æ…‹:",{x:this.player.x,y:this.player.y,visible:this.player.visible,alpha:this.player.alpha,depth:this.player.depth,scaleX:this.player.scaleX,scaleY:this.player.scaleY,texture:this.player.texture.key,width:this.player.width,height:this.player.height,originX:this.player.originX,originY:this.player.originY,active:this.player.active});const e=this.player.x>=0&&this.player.x<=1274&&this.player.y>=0&&this.player.y<=739;console.log("ğŸ“ é£›æ©Ÿä½ç½®æª¢æŸ¥:",{gameSize:"1274x739",playerPosition:`${this.player.x}, ${this.player.y}`,isInBounds:e,distanceFromLeft:this.player.x,distanceFromTop:this.player.y})}createClouds(){this.clouds=this.physics.add.group(),console.log("â˜ï¸ å‰µå»ºé›²æœµç¾¤çµ„"),console.log("ğŸŒ ç‰©ç†ä¸–ç•Œç‹€æ…‹:",{gravity:this.physics.world.gravity,bounds:this.physics.world.bounds,isPaused:this.physics.world.isPaused}),this.physics.world.isPaused&&(console.log("âš¡ ç‰©ç†ä¸–ç•Œå·²æš«åœï¼Œå¼·åˆ¶æ¢å¾©"),this.physics.world.resume())}createGameHUD(){console.log("ğŸ“Š å‰µå»ºéŠæˆ² HUD (å·²æ“´å±•ç›®æ¨™è©å½™é¡¯ç¤º)"),this.scoreText=this.add.text(16,16,"åˆ†æ•¸: 0",{fontSize:"24px",color:"#000000",backgroundColor:"#f8f9fa",padding:{x:8,y:4}}).setDepth(100),this.accuracyText=this.add.text(16,50,"æº–ç¢ºç‡: 0%",{fontSize:"20px",color:"#000000",backgroundColor:"#f8f9fa",padding:{x:8,y:4}}).setDepth(100),this.wordsLearnedText=this.add.text(16,84,"å­¸ç¿’è©å½™: 0",{fontSize:"20px",color:"#000000",backgroundColor:"#f8f9fa",padding:{x:8,y:4}}).setDepth(100),this.healthBar=new d(this,16,this.cameras.main.height-60),console.log("â¤ï¸ è¡€æ¢ UI å·²å‰µå»ºï¼ˆå·¦ä¸‹è§’ä½ç½®ï¼‰"),this.targetWordText=this.add.text(637,20,"ç›®æ¨™: è¼‰å…¥ä¸­...",{fontSize:"32px",color:"#1f2937",backgroundColor:"#fef3c7",padding:{x:16,y:12},fontStyle:"bold"}).setOrigin(.5,0).setDepth(100);try{console.log("ğŸ–¥ï¸ é–‹å§‹å‰µå»ºå…¨è¢å¹•æŒ‰éˆ•..."),this.fullscreenButton=new u(this),console.log("âœ… å…¨è¢å¹•æŒ‰éˆ•å·²å‰µå»ºï¼ˆå³ä¸‹è§’ä½ç½®ï¼‰")}catch(e){console.error("âŒ å…¨è¢å¹•æŒ‰éˆ•å‰µå»ºå¤±æ•—:",e)}this.registerUIElementsToResponsiveManager()}registerUIElementsToResponsiveManager(){this.responsiveManager.registerElement("scoreText",this.scoreText,"ui",{anchor:{x:0,y:0},constraints:{fixedPosition:!1}}),this.responsiveManager.registerElement("accuracyText",this.accuracyText,"ui",{anchor:{x:0,y:0},constraints:{fixedPosition:!1}}),this.responsiveManager.registerElement("wordsLearnedText",this.wordsLearnedText,"ui",{anchor:{x:0,y:0},constraints:{fixedPosition:!1}}),this.responsiveManager.registerElement("healthBar",this.healthBar.getContainer(),"ui",{anchor:{x:0,y:1},constraints:{fixedPosition:!1}}),this.responsiveManager.registerElement("targetWordText",this.targetWordText,"ui",{anchor:{x:.5,y:0},constraints:{fixedPosition:!1}}),console.log("ğŸ“ æ‰€æœ‰ UI å…ƒç´ å·²è¨»å†Šåˆ°éŸ¿æ‡‰å¼ç®¡ç†å™¨")}registerBackgroundLayersToResponsiveManager(){this.backgroundLayers.forEach(((e,t)=>{this.responsiveManager.registerElement(`backgroundLayer_${t}`,e,"background",{anchor:{x:0,y:0},constraints:{keepAspectRatio:!0,minScale:.5,maxScale:2}})})),console.log(`ğŸ“ ${this.backgroundLayers.length} å€‹èƒŒæ™¯å±¤å·²è¨»å†Šåˆ°éŸ¿æ‡‰å¼ç®¡ç†å™¨`)}setupInput(){this.cursors=this.input.keyboard.createCursorKeys();const e=this.input.keyboard.addKeys("W,S,A,D");this.wasd=e,this.setupTouchAndMouseControls(),console.log("ğŸ® è¨­ç½®è¼¸å…¥æ§åˆ¶ï¼ˆéµç›¤ + è§¸ç¢° + æ»‘é¼ ï¼‰")}setupTouchAndMouseControls(){console.log("ğŸ‘† è¨­ç½®è§¸ç¢°å’Œæ»‘é¼ æ§åˆ¶"),this.touchControl={isPressed:!1,moveUp:!1,moveDown:!1},this.input.on("pointerdown",(e=>{if(!this.gameState.isPlaying||this.gameState.isPaused||this.showStartScreen)return;const t=this.touchControl;t.isPressed=!0;e.y<369.5?(t.moveUp=!0,t.moveDown=!1,console.log("ğŸ‘† è§¸ç¢°æ§åˆ¶ï¼šå‘ä¸Šç§»å‹•")):(t.moveUp=!1,t.moveDown=!0,console.log("ğŸ‘‡ è§¸ç¢°æ§åˆ¶ï¼šå‘ä¸‹ç§»å‹•"))})),this.input.on("pointerup",(()=>{const e=this.touchControl;e.isPressed=!1,e.moveUp=!1,e.moveDown=!1,console.log("âœ‹ è§¸ç¢°æ§åˆ¶ï¼šåœæ­¢ç§»å‹•")})),this.input.on("pointerout",(()=>{const e=this.touchControl;e.isPressed=!1,e.moveUp=!1,e.moveDown=!1,console.log("ğŸš« è§¸ç¢°æ§åˆ¶ï¼šæŒ‡é‡ç§»å‡ºï¼Œåœæ­¢ç§»å‹•")})),console.log("âœ… è§¸ç¢°å’Œæ»‘é¼ æ§åˆ¶è¨­ç½®å®Œæˆ"),console.log("ğŸ“± ä½¿ç”¨æ–¹æ³•ï¼š"),console.log("  - é»æ“Š/è§¸ç¢°ç•«é¢ä¸ŠåŠéƒ¨åˆ†ï¼šé£›æ©Ÿå‘ä¸Šç§»å‹•"),console.log("  - é»æ“Š/è§¸ç¢°ç•«é¢ä¸‹åŠéƒ¨åˆ†ï¼šé£›æ©Ÿå‘ä¸‹ç§»å‹•"),console.log("  - é‡‹æ”¾æ»‘é¼ /æ‰‹æŒ‡ï¼šåœæ­¢ç§»å‹•")}setupPhysics(){console.log("âš¡ è¨­ç½®ç‰©ç†ç¢°æ’ (å·²ç§»é™¤å­å½ˆç¢°æ’ï¼Œä¿®æ”¹ç©å®¶ç¢°æ’)"),this.physics.add.overlap(this.player,this.clouds,this.handleAdvancedCollision,void 0,this)}setRandomTargetWord(){const e=this.geptManager.getRandomWord();this.currentTargetWord=e||void 0,this.gameState.currentTargetWord=this.currentTargetWord,this.targetWordSetTime=Date.now(),this.targetWordText&&this.currentTargetWord&&(this.targetWordText.setText(`ç›®æ¨™: ${this.currentTargetWord.chinese} (${this.currentTargetWord.english})`),this.collisionSystem.setTargetWord(this.currentTargetWord.english,this.currentTargetWord.chinese),this.bilingualManager.updateTargetWord(this.currentTargetWord.english),this.chineseUIManager.updateTargetWord(this.currentTargetWord),console.log("ğŸ¯ è¨­ç½®ç›®æ¨™è©å½™:",this.currentTargetWord.english))}startCloudSpawning(){this.cloudSpawnTimer=this.time.addEvent({delay:2e3,callback:this.spawnCloud,callbackScope:this,loop:!0}),console.log("â˜ï¸ é–‹å§‹é›²æœµç”Ÿæˆ - æ¯ 2 ç§’ç”Ÿæˆä¸€å€‹é›²æœµ"),console.log("ğŸ® éŠæˆ²ç‹€æ…‹:",this.gameState),this.time.delayedCall(500,(()=>{console.log("ğŸ§ª æ¸¬è©¦ï¼šç«‹å³ç”Ÿæˆç¬¬ä¸€å€‹é›²æœµ"),this.spawnCloud()}))}spawnCloud(){if(console.log("ğŸ”„ å˜—è©¦ç”Ÿæˆé›²æœµ..."),console.log("ğŸ® éŠæˆ²ç‹€æ…‹ isPlaying:",this.gameState.isPlaying),!this.gameState.isPlaying)return void console.log("âŒ éŠæˆ²æœªåœ¨é€²è¡Œä¸­ï¼Œè·³éé›²æœµç”Ÿæˆ");const e=this.geptManager.getRandomWord();if(console.log("ğŸ“ ç²å–è©å½™:",e),!e)return void console.log("âŒ ç„¡æ³•ç²å–è©å½™ï¼Œè·³éé›²æœµç”Ÿæˆ");const t=1350,i=s.Math.Between(100,639),o=this.useBackupCloudTexture?"cloud-word-fallback":"cloud-word",n=this.physics.add.image(t,i,o);console.log("â˜ï¸ ä½¿ç”¨é›²æœµç´‹ç†:",o,"ä½ç½®:",t,i),n.setScale(1.44),n.body||(console.log("âŒ é›²æœµæ²’æœ‰ç‰©ç†é«”ï¼Œå¼·åˆ¶å•Ÿç”¨ç‰©ç†"),this.physics.world.enable(n)),n.setVelocityX(-200),n.body&&(n.body.setVelocityX(-200),n.body.velocity.x=-200),console.log("ğŸ”§ é›²æœµç‰©ç†å±¬æ€§ (ä¿®å¾©å¾Œ):",{hasBody:!!n.body,velocity:n.body?.velocity,velocityX:n.body?.velocity?.x,position:{x:n.x,y:n.y},bodyType:n.body?.constructor.name}),n.setData("word",e),n.setData("isTarget",e.english===this.currentTargetWord?.english),n.setDepth(110),n.setAlpha(1),n.setVisible(!0);const a=e.english===this.currentTargetWord?.english,r=this.add.text(t,i,e.english,{fontSize:"23px",color:a?"#ff0000":"#000000",fontStyle:a?"bold":"normal",backgroundColor:a?"#ffff00":"rgba(255, 255, 255, 0.8)",padding:{x:6,y:3}}).setOrigin(.5);r.setDepth(111),r.setAlpha(1),r.setVisible(!0),n.setData("wordText",r);const l=`cloud_${Date.now()}_${Math.random()}`,h=`cloudText_${Date.now()}_${Math.random()}`;this.responsiveManager.registerElement(l,n,"gameObject",{constraints:{keepAspectRatio:!0,minScale:.8,maxScale:2}}),this.responsiveManager.registerElement(h,r,"text",{constraints:{keepAspectRatio:!0,minScale:.6,maxScale:1.8}}),a&&this.bilingualManager&&this.bilingualManager.showChinesePrompt(e.english,{x:t,y:i-60}),console.log("ğŸ”§ æ·»åŠ åˆ°ç¾¤çµ„å‰çš„é€Ÿåº¦:",n.body?.velocity?.x),this.clouds.add(n),console.log("ğŸ”§ æ·»åŠ åˆ°ç¾¤çµ„å¾Œçš„é€Ÿåº¦:",n.body?.velocity?.x),-200!==n.body?.velocity?.x&&(console.log("âš ï¸ é€Ÿåº¦è¢«é‡ç½®ï¼Œå¼·åˆ¶æ¢å¾©"),n.setVelocityX(-200),n.body.velocity.x=-200),console.log("â˜ï¸ ç”Ÿæˆé›²æœµ (ä¿®å¾©ç‰ˆæœ¬):",e.english,a?"(ç›®æ¨™)":"",{cloudVisible:n.visible,textVisible:r.visible,cloudDepth:n.depth,textDepth:r.depth})}forceSpawnTestCloud(){console.log("ğŸ§ª å¼·åˆ¶ç”Ÿæˆæ¸¬è©¦é›²æœµ - é–‹å§‹");const e=1e3,t=this.useBackupCloudTexture?"cloud-word-fallback":"cloud-word",s=this.physics.add.image(e,300,t);s.body||(console.log("âŒ æ¸¬è©¦é›²æœµæ²’æœ‰ç‰©ç†é«”ï¼Œå¼·åˆ¶å•Ÿç”¨ç‰©ç†"),this.physics.world.enable(s)),s.setVelocityX(-150),s.body&&(s.body.setVelocityX(-150),s.body.velocity.x=-150),s.setDepth(10),s.setAlpha(1),s.setVisible(!0),s.setTint(16711680),console.log("ğŸ§ª æ¸¬è©¦é›²æœµä½¿ç”¨ç´‹ç†:",t),console.log("ğŸ§ª æ¸¬è©¦é›²æœµç‰©ç†å±¬æ€§:",{hasBody:!!s.body,velocity:s.body?.velocity,velocityX:s.body?.velocity?.x});const i=this.add.text(e,300,"TEST",{fontSize:"20px",color:"#ffffff",fontStyle:"bold",backgroundColor:"#dc2626",padding:{x:8,y:4}}).setOrigin(.5);i.setDepth(11),i.setAlpha(1),i.setVisible(!0),s.setData("wordText",i),s.setData("word",{english:"test",chinese:"æ¸¬è©¦"}),s.setData("isTarget",!1),console.log("ğŸ§ª æ·»åŠ åˆ°ç¾¤çµ„å‰çš„æ¸¬è©¦é›²æœµé€Ÿåº¦:",s.body?.velocity?.x),this.clouds.add(s),console.log("ğŸ§ª æ·»åŠ åˆ°ç¾¤çµ„å¾Œçš„æ¸¬è©¦é›²æœµé€Ÿåº¦:",s.body?.velocity?.x),-150!==s.body?.velocity?.x&&(console.log("âš ï¸ æ¸¬è©¦é›²æœµé€Ÿåº¦è¢«é‡ç½®ï¼Œå¼·åˆ¶æ¢å¾©"),s.setVelocityX(-150),s.body.velocity.x=-150),console.log("ğŸ§ª æ¸¬è©¦é›²æœµå·²ç”Ÿæˆ:",{x:e,y:300,visible:s.visible,depth:s.depth,velocity:s.body?.velocity})}createSimpleTestObject(){console.log("ğŸ”´ å‰µå»ºç°¡å–®ç´…è‰²æ–¹å¡Š");const e=this.add.rectangle(600,200,50,50,16711680);e.setDepth(20),e.setAlpha(1),e.setVisible(!0),this.tweens.add({targets:e,x:100,duration:3e3,ease:"Linear"}),console.log("ğŸ”´ ç´…è‰²æ–¹å¡Šå·²å‰µå»º:",{x:e.x,y:e.y,visible:e.visible,depth:e.depth})}handleAdvancedCollision(e,t){if(!this.gameState.isPlaying||this.gameState.isPaused)return;const s=t.getData("word");t.getData("isTarget");const i=t.getData("wordText");if(t.getData("processed"))return;t.setData("processed",!0);const o=this.collisionSystem.handleCollision(e,t,s),n={wordId:s.id,word:s.english,timestamp:Date.now(),responseTime:Date.now()-this.targetWordSetTime,isCorrect:"correct"===o.type,attemptNumber:this.totalCollisions+1,contextData:{targetWord:this.currentTargetWord?.english,geptLevel:this.gameConfig.geptLevel,gameMode:this.gameConfig.gameMode}};if(this.memoryEngine.recordLearningEvent(n),this.totalCollisions++,"correct"===o.type)this.correctCollisions++,this.gameState.currentScore+=10,this.gameState.wordsLearned++,this.chineseUIManager&&this.chineseUIManager.showSuccessMessage(s,10),this.bilingualManager&&this.bilingualManager.hideChinesePrompt(),this.setRandomTargetWord(),console.log("âœ… æ­£ç¢ºç¢°æ’:",s.english);else{if(this.wrongCollisions++,console.log("âŒ éŒ¯èª¤ç¢°æ’:",s.english,`(ç¬¬${this.wrongCollisions}æ¬¡éŒ¯èª¤)`),this.wrongCollisions>=5)return console.log("ğŸ’¥ ç¬¬5æ¬¡éŒ¯èª¤ï¼åˆ†æ•¸æ­¸é›¶å¾ŒçµæŸéŠæˆ²"),this.gameState.isPlaying=!1,this.gameState.currentScore=0,this.updateUI(),this.chineseUIManager&&this.chineseUIManager.showErrorMessage({english:"GAME OVER",chinese:"éŠæˆ²çµæŸ"},0),this.removeCloudWithAnimation(t,i),void this.time.delayedCall(1e3,(()=>{this.endGame()}));if(this.gameState.currentHealth-=20,this.chineseUIManager&&this.chineseUIManager.showErrorMessage(s,20),this.gameState.currentHealth<=0)return this.removeCloudWithAnimation(t,i),void this.endGame()}this.removeCloudWithAnimation(t,i),this.updateGameStats(),this.updateUI(),this.sendMessageToParent({type:"GAME_SCORE_UPDATE",score:this.gameState.currentScore,health:this.gameState.currentHealth})}updateGameStats(){this.gameState.accuracy=this.totalCollisions>0?Math.round(this.correctCollisions/this.totalCollisions*100):0}updateUI(){this.scoreText.setText(`åˆ†æ•¸: ${this.gameState.currentScore}`),this.healthBar.updateHealth(this.gameState.currentHealth,!0),this.accuracyText.setText(`æº–ç¢ºç‡: ${this.gameState.accuracy}%`),this.wordsLearnedText.setText(`å­¸ç¿’è©å½™: ${this.gameState.wordsLearned}`),console.log("ğŸ“Š æ›´æ–° HUD:",{"åˆ†æ•¸":this.gameState.currentScore,"ç”Ÿå‘½å€¼":this.gameState.currentHealth,"æº–ç¢ºç‡":this.gameState.accuracy,"å­¸ç¿’è©å½™":this.gameState.wordsLearned})}startGame(){this.gameState.isPlaying=!0,this.gameState.isPaused=!1,this.totalCollisions=0,this.correctCollisions=0,this.wrongCollisions=0,console.log("ğŸš€ éŠæˆ²é–‹å§‹ï¼ˆéŒ¯èª¤æ¬¡æ•¸å·²é‡ç½®ï¼‰"),this.startCloudSpawning(),this.sendMessageToParent({type:"GAME_STATE_CHANGE",state:"playing"})}endGame(){this.gameState.isPlaying=!1,this.gameState.currentHealth=0,this.updateUI(),console.log("ğŸ éŠæˆ²çµæŸ - ç”Ÿå‘½å€¼æ­¸é›¶"),this.cloudSpawnTimer&&this.cloudSpawnTimer.destroy(),this.clearCloudsGradually(),this.sendMessageToParent({type:"GAME_COMPLETE",score:this.gameState.currentScore,health:this.gameState.currentHealth})}clearCloudsGradually(){console.log("ğŸŒ¤ï¸ é–‹å§‹æ¼¸é€²å¼æ¸…ç†é›²æœµï¼Œé˜²æ­¢ç™½è‰²é–ƒçˆ");const e=this.clouds.children.entries;0!==e.length?(e.forEach(((e,t)=>{this.tweens.add({targets:e,alpha:0,scale:.5,duration:300,delay:50*t,ease:"Power2",onComplete:()=>{e&&e.active&&e.destroy()}})})),this.time.delayedCall(1e3,(()=>{this.clouds.clear(!1,!1),console.log("âœ… é›²æœµæ¼¸é€²å¼æ¸…ç†å®Œæˆ")}))):console.log("âœ… æ²’æœ‰é›²æœµéœ€è¦æ¸…ç†")}removeCloudWithAnimation(e,t){console.log("ğŸŒ¤ï¸ ä½¿ç”¨æ·¡å‡ºå‹•ç•«ç§»é™¤é›²æœµ"),t&&t.active&&this.tweens.add({targets:t,alpha:0,scale:.2,duration:150,ease:"Power2",onComplete:()=>{t&&t.active&&(t.destroy(),console.log("âœ… æ–‡å­—å·²éŠ·æ¯€"))}}),this.tweens.add({targets:e,alpha:0,scale:.3,duration:200,delay:50,ease:"Power2",onComplete:()=>{e&&e.active&&(e.destroy(),console.log("âœ… é›²æœµå·²éŠ·æ¯€"))}})}sendMessageToParent(e){window.parent!==window&&window.parent.postMessage(e,"*")}update(e,t){this.gameState.isPlaying&&!this.gameState.isPaused&&(this.updateParallaxBackground(),this.handlePlayerMovement(),this.updateClouds(),this.updateChineseUI(),this.cleanupObjects())}updateParallaxBackground(){this.backgroundLayers.forEach(((e,t)=>{const s=.3*(t+1);e.tilePositionX+=s})),console.log("ğŸŒŒ æ›´æ–°è¦–å·®èƒŒæ™¯")}updateChineseUI(){if(this.chineseUIManager){this.chineseUIManager.updateScore(this.gameState.currentScore),this.chineseUIManager.updateLives(this.gameState.currentHealth);const e=this.gameState.isPlaying?"playing":this.gameState.isPaused?"paused":"waiting";this.chineseUIManager.updateGameStatus(e)}}handlePlayerMovement(){const e=this.wasd,t=this.touchControl;this.player.setVelocityX(0);const s=this.cursors.up.isDown||e?.W.isDown||t?.moveUp,i=this.cursors.down.isDown||e?.S.isDown||t?.moveDown;s?this.player.setVelocityY(-250):i?this.player.setVelocityY(250):this.player.setVelocityY(0)}createEngineFlameEffect(){console.log("ğŸ”¥ å‰µå»ºå¼•æ“ç«ç„°æ•ˆæœ");const e=this.player.x,t=this.player.y+30,s=this.add.sprite(e,t,"cloud");s.setScale(.3),s.setTint(16737792),s.setDepth(this.player.depth-1),this.tweens.add({targets:s,alpha:{from:.8,to:.3},scaleX:{from:.3,to:.4},scaleY:{from:.3,to:.4},duration:150,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),console.log("ğŸ”¥ å¼•æ“ç«ç„°æ•ˆæœå‰µå»ºå®Œæˆ")}cleanupObjects(){this.clouds.children.entries.forEach((e=>{if(e.x<-100){const t=e.getData("wordText");t&&t.destroy(),e.destroy()}else{const t=e.getData("wordText");t&&t.setPosition(e.x,e.y)}}))}}export{p as G};
//# sourceMappingURL=scenes-DHN9EBcS.js.map
