var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{P as s}from"./phaser-CjIEy6U-.js";import{G as i,M as a,C as n}from"./managers-BDCOAzdU.js";class o{constructor(t,s){e(this,"scene"),e(this,"geptManager"),e(this,"promptContainer",null),e(this,"chineseText",null),e(this,"englishText",null),e(this,"backgroundRect",null),e(this,"config"),e(this,"state"),e(this,"accessibilitySettings"),e(this,"wordCache",new Map),e(this,"translationCache",new Map),this.scene=t,this.geptManager=s,this.config=this.getDefaultConfig(),this.state=this.getInitialState(),this.accessibilitySettings=this.getDefaultAccessibilitySettings(),this.initializePromptUI(),console.log("🌐 BilingualManager 初始化完成")}getDefaultConfig(){return{position:"top-center",style:{fontSize:24,fontFamily:"Microsoft YaHei, SimHei, Arial, sans-serif",color:"#FFFFFF",backgroundColor:"rgba(0, 0, 0, 0.8)",padding:{x:16,y:8},borderRadius:8,border:"2px solid #FFD700"},animation:{fadeIn:{duration:300,ease:"Power2.easeOut"},fadeOut:{duration:200,ease:"Power2.easeIn"},bounce:{amplitude:10,duration:500}}}}getInitialState(){return{isVisible:!1,currentWord:null,displayMode:"chinese-only",lastUpdateTime:0}}getDefaultAccessibilitySettings(){return{fontSize:"medium",contrast:"normal",enableVoice:!1,enableKeyboardNav:!0,screenReaderMode:!1}}initializePromptUI(){this.scene.scale.width,this.scene.scale.height,this.promptContainer=this.scene.add.container(0,0),this.promptContainer.setDepth(1e3),this.backgroundRect=this.scene.add.rectangle(0,0,200,60,0,.8),this.backgroundRect.setStrokeStyle(2,16766720),this.chineseText=this.scene.add.text(0,-10,"",{fontSize:`${this.config.style.fontSize}px`,fontFamily:this.config.style.fontFamily,color:this.config.style.color,align:"center",fontStyle:"bold"}),this.chineseText.setOrigin(.5),this.englishText=this.scene.add.text(0,15,"",{fontSize:.7*this.config.style.fontSize+"px",fontFamily:"Arial, sans-serif",color:"#CCCCCC",align:"center"}),this.englishText.setOrigin(.5),this.promptContainer.add([this.backgroundRect,this.chineseText,this.englishText]),this.updatePromptPosition(),this.promptContainer.setVisible(!1),this.promptContainer.setAlpha(0)}updatePromptPosition(){if(!this.promptContainer)return;const t=this.scene.scale.width,e=this.scene.scale.height;switch(this.config.position){case"top-center":this.promptContainer.setPosition(t/2,80);break;case"bottom-center":this.promptContainer.setPosition(t/2,e-80)}}showChinesePrompt(t,e){const s=this.getWordFromCache(t);s?(this.state.currentWord=s,this.state.isVisible=!0,this.state.lastUpdateTime=Date.now(),this.chineseText&&this.chineseText.setText(s.chinese),this.englishText&&"both"===this.state.displayMode?this.englishText.setText(`(${s.english})`):this.englishText&&this.englishText.setText(""),this.adjustBackgroundSize(),"floating"===this.config.position&&e&&this.promptContainer?.setPosition(e.x,e.y-60),this.playShowAnimation(),console.log(`🌐 顯示中文提示: ${s.chinese} (${s.english})`)):console.warn(`⚠️ 未找到詞彙: ${t}`)}hideChinesePrompt(){this.state.isVisible&&(this.state.isVisible=!1,this.state.currentWord=null,this.playHideAnimation(),console.log("🌐 隱藏中文提示"))}updateTargetWord(t){const e=this.getWordFromCache(t);e?(this.state.isVisible&&this.showChinesePrompt(t),console.log(`🎯 更新目標詞彙: ${e.chinese} (${e.english})`)):console.warn(`⚠️ 未找到目標詞彙: ${t}`)}getWordFromCache(t){if(this.wordCache.has(t))return this.wordCache.get(t);const e=this.geptManager.findWordByEnglish(t);return e&&(this.wordCache.set(t,e),this.translationCache.set(t,e.chinese)),e}adjustBackgroundSize(){if(!this.backgroundRect||!this.chineseText)return;const t=this.chineseText.getBounds(),e=this.config.style.padding,s=Math.max(t.width+2*e.x,120),i=Math.max(t.height+2*e.y,50);this.backgroundRect.setSize(s,i)}playShowAnimation(){this.promptContainer&&(this.promptContainer.setVisible(!0),this.scene.tweens.add({targets:this.promptContainer,alpha:1,duration:this.config.animation.fadeIn.duration,ease:this.config.animation.fadeIn.ease,onComplete:()=>{this.config.animation.bounce&&this.playBounceAnimation()}}))}playHideAnimation(){this.promptContainer&&this.scene.tweens.add({targets:this.promptContainer,alpha:0,duration:this.config.animation.fadeOut.duration,ease:this.config.animation.fadeOut.ease,onComplete:()=>{this.promptContainer?.setVisible(!1)}})}playBounceAnimation(){if(!this.promptContainer||!this.config.animation.bounce)return;const t=this.promptContainer.y,e=this.config.animation.bounce;this.scene.tweens.add({targets:this.promptContainer,y:t-e.amplitude,duration:e.duration/2,ease:"Power2.easeOut",yoyo:!0,repeat:0})}setDisplayMode(t){this.state.displayMode=t,this.state.isVisible&&this.state.currentWord&&this.showChinesePrompt(this.state.currentWord.english)}applyAccessibilitySettings(t){this.accessibilitySettings={...this.accessibilitySettings,...t},this.updateFontSize(),this.updateContrast(),console.log("♿ 應用無障礙設置:",this.accessibilitySettings)}updateFontSize(){const t={small:18,medium:24,large:30,"extra-large":36}[this.accessibilitySettings.fontSize];this.chineseText&&this.chineseText.setFontSize(t),this.englishText&&this.englishText.setFontSize(.7*t),this.adjustBackgroundSize()}updateContrast(){const t={normal:{bg:0,text:"#FFFFFF",border:16766720},high:{bg:0,text:"#FFFF00",border:16777215},reverse:{bg:16777215,text:"#000000",border:0}}[this.accessibilitySettings.contrast];this.backgroundRect&&(this.backgroundRect.setFillStyle(t.bg,.9),this.backgroundRect.setStrokeStyle(2,t.border)),this.chineseText&&this.chineseText.setColor(t.text),this.englishText&&this.englishText.setColor(t.text)}getChineseTranslation(t){if(this.translationCache.has(t))return this.translationCache.get(t);const e=this.getWordFromCache(t);return e?e.chinese:""}destroy(){this.promptContainer&&(this.promptContainer.destroy(),this.promptContainer=null),this.wordCache.clear(),this.translationCache.clear(),console.log("🧹 BilingualManager 已銷毀")}getState(){return{...this.state}}getStatistics(){return{cacheSize:this.wordCache.size,translationCacheSize:this.translationCache.size,currentLevel:this.geptManager.getCurrentLevel(),isVisible:this.state.isVisible,displayMode:this.state.displayMode}}}class r{constructor(t,s,i){e(this,"scene"),e(this,"geptManager"),e(this,"bilingualManager"),e(this,"uiElements"),e(this,"textConfig"),e(this,"accessibilitySettings"),e(this,"hudContainer",null),e(this,"targetContainer",null),e(this,"currentScore",0),e(this,"currentLives",100),e(this,"currentTarget",null),e(this,"gameStatus","waiting"),this.scene=t,this.geptManager=s,this.bilingualManager=i,this.uiElements=this.initializeUIElements(),this.textConfig=this.getDefaultTextConfig(),this.accessibilitySettings=this.getDefaultAccessibilitySettings(),this.createChineseHUD(),console.log("🎨 ChineseUIManager 初始化完成")}initializeUIElements(){return{scoreText:null,livesText:null,targetText:null,statusText:null,instructionText:null}}getDefaultTextConfig(){return{fontSize:20,fontFamily:"Microsoft YaHei, SimHei, Arial, sans-serif",color:"#FFFFFF",stroke:"#000000",strokeThickness:2,shadow:{offsetX:2,offsetY:2,color:"#000000",blur:4,fill:!0}}}getDefaultAccessibilitySettings(){return{fontSize:"medium",contrast:"normal",enableVoice:!1,enableKeyboardNav:!0,screenReaderMode:!1}}createChineseHUD(){const t=this.scene.scale.width;this.scene.scale.height,this.hudContainer=this.scene.add.container(0,0),this.hudContainer.setDepth(999),this.uiElements.scoreText=this.scene.add.text(20,20,"分數: 0",this.getTextStyle()),this.hudContainer.add(this.uiElements.scoreText),this.uiElements.livesText=this.scene.add.text(20,50,"生命值: 100",this.getTextStyle()),this.hudContainer.add(this.uiElements.livesText),this.uiElements.statusText=this.scene.add.text(t-20,20,"遊戲狀態: 待開始",{...this.getTextStyle(),align:"right"}),this.uiElements.statusText.setOrigin(1,0),this.hudContainer.add(this.uiElements.statusText),this.createTargetDisplay(),this.createInstructionText(),console.log("🎨 中文 HUD 創建完成")}createTargetDisplay(){const t=this.scene.scale.width;this.targetContainer=this.scene.add.container(t/2,120),this.targetContainer.setDepth(998);const e=this.scene.add.rectangle(0,0,300,60,0,.7);e.setStrokeStyle(2,65280),this.targetContainer.add(e);const s=this.scene.add.text(0,-15,"目標詞彙",{fontSize:"16px",fontFamily:this.textConfig.fontFamily,color:"#00FF00",align:"center"});s.setOrigin(.5),this.targetContainer.add(s),this.uiElements.targetText=this.scene.add.text(0,10,"等待設置...",{fontSize:"24px",fontFamily:this.textConfig.fontFamily,color:"#FFFFFF",align:"center",fontStyle:"bold"}),this.uiElements.targetText.setOrigin(.5),this.targetContainer.add(this.uiElements.targetText),console.log("🎯 目標詞彙顯示創建完成")}createInstructionText(){const t=this.scene.scale.width,e=this.scene.scale.height;this.uiElements.instructionText=this.scene.add.text(t/2,e-40,"使用方向鍵或 WASD 控制飛機，碰撞正確的中文詞彙！",{fontSize:"16px",fontFamily:this.textConfig.fontFamily,color:"#CCCCCC",align:"center"}),this.uiElements.instructionText.setOrigin(.5),this.hudContainer&&this.hudContainer.add(this.uiElements.instructionText)}getTextStyle(){return{fontSize:`${this.textConfig.fontSize}px`,fontFamily:this.textConfig.fontFamily,color:this.textConfig.color,stroke:this.textConfig.stroke,strokeThickness:this.textConfig.strokeThickness,shadow:this.textConfig.shadow}}updateScore(t){this.currentScore=t,this.uiElements.scoreText&&this.uiElements.scoreText.setText(`分數: ${t}`),console.log(`📊 更新分數: ${t}`)}updateLives(t){this.currentLives=t,this.uiElements.livesText&&(this.uiElements.livesText.setText(`生命值: ${t}`),t<=30?this.uiElements.livesText.setColor("#FF0000"):t<=60?this.uiElements.livesText.setColor("#FFAA00"):this.uiElements.livesText.setColor("#FFFFFF")),console.log(`❤️ 更新生命值: ${t}`)}updateTargetWord(t){this.currentTarget=t,this.uiElements.targetText&&this.uiElements.targetText.setText(`尋找: ${t.chinese} (${t.english})`),this.bilingualManager.updateTargetWord(t.english),console.log(`🎯 更新目標詞彙: ${t.chinese} (${t.english})`)}updateGameStatus(t){this.gameStatus=t;const e={waiting:"遊戲狀態: 待開始",playing:"遊戲狀態: 進行中",paused:"遊戲狀態: 暫停",ended:"遊戲狀態: 結束"};if(this.uiElements.statusText)switch(this.uiElements.statusText.setText(e[t]),t){case"waiting":this.uiElements.statusText.setColor("#CCCCCC");break;case"playing":this.uiElements.statusText.setColor("#00FF00");break;case"paused":this.uiElements.statusText.setColor("#FFAA00");break;case"ended":this.uiElements.statusText.setColor("#FF0000")}console.log(`🎮 更新遊戲狀態: ${e[t]}`)}showSuccessMessage(t,e){const s=this.scene.scale.width,i=this.scene.scale.height,a=this.scene.add.text(s/2,i/2,`正確！\n${t.chinese} (${t.english})\n+${e} 分`,{fontSize:"32px",fontFamily:this.textConfig.fontFamily,color:"#00FF00",align:"center",fontStyle:"bold",stroke:"#000000",strokeThickness:3});a.setOrigin(.5),a.setDepth(1001),this.scene.tweens.add({targets:a,scaleX:1.2,scaleY:1.2,alpha:0,duration:1500,ease:"Power2.easeOut",onComplete:()=>{a.destroy()}}),console.log(`✅ 顯示成功提示: ${t.chinese} +${e}分`)}showErrorMessage(t,e){const s=this.scene.scale.width,i=this.scene.scale.height,a=this.scene.add.text(s/2,i/2,`錯誤！\n${t.chinese} (${t.english})\n-${e} 生命值`,{fontSize:"28px",fontFamily:this.textConfig.fontFamily,color:"#FF0000",align:"center",fontStyle:"bold",stroke:"#000000",strokeThickness:3});a.setOrigin(.5),a.setDepth(1001),this.scene.tweens.add({targets:a,scaleX:.8,scaleY:.8,alpha:0,duration:1200,ease:"Power2.easeIn",onComplete:()=>{a.destroy()}}),console.log(`❌ 顯示錯誤提示: ${t.chinese} -${e}生命值`)}applyAccessibilitySettings(t){this.accessibilitySettings={...this.accessibilitySettings,...t},this.updateAllFontSizes(),this.updateAllContrast(),console.log("♿ ChineseUIManager 應用無障礙設置:",this.accessibilitySettings)}updateAllFontSizes(){const t={small:16,medium:20,large:24,"extra-large":28}[this.accessibilitySettings.fontSize];this.textConfig.fontSize=t,Object.values(this.uiElements).forEach((e=>{e&&e.setFontSize&&e.setFontSize(t)}))}updateAllContrast(){const t={normal:{text:"#FFFFFF",stroke:"#000000"},high:{text:"#FFFF00",stroke:"#000000"},reverse:{text:"#000000",stroke:"#FFFFFF"}}[this.accessibilitySettings.contrast];this.textConfig.color=t.text,this.textConfig.stroke=t.stroke,Object.values(this.uiElements).forEach((e=>{e&&e.setColor&&(e.setColor(t.text),e.setStroke(t.stroke,this.textConfig.strokeThickness))}))}setVisible(t){this.hudContainer&&this.hudContainer.setVisible(t),this.targetContainer&&this.targetContainer.setVisible(t)}getState(){return{score:this.currentScore,lives:this.currentLives,target:this.currentTarget,status:this.gameStatus,accessibilitySettings:this.accessibilitySettings}}destroy(){this.hudContainer&&(this.hudContainer.destroy(),this.hudContainer=null),this.targetContainer&&(this.targetContainer.destroy(),this.targetContainer=null),Object.keys(this.uiElements).forEach((t=>{this.uiElements[t]=null})),console.log("🧹 ChineseUIManager 已銷毀")}}class h extends s.Scene{constructor(){super({key:"GameScene"}),e(this,"gameConfig"),e(this,"gameState",{isPlaying:!1,isPaused:!1,currentScore:0,currentHealth:100,wordsLearned:0,accuracy:0}),e(this,"player"),e(this,"clouds"),e(this,"cursors"),e(this,"backgroundLayers",[]),e(this,"scoreText"),e(this,"healthText"),e(this,"targetWordText"),e(this,"accuracyText"),e(this,"wordsLearnedText"),e(this,"geptManager"),e(this,"collisionSystem"),e(this,"memoryEngine"),e(this,"bilingualManager"),e(this,"chineseUIManager"),e(this,"cloudSpawnTimer"),e(this,"currentTargetWord"),e(this,"targetWordSetTime",0),e(this,"totalCollisions",0),e(this,"correctCollisions",0)}init(){console.log("🎮 初始化遊戲場景"),this.gameConfig=this.registry.get("gameConfig")||{geptLevel:"elementary",enableSound:!0,enableHapticFeedback:!0,difficulty:"medium",gameMode:"practice"},console.log("📋 遊戲配置:",this.gameConfig),this.initializeManagers()}initializeManagers(){this.geptManager=new i,this.geptManager.setLevel(this.gameConfig.geptLevel),this.memoryEngine=new a,this.collisionSystem=new n(this,this.gameConfig.geptLevel,{enableParticles:!0,enableScreenShake:!0,enableSoundEffects:this.gameConfig.enableSound,enableVisualFeedback:!0,particleIntensity:"medium",soundVolume:.7}),this.bilingualManager=new o(this,this.geptManager),this.chineseUIManager=new r(this,this.geptManager,this.bilingualManager),console.log("🔧 管理器初始化完成（包含雙語系統）")}preload(){console.log("🎨 載入遊戲資源"),this.loadMoonBackground();const t=this.add.graphics();t.fillStyle(26367),t.fillTriangle(16,0,0,32,32,32),t.generateTexture("player-plane",32,32),t.destroy();const e=this.add.graphics();e.fillStyle(16777215),e.fillEllipse(32,16,60,28),e.lineStyle(2,8947848),e.strokeEllipse(32,16,60,28),e.generateTexture("cloud-word",64,32),e.destroy();const s=this.add.graphics();s.fillStyle(16777215),s.fillCircle(2,2,2),s.generateTexture("star",4,4),s.destroy(),console.log("✅ 遊戲資源載入完成 - 包含月亮背景")}loadMoonBackground(){console.log("🌙 載入月亮主題背景");try{this.load.image("moon-bg-1","/assets/backgrounds/moon/layer-1.png"),this.load.image("moon-bg-2","/assets/backgrounds/moon/layer-2.png"),this.load.image("moon-bg-3","/assets/backgrounds/moon/layer-3.png"),this.load.image("moon","/assets/backgrounds/moon/moon.png"),console.log("🌙 月亮背景圖片載入排程完成")}catch(t){console.warn("⚠️ 月亮背景載入失敗，將使用備用背景:",t)}}create(){console.log("🏗️ 創建遊戲場景"),this.createParallaxBackground(),this.createPlayer(),this.createClouds(),this.createGameHUD(),this.setupInput(),this.setupPhysics(),this.setRandomTargetWord(),this.startCloudSpawning(),console.log("✅ 遊戲場景創建完成"),this.startGame()}createParallaxBackground(){console.log("� 創建月亮主題視差背景");this.add.rectangle(400,300,800,600,657966).setDepth(-20),this.createMoonBackgroundLayers(),this.createStarField(),console.log("🌙 月亮主題視差背景創建完成")}createMoonBackgroundLayers(){const t=[],e=this.textures.exists("moon-bg-1"),s=this.textures.exists("moon-bg-2"),i=this.textures.exists("moon-bg-3"),a=this.textures.exists("moon");if(e||s||i){if(console.log("🌙 使用月亮主題背景圖片"),e){const e=this.add.tileSprite(0,0,800,600,"moon-bg-1");e.setOrigin(0,0),e.setDepth(-15),t.push(e)}if(a){const t=this.add.image(650,150,"moon");t.setDepth(-14),t.setScale(.8),t.setAlpha(.9)}if(s){const e=this.add.tileSprite(0,0,800,600,"moon-bg-2");e.setOrigin(0,0),e.setDepth(-13),t.push(e)}if(i){const e=this.add.tileSprite(0,0,800,600,"moon-bg-3");e.setOrigin(0,0),e.setDepth(-12),t.push(e)}}else{console.log("🌌 使用備用漸層背景");const e=this.add.graphics();e.fillGradientStyle(657966,657966,1710670,1710670),e.fillRect(0,0,800,600),e.generateTexture("fallback-bg-1",800,600),e.destroy();const s=this.add.graphics();s.fillGradientStyle(1710670,1710670,2763374,2763374),s.fillRect(0,0,800,600),s.generateTexture("fallback-bg-2",800,600),s.destroy();const i=this.add.tileSprite(0,0,800,600,"fallback-bg-1");i.setOrigin(0,0),i.setDepth(-15),i.setAlpha(.7),t.push(i);const a=this.add.tileSprite(0,0,800,600,"fallback-bg-2");a.setOrigin(0,0),a.setDepth(-13),a.setAlpha(.5),t.push(a)}this.backgroundLayers=t}createStarField(){console.log("⭐ 創建星空背景");for(let t=0;t<80;t++){const t=s.Math.Between(0,800),e=s.Math.Between(0,400),i=this.add.image(t,e,"star"),a=s.Math.FloatBetween(.3,1.2),n=s.Math.FloatBetween(.4,1);i.setScale(a),i.setAlpha(n),i.setDepth(-11),this.tweens.add({targets:i,alpha:.3*n,duration:s.Math.Between(2e3,4e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createPlayer(){console.log("✈️ 創建玩家飛機 (修復版本)"),this.player=this.physics.add.image(100,300,"player-plane"),this.player.setCollideWorldBounds(!0),this.player.setScale(1.5),this.player.setDepth(10),this.player.setAlpha(1),this.player.setVisible(!0),console.log("✈️ 玩家飛機創建完成:",{x:this.player.x,y:this.player.y,visible:this.player.visible,alpha:this.player.alpha,depth:this.player.depth,texture:this.player.texture.key})}createClouds(){this.clouds=this.physics.add.group(),console.log("☁️ 創建雲朵群組")}createGameHUD(){console.log("📊 創建遊戲 HUD (已擴展目標詞彙顯示)"),this.scoreText=this.add.text(16,16,"分數: 0",{fontSize:"24px",color:"#ffffff",backgroundColor:"#000000",padding:{x:8,y:4}}).setDepth(100),this.healthText=this.add.text(16,50,"生命值: 100",{fontSize:"20px",color:"#ffffff",backgroundColor:"#000000",padding:{x:8,y:4}}).setDepth(100),this.accuracyText=this.add.text(16,84,"準確率: 0%",{fontSize:"18px",color:"#ffffff",backgroundColor:"#000000",padding:{x:8,y:4}}).setDepth(100),this.wordsLearnedText=this.add.text(16,118,"學習詞彙: 0",{fontSize:"18px",color:"#ffffff",backgroundColor:"#000000",padding:{x:8,y:4}}).setDepth(100),this.targetWordText=this.add.text(400,16,"目標: 載入中...",{fontSize:"24px",color:"#ffff00",backgroundColor:"#000000",padding:{x:12,y:8},fontStyle:"bold"}).setOrigin(.5,0).setDepth(100),this.add.text(400,50,`GEPT: ${this.gameConfig.geptLevel}`,{fontSize:"16px",color:"#00ff00",backgroundColor:"#000000",padding:{x:8,y:4}}).setOrigin(.5,0).setDepth(100)}setupInput(){this.cursors=this.input.keyboard.createCursorKeys();const t=this.input.keyboard.addKeys("W,S,A,D");this.wasd=t,console.log("🎮 設置輸入控制")}setupPhysics(){console.log("⚡ 設置物理碰撞 (已移除子彈碰撞，修改玩家碰撞)"),this.physics.add.overlap(this.player,this.clouds,this.handleAdvancedCollision,void 0,this)}setRandomTargetWord(){const t=this.geptManager.getRandomWord();this.currentTargetWord=t||void 0,this.gameState.currentTargetWord=this.currentTargetWord,this.targetWordSetTime=Date.now(),this.targetWordText&&this.currentTargetWord&&(this.targetWordText.setText(`目標: ${this.currentTargetWord.chinese} (${this.currentTargetWord.english})`),this.collisionSystem.setTargetWord(this.currentTargetWord.english,this.currentTargetWord.chinese),this.bilingualManager.updateTargetWord(this.currentTargetWord.english),this.chineseUIManager.updateTargetWord(this.currentTargetWord),console.log("🎯 設置目標詞彙:",this.currentTargetWord.english))}startCloudSpawning(){this.cloudSpawnTimer=this.time.addEvent({delay:2e3,callback:this.spawnCloud,callbackScope:this,loop:!0}),console.log("☁️ 開始雲朵生成")}spawnCloud(){if(!this.gameState.isPlaying)return;const t=this.geptManager.getRandomWord();if(!t)return;const e=s.Math.Between(100,500),i=this.physics.add.image(850,e,"cloud-word");i.setVelocityX(-100),i.setData("word",t),i.setData("isTarget",t.english===this.currentTargetWord?.english),i.setDepth(5),i.setAlpha(1),i.setVisible(!0);const a=t.english===this.currentTargetWord?.english,n=this.add.text(850,e,t.english,{fontSize:"16px",color:a?"#ff0000":"#000000",fontStyle:a?"bold":"normal",backgroundColor:a?"#ffff00":"#ffffff",padding:{x:4,y:2}}).setOrigin(.5);n.setDepth(6),n.setAlpha(1),n.setVisible(!0),i.setData("wordText",n),a&&this.bilingualManager&&this.bilingualManager.showChinesePrompt(t.english,{x:850,y:e-60}),this.clouds.add(i),console.log("☁️ 生成雲朵 (修復版本):",t.english,a?"(目標)":"",{cloudVisible:i.visible,textVisible:n.visible,cloudDepth:i.depth,textDepth:n.depth})}handleAdvancedCollision(t,e){const s=e.getData("word");e.getData("isTarget");const i=e.getData("wordText"),a=this.collisionSystem.handleCollision(t,e,s),n={wordId:s.id,word:s.english,timestamp:Date.now(),responseTime:Date.now()-this.targetWordSetTime,isCorrect:"correct"===a.type,attemptNumber:this.totalCollisions+1,contextData:{targetWord:this.currentTargetWord?.english,geptLevel:this.gameConfig.geptLevel,gameMode:this.gameConfig.gameMode}};if(this.memoryEngine.recordLearningEvent(n),this.totalCollisions++,"correct"===a.type)this.correctCollisions++,this.gameState.currentScore+=10,this.gameState.wordsLearned++,this.chineseUIManager&&this.chineseUIManager.showSuccessMessage(s,10),this.bilingualManager&&this.bilingualManager.hideChinesePrompt(),this.setRandomTargetWord(),console.log("✅ 正確碰撞:",s.english);else if(this.gameState.currentHealth-=20,this.chineseUIManager&&this.chineseUIManager.showErrorMessage(s,20),console.log("❌ 錯誤碰撞:",s.english),this.gameState.currentHealth<=0)return void this.endGame();i&&i.destroy(),e.destroy(),this.updateGameStats(),this.updateUI(),this.sendMessageToParent({type:"GAME_SCORE_UPDATE",score:this.gameState.currentScore,health:this.gameState.currentHealth})}updateGameStats(){this.gameState.accuracy=this.totalCollisions>0?Math.round(this.correctCollisions/this.totalCollisions*100):0}updateUI(){this.scoreText.setText(`分數: ${this.gameState.currentScore}`),this.healthText.setText(`生命值: ${this.gameState.currentHealth}`),this.accuracyText.setText(`準確率: ${this.gameState.accuracy}%`),this.wordsLearnedText.setText(`學習詞彙: ${this.gameState.wordsLearned}`),console.log("📊 更新 HUD:",{"分數":this.gameState.currentScore,"生命值":this.gameState.currentHealth,"準確率":this.gameState.accuracy,"學習詞彙":this.gameState.wordsLearned})}startGame(){this.gameState.isPlaying=!0,this.gameState.isPaused=!1,console.log("🚀 遊戲開始"),this.sendMessageToParent({type:"GAME_STATE_CHANGE",state:"playing"})}endGame(){this.gameState.isPlaying=!1,console.log("🏁 遊戲結束"),this.cloudSpawnTimer&&this.cloudSpawnTimer.destroy(),this.clouds.clear(!0,!0),this.sendMessageToParent({type:"GAME_COMPLETE",score:this.gameState.currentScore,health:this.gameState.currentHealth})}sendMessageToParent(t){window.parent!==window&&window.parent.postMessage(t,"*")}update(t,e){this.gameState.isPlaying&&!this.gameState.isPaused&&(this.updateParallaxBackground(),this.handlePlayerMovement(),this.updateChineseUI(),this.cleanupObjects())}updateParallaxBackground(){this.backgroundLayers.forEach(((t,e)=>{const s=.3*(e+1);t.tilePositionX+=s})),Math.floor(Date.now()/1e3)%10==0&&console.log("� 更新月亮主題視差背景")}updateChineseUI(){if(this.chineseUIManager){this.chineseUIManager.updateScore(this.gameState.currentScore),this.chineseUIManager.updateLives(this.gameState.currentHealth);const t=this.gameState.isPlaying?"playing":this.gameState.isPaused?"paused":"waiting";this.chineseUIManager.updateGameStatus(t)}}handlePlayerMovement(){const t=250,e=this.wasd;this.cursors.left.isDown||e?.A.isDown?this.player.setVelocityX(-250):this.cursors.right.isDown||e?.D.isDown?this.player.setVelocityX(t):this.player.setVelocityX(0),this.cursors.up.isDown||e?.W.isDown?this.player.setVelocityY(-250):this.cursors.down.isDown||e?.S.isDown?this.player.setVelocityY(t):this.player.setVelocityY(0)}cleanupObjects(){this.clouds.children.entries.forEach((t=>{if(t.x<-100){const e=t.getData("wordText");e&&e.destroy(),t.destroy()}else{const e=t.getData("wordText");e&&e.setPosition(t.x,t.y)}}))}}export{h as default};
//# sourceMappingURL=scenes-IflaBaD5.js.map
