var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{P as s}from"./phaser-CjIEy6U-.js";import{G as a,M as o,C as i}from"./managers-BDCOAzdU.js";class r extends s.Scene{constructor(){super({key:"GameScene"}),t(this,"gameConfig"),t(this,"gameState",{isPlaying:!1,isPaused:!1,currentScore:0,currentHealth:100,wordsLearned:0,accuracy:0}),t(this,"player"),t(this,"clouds"),t(this,"cursors"),t(this,"backgroundLayers",[]),t(this,"scoreText"),t(this,"healthText"),t(this,"targetWordText"),t(this,"accuracyText"),t(this,"wordsLearnedText"),t(this,"geptManager"),t(this,"collisionSystem"),t(this,"memoryEngine"),t(this,"cloudSpawnTimer"),t(this,"currentTargetWord"),t(this,"targetWordSetTime",0),t(this,"totalCollisions",0),t(this,"correctCollisions",0)}init(){console.log("ğŸ® åˆå§‹åŒ–éŠæˆ²å ´æ™¯"),this.gameConfig=this.registry.get("gameConfig")||{geptLevel:"elementary",enableSound:!0,enableHapticFeedback:!0,difficulty:"medium",gameMode:"practice"},console.log("ğŸ“‹ éŠæˆ²é…ç½®:",this.gameConfig),this.initializeManagers()}initializeManagers(){this.geptManager=new a,this.geptManager.setLevel(this.gameConfig.geptLevel),this.memoryEngine=new o,this.collisionSystem=new i(this,this.gameConfig.geptLevel,{enableParticles:!0,enableScreenShake:!0,enableSoundEffects:this.gameConfig.enableSound,enableVisualFeedback:!0,particleIntensity:"medium",soundVolume:.7}),console.log("ğŸ”§ ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ")}preload(){console.log("ğŸ¨ è¼‰å…¥éŠæˆ²è³‡æº"),this.loadMoonBackground();const e=this.add.graphics();e.fillStyle(26367),e.fillTriangle(16,0,0,32,32,32),e.generateTexture("player-plane",32,32),e.destroy();const t=this.add.graphics();t.fillStyle(16777215),t.fillEllipse(32,16,60,28),t.lineStyle(2,8947848),t.strokeEllipse(32,16,60,28),t.generateTexture("cloud-word",64,32),t.destroy();const s=this.add.graphics();s.fillStyle(16777215),s.fillCircle(2,2,2),s.generateTexture("star",4,4),s.destroy(),console.log("âœ… éŠæˆ²è³‡æºè¼‰å…¥å®Œæˆ - åŒ…å«æœˆäº®èƒŒæ™¯")}loadMoonBackground(){console.log("ğŸŒ™ è¼‰å…¥æœˆäº®ä¸»é¡ŒèƒŒæ™¯");try{this.load.image("moon-bg-1","/assets/backgrounds/moon/layer-1.png"),this.load.image("moon-bg-2","/assets/backgrounds/moon/layer-2.png"),this.load.image("moon-bg-3","/assets/backgrounds/moon/layer-3.png"),this.load.image("moon","/assets/backgrounds/moon/moon.png"),console.log("ğŸŒ™ æœˆäº®èƒŒæ™¯åœ–ç‰‡è¼‰å…¥æ’ç¨‹å®Œæˆ")}catch(e){console.warn("âš ï¸ æœˆäº®èƒŒæ™¯è¼‰å…¥å¤±æ•—ï¼Œå°‡ä½¿ç”¨å‚™ç”¨èƒŒæ™¯:",e)}}create(){console.log("ğŸ—ï¸ å‰µå»ºéŠæˆ²å ´æ™¯"),this.createParallaxBackground(),this.createPlayer(),this.createClouds(),this.createGameHUD(),this.setupInput(),this.setupPhysics(),this.setRandomTargetWord(),this.startCloudSpawning(),console.log("âœ… éŠæˆ²å ´æ™¯å‰µå»ºå®Œæˆ"),this.startGame()}createParallaxBackground(){console.log("ï¿½ å‰µå»ºæœˆäº®ä¸»é¡Œè¦–å·®èƒŒæ™¯");this.add.rectangle(400,300,800,600,657966).setDepth(-20),this.createMoonBackgroundLayers(),this.createStarField(),console.log("ğŸŒ™ æœˆäº®ä¸»é¡Œè¦–å·®èƒŒæ™¯å‰µå»ºå®Œæˆ")}createMoonBackgroundLayers(){const e=[],t=this.textures.exists("moon-bg-1"),s=this.textures.exists("moon-bg-2"),a=this.textures.exists("moon-bg-3"),o=this.textures.exists("moon");if(t||s||a){if(console.log("ğŸŒ™ ä½¿ç”¨æœˆäº®ä¸»é¡ŒèƒŒæ™¯åœ–ç‰‡"),t){const t=this.add.tileSprite(0,0,800,600,"moon-bg-1");t.setOrigin(0,0),t.setDepth(-15),e.push(t)}if(o){const e=this.add.image(650,150,"moon");e.setDepth(-14),e.setScale(.8),e.setAlpha(.9)}if(s){const t=this.add.tileSprite(0,0,800,600,"moon-bg-2");t.setOrigin(0,0),t.setDepth(-13),e.push(t)}if(a){const t=this.add.tileSprite(0,0,800,600,"moon-bg-3");t.setOrigin(0,0),t.setDepth(-12),e.push(t)}}else{console.log("ğŸŒŒ ä½¿ç”¨å‚™ç”¨æ¼¸å±¤èƒŒæ™¯");const t=this.add.graphics();t.fillGradientStyle(657966,657966,1710670,1710670),t.fillRect(0,0,800,600),t.generateTexture("fallback-bg-1",800,600),t.destroy();const s=this.add.graphics();s.fillGradientStyle(1710670,1710670,2763374,2763374),s.fillRect(0,0,800,600),s.generateTexture("fallback-bg-2",800,600),s.destroy();const a=this.add.tileSprite(0,0,800,600,"fallback-bg-1");a.setOrigin(0,0),a.setDepth(-15),a.setAlpha(.7),e.push(a);const o=this.add.tileSprite(0,0,800,600,"fallback-bg-2");o.setOrigin(0,0),o.setDepth(-13),o.setAlpha(.5),e.push(o)}this.backgroundLayers=e}createStarField(){console.log("â­ å‰µå»ºæ˜Ÿç©ºèƒŒæ™¯");for(let e=0;e<80;e++){const e=s.Math.Between(0,800),t=s.Math.Between(0,400),a=this.add.image(e,t,"star"),o=s.Math.FloatBetween(.3,1.2),i=s.Math.FloatBetween(.4,1);a.setScale(o),a.setAlpha(i),a.setDepth(-11),this.tweens.add({targets:a,alpha:.3*i,duration:s.Math.Between(2e3,4e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createPlayer(){console.log("âœˆï¸ å‰µå»ºç©å®¶é£›æ©Ÿ (ä¿®å¾©ç‰ˆæœ¬)"),this.player=this.physics.add.image(100,300,"player-plane"),this.player.setCollideWorldBounds(!0),this.player.setScale(1.5),this.player.setDepth(10),this.player.setAlpha(1),this.player.setVisible(!0),console.log("âœˆï¸ ç©å®¶é£›æ©Ÿå‰µå»ºå®Œæˆ:",{x:this.player.x,y:this.player.y,visible:this.player.visible,alpha:this.player.alpha,depth:this.player.depth,texture:this.player.texture.key})}createClouds(){this.clouds=this.physics.add.group(),console.log("â˜ï¸ å‰µå»ºé›²æœµç¾¤çµ„")}createGameHUD(){console.log("ğŸ“Š å‰µå»ºéŠæˆ² HUD (å·²æ“´å±•ç›®æ¨™è©å½™é¡¯ç¤º)"),this.scoreText=this.add.text(16,16,"åˆ†æ•¸: 0",{fontSize:"24px",color:"#ffffff",backgroundColor:"#000000",padding:{x:8,y:4}}).setDepth(100),this.healthText=this.add.text(16,50,"ç”Ÿå‘½å€¼: 100",{fontSize:"20px",color:"#ffffff",backgroundColor:"#000000",padding:{x:8,y:4}}).setDepth(100),this.accuracyText=this.add.text(16,84,"æº–ç¢ºç‡: 0%",{fontSize:"18px",color:"#ffffff",backgroundColor:"#000000",padding:{x:8,y:4}}).setDepth(100),this.wordsLearnedText=this.add.text(16,118,"å­¸ç¿’è©å½™: 0",{fontSize:"18px",color:"#ffffff",backgroundColor:"#000000",padding:{x:8,y:4}}).setDepth(100),this.targetWordText=this.add.text(400,16,"ç›®æ¨™: è¼‰å…¥ä¸­...",{fontSize:"24px",color:"#ffff00",backgroundColor:"#000000",padding:{x:12,y:8},fontStyle:"bold"}).setOrigin(.5,0).setDepth(100),this.add.text(400,50,`GEPT: ${this.gameConfig.geptLevel}`,{fontSize:"16px",color:"#00ff00",backgroundColor:"#000000",padding:{x:8,y:4}}).setOrigin(.5,0).setDepth(100)}setupInput(){this.cursors=this.input.keyboard.createCursorKeys();const e=this.input.keyboard.addKeys("W,S,A,D");this.wasd=e,console.log("ğŸ® è¨­ç½®è¼¸å…¥æ§åˆ¶")}setupPhysics(){console.log("âš¡ è¨­ç½®ç‰©ç†ç¢°æ’ (å·²ç§»é™¤å­å½ˆç¢°æ’ï¼Œä¿®æ”¹ç©å®¶ç¢°æ’)"),this.physics.add.overlap(this.player,this.clouds,this.handleAdvancedCollision,void 0,this)}setRandomTargetWord(){const e=this.geptManager.getRandomWord();this.currentTargetWord=e||void 0,this.gameState.currentTargetWord=this.currentTargetWord,this.targetWordSetTime=Date.now(),this.targetWordText&&this.currentTargetWord&&(this.targetWordText.setText(`ç›®æ¨™: ${this.currentTargetWord.chinese} (${this.currentTargetWord.english})`),this.collisionSystem.setTargetWord(this.currentTargetWord.english,this.currentTargetWord.chinese),console.log("ğŸ¯ è¨­ç½®ç›®æ¨™è©å½™:",this.currentTargetWord.english))}startCloudSpawning(){this.cloudSpawnTimer=this.time.addEvent({delay:2e3,callback:this.spawnCloud,callbackScope:this,loop:!0}),console.log("â˜ï¸ é–‹å§‹é›²æœµç”Ÿæˆ")}spawnCloud(){if(!this.gameState.isPlaying)return;const e=this.geptManager.getRandomWord();if(!e)return;const t=s.Math.Between(100,500),a=this.physics.add.image(850,t,"cloud-word");a.setVelocityX(-100),a.setData("word",e),a.setData("isTarget",e.english===this.currentTargetWord?.english),a.setDepth(5),a.setAlpha(1),a.setVisible(!0);const o=e.english===this.currentTargetWord?.english,i=this.add.text(850,t,e.english,{fontSize:"16px",color:o?"#ff0000":"#000000",fontStyle:o?"bold":"normal",backgroundColor:o?"#ffff00":"#ffffff",padding:{x:4,y:2}}).setOrigin(.5);i.setDepth(6),i.setAlpha(1),i.setVisible(!0),a.setData("wordText",i),this.clouds.add(a),console.log("â˜ï¸ ç”Ÿæˆé›²æœµ (ä¿®å¾©ç‰ˆæœ¬):",e.english,o?"(ç›®æ¨™)":"",{cloudVisible:a.visible,textVisible:i.visible,cloudDepth:a.depth,textDepth:i.depth})}handleAdvancedCollision(e,t){const s=t.getData("word");t.getData("isTarget");const a=t.getData("wordText"),o=this.collisionSystem.handleCollision(e,t,s),i={wordId:s.id,word:s.english,timestamp:Date.now(),responseTime:Date.now()-this.targetWordSetTime,isCorrect:"correct"===o.type,attemptNumber:this.totalCollisions+1,contextData:{targetWord:this.currentTargetWord?.english,geptLevel:this.gameConfig.geptLevel,gameMode:this.gameConfig.gameMode}};if(this.memoryEngine.recordLearningEvent(i),this.totalCollisions++,"correct"===o.type)this.correctCollisions++,this.gameState.currentScore+=10,this.gameState.wordsLearned++,this.setRandomTargetWord(),console.log("âœ… æ­£ç¢ºç¢°æ’:",s.english);else if(this.gameState.currentHealth-=20,console.log("âŒ éŒ¯èª¤ç¢°æ’:",s.english),this.gameState.currentHealth<=0)return void this.endGame();a&&a.destroy(),t.destroy(),this.updateGameStats(),this.updateUI(),this.sendMessageToParent({type:"GAME_SCORE_UPDATE",score:this.gameState.currentScore,health:this.gameState.currentHealth})}updateGameStats(){this.gameState.accuracy=this.totalCollisions>0?Math.round(this.correctCollisions/this.totalCollisions*100):0}updateUI(){this.scoreText.setText(`åˆ†æ•¸: ${this.gameState.currentScore}`),this.healthText.setText(`ç”Ÿå‘½å€¼: ${this.gameState.currentHealth}`),this.accuracyText.setText(`æº–ç¢ºç‡: ${this.gameState.accuracy}%`),this.wordsLearnedText.setText(`å­¸ç¿’è©å½™: ${this.gameState.wordsLearned}`),console.log("ğŸ“Š æ›´æ–° HUD:",{"åˆ†æ•¸":this.gameState.currentScore,"ç”Ÿå‘½å€¼":this.gameState.currentHealth,"æº–ç¢ºç‡":this.gameState.accuracy,"å­¸ç¿’è©å½™":this.gameState.wordsLearned})}startGame(){this.gameState.isPlaying=!0,this.gameState.isPaused=!1,console.log("ğŸš€ éŠæˆ²é–‹å§‹"),this.sendMessageToParent({type:"GAME_STATE_CHANGE",state:"playing"})}endGame(){this.gameState.isPlaying=!1,console.log("ğŸ éŠæˆ²çµæŸ"),this.cloudSpawnTimer&&this.cloudSpawnTimer.destroy(),this.clouds.clear(!0,!0),this.sendMessageToParent({type:"GAME_COMPLETE",score:this.gameState.currentScore,health:this.gameState.currentHealth})}sendMessageToParent(e){window.parent!==window&&window.parent.postMessage(e,"*")}update(e,t){this.gameState.isPlaying&&!this.gameState.isPaused&&(this.updateParallaxBackground(),this.handlePlayerMovement(),this.cleanupObjects())}updateParallaxBackground(){this.backgroundLayers.forEach(((e,t)=>{const s=.3*(t+1);e.tilePositionX+=s})),Math.floor(Date.now()/1e3)%10==0&&console.log("ï¿½ æ›´æ–°æœˆäº®ä¸»é¡Œè¦–å·®èƒŒæ™¯")}handlePlayerMovement(){const e=250,t=this.wasd;this.cursors.left.isDown||t?.A.isDown?this.player.setVelocityX(-250):this.cursors.right.isDown||t?.D.isDown?this.player.setVelocityX(e):this.player.setVelocityX(0),this.cursors.up.isDown||t?.W.isDown?this.player.setVelocityY(-250):this.cursors.down.isDown||t?.S.isDown?this.player.setVelocityY(e):this.player.setVelocityY(0)}cleanupObjects(){this.clouds.children.entries.forEach((e=>{if(e.x<-100){const t=e.getData("wordText");t&&t.destroy(),e.destroy()}else{const t=e.getData("wordText");t&&t.setPosition(e.x,e.y)}}))}}export{r as default};
//# sourceMappingURL=scenes-D5GcjUem.js.map
