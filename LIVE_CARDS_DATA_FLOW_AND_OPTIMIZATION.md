# ğŸ“Š æ´»å¡ç‰‡æ•¸æ“šæµèˆ‡å„ªåŒ–ç­–ç•¥

## 1. å®Œæ•´æ•¸æ“šæµåœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ¶äº¤äº’å±¤                                 â”‚
â”‚  (é»æ“ŠéŠæˆ²ã€é¸æ“‡ç­‰ç´šã€æŸ¥çœ‹é€²åº¦)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  GameSwitcher çµ„ä»¶                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç‹€æ…‹ç®¡ç†å±¤                                            â”‚   â”‚
â”‚  â”‚ - currentGameId: ç•¶å‰éŠæˆ²                            â”‚   â”‚
â”‚  â”‚ - gameStates: æ‰€æœ‰éŠæˆ²ç‹€æ…‹å­—å…¸                       â”‚   â”‚
â”‚  â”‚ - isLoading: è¼‰å…¥ç‹€æ…‹                                â”‚   â”‚
â”‚  â”‚ - isMobile: è¨­å‚™é¡å‹                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  iframe é‚Šç•Œ                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ éŠæˆ²å…§éƒ¨ (match-up-game)                             â”‚   â”‚
â”‚  â”‚ - GameScene å ´æ™¯                                     â”‚   â”‚
â”‚  â”‚ - å¡ç‰‡æ‹–æ”¾é‚è¼¯                                       â”‚   â”‚
â”‚  â”‚ - åˆ†æ•¸è¨ˆç®—                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              postMessage é€šä¿¡å±¤                              â”‚
â”‚  {type: 'GAME_STATE_UPDATE', score, progress, ...}         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           handleIframeMessage æ¥æ”¶å™¨                         â”‚
â”‚  - è§£ææ¶ˆæ¯                                                  â”‚
â”‚  - é©—è­‰æ•¸æ“š                                                  â”‚
â”‚  - èª¿ç”¨ setGameStates                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              React ç‹€æ…‹æ›´æ–°                                  â”‚
â”‚  setGameStates(prev => ({                                   â”‚
â”‚    ...prev,                                                  â”‚
â”‚    [currentGameId]: newState                                â”‚
â”‚  }))                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              çµ„ä»¶é‡æ–°æ¸²æŸ“                                     â”‚
â”‚  - éŠæˆ²ç‹€æ…‹é¢æ¿æ›´æ–°                                          â”‚
â”‚  - éŠæˆ²é¸æ“‡å¡ç‰‡æ›´æ–°                                          â”‚
â”‚  - GEPT ç­‰ç´šå¡ç‰‡æ›´æ–°                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UI é¡¯ç¤ºå±¤                                       â”‚
â”‚  ç”¨æˆ¶çœ‹åˆ°å¯¦æ™‚æ›´æ–°çš„éŠæˆ²ç‹€æ…‹                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç‹€æ…‹æ›´æ–°æ™‚åºåœ–

```
æ™‚é–“è»¸ (æ¯«ç§’)
0ms    â”œâ”€ ç”¨æˆ¶æ“ä½œ (æ‹–æ”¾å¡ç‰‡)
       â”‚
10ms   â”œâ”€ éŠæˆ²å…§éƒ¨è¨ˆç®—
       â”‚
20ms   â”œâ”€ postMessage ç™¼é€
       â”‚
25ms   â”œâ”€ handleIframeMessage æ¥æ”¶
       â”‚
30ms   â”œâ”€ setGameStates æ›´æ–°
       â”‚
35ms   â”œâ”€ React é‡æ–°æ¸²æŸ“
       â”‚
40ms   â”œâ”€ DOM æ›´æ–°
       â”‚
45ms   â””â”€ ç”¨æˆ¶çœ‹åˆ°æ–°ç‹€æ…‹ âœ…
```

---

## 3. å„ªåŒ–ç­–ç•¥

### å„ªåŒ– 1ï¼šç‹€æ…‹éš”é›¢

**å•é¡Œï¼š** å…¨å±€ç‹€æ…‹æ›´æ–°å°è‡´æ‰€æœ‰çµ„ä»¶é‡æ–°æ¸²æŸ“

**è§£æ±ºï¼š**
```typescript
// âŒ ä¸å¥½çš„åšæ³•
const [gameState, setGameState] = useState({});

// âœ… å¥½çš„åšæ³•
const [gameStates, setGameStates] = useState<Record<string, GameState>>({});
// åªæ›´æ–°ç‰¹å®šéŠæˆ²çš„ç‹€æ…‹
setGameStates(prev => ({
  ...prev,
  [currentGameId]: newState  // åªæ›´æ–°ç•¶å‰éŠæˆ²
}));
```

### å„ªåŒ– 2ï¼šæ¢ä»¶æ¸²æŸ“

**å•é¡Œï¼š** å³ä½¿æ²’æœ‰ç‹€æ…‹ä¹Ÿæ¸²æŸ“å¡ç‰‡

**è§£æ±ºï¼š**
```typescript
// âœ… åªåœ¨æœ‰ç‹€æ…‹æ™‚æ¸²æŸ“
{gameStates[currentGameId] && (
  <div className="game-status-panel">
    {/* å¡ç‰‡å…§å®¹ */}
  </div>
)}
```

### å„ªåŒ– 3ï¼šé˜²æŠ–æ¶ˆæ¯

**å•é¡Œï¼š** æ¶ˆæ¯éæ–¼é »ç¹å°è‡´æ€§èƒ½ä¸‹é™

**è§£æ±ºï¼š**
```typescript
const handleIframeMessage = useCallback((event: MessageEvent) => {
  // ä½¿ç”¨ useCallback é¿å…é‡è¤‡å‰µå»ºå‡½æ•¸
  // ä¾è³´é …ç²¾ç¢ºæ§åˆ¶
}, [currentGameId, currentGeptLevel, onGameStateUpdate]);
```

### å„ªåŒ– 4ï¼šéŸ¿æ‡‰å¼è¨­è¨ˆ

**å•é¡Œï¼š** æ‰‹æ©Ÿç‰ˆå¡ç‰‡é¡¯ç¤ºç•°å¸¸

**è§£æ±ºï¼š**
```typescript
// æ ¹æ“šè¨­å‚™é¡å‹èª¿æ•´å¡ç‰‡å¤§å°
const cardSize = isMobile ? 'sm' : 'md';
const gridCols = isMobile ? 'grid-cols-2' : 'grid-cols-4';
```

---

## 4. æ€§èƒ½æŒ‡æ¨™

### é—œéµæŒ‡æ¨™

| æŒ‡æ¨™ | ç•¶å‰ | ç›®æ¨™ | å„ªåŒ–æ–¹æ¡ˆ |
|------|------|------|---------|
| é¦–æ¬¡è¼‰å…¥ | 1.5s | < 1s | ä»£ç¢¼åˆ†å‰² |
| æ¶ˆæ¯å»¶é² | 50ms | < 30ms | é˜²æŠ– |
| é‡æ–°æ¸²æŸ“ | 100ms | < 50ms | useMemo |
| å…§å­˜å ç”¨ | 45MB | < 30MB | ç‹€æ…‹æ¸…ç† |

---

## 5. ç›£æ§å’Œèª¿è©¦

### èª¿è©¦å·¥å…·

```javascript
// 1. æŸ¥çœ‹ç•¶å‰ç‹€æ…‹
console.log('gameStates:', gameStates);
console.log('currentGameId:', currentGameId);

// 2. ç›£æ§æ¶ˆæ¯
window.addEventListener('message', (e) => {
  console.log('ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯:', e.data);
});

// 3. æ€§èƒ½ç›£æ§
performance.mark('game-state-update-start');
setGameStates(newState);
performance.mark('game-state-update-end');
performance.measure('game-state-update', 
  'game-state-update-start', 
  'game-state-update-end'
);
```

---

## 6. æœªä¾†æ”¹é€²æ–¹å‘

### çŸ­æœŸ (1-2 é€±)
- [ ] æ·»åŠ ç‹€æ…‹æŒä¹…åŒ– (localStorage)
- [ ] å¯¦ç¾æ¶ˆæ¯é˜²æŠ–
- [ ] å„ªåŒ–æ‰‹æ©Ÿç‰ˆå¡ç‰‡

### ä¸­æœŸ (1 å€‹æœˆ)
- [ ] å¯¦ç¾ç‹€æ…‹é æ¸¬
- [ ] æ·»åŠ é›¢ç·šæ”¯æŒ
- [ ] å„ªåŒ–å…§å­˜å ç”¨

### é•·æœŸ (3 å€‹æœˆ)
- [ ] å¯¦ç¾å¯¦æ™‚å”ä½œ
- [ ] æ·»åŠ åˆ†æå„€è¡¨æ¿
- [ ] æ”¯æŒè‡ªå®šç¾©å¡ç‰‡

---

**å„ªåŒ–åˆ†æå®Œæˆ âœ…**

