# ğŸ”„ æ•¸æ“šåº«åŒæ­¥ç­–ç•¥

**ç›®æ¨™**: åŒæ­¥ Production Branch å’Œ Development Branch çš„æ•¸æ“š  
**æ—¥æœŸ**: 2025-11-04  
**ç‹€æ…‹**: ğŸ“‹ æº–å‚™åŸ·è¡Œ

---

## ğŸ“Š ç•¶å‰æ•¸æ“šç‹€æ³

### Production Branchï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰
```
Compute: ep-curly-salad-a85exs3f
- ç”¨æˆ¶: 1 å€‹ï¼ˆnteverysome@gmail.comï¼‰
- è³‡æ–™å¤¾: 77 å€‹
- æ´»å‹•: 92 å€‹ï¼ˆå·²æ¢å¾©ï¼‰
- è©å½™é …ç›®: 3 å€‹
```

### Development Branchï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰
```
Compute: ep-hidden-field-a8tai7gk
- ç”¨æˆ¶: 1 å€‹ï¼ˆdemo@educreate.comï¼‰
- è³‡æ–™å¤¾: 2 å€‹
- æ´»å‹•: 0 å€‹
- è©å½™é …ç›®: 0 å€‹
```

---

## ğŸ¯ åŒæ­¥ç›®æ¨™

### ç›®æ¨™ 1ï¼šçµ±ä¸€é–‹ç™¼ç’°å¢ƒ
- âœ… Development Branch ç²å¾— Production Branch çš„å®Œæ•´æ•¸æ“š
- âœ… æœ¬åœ°é–‹ç™¼ç’°å¢ƒæœ‰å®Œæ•´çš„æ¸¬è©¦æ•¸æ“š
- âœ… é–‹ç™¼äººå“¡å¯ä»¥åœ¨çœŸå¯¦æ•¸æ“šä¸Šé€²è¡Œæ¸¬è©¦

### ç›®æ¨™ 2ï¼šä¿æŒæ•¸æ“šä¸€è‡´æ€§
- âœ… å…©å€‹åˆ†æ”¯çš„æ•¸æ“šçµæ§‹ä¿æŒä¸€è‡´
- âœ… ç”¨æˆ¶ã€è³‡æ–™å¤¾ã€æ´»å‹•ç­‰æ•¸æ“šå®Œå…¨åŒæ­¥
- âœ… é¿å…æ•¸æ“šä¸ä¸€è‡´å°è‡´çš„å•é¡Œ

### ç›®æ¨™ 3ï¼šå»ºç«‹åŒæ­¥æ©Ÿåˆ¶
- âœ… å‰µå»ºå¯é‡è¤‡ä½¿ç”¨çš„åŒæ­¥è…³æœ¬
- âœ… æ”¯æŒå®šæœŸåŒæ­¥
- âœ… ç”ŸæˆåŒæ­¥å ±å‘Šç”¨æ–¼å¯©è¨ˆ

---

## ğŸ”§ åŒæ­¥æ–¹æ¡ˆ

### æ–¹æ¡ˆé¸æ“‡ï¼šProduction â†’ Development

**åŸå› **ï¼š
1. Production Branch æœ‰å®Œæ•´çš„ 92 å€‹æ´»å‹•
2. Development Branch æ˜¯é–‹ç™¼ç’°å¢ƒï¼Œæ‡‰è©²æœ‰å®Œæ•´çš„æ¸¬è©¦æ•¸æ“š
3. é€™æ¨£æœ¬åœ°é–‹ç™¼äººå“¡å¯ä»¥åœ¨çœŸå¯¦æ•¸æ“šä¸Šå·¥ä½œ

### åŒæ­¥æµç¨‹

```
æ­¥é©Ÿ 1: é€£æ¥åˆ° Production Branch
   â†“
æ­¥é©Ÿ 2: è®€å–æ‰€æœ‰æ•¸æ“š
   - User è¡¨
   - Folder è¡¨
   - Activity è¡¨
   - GameSettings è¡¨
   - VocabularyItem è¡¨
   â†“
æ­¥é©Ÿ 3: é€£æ¥åˆ° Development Branch
   â†“
æ­¥é©Ÿ 4: æ¸…ç©ºèˆŠæ•¸æ“šï¼ˆæŒ‰ä¾è³´é †åºï¼‰
   - VocabularyItem
   - GameSettings
   - Activity
   - Folder
   - User
   â†“
æ­¥é©Ÿ 5: è¤‡è£½æ–°æ•¸æ“šï¼ˆæŒ‰ä¾è³´é †åºï¼‰
   - User
   - Folder
   - GameSettings
   - Activity
   - VocabularyItem
   â†“
æ­¥é©Ÿ 6: é©—è­‰åŒæ­¥çµæœ
   â†“
æ­¥é©Ÿ 7: ç”ŸæˆåŒæ­¥å ±å‘Š
```

---

## ğŸ“‹ åŒæ­¥è…³æœ¬

### è…³æœ¬ä½ç½®
```
scripts/sync-databases.js
```

### åŠŸèƒ½
- è‡ªå‹•é€£æ¥åˆ°å…©å€‹æ•¸æ“šåº«åˆ†æ”¯
- è®€å– Production Branch çš„æ‰€æœ‰æ•¸æ“š
- æ¸…ç©º Development Branch çš„èˆŠæ•¸æ“š
- è¤‡è£½æ‰€æœ‰æ•¸æ“šåˆ° Development Branch
- é©—è­‰åŒæ­¥çµæœ
- ç”ŸæˆåŒæ­¥å ±å‘Š

### ä½¿ç”¨æ–¹æ³•

```bash
# åŸ·è¡ŒåŒæ­¥
node scripts/sync-databases.js

# é æœŸè¼¸å‡º
ğŸ”„ é–‹å§‹åŒæ­¥æ•¸æ“šåº«...

ğŸ“– æ­¥é©Ÿ 1ï¼šå¾ Production Branch è®€å–æ•¸æ“š...
   âœ… è®€å– 1 å€‹ç”¨æˆ¶
   âœ… è®€å– 77 å€‹è³‡æ–™å¤¾
   âœ… è®€å– 92 å€‹æ´»å‹•

ğŸ—‘ï¸  æ­¥é©Ÿ 2ï¼šæ¸…ç©º Development Branch çš„èˆŠæ•¸æ“š...
   âœ… æ¸…ç©º VocabularyItem è¡¨
   âœ… æ¸…ç©º GameSettings è¡¨
   âœ… æ¸…ç©º Activity è¡¨
   âœ… æ¸…ç©º Folder è¡¨
   âœ… æ¸…ç©º User è¡¨

ğŸ‘¥ æ­¥é©Ÿ 3ï¼šè¤‡è£½ç”¨æˆ¶æ•¸æ“š...
   âœ… è¤‡è£½ 1 å€‹ç”¨æˆ¶

ğŸ“ æ­¥é©Ÿ 4ï¼šè¤‡è£½è³‡æ–™å¤¾æ•¸æ“š...
   âœ… è¤‡è£½ 77 å€‹è³‡æ–™å¤¾

ğŸ® æ­¥é©Ÿ 5ï¼šè¤‡è£½æ´»å‹•å’Œç›¸é—œæ•¸æ“š...
   âœ… æˆåŠŸè¤‡è£½ 92 å€‹æ´»å‹•

âœ… æ­¥é©Ÿ 6ï¼šé©—è­‰åŒæ­¥çµæœ...
   ğŸ“Š Development Branch ç¾åœ¨æœ‰ï¼š
      - 1 å€‹ç”¨æˆ¶
      - 77 å€‹è³‡æ–™å¤¾
      - 92 å€‹æ´»å‹•
      - 3 å€‹è©å½™é …ç›®

ğŸ“ æ­¥é©Ÿ 7ï¼šç”ŸæˆåŒæ­¥å ±å‘Š...
   âœ… å ±å‘Šå·²ä¿å­˜åˆ°: DATABASE_SYNC_REPORT_2025-11-04.json

ğŸ‰ æ•¸æ“šåº«åŒæ­¥å®Œæˆï¼
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### 1. æ•¸æ“šè¦†è“‹
- âš ï¸ æ­¤æ“ä½œå°‡**å®Œå…¨è¦†è“‹** Development Branch çš„æ‰€æœ‰æ•¸æ“š
- âš ï¸ Development Branch ä¸­çš„ä»»ä½•æœ¬åœ°æ•¸æ“šéƒ½å°‡è¢«åˆªé™¤
- âœ… å»ºè­°åœ¨åŸ·è¡Œå‰å‚™ä»½ Development Branch çš„æ•¸æ“š

### 2. ç”¨æˆ¶æ•¸æ“š
- âš ï¸ åŒæ­¥å¾Œï¼ŒDevelopment Branch å°‡æœ‰ Production Branch çš„ç”¨æˆ¶
- âš ï¸ åŸæœ‰çš„ demo@educreate.com ç”¨æˆ¶å°‡è¢«åˆªé™¤
- âœ… å¦‚æœéœ€è¦ä¿ç•™ï¼Œè«‹å…ˆå‚™ä»½

### 3. åŸ·è¡Œæ™‚é–“
- â±ï¸ åŒæ­¥ 92 å€‹æ´»å‹•å¯èƒ½éœ€è¦ 1-5 åˆ†é˜
- â±ï¸ å–æ±ºæ–¼ç¶²çµ¡é€£æ¥é€Ÿåº¦å’Œæ•¸æ“šåº«æ€§èƒ½

### 4. å›æ»¾
- âœ… å¦‚æœåŒæ­¥å¤±æ•—ï¼Œå¯ä»¥é‡æ–°åŸ·è¡Œè…³æœ¬
- âœ… å¦‚æœéœ€è¦æ¢å¾©åŸæ•¸æ“šï¼Œå¯ä»¥ä½¿ç”¨ Neon çš„å‚™ä»½åŠŸèƒ½

---

## ğŸš€ åŸ·è¡Œæ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šæº–å‚™
```bash
# ç¢ºä¿æ‰€æœ‰ä¾è³´å·²å®‰è£
npm install

# ç¢ºä¿ Prisma å®¢æˆ¶ç«¯å·²ç”Ÿæˆ
npx prisma generate
```

### æ­¥é©Ÿ 2ï¼šå‚™ä»½ï¼ˆå¯é¸ä½†æ¨è–¦ï¼‰
```bash
# å‚™ä»½ Development Branch çš„æ•¸æ“š
pg_dump "postgresql://neondb_owner:npg_JiVYrWK7L6Ff@ep-hidden-field-a8tai7gk-pooler.eastus2.azure.neon.tech/neondb?sslmode=require" > dev_backup_$(date +%Y%m%d_%H%M%S).sql
```

### æ­¥é©Ÿ 3ï¼šåŸ·è¡ŒåŒæ­¥
```bash
# é‹è¡ŒåŒæ­¥è…³æœ¬
node scripts/sync-databases.js
```

### æ­¥é©Ÿ 4ï¼šé©—è­‰
```bash
# æª¢æŸ¥ Development Branch çš„æ•¸æ“š
DATABASE_URL="postgresql://neondb_owner:npg_JiVYrWK7L6Ff@ep-hidden-field-a8tai7gk-pooler.eastus2.azure.neon.tech/neondb?sslmode=require&channel_binding=require" node scripts/diagnose-data-loss.js
```

### æ­¥é©Ÿ 5ï¼šæ›´æ–°æœ¬åœ°ç’°å¢ƒ
```bash
# å¦‚æœä½¿ç”¨ .env.localï¼Œç¢ºä¿æŒ‡å‘ Development Branch
# æˆ–è€…ä½¿ç”¨ .env.development
cp .env.development .env.local
```

---

## ğŸ“Š é æœŸçµæœ

### åŒæ­¥å‰
```
Production Branch: 92 å€‹æ´»å‹• âœ…
Development Branch: 0 å€‹æ´»å‹• âŒ
```

### åŒæ­¥å¾Œ
```
Production Branch: 92 å€‹æ´»å‹• âœ…
Development Branch: 92 å€‹æ´»å‹• âœ…
```

---

## ğŸ“ åŒæ­¥å ±å‘Š

åŒæ­¥å®Œæˆå¾Œï¼Œå°‡ç”Ÿæˆä¸€å€‹ JSON å ±å‘Šï¼š

```json
{
  "timestamp": "2025-11-04T10:30:00.000Z",
  "source": "Production Branch (ep-curly-salad-a85exs3f)",
  "destination": "Development Branch (ep-hidden-field-a8tai7gk)",
  "summary": {
    "users": { "source": 1, "destination": 1 },
    "folders": { "source": 77, "destination": 77 },
    "activities": { "source": 92, "destination": 92 },
    "vocabularyItems": { "source": 3, "destination": 3 }
  },
  "status": "completed",
  "successCount": 92,
  "errorCount": 0
}
```

---

## ğŸ”„ å¾ŒçºŒåŒæ­¥

### å®šæœŸåŒæ­¥
å¦‚æœéœ€è¦å®šæœŸåŒæ­¥ï¼Œå¯ä»¥ï¼š
1. è¨­ç½® cron ä»»å‹™å®šæœŸåŸ·è¡Œè…³æœ¬
2. æˆ–åœ¨ CI/CD æµç¨‹ä¸­é›†æˆåŒæ­¥

### åå‘åŒæ­¥
å¦‚æœéœ€è¦å°‡ Development Branch çš„æ•¸æ“šåŒæ­¥å› Production Branchï¼š
1. ä¿®æ”¹è…³æœ¬ä¸­çš„æ•¸æ“šåº«é€£æ¥é †åº
2. æˆ–å‰µå»ºæ–°çš„åå‘åŒæ­¥è…³æœ¬

---

## ğŸ†˜ æ•…éšœæ’é™¤

### é€£æ¥å¤±æ•—
```
Error: connect ECONNREFUSED
```
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥ç¶²çµ¡é€£æ¥
- ç¢ºèª Neon æ•¸æ“šåº«é€£æ¥å­—ç¬¦ä¸²æ­£ç¢º
- æª¢æŸ¥é˜²ç«ç‰†è¨­ç½®

### æ¬Šé™éŒ¯èª¤
```
Error: permission denied
```
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºèªä½¿ç”¨çš„æ˜¯æ­£ç¢ºçš„æ•¸æ“šåº«ç”¨æˆ¶
- æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦æœ‰åˆªé™¤å’Œæ’å…¥æ¬Šé™

### æ•¸æ“šä¸ä¸€è‡´
```
Error: foreign key constraint
```
**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºä¿æŒ‰æ­£ç¢ºçš„é †åºåˆªé™¤å’Œæ’å…¥æ•¸æ“š
- æª¢æŸ¥æ˜¯å¦æœ‰å­¤ç«‹çš„è¨˜éŒ„

---

## âœ… æª¢æŸ¥æ¸…å–®

- [ ] å·²å‚™ä»½ Development Branch çš„æ•¸æ“šï¼ˆå¯é¸ï¼‰
- [ ] å·²ç¢ºèª Neon é€£æ¥å­—ç¬¦ä¸²æ­£ç¢º
- [ ] å·²å®‰è£æ‰€æœ‰ä¾è³´
- [ ] å·²ç”Ÿæˆ Prisma å®¢æˆ¶ç«¯
- [ ] å·²æº–å‚™å¥½åŸ·è¡ŒåŒæ­¥è…³æœ¬
- [ ] å·²äº†è§£åŒæ­¥å°‡è¦†è“‹ Development Branch çš„æ‰€æœ‰æ•¸æ“š
- [ ] å·²æº–å‚™å¥½é©—è­‰åŒæ­¥çµæœ

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… åŸ·è¡ŒåŒæ­¥è…³æœ¬
2. âœ… é©—è­‰åŒæ­¥çµæœ
3. âœ… æ›´æ–°æœ¬åœ°ç’°å¢ƒé…ç½®
4. âœ… æ¸¬è©¦æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
5. âœ… æäº¤åŒæ­¥å ±å‘Šåˆ° Git

