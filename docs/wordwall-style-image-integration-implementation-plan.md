# Wordwall é¢¨æ ¼åœ–ç‰‡åŠŸèƒ½æ•´åˆå¯¦æ–½è¨ˆç•«

**æ—¥æœŸ**: 2025-10-22  
**ç›®æ¨™**: å°‡ Wordwall é¢¨æ ¼çš„åœ–ç‰‡åŠŸèƒ½æ•´åˆåˆ° /create/shimozurdo-game é é¢  
**é ä¼°æ™‚é–“**: 7 å°æ™‚  
**æ–¹æ¡ˆ**: æ–¹æ¡ˆ A - Wordwall é¢¨æ ¼ + EduCreate åŠŸèƒ½

---

## ğŸ“Š é …ç›®æ¦‚è¿°

### ç›®æ¨™

å°‡ EduCreate çš„å¼·å¤§åœ–ç‰‡åŠŸèƒ½ï¼ˆé¸æ“‡ã€ç·¨è¼¯ã€æ–‡å­—ç–ŠåŠ ã€ç‰ˆæœ¬ç®¡ç†ï¼‰ä»¥ Wordwall çš„ç°¡æ½” UI é¢¨æ ¼æ•´åˆåˆ°éŠæˆ²å‰µå»ºé é¢ã€‚

### æ ¸å¿ƒç‰¹é»

1. **ç°¡æ½”çš„ UI** - åªé¡¯ç¤ºå°åœ–æ¨™æŒ‰éˆ•ï¼ˆğŸ–¼ï¸ï¼‰
2. **å¼·å¤§çš„åŠŸèƒ½** - ä¿ç•™æ‰€æœ‰ EduCreate åœ–ç‰‡åŠŸèƒ½
3. **ç„¡ç¸«æ•´åˆ** - ç›´æ¥åœ¨è©å½™è¼¸å…¥åˆ—è¡¨ä¸­ä½¿ç”¨
4. **è‡ªå‹•æ–‡å­—ç–ŠåŠ ** - è‡ªå‹•å°‡è‹±æ–‡å’Œä¸­æ–‡ç–ŠåŠ åˆ°åœ–ç‰‡ä¸Š

---

## ğŸ¯ ä»»å‹™æ¸…å–®ç¸½è¦½

### éšæ®µ 1: åŸºç¤çµ„ä»¶é–‹ç™¼ï¼ˆ2 å°æ™‚ï¼‰

- [x] Task 1.1: å‰µå»º ImageIconButton çµ„ä»¶ï¼ˆ30 åˆ†é˜ï¼‰
- [x] Task 1.2: å‰µå»º CompactImagePreview çµ„ä»¶ï¼ˆ30 åˆ†é˜ï¼‰
- [x] Task 1.3: å‰µå»º VocabularyItemWithImage çµ„ä»¶ï¼ˆ1 å°æ™‚ï¼‰

### éšæ®µ 2: æ•¸æ“šçµæ§‹æ›´æ–°ï¼ˆ1 å°æ™‚ï¼‰

- [x] Task 2.1: æ›´æ–° VocabularyItem æ¥å£ï¼ˆ15 åˆ†é˜ï¼‰
- [x] Task 2.2: æ›´æ–° updateItem å‡½æ•¸ï¼ˆ15 åˆ†é˜ï¼‰
- [x] Task 2.3: æ›´æ–° saveActivity é‚è¼¯ï¼ˆ30 åˆ†é˜ï¼‰

### éšæ®µ 3: åœ–ç‰‡åŠŸèƒ½æ•´åˆï¼ˆ2 å°æ™‚ï¼‰

- [x] Task 3.1: æ•´åˆ ImagePicker æ¨¡æ…‹æ¡†ï¼ˆ30 åˆ†é˜ï¼‰
- [x] Task 3.2: æ•´åˆ ImageEditor æ¨¡æ…‹æ¡†ï¼ˆ30 åˆ†é˜ï¼‰
- [x] Task 3.3: å¯¦ç¾åœ–ç‰‡ç”Ÿæˆï¼ˆæ–‡å­—ç–ŠåŠ ï¼‰ï¼ˆ1 å°æ™‚ï¼‰

### éšæ®µ 4: é é¢æ•´åˆï¼ˆ1 å°æ™‚ï¼‰

- [x] Task 4.1: æ›¿æ›ç¾æœ‰è¼¸å…¥æ¡†ç‚ºæ–°çµ„ä»¶ï¼ˆ30 åˆ†é˜ï¼‰
- [x] Task 4.2: æ¸¬è©¦å®Œæ•´æµç¨‹ï¼ˆ30 åˆ†é˜ï¼‰

### éšæ®µ 5: æ¸¬è©¦å’Œå„ªåŒ–ï¼ˆ1 å°æ™‚ï¼‰

- [x] Task 5.1: ç€è¦½å™¨æ¸¬è©¦ï¼ˆ30 åˆ†é˜ï¼‰
- [x] Task 5.2: ä¿®å¾© bug å’Œå„ªåŒ–ï¼ˆ30 åˆ†é˜ï¼‰

---

## ğŸ“ æ–‡ä»¶çµæ§‹

### æ–°å»ºæ–‡ä»¶

```
components/
â””â”€â”€ vocabulary-item-with-image/
    â”œâ”€â”€ index.tsx                    # ä¸»çµ„ä»¶
    â”œâ”€â”€ ImageIconButton.tsx          # åœ–æ¨™æŒ‰éˆ•
    â””â”€â”€ CompactImagePreview.tsx      # ç·Šæ¹Šé è¦½
```

### ä¿®æ”¹æ–‡ä»¶

```
lib/vocabulary/loadVocabularyData.ts  # æ›´æ–°æ¥å£
app/create/[templateId]/page.tsx      # æ•´åˆçµ„ä»¶
```

---

## ğŸ”§ è©³ç´°å¯¦æ–½æ­¥é©Ÿ

### éšæ®µ 1: åŸºç¤çµ„ä»¶é–‹ç™¼

#### Task 1.1: ImageIconButton çµ„ä»¶

**æ–‡ä»¶**: `components/vocabulary-item-with-image/ImageIconButton.tsx`

```tsx
'use client';

import React from 'react';

interface ImageIconButtonProps {
  onClick: () => void;
  hasImage?: boolean;
}

export default function ImageIconButton({ onClick, hasImage }: ImageIconButtonProps) {
  return (
    <button
      onClick={onClick}
      className={`
        w-10 h-10 flex items-center justify-center 
        border rounded-md transition-colors
        ${hasImage 
          ? 'border-blue-500 bg-blue-50 text-blue-600' 
          : 'border-gray-300 bg-white text-gray-400 hover:bg-gray-50 hover:text-gray-600'
        }
      `}
      title={hasImage ? "ç·¨è¼¯åœ–ç‰‡" : "æ·»åŠ åœ–ç‰‡"}
    >
      <span className="text-xl">ğŸ–¼ï¸</span>
    </button>
  );
}
```

**é©—æ”¶æ¨™æº–**:
- âœ… æŒ‰éˆ•é¡¯ç¤ºåœ–æ¨™
- âœ… Hover æ•ˆæœæ­£å¸¸
- âœ… æœ‰åœ–ç‰‡æ™‚é¡¯ç¤ºè—è‰²é‚Šæ¡†
- âœ… Tooltip é¡¯ç¤ºæ­£ç¢º

---

#### Task 1.2: CompactImagePreview çµ„ä»¶

**æ–‡ä»¶**: `components/vocabulary-item-with-image/CompactImagePreview.tsx`

```tsx
'use client';

import React from 'react';
import { Edit2, Trash2 } from 'lucide-react';

interface CompactImagePreviewProps {
  imageUrl: string;
  onEdit: () => void;
  onRemove: () => void;
}

export default function CompactImagePreview({ 
  imageUrl, 
  onEdit, 
  onRemove 
}: CompactImagePreviewProps) {
  return (
    <div className="mt-2 relative w-full h-32 border border-gray-200 rounded overflow-hidden group">
      <img 
        src={imageUrl} 
        alt="preview" 
        className="w-full h-full object-cover" 
      />
      <div className="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all flex items-center justify-center space-x-2 opacity-0 group-hover:opacity-100">
        <button
          onClick={onEdit}
          className="px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors flex items-center space-x-1"
        >
          <Edit2 size={14} />
          <span>ç·¨è¼¯</span>
        </button>
        <button
          onClick={onRemove}
          className="px-3 py-1.5 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors flex items-center space-x-1"
        >
          <Trash2 size={14} />
          <span>åˆªé™¤</span>
        </button>
      </div>
    </div>
  );
}
```

**é©—æ”¶æ¨™æº–**:
- âœ… åœ–ç‰‡æ­£ç¢ºé¡¯ç¤º
- âœ… Hover æ™‚é¡¯ç¤ºç·¨è¼¯/åˆªé™¤æŒ‰éˆ•
- âœ… æŒ‰éˆ•é»æ“Šè§¸ç™¼æ­£ç¢ºå›èª¿
- âœ… éŸ¿æ‡‰å¼è¨­è¨ˆæ­£å¸¸

---

#### Task 1.3: VocabularyItemWithImage çµ„ä»¶

**æ–‡ä»¶**: `components/vocabulary-item-with-image/index.tsx`

```tsx
'use client';

import React, { useState } from 'react';
import ImageIconButton from './ImageIconButton';
import CompactImagePreview from './CompactImagePreview';
import ImagePicker, { UserImage } from '../image-picker';
import ImageEditor from '../image-editor';
import { overlayTextOnImage } from '@/lib/image-text-overlay';

export interface VocabularyItemData {
  id: string;
  english: string;
  chinese: string;
  imageId?: string;
  imageUrl?: string;
}

interface VocabularyItemWithImageProps {
  item: VocabularyItemData;
  index: number;
  onChange: (item: VocabularyItemData) => void;
  onRemove: () => void;
  minItems: number;
  totalItems: number;
}

export default function VocabularyItemWithImage({
  item,
  index,
  onChange,
  onRemove,
  minItems,
  totalItems,
}: VocabularyItemWithImageProps) {
  const [showImagePicker, setShowImagePicker] = useState(false);
  const [showImageEditor, setShowImageEditor] = useState(false);
  const [isGenerating, setIsGenerating] = useState(false);

  // è™•ç†åœ–ç‰‡é¸æ“‡
  const handleImageSelect = async (images: UserImage[]) => {
    if (images.length > 0) {
      const selectedImage = images[0];
      onChange({
        ...item,
        imageId: selectedImage.id,
        imageUrl: selectedImage.url,
      });
      setShowImagePicker(false);
      
      // è‡ªå‹•ç”Ÿæˆå¸¶æ–‡å­—çš„åœ–ç‰‡
      if (item.english || item.chinese) {
        await generateImageWithText(selectedImage.url);
      }
    }
  };

  // ç”Ÿæˆå¸¶æ–‡å­—çš„åœ–ç‰‡
  const generateImageWithText = async (baseImageUrl: string) => {
    if (!item.english && !item.chinese) return;
    
    setIsGenerating(true);
    try {
      const generatedImageUrl = await overlayTextOnImage(baseImageUrl, {
        text: `${item.english}\n${item.chinese}`,
        position: { x: 50, y: 50 },
        fontSize: 'medium',
        color: 'white',
        backgroundColor: true,
      });
      
      onChange({
        ...item,
        imageUrl: generatedImageUrl,
      });
    } catch (error) {
      console.error('ç”Ÿæˆåœ–ç‰‡å¤±æ•—:', error);
    } finally {
      setIsGenerating(false);
    }
  };

  return (
    <div className="flex items-start space-x-4 p-4 border border-gray-200 rounded-lg">
      {/* åºè™Ÿ */}
      <div className="w-8 text-center text-sm text-gray-500 font-medium pt-2">
        {index + 1}.
      </div>

      {/* åœ–æ¨™æŒ‰éˆ• */}
      <div className="pt-2">
        <ImageIconButton 
          onClick={() => setShowImagePicker(true)}
          hasImage={!!item.imageUrl}
        />
      </div>

      {/* è¼¸å…¥å€åŸŸ */}
      <div className="flex-1 space-y-2">
        {/* è‹±æ–‡è¼¸å…¥æ¡† */}
        <input
          type="text"
          value={item.english}
          onChange={(e) => onChange({ ...item, english: e.target.value })}
          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="è¼¸å…¥è‹±æ–‡å–®å­—..."
        />
        
        {/* åœ–ç‰‡é è¦½ */}
        {item.imageUrl && (
          <CompactImagePreview
            imageUrl={item.imageUrl}
            onEdit={() => setShowImageEditor(true)}
            onRemove={() => onChange({ ...item, imageId: undefined, imageUrl: undefined })}
          />
        )}
        
        {isGenerating && (
          <div className="text-sm text-blue-600">æ­£åœ¨ç”Ÿæˆåœ–ç‰‡...</div>
        )}
      </div>

      {/* ä¸­æ–‡è¼¸å…¥æ¡† */}
      <div className="flex-1 pt-2">
        <input
          type="text"
          value={item.chinese}
          onChange={(e) => onChange({ ...item, chinese: e.target.value })}
          className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="è¼¸å…¥ä¸­æ–‡ç¿»è­¯..."
        />
      </div>

      {/* åˆªé™¤æŒ‰éˆ• */}
      {totalItems > minItems && (
        <button
          onClick={onRemove}
          className="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-md transition-colors mt-2"
          title="åˆªé™¤æ­¤é …ç›®"
        >
          ğŸ—‘ï¸
        </button>
      )}

      {/* æ¨¡æ…‹æ¡† */}
      {showImagePicker && (
        <ImagePicker
          onSelect={handleImageSelect}
          onClose={() => setShowImagePicker(false)}
          multiple={false}
        />
      )}

      {showImageEditor && item.imageUrl && (
        <ImageEditor
          imageUrl={item.imageUrl}
          onSave={(editedUrl) => {
            onChange({ ...item, imageUrl: editedUrl });
            setShowImageEditor(false);
          }}
          onClose={() => setShowImageEditor(false)}
        />
      )}
    </div>
  );
}
```

**é©—æ”¶æ¨™æº–**:
- âœ… æ‰€æœ‰å­çµ„ä»¶æ­£ç¢ºæ¸²æŸ“
- âœ… åœ–ç‰‡é¸æ“‡æµç¨‹æ­£å¸¸
- âœ… åœ–ç‰‡ç·¨è¼¯æµç¨‹æ­£å¸¸
- âœ… æ–‡å­—ç–ŠåŠ è‡ªå‹•ç”Ÿæˆ
- âœ… ç‹€æ…‹ç®¡ç†æ­£ç¢º

---

## ğŸ“Š é€²åº¦è¿½è¹¤

| éšæ®µ | ä»»å‹™æ•¸ | é ä¼°æ™‚é–“ | ç‹€æ…‹ |
|------|--------|----------|------|
| éšæ®µ 1 | 3 | 2 å°æ™‚ | â³ å¾…é–‹å§‹ |
| éšæ®µ 2 | 3 | 1 å°æ™‚ | â³ å¾…é–‹å§‹ |
| éšæ®µ 3 | 3 | 2 å°æ™‚ | â³ å¾…é–‹å§‹ |
| éšæ®µ 4 | 2 | 1 å°æ™‚ | â³ å¾…é–‹å§‹ |
| éšæ®µ 5 | 2 | 1 å°æ™‚ | â³ å¾…é–‹å§‹ |
| **ç¸½è¨ˆ** | **13** | **7 å°æ™‚** | **0% å®Œæˆ** |

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0  
**å‰µå»ºæ™‚é–“**: 2025-10-22  
**ä¸‹ä¸€æ­¥**: é–‹å§‹éšæ®µ 1 - åŸºç¤çµ„ä»¶é–‹ç™¼

