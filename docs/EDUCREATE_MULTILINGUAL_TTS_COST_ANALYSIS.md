# EduCreate 多語言 TTS 成本分析（混合策略）

## 📋 文檔概述

**創建日期**: 2025-10-23  
**分析目的**: 分析 EduCreate 採用 Wordwall 動態生成策略支援多語言的成本  
**核心策略**: 預生成（GEPT 英語）+ 動態生成（其他語言）+ MD5 Hash 緩存

---

## 🎯 混合策略設計

### 語言分類

#### 類別 1: GEPT 英語詞庫（預生成）
```
語言: 英語（en-US, en-GB）
詞庫: 6,000 個單字
策略: 預生成 + Cloudflare R2
成本: $0（一次性預生成）
```

#### 類別 2: 其他語言（動態生成）
```
語言: 日語、韓語、法語、德語、西班牙語等
詞庫: 無法預測（用戶自定義）
策略: 動態生成 + MD5 Hash 緩存
成本: 按使用量計費
```

---

## 💰 成本分析

### 假設條件

#### 用戶使用分布
```
總用戶數: 10,000
英語用戶: 70%（7,000 人）
其他語言用戶: 30%（3,000 人）
  - 日語: 10%（1,000 人）
  - 韓語: 5%（500 人）
  - 法語: 5%（500 人）
  - 德語: 5%（500 人）
  - 西班牙語: 5%（500 人）
```

#### 使用量假設
```
每個用戶每月使用: 100 個單字
每個單字平均: 8 字符
每個用戶每月字符數: 100 × 8 = 800 字符
```

---

### 場景 1: 不使用緩存（理論最大成本）

#### 英語用戶（預生成）
```
用戶數: 7,000
成本: $0（音頻已預生成）
```

#### 其他語言用戶（動態生成）
```
用戶數: 3,000
每個用戶每月字符數: 800
總字符數/月: 3,000 × 800 = 2,400,000 字符

Google Cloud TTS 成本:
(2,400,000 - 1,000,000) / 1,000,000 × $16 = $22.4/月
年成本: $268.8/年
```

#### 存儲成本
```
總音頻數: 3,000 × 100 = 300,000 個音頻
每個音頻大小: 50KB
總存儲: 300,000 × 50KB = 15GB

Cloudflare R2 成本:
15GB × $0.015 = $0.225/月
年成本: $2.7/年
```

#### 流量成本
```
Cloudflare R2: $0（免費流量）
```

#### 總成本（不緩存）
```
TTS 成本: $22.4/月
存儲成本: $0.225/月
流量成本: $0/月

總成本: $22.625/月
年成本: $271.5/年
```

---

### 場景 2: 使用 MD5 Hash 緩存（80% 緩存命中率）

#### 緩存命中率分析

**為什麼其他語言緩存命中率較低？**
1. ❌ 詞彙多樣性高（無法預測用戶輸入）
2. ❌ 語法結構複雜（日語、韓語）
3. ❌ 用戶自定義內容多

**估計緩存命中率**: **80%**

#### TTS 成本計算
```
總字符數/月: 2,400,000
緩存命中率: 80%
實際需要生成: 20%

實際字符數/月: 2,400,000 × 20% = 480,000 字符

Google Cloud TTS 成本:
480,000 字符 < 1,000,000（免費額度）
成本: $0/月
年成本: $0/年
```

#### 存儲成本
```
第一個月: 300,000 個音頻 × 20% = 60,000 個新音頻
累積存儲（第一年）: 60,000 × 12 = 720,000 個音頻
總存儲: 720,000 × 50KB = 36GB

Cloudflare R2 成本:
36GB × $0.015 = $0.54/月
年成本: $6.48/年
```

#### 總成本（80% 緩存）
```
TTS 成本: $0/月
存儲成本: $0.54/月
流量成本: $0/月

總成本: $0.54/月
年成本: $6.48/年
```

---

### 場景 3: 使用 MD5 Hash 緩存（90% 緩存命中率）

#### TTS 成本計算
```
實際字符數/月: 2,400,000 × 10% = 240,000 字符

Google Cloud TTS 成本:
240,000 字符 < 1,000,000（免費額度）
成本: $0/月
年成本: $0/年
```

#### 存儲成本
```
第一個月: 300,000 × 10% = 30,000 個新音頻
累積存儲（第一年）: 30,000 × 12 = 360,000 個音頻
總存儲: 360,000 × 50KB = 18GB

Cloudflare R2 成本:
18GB × $0.015 = $0.27/月
年成本: $3.24/年
```

#### 總成本（90% 緩存）
```
TTS 成本: $0/月
存儲成本: $0.27/月
流量成本: $0/月

總成本: $0.27/月
年成本: $3.24/年
```

---

## 📊 成本總結（10,000 用戶）

| 場景 | TTS 成本/月 | 存儲成本/月 | 流量成本/月 | 總成本/月 | 年成本 |
|------|------------|------------|------------|----------|--------|
| **不緩存** | $22.4 | $0.225 | $0 | **$22.625** | **$271.5** |
| **80% 緩存** | $0 | $0.54 | $0 | **$0.54** | **$6.48** |
| **90% 緩存** | $0 | $0.27 | $0 | **$0.27** | **$3.24** |

---

## 🚀 擴展到 100,000 用戶

### 假設條件
```
總用戶數: 100,000
英語用戶: 70%（70,000 人）
其他語言用戶: 30%（30,000 人）
```

---

### 場景 1: 不使用緩存

#### TTS 成本
```
總字符數/月: 30,000 × 800 = 24,000,000 字符

Google Cloud TTS 成本:
(24,000,000 - 1,000,000) / 1,000,000 × $16 = $368/月
年成本: $4,416/年
```

#### 存儲成本
```
總存儲: 30,000 × 100 × 50KB = 150GB

Cloudflare R2 成本:
150GB × $0.015 = $2.25/月
年成本: $27/年
```

#### 總成本
```
總成本: $370.25/月
年成本: $4,443/年
```

---

### 場景 2: 80% 緩存命中率

#### TTS 成本
```
實際字符數/月: 24,000,000 × 20% = 4,800,000 字符

Google Cloud TTS 成本:
(4,800,000 - 1,000,000) / 1,000,000 × $16 = $60.8/月
年成本: $729.6/年
```

#### 存儲成本
```
累積存儲（第一年）: 600,000 × 12 = 7,200,000 個音頻
總存儲: 7,200,000 × 50KB = 360GB

Cloudflare R2 成本:
360GB × $0.015 = $5.4/月
年成本: $64.8/年
```

#### 總成本
```
總成本: $66.2/月
年成本: $794.4/年
```

---

### 場景 3: 90% 緩存命中率

#### TTS 成本
```
實際字符數/月: 24,000,000 × 10% = 2,400,000 字符

Google Cloud TTS 成本:
(2,400,000 - 1,000,000) / 1,000,000 × $16 = $22.4/月
年成本: $268.8/年
```

#### 存儲成本
```
累積存儲（第一年）: 300,000 × 12 = 3,600,000 個音頻
總存儲: 3,600,000 × 50KB = 180GB

Cloudflare R2 成本:
180GB × $0.015 = $2.7/月
年成本: $32.4/年
```

#### 總成本
```
總成本: $25.1/月
年成本: $301.2/年
```

---

## 📊 完整成本對比表

### 10,000 用戶規模

| 策略 | 月成本 | 年成本 | 說明 |
|------|--------|--------|------|
| **純預生成（僅英語）** | $0.0045 | $0.054 | 不支援其他語言 |
| **混合策略（不緩存）** | $22.625 | $271.5 | 支援多語言，無緩存 |
| **混合策略（80% 緩存）** | $0.54 | $6.48 | 支援多語言，80% 緩存 |
| **混合策略（90% 緩存）** | $0.27 | $3.24 | 支援多語言，90% 緩存 |

---

### 100,000 用戶規模

| 策略 | 月成本 | 年成本 | 說明 |
|------|--------|--------|------|
| **純預生成（僅英語）** | $0.0045 | $0.054 | 不支援其他語言 |
| **混合策略（不緩存）** | $370.25 | $4,443 | 支援多語言，無緩存 |
| **混合策略（80% 緩存）** | $66.2 | $794.4 | 支援多語言，80% 緩存 |
| **混合策略（90% 緩存）** | $25.1 | $301.2 | 支援多語言，90% 緩存 |

---

## 🎯 與 Wordwall 成本對比

### 100,000 用戶規模

| 方案 | 年成本 | 說明 |
|------|--------|------|
| **Wordwall（Azure TTS）** | $9,180-$16,920 | 支援 70+ 種語言 |
| **EduCreate（純預生成）** | $0.054 | 僅支援英語 GEPT 詞庫 |
| **EduCreate（混合策略，90% 緩存）** | $301.2 | 支援多語言 |

**節省**: $9,180 - $301.2 = **$8,878.8/年**（96.7%）

---

## 💡 混合策略的優勢

### 1. **成本優勢**

| 用戶規模 | 混合策略成本 | Wordwall 成本 | 節省 |
|---------|-------------|--------------|------|
| 10,000 | $3.24/年 | $918-$1,692/年 | **99.6%** |
| 100,000 | $301.2/年 | $9,180-$16,920/年 | **96.7%** |

---

### 2. **靈活性優勢**

**支援語言**:
- ✅ 英語（GEPT 詞庫，預生成）
- ✅ 日語（動態生成 + 緩存）
- ✅ 韓語（動態生成 + 緩存）
- ✅ 法語（動態生成 + 緩存）
- ✅ 德語（動態生成 + 緩存）
- ✅ 西班牙語（動態生成 + 緩存）
- ✅ 任意其他語言（動態生成 + 緩存）

---

### 3. **性能優勢**

| 語言類型 | 載入時間 | 說明 |
|---------|---------|------|
| **英語（GEPT 詞庫）** | ~250ms | 預生成，從 CDN 載入 |
| **其他語言（首次）** | ~2.3 秒 | 動態生成 + 上傳 CDN |
| **其他語言（緩存命中）** | ~250ms | 從 CDN 載入 |

---

### 4. **用戶體驗優勢**

**英語用戶**（70%）:
- ✅ 零延遲（音頻已預生成）
- ✅ 100% 緩存命中率

**其他語言用戶**（30%）:
- ✅ 首次生成: ~2.3 秒
- ✅ 後續使用: ~250ms（緩存命中）
- ✅ 90% 緩存命中率

---

## 🚀 實施建議

### 階段 1: 預生成 GEPT 英語詞庫

```javascript
// 預生成 6,000 個英語單字
const geptVocabulary = {
  elementary: ['apple', 'banana', ...], // 1000 個
  intermediate: ['abandon', 'ability', ...], // 2000 個
  highIntermediate: ['abbreviate', ...] // 3000 個
};

// 預生成所有音頻
await pregenerateGEPTAudio(geptVocabulary);

// 成本: $0（在免費額度內）
```

---

### 階段 2: 實施動態生成 + MD5 Hash 緩存

```javascript
async function generateTTS(text, language, voice, geptLevel) {
  // 1. 檢查是否為 GEPT 英語詞庫
  if (language.startsWith('en-') && isGEPTWord(text)) {
    // 使用預生成音頻（免費，250ms）
    return getPreGeneratedAudio(text, language, voice);
  }
  
  // 2. 檢查 MD5 Hash 緩存
  const hash = calculateHash(text, language, voice);
  const cachedUrl = await checkCache(hash);
  if (cachedUrl) {
    // 緩存命中（免費，250ms）
    return cachedUrl;
  }
  
  // 3. 動態生成（付費，2.3 秒）
  const audioBuffer = await googleCloudTTS.synthesize(text, {
    languageCode: language,
    voiceName: getVoiceName(language, voice, geptLevel),
    speakingRate: getGEPTSpeakingRate(geptLevel),
    pitch: getGEPTPitch(geptLevel)
  });
  
  // 4. 上傳到 Cloudflare R2
  const audioUrl = await uploadToR2(audioBuffer, hash, language);
  
  // 5. 緩存 URL
  await cacheUrl(hash, {
    text,
    language,
    voice,
    audioUrl,
    geptLevel,
    createdAt: new Date()
  });
  
  return audioUrl;
}
```

---

### 階段 3: 監控和優化

```javascript
// 監控緩存命中率
async function monitorCacheHitRate() {
  const stats = await db.query(`
    SELECT 
      language,
      COUNT(*) as total_requests,
      SUM(CASE WHEN cached = true THEN 1 ELSE 0 END) as cache_hits,
      (SUM(CASE WHEN cached = true THEN 1 ELSE 0 END)::float / COUNT(*)) * 100 as hit_rate
    FROM tts_requests
    WHERE created_at > NOW() - INTERVAL '30 days'
    GROUP BY language
    ORDER BY total_requests DESC
  `);
  
  console.log('Cache Hit Rate by Language:');
  stats.rows.forEach(row => {
    console.log(`${row.language}: ${row.hit_rate.toFixed(2)}%`);
  });
}

// 預生成熱門內容
async function pregenerateHotContent() {
  // 找出最常用的非 GEPT 詞彙
  const hotWords = await db.query(`
    SELECT text, language, voice, COUNT(*) as usage_count
    FROM tts_requests
    WHERE language NOT LIKE 'en-%'
    GROUP BY text, language, voice
    HAVING COUNT(*) > 10
    ORDER BY usage_count DESC
    LIMIT 1000
  `);
  
  // 預生成這些熱門詞彙
  for (const word of hotWords.rows) {
    await generateTTS(word.text, word.language, word.voice);
  }
}
```

---

## 🎯 最終推薦

### 推薦方案: 混合策略（預生成 + 動態生成 + MD5 Hash 緩存）

**成本**（100,000 用戶）:
- **月成本**: $25.1
- **年成本**: $301.2

**優勢**:
1. ✅ **成本低**: 比 Wordwall 便宜 96.7%
2. ✅ **靈活性高**: 支援任意語言
3. ✅ **性能好**: 英語 250ms，其他語言首次 2.3 秒，後續 250ms
4. ✅ **用戶體驗好**: 70% 用戶零延遲，30% 用戶首次稍慢但後續快速

**劣勢**:
1. ❌ **首次生成較慢**: 其他語言首次生成需要 2.3 秒
2. ❌ **成本隨用戶增長**: 不像純預生成策略成本固定

---

## 📊 成本增長預測

| 用戶規模 | 月成本 | 年成本 | 說明 |
|---------|--------|--------|------|
| 1,000 | $0.027 | $0.324 | 幾乎免費 |
| 10,000 | $0.27 | $3.24 | 非常便宜 |
| 100,000 | $25.1 | $301.2 | 仍然很便宜 |
| 1,000,000 | $251 | $3,012 | 可接受 |

**結論**: 即使擴展到 100 萬用戶，年成本也只有 $3,012，仍然比 Wordwall 便宜 82%！

---

**文檔創建日期**: 2025-10-23  
**維護者**: EduCreate Development Team  
**狀態**: 多語言 TTS 成本分析完成，建議採用混合策略

