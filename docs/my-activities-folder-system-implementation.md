# My Activities è³‡æ–™å¤¾ç³»çµ±å¯¦æ–½å®Œæ•´æ–‡æª”

## ğŸ“‹ ç›®éŒ„

1. [é …ç›®æ¦‚è¿°](#é …ç›®æ¦‚è¿°)
2. [æŠ€è¡“æ¶æ§‹](#æŠ€è¡“æ¶æ§‹)
3. [æ•¸æ“šåº«è¨­è¨ˆ](#æ•¸æ“šåº«è¨­è¨ˆ)
4. [API ç«¯é»è¨­è¨ˆ](#api-ç«¯é»è¨­è¨ˆ)
5. [å‰ç«¯çµ„ä»¶è¨­è¨ˆ](#å‰ç«¯çµ„ä»¶è¨­è¨ˆ)
6. [å¯¦æ–½æ­¥é©Ÿ](#å¯¦æ–½æ­¥é©Ÿ)
7. [æ¸¬è©¦èˆ‡é©—è­‰](#æ¸¬è©¦èˆ‡é©—è­‰)
8. [æ€§èƒ½å„ªåŒ–](#æ€§èƒ½å„ªåŒ–)
9. [å¾ŒçºŒæ“´å±•](#å¾ŒçºŒæ“´å±•)

---

## é …ç›®æ¦‚è¿°

### ğŸ¯ ç›®æ¨™

åœ¨ `/my-activities` é é¢å¯¦ç¾ **10 å±¤è³‡æ–™å¤¾åµŒå¥—ç³»çµ±**ï¼Œæä¾›é¡ä¼¼ Wordwall çš„è³‡æ–™å¤¾ç®¡ç†åŠŸèƒ½ã€‚

### âœ¨ æ ¸å¿ƒåŠŸèƒ½

- âœ… 10 å±¤è³‡æ–™å¤¾åµŒå¥—æ”¯æ´
- âœ… è³‡æ–™å¤¾ CRUD æ“ä½œï¼ˆå‰µå»ºã€è®€å–ã€æ›´æ–°ã€åˆªé™¤ï¼‰
- âœ… æ´»å‹•åœ¨è³‡æ–™å¤¾é–“ç§»å‹•
- âœ… éºµåŒ…å±‘å°èˆª
- âœ… è³‡æ–™å¤¾æ¨¹ç‹€é¡¯ç¤º
- âœ… URL ç‹€æ…‹åŒæ­¥
- âœ… ç€è¦½å™¨æ­·å²æ”¯æ´

### ğŸ“Š æŠ€è¡“æ£§

- **å¾Œç«¯**: Next.js 14 App Router, Prisma ORM
- **å‰ç«¯**: React 18, TypeScript, Tailwind CSS
- **æ•¸æ“šåº«**: PostgreSQL (Neon)
- **UI çµ„ä»¶**: shadcn/ui

---

## æŠ€è¡“æ¶æ§‹

### ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ¶ç•Œé¢å±¤                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è³‡æ–™å¤¾ç®¡ç†å™¨  â”‚  â”‚ æ´»å‹•åˆ—è¡¨     â”‚  â”‚ éºµåŒ…å±‘å°èˆª    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API å±¤                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ /api/folders â”‚  â”‚ /api/activitiesâ”‚ â”‚ /api/activitiesâ”‚
â”‚  â”‚              â”‚  â”‚                â”‚  â”‚ /move         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•¸æ“šè¨ªå•å±¤ (Prisma)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                PostgreSQL æ•¸æ“šåº« (Neon)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è³‡æ–™å¤¾å±¤ç´šçµæ§‹

```
æ ¹ç›®éŒ„ (depth: 0)
â”œâ”€â”€ è³‡æ–™å¤¾ A (depth: 1)
â”‚   â”œâ”€â”€ è³‡æ–™å¤¾ A1 (depth: 2)
â”‚   â”‚   â”œâ”€â”€ è³‡æ–™å¤¾ A1a (depth: 3)
â”‚   â”‚   â”‚   â””â”€â”€ ... (æœ€å¤šåˆ° depth: 9)
â”‚   â”‚   â””â”€â”€ è³‡æ–™å¤¾ A1b (depth: 3)
â”‚   â””â”€â”€ è³‡æ–™å¤¾ A2 (depth: 2)
â”œâ”€â”€ è³‡æ–™å¤¾ B (depth: 1)
â”‚   â””â”€â”€ è³‡æ–™å¤¾ B1 (depth: 2)
â””â”€â”€ è³‡æ–™å¤¾ C (depth: 1)
```

---

## æ•¸æ“šåº«è¨­è¨ˆ

### Prisma Schema

**æ–‡ä»¶**: `prisma/schema.prisma`

```prisma
model Folder {
  id        String   @id @default(cuid())
  name      String
  userId    String
  type      FolderType
  parentId  String?  // çˆ¶è³‡æ–™å¤¾ ID
  depth     Int      @default(0)  // å±¤ç´šæ·±åº¦ï¼ˆ0-9ï¼‰
  path      String?  // å®Œæ•´è·¯å¾‘
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // é—œè¯
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent     Folder?    @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children   Folder[]   @relation("FolderHierarchy")
  activities Activity[]
  results    Result[]

  @@index([userId, type])
  @@index([parentId])
  @@index([userId, type, parentId])
}

enum FolderType {
  ACTIVITIES
  RESULTS
}
```

### é—œéµå­—æ®µèªªæ˜

| å­—æ®µ | é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|------|
| `id` | String | å”¯ä¸€æ¨™è­˜ç¬¦ | `clfx1234...` |
| `name` | String | è³‡æ–™å¤¾åç¨± | `åœ‹å°ä¸‰å¹´ç´š` |
| `userId` | String | æ‰€å±¬ç”¨æˆ¶ ID | `user123` |
| `type` | FolderType | è³‡æ–™å¤¾é¡å‹ | `ACTIVITIES` |
| `parentId` | String? | çˆ¶è³‡æ–™å¤¾ ID | `clfx5678...` æˆ– `null` |
| `depth` | Int | å±¤ç´šæ·±åº¦ | `0` (æ ¹) åˆ° `9` (æœ€æ·±) |
| `path` | String? | å®Œæ•´è·¯å¾‘ | `åœ‹å°/ä¸‰å¹´ç´š/ä¸Šå­¸æœŸ` |

### è¨­è¨ˆæ±ºç­–

#### 1. è‡ªå¼•ç”¨é—œä¿‚

ä½¿ç”¨ `parentId` å’Œ `"FolderHierarchy"` é—œä¿‚å¯¦ç¾æ¨¹ç‹€çµæ§‹ï¼š

```prisma
parent     Folder?    @relation("FolderHierarchy", fields: [parentId], references: [id])
children   Folder[]   @relation("FolderHierarchy")
```

**å„ªé»**:
- éˆæ´»çš„å±¤ç´šçµæ§‹
- æ”¯æ´ä»»æ„æ·±åº¦åµŒå¥—
- æ˜“æ–¼æŸ¥è©¢å’Œéæ­·

#### 2. æ·±åº¦é™åˆ¶

ä½¿ç”¨ `depth` å­—æ®µé™åˆ¶ç‚º 0-9ï¼ˆå…± 10 å±¤ï¼‰ï¼š

```typescript
if (depth >= 10) {
  throw new Error('å·²é”åˆ°æœ€å¤§è³‡æ–™å¤¾å±¤ç´šï¼ˆ10å±¤ï¼‰');
}
```

**å„ªé»**:
- é˜²æ­¢ç„¡é™åµŒå¥—
- æå‡æŸ¥è©¢æ€§èƒ½
- ç¬¦åˆç”¨æˆ¶ä½¿ç”¨ç¿’æ…£

#### 3. è·¯å¾‘å­˜å„²

ä½¿ç”¨ `path` å­—æ®µå­˜å„²å®Œæ•´è·¯å¾‘ï¼š

```typescript
path = `${parentFolder.path}/${name}`;
// ç¯„ä¾‹: "åœ‹å°/ä¸‰å¹´ç´š/ä¸Šå­¸æœŸ"
```

**å„ªé»**:
- å¿«é€Ÿæ§‹å»ºéºµåŒ…å±‘å°èˆª
- ä¾¿æ–¼æœç´¢å’Œéæ¿¾
- æ¸›å°‘éæ­¸æŸ¥è©¢

#### 4. ç´šè¯åˆªé™¤

ä½¿ç”¨ `onDelete: Cascade` ç¢ºä¿æ•¸æ“šä¸€è‡´æ€§ï¼š

```prisma
parent Folder? @relation(..., onDelete: Cascade)
```

**è¡Œç‚º**:
- åˆªé™¤çˆ¶è³‡æ–™å¤¾æ™‚ï¼Œè‡ªå‹•åˆªé™¤æ‰€æœ‰å­è³‡æ–™å¤¾
- åˆªé™¤è³‡æ–™å¤¾æ™‚ï¼Œè‡ªå‹•è§£é™¤æ´»å‹•é—œè¯

#### 5. ç´¢å¼•å„ªåŒ–

æ·»åŠ å¤šå€‹ç´¢å¼•åŠ é€ŸæŸ¥è©¢ï¼š

```prisma
@@index([userId, type])           // ç”¨æˆ¶çš„æ‰€æœ‰è³‡æ–™å¤¾
@@index([parentId])                // å­è³‡æ–™å¤¾æŸ¥è©¢
@@index([userId, type, parentId])  // çµ„åˆæŸ¥è©¢
```

### æ•¸æ“šåº«é·ç§»

**åŸ·è¡Œå‘½ä»¤**:

```bash
# å‰µå»ºé·ç§»
npx prisma migrate dev --name add_folder_hierarchy

# ç”Ÿæˆ Prisma Client
npx prisma generate

# æ¨é€åˆ°ç”Ÿç”¢ç’°å¢ƒ
npx prisma migrate deploy
```

**é·ç§»å…§å®¹**:
1. æ·»åŠ  `parentId`, `depth`, `path` æ¬„ä½
2. å‰µå»ºè‡ªå¼•ç”¨å¤–éµç´„æŸ
3. å‰µå»ºæ€§èƒ½å„ªåŒ–ç´¢å¼•
4. è¨­ç½®ç´šè¯åˆªé™¤è¦å‰‡

---

## API ç«¯é»è¨­è¨ˆ

### 1. è³‡æ–™å¤¾ CRUD API

**æ–‡ä»¶**: `app/api/folders/route.ts`

#### GET - ç²å–è³‡æ–™å¤¾åˆ—è¡¨

**ç«¯é»**: `GET /api/folders`

**æŸ¥è©¢åƒæ•¸**:
```typescript
{
  type: 'ACTIVITIES' | 'RESULTS';  // å¿…éœ€
  parentId?: string | null;         // å¯é¸ï¼Œnull è¡¨ç¤ºæ ¹ç›®éŒ„
}
```

**éŸ¿æ‡‰**:
```typescript
{
  id: string;
  name: string;
  parentId: string | null;
  depth: number;
  path: string;
  _count: {
    activities: number;  // æ´»å‹•æ•¸é‡
    children: number;    // å­è³‡æ–™å¤¾æ•¸é‡
  };
}[]
```

**å¯¦ç¾é‚è¼¯**:

```typescript
export async function GET(request: NextRequest) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: 'æœªæˆæ¬Š' }, { status: 401 });
  }

  const searchParams = request.nextUrl.searchParams;
  const type = searchParams.get('type') as FolderType;
  const parentId = searchParams.get('parentId') || null;

  const folders = await prisma.folder.findMany({
    where: {
      userId: session.user.id,
      type,
      parentId,
    },
    include: {
      _count: {
        select: {
          activities: type === 'ACTIVITIES',
          results: type === 'RESULTS',
          children: true,
        },
      },
    },
    orderBy: {
      name: 'asc',
    },
  });

  return NextResponse.json(folders);
}
```

**é—œéµé»**:
- âœ… åªè¿”å›ç•¶å‰å±¤ç´šçš„è³‡æ–™å¤¾ï¼ˆä¸éæ­¸ï¼‰
- âœ… åŒ…å«æ´»å‹•/çµæœæ•¸é‡çµ±è¨ˆ
- âœ… åŒ…å«å­è³‡æ–™å¤¾æ•¸é‡
- âœ… æŒ‰åç¨±æ’åº
- âœ… æ¬Šé™é©—è­‰

#### POST - å‰µå»ºæ–°è³‡æ–™å¤¾

**ç«¯é»**: `POST /api/folders`

**è«‹æ±‚é«”**:
```typescript
{
  name: string;                      // å¿…éœ€
  type: 'ACTIVITIES' | 'RESULTS';    // å¿…éœ€
  parentId?: string | null;          // å¯é¸
}
```

**éŸ¿æ‡‰**:
```typescript
{
  id: string;
  name: string;
  parentId: string | null;
  depth: number;
  path: string;
  createdAt: string;
}
```

**å¯¦ç¾é‚è¼¯**:

```typescript
export async function POST(request: NextRequest) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: 'æœªæˆæ¬Š' }, { status: 401 });
  }

  const body = await request.json();
  const { name, type, parentId } = body;

  // é©—è­‰è¼¸å…¥
  if (!name || !type) {
    return NextResponse.json(
      { error: 'ç¼ºå°‘å¿…è¦åƒæ•¸' },
      { status: 400 }
    );
  }

  // è¨ˆç®—æ·±åº¦å’Œè·¯å¾‘
  let depth = 0;
  let path = name;

  if (parentId) {
    const parentFolder = await prisma.folder.findUnique({
      where: { id: parentId },
      select: { depth: true, path: true, userId: true },
    });

    if (!parentFolder) {
      return NextResponse.json(
        { error: 'çˆ¶è³‡æ–™å¤¾ä¸å­˜åœ¨' },
        { status: 404 }
      );
    }

    // é©—è­‰çˆ¶è³‡æ–™å¤¾æ‰€æœ‰æ¬Š
    if (parentFolder.userId !== session.user.id) {
      return NextResponse.json(
        { error: 'ç„¡æ¬Šè¨ªå•æ­¤è³‡æ–™å¤¾' },
        { status: 403 }
      );
    }

    depth = parentFolder.depth + 1;

    // æª¢æŸ¥æ·±åº¦é™åˆ¶
    if (depth >= 10) {
      return NextResponse.json(
        { error: 'å·²é”åˆ°æœ€å¤§è³‡æ–™å¤¾å±¤ç´šï¼ˆ10å±¤ï¼‰' },
        { status: 400 }
      );
    }

    path = `${parentFolder.path}/${name}`;
  }

  // å‰µå»ºè³‡æ–™å¤¾
  const folder = await prisma.folder.create({
    data: {
      name,
      type,
      userId: session.user.id,
      parentId,
      depth,
      path,
    },
  });

  return NextResponse.json(folder);
}
```

**é—œéµé»**:
- âœ… è‡ªå‹•è¨ˆç®—æ·±åº¦
- âœ… å¼·åˆ¶åŸ·è¡Œ 10 å±¤é™åˆ¶
- âœ… è‡ªå‹•æ§‹å»ºå®Œæ•´è·¯å¾‘
- âœ… é©—è­‰çˆ¶è³‡æ–™å¤¾å­˜åœ¨æ€§å’Œæ‰€æœ‰æ¬Š
- âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†

**éŒ¯èª¤è™•ç†**:

| éŒ¯èª¤ç¢¼ | éŒ¯èª¤ä¿¡æ¯ | åŸå›  |
|--------|----------|------|
| 400 | ç¼ºå°‘å¿…è¦åƒæ•¸ | name æˆ– type æœªæä¾› |
| 400 | å·²é”åˆ°æœ€å¤§è³‡æ–™å¤¾å±¤ç´š | æ·±åº¦è¶…é 9 |
| 401 | æœªæˆæ¬Š | æœªç™»å…¥ |
| 403 | ç„¡æ¬Šè¨ªå•æ­¤è³‡æ–™å¤¾ | çˆ¶è³‡æ–™å¤¾ä¸å±¬æ–¼ç•¶å‰ç”¨æˆ¶ |
| 404 | çˆ¶è³‡æ–™å¤¾ä¸å­˜åœ¨ | parentId ç„¡æ•ˆ |

#### PATCH - æ›´æ–°è³‡æ–™å¤¾

**ç«¯é»**: `PATCH /api/folders`

**è«‹æ±‚é«”**:
```typescript
{
  id: string;                    // å¿…éœ€
  name?: string;                 // å¯é¸
  parentId?: string | null;      // å¯é¸
}
```

**åŠŸèƒ½**:
- é‡å‘½åè³‡æ–™å¤¾
- ç§»å‹•è³‡æ–™å¤¾åˆ°å…¶ä»–ä½ç½®

**å¯¦ç¾é‚è¼¯**:

```typescript
export async function PATCH(request: NextRequest) {
  const session = await getServerSession(authOptions);
  const body = await request.json();
  const { id, name, parentId } = body;

  // ç²å–ç•¶å‰è³‡æ–™å¤¾
  const currentFolder = await prisma.folder.findUnique({
    where: { id },
    include: { children: true },
  });

  if (!currentFolder || currentFolder.userId !== session.user.id) {
    return NextResponse.json(
      { error: 'è³‡æ–™å¤¾ä¸å­˜åœ¨æˆ–ç„¡æ¬Šè¨ªå•' },
      { status: 404 }
    );
  }

  // å¦‚æœç§»å‹•è³‡æ–™å¤¾ï¼Œæª¢æŸ¥æ·±åº¦
  if (parentId !== undefined && parentId !== currentFolder.parentId) {
    // é˜²æ­¢å¾ªç’°å¼•ç”¨
    if (parentId === id) {
      return NextResponse.json(
        { error: 'ä¸èƒ½å°‡è³‡æ–™å¤¾ç§»å‹•åˆ°è‡ªå·±' },
        { status: 400 }
      );
    }

    // æª¢æŸ¥æ˜¯å¦ç§»å‹•åˆ°è‡ªå·±çš„å­è³‡æ–™å¤¾
    if (parentId && await isDescendant(parentId, id)) {
      return NextResponse.json(
        { error: 'ä¸èƒ½å°‡è³‡æ–™å¤¾ç§»å‹•åˆ°è‡ªå·±çš„å­è³‡æ–™å¤¾' },
        { status: 400 }
      );
    }

    let newDepth = 0;
    let newPath = name || currentFolder.name;

    if (parentId) {
      const parentFolder = await prisma.folder.findUnique({
        where: { id: parentId },
        select: { depth: true, path: true, userId: true },
      });

      if (!parentFolder || parentFolder.userId !== session.user.id) {
        return NextResponse.json(
          { error: 'ç›®æ¨™è³‡æ–™å¤¾ä¸å­˜åœ¨æˆ–ç„¡æ¬Šè¨ªå•' },
          { status: 404 }
        );
      }

      newDepth = parentFolder.depth + 1;

      // æª¢æŸ¥ç§»å‹•å¾Œçš„æ·±åº¦
      const maxChildDepth = await getMaxChildDepth(id);
      const totalDepth = newDepth + maxChildDepth;

      if (totalDepth >= 10) {
        return NextResponse.json(
          { error: 'ç§»å‹•å¾Œæœƒè¶…éæœ€å¤§å±¤ç´šé™åˆ¶' },
          { status: 400 }
        );
      }

      newPath = `${parentFolder.path}/${name || currentFolder.name}`;
    }

    // æ›´æ–°è³‡æ–™å¤¾åŠå…¶æ‰€æœ‰å­è³‡æ–™å¤¾
    await updateFolderHierarchy(id, newDepth, newPath);
  }

  // æ›´æ–°è³‡æ–™å¤¾
  const folder = await prisma.folder.update({
    where: { id },
    data: {
      ...(name && { name }),
      ...(parentId !== undefined && { parentId }),
    },
  });

  return NextResponse.json(folder);
}

// è¼”åŠ©å‡½æ•¸ï¼šæª¢æŸ¥æ˜¯å¦ç‚ºå­å­«è³‡æ–™å¤¾
async function isDescendant(folderId: string, ancestorId: string): Promise<boolean> {
  let currentId: string | null = folderId;

  while (currentId) {
    if (currentId === ancestorId) {
      return true;
    }

    const folder = await prisma.folder.findUnique({
      where: { id: currentId },
      select: { parentId: true },
    });

    currentId = folder?.parentId || null;
  }

  return false;
}

// è¼”åŠ©å‡½æ•¸ï¼šç²å–æœ€å¤§å­è³‡æ–™å¤¾æ·±åº¦
async function getMaxChildDepth(folderId: string): Promise<number> {
  const children = await prisma.folder.findMany({
    where: { parentId: folderId },
    select: { id: true },
  });

  if (children.length === 0) {
    return 0;
  }

  const childDepths = await Promise.all(
    children.map(child => getMaxChildDepth(child.id))
  );

  return Math.max(...childDepths) + 1;
}

// è¼”åŠ©å‡½æ•¸ï¼šéæ­¸æ›´æ–°è³‡æ–™å¤¾å±¤ç´š
async function updateFolderHierarchy(
  folderId: string,
  newDepth: number,
  newPath: string
) {
  // æ›´æ–°ç•¶å‰è³‡æ–™å¤¾
  await prisma.folder.update({
    where: { id: folderId },
    data: { depth: newDepth, path: newPath },
  });

  // ç²å–æ‰€æœ‰å­è³‡æ–™å¤¾
  const children = await prisma.folder.findMany({
    where: { parentId: folderId },
    select: { id: true, name: true },
  });

  // éæ­¸æ›´æ–°å­è³‡æ–™å¤¾
  await Promise.all(
    children.map(child =>
      updateFolderHierarchy(
        child.id,
        newDepth + 1,
        `${newPath}/${child.name}`
      )
    )
  );
}
```

**é—œéµé»**:
- âœ… æ”¯æ´é‡å‘½åå’Œç§»å‹•
- âœ… é˜²æ­¢å¾ªç’°å¼•ç”¨
- âœ… ç§»å‹•æ™‚æª¢æŸ¥æ•´å€‹å­æ¨¹çš„æ·±åº¦
- âœ… éæ­¸æ›´æ–°æ‰€æœ‰å­è³‡æ–™å¤¾çš„æ·±åº¦å’Œè·¯å¾‘
- âœ… å®Œæ•´çš„æ¬Šé™é©—è­‰

#### DELETE - åˆªé™¤è³‡æ–™å¤¾

**ç«¯é»**: `DELETE /api/folders?id={folderId}`

**æŸ¥è©¢åƒæ•¸**:
```typescript
{
  id: string;  // å¿…éœ€
}
```

**å¯¦ç¾é‚è¼¯**:

```typescript
export async function DELETE(request: NextRequest) {
  const session = await getServerSession(authOptions);
  const searchParams = request.nextUrl.searchParams;
  const id = searchParams.get('id');

  if (!id) {
    return NextResponse.json(
      { error: 'ç¼ºå°‘è³‡æ–™å¤¾ ID' },
      { status: 400 }
    );
  }

  // æª¢æŸ¥è³‡æ–™å¤¾å­˜åœ¨æ€§å’Œæ‰€æœ‰æ¬Š
  const folder = await prisma.folder.findUnique({
    where: { id },
    include: {
      _count: {
        select: {
          children: true,
          activities: true,
        },
      },
    },
  });

  if (!folder || folder.userId !== session.user.id) {
    return NextResponse.json(
      { error: 'è³‡æ–™å¤¾ä¸å­˜åœ¨æˆ–ç„¡æ¬Šè¨ªå•' },
      { status: 404 }
    );
  }

  // æª¢æŸ¥æ˜¯å¦ç‚ºç©ºè³‡æ–™å¤¾
  if (folder._count.children > 0 || folder._count.activities > 0) {
    return NextResponse.json(
      { error: 'è³‡æ–™å¤¾ä¸ç‚ºç©ºï¼Œç„¡æ³•åˆªé™¤' },
      { status: 400 }
    );
  }

  // åˆªé™¤è³‡æ–™å¤¾
  await prisma.folder.delete({
    where: { id },
  });

  return NextResponse.json({ success: true });
}
```

**é—œéµé»**:
- âœ… åªèƒ½åˆªé™¤ç©ºè³‡æ–™å¤¾
- âœ… é˜²æ­¢èª¤åˆªé™¤åŒ…å«å…§å®¹çš„è³‡æ–™å¤¾
- âœ… æ¬Šé™é©—è­‰

### 2. æ´»å‹•ç§»å‹• API

**æ–‡ä»¶**: `app/api/activities/move/route.ts`

**ç«¯é»**: `POST /api/activities/move`

**è«‹æ±‚é«”**:
```typescript
{
  activityId: string;           // å¿…éœ€
  folderId: string | null;      // å¿…éœ€ï¼Œnull è¡¨ç¤ºç§»å‹•åˆ°æ ¹ç›®éŒ„
}
```

**å¯¦ç¾é‚è¼¯**:

```typescript
export async function POST(request: NextRequest) {
  const session = await getServerSession(authOptions);
  const body = await request.json();
  const { activityId, folderId } = body;

  // é©—è­‰æ´»å‹•å­˜åœ¨ä¸”å±¬æ–¼ç”¨æˆ¶
  const activity = await prisma.activity.findUnique({
    where: { id: activityId },
    select: { userId: true },
  });

  if (!activity || activity.userId !== session.user.id) {
    return NextResponse.json(
      { error: 'æ´»å‹•ä¸å­˜åœ¨æˆ–ç„¡æ¬Šè¨ªå•' },
      { status: 404 }
    );
  }

  // é©—è­‰è³‡æ–™å¤¾å­˜åœ¨ä¸”å±¬æ–¼ç”¨æˆ¶
  if (folderId) {
    const folder = await prisma.folder.findFirst({
      where: {
        id: folderId,
        userId: session.user.id,
        type: 'ACTIVITIES',
      },
    });

    if (!folder) {
      return NextResponse.json(
        { error: 'è³‡æ–™å¤¾ä¸å­˜åœ¨æˆ–ç„¡æ¬Šè¨ªå•' },
        { status: 404 }
      );
    }
  }

  // æ›´æ–°æ´»å‹•çš„è³‡æ–™å¤¾
  const updatedActivity = await prisma.activity.update({
    where: { id: activityId },
    data: { folderId },
  });

  return NextResponse.json(updatedActivity);
}
```

---

## å‰ç«¯çµ„ä»¶è¨­è¨ˆ

### 1. ä¸»é é¢çµ„ä»¶

**æ–‡ä»¶**: `components/activities/WordwallStyleMyActivities.tsx`

#### ç‹€æ…‹ç®¡ç†

```typescript
const [currentFolderId, setCurrentFolderId] = useState<string | null>(null);
const [folders, setFolders] = useState<FolderData[]>([]);
const [currentFolder, setCurrentFolder] = useState<CurrentFolder | null>(null);
const [breadcrumbs, setBreadcrumbs] = useState<Breadcrumb[]>([]);
const [activities, setActivities] = useState<Activity[]>([]);
```

**ç‹€æ…‹èªªæ˜**:

| ç‹€æ…‹ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `currentFolderId` | `string \| null` | ç•¶å‰æ‰€åœ¨è³‡æ–™å¤¾çš„ ID |
| `folders` | `FolderData[]` | ç•¶å‰å±¤ç´šçš„å­è³‡æ–™å¤¾åˆ—è¡¨ |
| `currentFolder` | `CurrentFolder \| null` | ç•¶å‰è³‡æ–™å¤¾çš„è©³ç´°ä¿¡æ¯ |
| `breadcrumbs` | `Breadcrumb[]` | éºµåŒ…å±‘å°èˆªè·¯å¾‘ |
| `activities` | `Activity[]` | ç•¶å‰è³‡æ–™å¤¾çš„æ´»å‹•åˆ—è¡¨ |

#### è³‡æ–™å¤¾å°èˆªé‚è¼¯

```typescript
const handleFolderClick = (folderId: string | null) => {
  setCurrentFolderId(folderId);
  setPage(1); // é‡ç½®åˆ†é 

  // æ›´æ–° URL æŸ¥è©¢åƒæ•¸
  const params = new URLSearchParams(window.location.search);
  if (folderId) {
    params.set('folderId', folderId);
  } else {
    params.delete('folderId');
  }

  const newUrl = `${window.location.pathname}?${params.toString()}`;
  window.history.pushState({}, '', newUrl);
};

// è¿”å›ä¸Šä¸€å±¤
const handleBackToParent = () => {
  if (currentFolder?.parentId) {
    handleFolderClick(currentFolder.parentId);
  } else {
    handleFolderClick(null);
  }
};
```

**é—œéµé»**:
- âœ… ä½¿ç”¨ URL æŸ¥è©¢åƒæ•¸ä¿æŒç‹€æ…‹
- âœ… æ”¯æ´ç€è¦½å™¨å‰é€²/å¾Œé€€
- âœ… åˆ‡æ›è³‡æ–™å¤¾æ™‚é‡ç½®åˆ†é 

#### éºµåŒ…å±‘å°èˆª

```typescript
const buildBreadcrumbs = async (folderId: string | null) => {
  if (!folderId) {
    setBreadcrumbs([]);
    return;
  }

  const crumbs: Breadcrumb[] = [];
  let currentId: string | null = folderId;

  // å¾ç•¶å‰è³‡æ–™å¤¾å‘ä¸Šéæ­·åˆ°æ ¹ç›®éŒ„
  while (currentId) {
    const folder = await fetchFolderById(currentId);
    if (!folder) break;

    crumbs.unshift({
      id: folder.id,
      name: folder.name,
    });

    currentId = folder.parentId;
  }

  setBreadcrumbs(crumbs);
};

// éºµåŒ…å±‘æ¸²æŸ“
<div className="flex items-center gap-2 text-sm">
  <button onClick={() => handleFolderClick(null)}>
    <HomeIcon className="w-4 h-4" />
  </button>
  {breadcrumbs.map((crumb, index) => (
    <React.Fragment key={crumb.id}>
      <ChevronRightIcon className="w-4 h-4 text-gray-400" />
      <button
        onClick={() => handleFolderClick(crumb.id)}
        className="hover:text-blue-600"
      >
        {crumb.name}
      </button>
    </React.Fragment>
  ))}
</div>
```

**é—œéµé»**:
- âœ… å¾ç•¶å‰è³‡æ–™å¤¾å‘ä¸Šéæ­·åˆ°æ ¹ç›®éŒ„
- âœ… æ§‹å»ºå®Œæ•´çš„è·¯å¾‘éˆ
- âœ… æ¯å€‹éºµåŒ…å±‘éƒ½å¯é»æ“Šå°èˆª

#### æ•¸æ“šåŠ è¼‰

```typescript
useEffect(() => {
  const loadData = async () => {
    setLoading(true);
    try {
      // åŠ è¼‰è³‡æ–™å¤¾åˆ—è¡¨
      const foldersResponse = await fetch(
        `/api/folders?type=ACTIVITIES&parentId=${currentFolderId || ''}`
      );
      const foldersData = await foldersResponse.json();
      setFolders(foldersData);

      // åŠ è¼‰ç•¶å‰è³‡æ–™å¤¾ä¿¡æ¯
      if (currentFolderId) {
        const folderResponse = await fetch(`/api/folders/${currentFolderId}`);
        const folderData = await folderResponse.json();
        setCurrentFolder(folderData);
        await buildBreadcrumbs(currentFolderId);
      } else {
        setCurrentFolder(null);
        setBreadcrumbs([]);
      }

      // åŠ è¼‰æ´»å‹•åˆ—è¡¨
      const activitiesResponse = await fetch(
        `/api/activities?folderId=${currentFolderId || ''}&page=${page}&limit=${limit}`
      );
      const activitiesData = await activitiesResponse.json();
      setActivities(activitiesData.activities);
      setTotalPages(activitiesData.totalPages);
    } catch (error) {
      console.error('åŠ è¼‰æ•¸æ“šå¤±æ•—:', error);
    } finally {
      setLoading(false);
    }
  };

  loadData();
}, [currentFolderId, page, limit]);
```

### 2. è³‡æ–™å¤¾ç®¡ç†çµ„ä»¶

**æ–‡ä»¶**: `components/activities/FolderManager.tsx`

#### è³‡æ–™å¤¾æ¨¹ç‹€é¡¯ç¤º

```typescript
interface FolderTreeProps {
  folders: FolderData[];
  currentFolderId: string | null;
  onFolderClick: (folderId: string) => void;
  level?: number;
}

const FolderTree: React.FC<FolderTreeProps> = ({
  folders,
  currentFolderId,
  onFolderClick,
  level = 0
}) => {
  return (
    <div className="space-y-1">
      {folders.map((folder) => (
        <div key={folder.id}>
          <button
            onClick={() => onFolderClick(folder.id)}
            className={cn(
              "w-full flex items-center gap-2 px-3 py-2 rounded-lg",
              "hover:bg-gray-100 transition-colors",
              currentFolderId === folder.id && "bg-blue-50 text-blue-600"
            )}
            style={{ paddingLeft: `${level * 20 + 12}px` }}
          >
            <FolderIcon className="w-4 h-4" />
            <span className="flex-1 text-left">{folder.name}</span>
            <span className="text-sm text-gray-500">
              {folder._count.activities}
            </span>
          </button>

          {/* éæ­¸æ¸²æŸ“å­è³‡æ–™å¤¾ */}
          {folder.children && folder.children.length > 0 && (
            <FolderTree
              folders={folder.children}
              currentFolderId={currentFolderId}
              onFolderClick={onFolderClick}
              level={level + 1}
            />
          )}
        </div>
      ))}
    </div>
  );
};
```

**é—œéµé»**:
- âœ… éæ­¸æ¸²æŸ“å­è³‡æ–™å¤¾
- âœ… è¦–è¦ºç¸®é€²è¡¨ç¤ºå±¤ç´š
- âœ… é«˜äº®ç•¶å‰è³‡æ–™å¤¾
- âœ… é¡¯ç¤ºæ´»å‹•æ•¸é‡

#### æ–°å»ºè³‡æ–™å¤¾å°è©±æ¡†

```typescript
interface NewFolderModalProps {
  isOpen: boolean;
  onClose: () => void;
  parentId: string | null;
  onSuccess: () => void;
}

const NewFolderModal: React.FC<NewFolderModalProps> = ({
  isOpen,
  onClose,
  parentId,
  onSuccess,
}) => {
  const [name, setName] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async () => {
    if (!name.trim()) {
      setError('è«‹è¼¸å…¥è³‡æ–™å¤¾åç¨±');
      return;
    }

    setLoading(true);
    setError('');

    try {
      const response = await fetch('/api/folders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: name.trim(),
          type: 'ACTIVITIES',
          parentId,
        }),
      });

      if (!response.ok) {
        const data = await response.json();
        throw new Error(data.error || 'å‰µå»ºå¤±æ•—');
      }

      onSuccess();
      onClose();
      setName('');
    } catch (error) {
      setError(error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>æ–°å»ºè³‡æ–™å¤¾</DialogTitle>
        </DialogHeader>
        <div className="space-y-4">
          <div>
            <Input
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="è³‡æ–™å¤¾åç¨±"
              onKeyDown={(e) => {
                if (e.key === 'Enter') {
                  handleSubmit();
                }
              }}
            />
            {error && (
              <p className="text-sm text-red-600 mt-1">{error}</p>
            )}
          </div>
          <div className="flex justify-end gap-2">
            <Button variant="outline" onClick={onClose}>
              å–æ¶ˆ
            </Button>
            <Button onClick={handleSubmit} disabled={!name.trim() || loading}>
              {loading ? 'å‰µå»ºä¸­...' : 'å‰µå»º'}
            </Button>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
};
```

### 3. æ´»å‹•ç§»å‹•çµ„ä»¶

**æ–‡ä»¶**: `components/activities/MoveToFolderModal.tsx`

```typescript
interface MoveToFolderModalProps {
  isOpen: boolean;
  onClose: () => void;
  activityId: string;
  currentFolderId: string | null;
  onSuccess: () => void;
}

const MoveToFolderModal: React.FC<MoveToFolderModalProps> = ({
  isOpen,
  onClose,
  activityId,
  currentFolderId,
  onSuccess,
}) => {
  const [folders, setFolders] = useState<FolderData[]>([]);
  const [selectedFolderId, setSelectedFolderId] = useState<string | null>(currentFolderId);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (isOpen) {
      loadFolders();
    }
  }, [isOpen]);

  const loadFolders = async () => {
    const response = await fetch('/api/folders?type=ACTIVITIES');
    const data = await response.json();
    setFolders(buildFolderTree(data));
  };

  const handleMove = async () => {
    setLoading(true);
    try {
      const response = await fetch('/api/activities/move', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          activityId,
          folderId: selectedFolderId,
        }),
      });

      if (response.ok) {
        onSuccess();
        onClose();
      }
    } catch (error) {
      console.error('ç§»å‹•å¤±æ•—:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-md">
        <DialogHeader>
          <DialogTitle>ç§»å‹•åˆ°è³‡æ–™å¤¾</DialogTitle>
        </DialogHeader>
        <div className="space-y-4">
          <div className="max-h-96 overflow-y-auto border rounded-lg p-2">
            <button
              onClick={() => setSelectedFolderId(null)}
              className={cn(
                "w-full flex items-center gap-2 px-3 py-2 rounded-lg",
                "hover:bg-gray-100 transition-colors",
                selectedFolderId === null && "bg-blue-50 text-blue-600"
              )}
            >
              <HomeIcon className="w-4 h-4" />
              <span>æ ¹ç›®éŒ„</span>
            </button>
            <FolderTree
              folders={folders}
              currentFolderId={selectedFolderId}
              onFolderClick={setSelectedFolderId}
            />
          </div>
          <div className="flex justify-end gap-2">
            <Button variant="outline" onClick={onClose}>
              å–æ¶ˆ
            </Button>
            <Button onClick={handleMove} disabled={loading}>
              {loading ? 'ç§»å‹•ä¸­...' : 'ç§»å‹•'}
            </Button>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
};
```

---

## å¯¦æ–½æ­¥é©Ÿ

### æ­¥é©Ÿ 1: æ•¸æ“šåº«é·ç§»

```bash
# 1. ä¿®æ”¹ Prisma schema
# æ·»åŠ  parentId, depth, path å­—æ®µ

# 2. å‰µå»ºé·ç§»
npx prisma migrate dev --name add_folder_hierarchy

# 3. ç”Ÿæˆ Prisma Client
npx prisma generate
```

### æ­¥é©Ÿ 2: å¯¦ç¾ API ç«¯é»

1. âœ… å‰µå»º `app/api/folders/route.ts`
2. âœ… å¯¦ç¾ GET, POST, PATCH, DELETE æ–¹æ³•
3. âœ… å‰µå»º `app/api/activities/move/route.ts`
4. âœ… æ·»åŠ éŒ¯èª¤è™•ç†å’Œé©—è­‰

### æ­¥é©Ÿ 3: é–‹ç™¼å‰ç«¯çµ„ä»¶

1. âœ… ä¿®æ”¹ `WordwallStyleMyActivities.tsx`
2. âœ… å‰µå»º `FolderManager.tsx`
3. âœ… å‰µå»º `NewFolderModal.tsx`
4. âœ… å‰µå»º `MoveToFolderModal.tsx`

### æ­¥é©Ÿ 4: æ¸¬è©¦

1. âœ… å–®å…ƒæ¸¬è©¦ API ç«¯é»
2. âœ… é›†æˆæ¸¬è©¦è³‡æ–™å¤¾æ“ä½œ
3. âœ… E2E æ¸¬è©¦ç”¨æˆ¶æµç¨‹

---

## æ¸¬è©¦èˆ‡é©—è­‰

### åŠŸèƒ½æ¸¬è©¦æ¸…å–®

- [x] å‰µå»ºæ ¹ç›®éŒ„è³‡æ–™å¤¾
- [x] å‰µå»ºå­è³‡æ–™å¤¾ï¼ˆå¤šå±¤åµŒå¥—ï¼‰
- [x] é‡å‘½åè³‡æ–™å¤¾
- [x] ç§»å‹•è³‡æ–™å¤¾
- [x] åˆªé™¤ç©ºè³‡æ–™å¤¾
- [x] é˜²æ­¢åˆªé™¤éç©ºè³‡æ–™å¤¾
- [x] ç§»å‹•æ´»å‹•åˆ°è³‡æ–™å¤¾
- [x] è³‡æ–™å¤¾å°èˆª
- [x] éºµåŒ…å±‘å°èˆª
- [x] æ·±åº¦é™åˆ¶ï¼ˆ10å±¤ï¼‰
- [x] é˜²æ­¢å¾ªç’°å¼•ç”¨
- [x] ç€è¦½å™¨å‰é€²/å¾Œé€€
- [x] URL ç‹€æ…‹åŒæ­¥

### é‚Šç•Œæ¸¬è©¦

1. **æ·±åº¦é™åˆ¶æ¸¬è©¦**:
   - å‰µå»º 10 å±¤è³‡æ–™å¤¾ âœ…
   - å˜—è©¦å‰µå»ºç¬¬ 11 å±¤ï¼ˆæ‡‰å¤±æ•—ï¼‰âœ…

2. **å¾ªç’°å¼•ç”¨æ¸¬è©¦**:
   - å˜—è©¦å°‡è³‡æ–™å¤¾ç§»å‹•åˆ°è‡ªå·± âœ…
   - å˜—è©¦å°‡è³‡æ–™å¤¾ç§»å‹•åˆ°å­è³‡æ–™å¤¾ âœ…

3. **æ¬Šé™æ¸¬è©¦**:
   - è¨ªå•å…¶ä»–ç”¨æˆ¶çš„è³‡æ–™å¤¾ï¼ˆæ‡‰å¤±æ•—ï¼‰âœ…
   - ç§»å‹•æ´»å‹•åˆ°å…¶ä»–ç”¨æˆ¶çš„è³‡æ–™å¤¾ï¼ˆæ‡‰å¤±æ•—ï¼‰âœ…

---

## æ€§èƒ½å„ªåŒ–

### 1. æ•¸æ“šåº«å„ªåŒ–

**ç´¢å¼•ç­–ç•¥**:
```prisma
@@index([userId, type])           // ç”¨æˆ¶çš„æ‰€æœ‰è³‡æ–™å¤¾
@@index([parentId])                // å­è³‡æ–™å¤¾æŸ¥è©¢
@@index([userId, type, parentId])  // çµ„åˆæŸ¥è©¢
```

**æŸ¥è©¢å„ªåŒ–**:
- åªåŠ è¼‰ç•¶å‰å±¤ç´šçš„è³‡æ–™å¤¾ï¼ˆä¸éæ­¸ï¼‰
- ä½¿ç”¨ `_count` èšåˆè¨ˆç®—æ•¸é‡
- ä½¿ç”¨ `select` åªæŸ¥è©¢éœ€è¦çš„å­—æ®µ

### 2. å‰ç«¯å„ªåŒ–

**æ‡¶åŠ è¼‰**:
```typescript
// åªåœ¨éœ€è¦æ™‚åŠ è¼‰å­è³‡æ–™å¤¾
const loadSubfolders = async (folderId: string) => {
  const response = await fetch(`/api/folders?parentId=${folderId}`);
  return response.json();
};
```

**ç·©å­˜ç­–ç•¥**:
```typescript
// ä½¿ç”¨ React Query ç·©å­˜è³‡æ–™å¤¾æ•¸æ“š
const { data: folders } = useQuery(
  ['folders', currentFolderId],
  () => fetchFolders(currentFolderId),
  { staleTime: 5 * 60 * 1000 } // 5 åˆ†é˜
);
```

**é˜²æŠ–**:
```typescript
// æœç´¢å’Œéæ¿¾ä½¿ç”¨é˜²æŠ–
const debouncedSearch = useMemo(
  () => debounce((value: string) => {
    setSearchQuery(value);
  }, 300),
  []
);
```

---

## å¾ŒçºŒæ“´å±•

### è¨ˆåŠƒåŠŸèƒ½

1. **æ‹–æ”¾æ”¯æ´** ğŸ”„
   - æ‹–æ”¾ç§»å‹•æ´»å‹•
   - æ‹–æ”¾ç§»å‹•è³‡æ–™å¤¾
   - æ‹–æ”¾æ’åº

2. **æ‰¹é‡æ“ä½œ** ğŸ”„
   - æ‰¹é‡ç§»å‹•æ´»å‹•
   - æ‰¹é‡åˆªé™¤æ´»å‹•
   - æ‰¹é‡æ¨™è¨˜

3. **è³‡æ–™å¤¾è‡ªå®šç¾©** ğŸ”„
   - è‡ªå®šç¾©è³‡æ–™å¤¾é¡è‰²
   - è‡ªå®šç¾©è³‡æ–™å¤¾åœ–æ¨™
   - è³‡æ–™å¤¾æè¿°

4. **é«˜ç´šåŠŸèƒ½** ğŸ”„
   - è³‡æ–™å¤¾æ’åºï¼ˆåç¨±ã€æ—¥æœŸã€æ´»å‹•æ•¸é‡ï¼‰
   - è³‡æ–™å¤¾æœç´¢
   - è³‡æ–™å¤¾æ”¶è—
   - è³‡æ–™å¤¾åˆ†äº«

---

## ç¸½çµ

### æŠ€è¡“äº®é»

1. **è‡ªå¼•ç”¨é—œä¿‚**: ä½¿ç”¨ Prisma çš„è‡ªå¼•ç”¨é—œä¿‚å¯¦ç¾æ¨¹ç‹€çµæ§‹
2. **éæ­¸çµ„ä»¶**: React éæ­¸çµ„ä»¶æ¸²æŸ“è³‡æ–™å¤¾æ¨¹
3. **æ·±åº¦æ§åˆ¶**: è‡ªå‹•è¨ˆç®—å’Œé©—è­‰è³‡æ–™å¤¾æ·±åº¦
4. **è·¯å¾‘ç®¡ç†**: è‡ªå‹•ç¶­è­·å®Œæ•´è·¯å¾‘
5. **ç´šè¯æ›´æ–°**: ç§»å‹•è³‡æ–™å¤¾æ™‚è‡ªå‹•æ›´æ–°å­æ¨¹

### å¯¦æ–½æˆæœ

- âœ… å®Œæ•´çš„ 10 å±¤è³‡æ–™å¤¾åµŒå¥—ç³»çµ±
- âœ… ç›´è§€çš„ç”¨æˆ¶ç•Œé¢
- âœ… å®Œå–„çš„éŒ¯èª¤è™•ç†
- âœ… è‰¯å¥½çš„æ€§èƒ½è¡¨ç¾
- âœ… å¯æ“´å±•çš„æ¶æ§‹è¨­è¨ˆ

### å­¸ç¿’è¦é»

1. **æ•¸æ“šåº«è¨­è¨ˆ**: æ¨¹ç‹€çµæ§‹çš„æ•¸æ“šåº«è¨­è¨ˆæ¨¡å¼
2. **éæ­¸ç®—æ³•**: éæ­¸éæ­·å’Œæ›´æ–°æ¨¹ç‹€çµæ§‹
3. **React æ¨¡å¼**: éæ­¸çµ„ä»¶å’Œç‹€æ…‹ç®¡ç†
4. **API è¨­è¨ˆ**: RESTful API è¨­è¨ˆæœ€ä½³å¯¦è¸
5. **æ€§èƒ½å„ªåŒ–**: æ•¸æ“šåº«ç´¢å¼•å’Œå‰ç«¯ç·©å­˜ç­–ç•¥

---

**æ–‡æª”ç‰ˆæœ¬**: 1.0
**æœ€å¾Œæ›´æ–°**: 2025-10-20
**ä½œè€…**: EduCreate Development Team


