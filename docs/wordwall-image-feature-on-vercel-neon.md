# Wordwall åœ–ç‰‡åŠŸèƒ½åœ¨ Vercel Blob + Neon æ¶æ§‹ä¸Šçš„å¯¦æ–½è¨ˆç•«

**æ–‡æª”ç‰ˆæœ¬**ï¼š1.0
**å‰µå»ºæ—¥æœŸ**ï¼š2025-01-21
**ç›®æ¨™æ¶æ§‹**ï¼šVercel Blob Storage + Neon PostgreSQL
**é ä¼°æ™‚é–“**ï¼š6-8 é€±
**é ä¼°æˆæœ¬**ï¼š$44.75/æœˆï¼ˆåŸºç¤ï¼‰ + åœ–ç‰‡å­˜å„²å¢é‡

---

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

æœ¬æ–‡æª”æ•´åˆäº†å…©æ¬¡æ·±åº¦åˆ†æçš„æˆæœï¼Œæä¾›åœ¨ Vercel Blob + Neon æ¶æ§‹ä¸Šå¯¦æ–½ Wordwall é¢¨æ ¼åœ–ç‰‡åŠŸèƒ½çš„å®Œæ•´è¨ˆç•«ã€‚

### æ•´åˆçš„åˆ†ææˆæœ

#### åˆ†æ 1ï¼šWordwall åœ–ç‰‡åŠŸèƒ½æ·±åº¦åˆ†æ
- âœ… åœ–ç‰‡é¸æ“‡å™¨ï¼ˆImagePickerï¼‰çµ„ä»¶è¨­è¨ˆ
- âœ… åœ–ç‰‡æ’å…¥ï¼ˆContentItemWithImageï¼‰çµ„ä»¶è¨­è¨ˆ
- âœ… æ€§èƒ½å„ªåŒ–ï¼ˆBase64 vs URL å°æ¯”ï¼‰
- âœ… å®‰å…¨æ€§è€ƒæ…®ï¼ˆXSS é˜²è­·ã€åœ–ç‰‡é©—è­‰ï¼‰
- âœ… å¯è¨ªå•æ€§ï¼ˆWCAG æ¨™æº–ï¼‰
- âœ… æ•¸æ“šæŒä¹…åŒ–ï¼ˆè‡ªå‹•ä¿å­˜ã€ç‰ˆæœ¬æ§åˆ¶ï¼‰
- âœ… æ¸¬è©¦ç­–ç•¥ï¼ˆå–®å…ƒæ¸¬è©¦ã€E2E æ¸¬è©¦ï¼‰

#### åˆ†æ 2ï¼šEduCreate åœ–ç‰‡å­˜å„²ç¾ç‹€åˆ†æ
- âœ… ç•¶å‰æ¶æ§‹è©•ä¼°ï¼ˆVercel Blobã€æœ¬åœ° FSã€Mock APIï¼‰
- âœ… æˆæœ¬å°æ¯”ï¼ˆVercel Blob vs Supabase Storageï¼‰
- âœ… é…ç½®åˆ†æï¼ˆSupabaseã€Cloudinaryã€Unsplashï¼‰
- âœ… å¯¦æ–½å»ºè­°ï¼ˆæ··åˆæ¶æ§‹ï¼‰

### é¸å®šæ¶æ§‹ï¼šVercel Blob + Neon

**æ ¸å¿ƒå„ªå‹¢**ï¼š
- âœ… ä¿ç•™ Neon Database Branchingï¼ˆé–‹ç™¼æ•ˆç‡ï¼‰
- âœ… çµ±ä¸€åœ–ç‰‡å­˜å„²åˆ° Vercel Blobï¼ˆç°¡åŒ–ç®¡ç†ï¼‰
- âœ… å…¨çƒ CDN åŠ é€Ÿï¼ˆæ€§èƒ½å„ªåŒ–ï¼‰
- âœ… èˆ‡ Vercel éƒ¨ç½²æ·±åº¦æ•´åˆï¼ˆé–‹ç™¼é«”é©—ï¼‰
- âœ… 2025 æ–°å®šåƒ¹é™ä½æˆæœ¬ï¼ˆç¶“æ¿Ÿæ€§ï¼‰

---

## ğŸ¯ åŠŸèƒ½ç›®æ¨™

### æ ¸å¿ƒåŠŸèƒ½ï¼ˆåŸºæ–¼ Wordwall åˆ†æï¼‰

1. **åœ–ç‰‡é¸æ“‡å™¨ï¼ˆImagePickerï¼‰**
   - ğŸ” Unsplash åœ–ç‰‡æœç´¢
   - ğŸ“ å°ºå¯¸ç¯©é¸ï¼ˆAll/Small/Medium/Largeï¼‰
   - ğŸ“¤ æœ¬åœ°åœ–ç‰‡ä¸Šå‚³
   - ğŸ–¼ï¸ å€‹äººåœ–ç‰‡åº«ç®¡ç†

2. **åœ–ç‰‡æ’å…¥ï¼ˆContentItemWithImageï¼‰**
   - ğŸ–¼ï¸ åœ–ç‰‡ + æ–‡å­—æ··åˆè¼¸å…¥
   - ğŸ¨ åœ–ç‰‡é è¦½å’Œç·¨è¼¯
   - ğŸ—‘ï¸ åœ–ç‰‡åˆªé™¤åŠŸèƒ½
   - ğŸ’¾ è‡ªå‹•ä¿å­˜

3. **åœ–ç‰‡ç®¡ç†**
   - ğŸ“ ç”¨æˆ¶å€‹äººåœ–ç‰‡åº«
   - ğŸ·ï¸ åœ–ç‰‡æ¨™ç±¤å’Œåˆ†é¡
   - ğŸ”„ åœ–ç‰‡ç‰ˆæœ¬æ§åˆ¶
   - ğŸ“Š ä½¿ç”¨çµ±è¨ˆ

4. **æ€§èƒ½å„ªåŒ–**
   - âš¡ åœ–ç‰‡å£“ç¸®å’Œå„ªåŒ–
   - ğŸŒ CDN ç·©å­˜ç­–ç•¥
   - ğŸ“¦ æ‡¶åŠ è¼‰å’Œé åŠ è¼‰
   - ğŸ“ˆ æ€§èƒ½ç›£æ§

5. **å®‰å…¨æ€§**
   - ğŸ”’ XSS é˜²è­·
   - âœ… åœ–ç‰‡é©—è­‰ï¼ˆé¡å‹ã€å¤§å°ã€å…§å®¹ï¼‰
   - ğŸ›¡ï¸ CORS è™•ç†
   - ğŸ” ç”¨æˆ¶æ¬Šé™æ§åˆ¶

6. **å¯è¨ªå•æ€§**
   - âŒ¨ï¸ éµç›¤å°èˆª
   - ğŸ“¢ å±å¹•é–±è®€å™¨æ”¯æŒ
   - ğŸ¨ é«˜å°æ¯”åº¦æ¨¡å¼
   - ğŸ” ç„¦é»æŒ‡ç¤ºå™¨

---

## ğŸ“Š æ¶æ§‹è¨­è¨ˆ

### æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EduCreate Next.js App                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           å‰ç«¯çµ„ä»¶å±¤                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ ImagePicker    â”‚  â”‚ ContentItemWithImage   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - æœç´¢         â”‚  â”‚ - åœ–ç‰‡ + æ–‡å­—è¼¸å…¥      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - å°ºå¯¸ç¯©é¸     â”‚  â”‚ - é è¦½å’Œç·¨è¼¯           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - ä¸Šå‚³         â”‚  â”‚ - è‡ªå‹•ä¿å­˜             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ ImageGallery   â”‚  â”‚ ImageEditor            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - å€‹äººåœ–ç‰‡åº«   â”‚  â”‚ - è£å‰ªã€æ—‹è½‰           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - æ¨™ç±¤ç®¡ç†     â”‚  â”‚ - æ¿¾é¡æ•ˆæœ             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           API è·¯ç”±å±¤                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ /api/images/   â”‚  â”‚ /api/unsplash/         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - upload       â”‚  â”‚ - search               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - list         â”‚  â”‚ - download             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - delete       â”‚  â”‚                        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           æ•¸æ“šå±¤                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Neon           â”‚  â”‚ Vercel Blob            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ PostgreSQL     â”‚  â”‚ Storage                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”œâ”€ users       â”‚  â”‚ â”œâ”€ avatars/            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”œâ”€ images      â”‚  â”‚ â”œâ”€ screenshots/        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â”œâ”€ activities  â”‚  â”‚ â”œâ”€ user-uploads/       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€ tags        â”‚  â”‚ â””â”€ activity-images/    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           å¤–éƒ¨æœå‹™                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Unsplash API   â”‚  â”‚ Vercel CDN             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - åœ–ç‰‡æœç´¢     â”‚  â”‚ - å…¨çƒåŠ é€Ÿ             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ - å…è²»é¡åº¦     â”‚  â”‚ - è‡ªå‹•ç·©å­˜             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•¸æ“šæ¨¡å‹è¨­è¨ˆ

#### Prisma Schema æ“´å±•

```prisma
// prisma/schema.prisma

// ç”¨æˆ¶åœ–ç‰‡è¡¨
model UserImage {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // åœ–ç‰‡ä¿¡æ¯
  url         String   // Vercel Blob URL
  blobPath    String   // Blob å­˜å„²è·¯å¾‘
  fileName    String   // åŸå§‹æ–‡ä»¶å
  fileSize    Int      // æ–‡ä»¶å¤§å°ï¼ˆbytesï¼‰
  mimeType    String   // MIME é¡å‹
  width       Int?     // åœ–ç‰‡å¯¬åº¦
  height      Int?     // åœ–ç‰‡é«˜åº¦

  // å…ƒæ•¸æ“š
  source      String   @default("upload") // upload | unsplash
  sourceId    String?  // Unsplash åœ–ç‰‡ IDï¼ˆå¦‚æœä¾†è‡ª Unsplashï¼‰
  alt         String?  // æ›¿ä»£æ–‡å­—ï¼ˆå¯è¨ªå•æ€§ï¼‰
  tags        String[] // æ¨™ç±¤

  // ä½¿ç”¨çµ±è¨ˆ
  usageCount  Int      @default(0) // ä½¿ç”¨æ¬¡æ•¸
  lastUsedAt  DateTime? // æœ€å¾Œä½¿ç”¨æ™‚é–“

  // æ™‚é–“æˆ³
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // é—œè¯
  activities  ActivityImage[]

  @@index([userId])
  @@index([source])
  @@index([createdAt])
}

// æ´»å‹•åœ–ç‰‡é—œè¯è¡¨
model ActivityImage {
  id          String   @id @default(cuid())
  activityId  String
  activity    Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)
  imageId     String
  image       UserImage @relation(fields: [imageId], references: [id], onDelete: Cascade)

  // åœ–ç‰‡åœ¨æ´»å‹•ä¸­çš„ä½ç½®
  position    Int      // åœ–ç‰‡é †åº
  context     String?  // åœ–ç‰‡ä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚ï¼šå•é¡Œæ–‡å­—ï¼‰

  createdAt   DateTime @default(now())

  @@unique([activityId, imageId, position])
  @@index([activityId])
  @@index([imageId])
}

// åœ–ç‰‡æ¨™ç±¤è¡¨
model ImageTag {
  id        String   @id @default(cuid())
  name      String   @unique
  userId    String?  // null è¡¨ç¤ºç³»çµ±æ¨™ç±¤
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([userId])
}

// æ“´å±• User æ¨¡å‹
model User {
  // ... ç¾æœ‰æ¬„ä½
  images    UserImage[]
  imageTags ImageTag[]
}

// æ“´å±• Activity æ¨¡å‹
model Activity {
  // ... ç¾æœ‰æ¬„ä½
  images    ActivityImage[]
}
```

---

## ğŸ—“ï¸ å¯¦æ–½æ™‚é–“è¡¨ï¼ˆ6-8 é€±ï¼‰

### Phase 1ï¼šåŸºç¤è¨­æ–½æº–å‚™ï¼ˆ1 é€±ï¼‰

**ç›®æ¨™**ï¼šæº–å‚™æ•¸æ“šåº«ã€å­˜å„²å’Œ API åŸºç¤

#### ä»»å‹™æ¸…å–®

- [ ] **1.1 æ•¸æ“šåº« Schema æ›´æ–°**
  - å‰µå»º UserImageã€ActivityImageã€ImageTag æ¨¡å‹
  - é‹è¡Œ Prisma é·ç§»
  - é©—è­‰æ•¸æ“šåº«çµæ§‹

- [ ] **1.2 Vercel Blob é…ç½®**
  - ç¢ºèª Vercel Blob é…ç½®
  - å‰µå»ºå­˜å„²ç›®éŒ„çµæ§‹
  - è¨­ç½®æˆæœ¬è­¦å ±

- [ ] **1.3 Unsplash API æ•´åˆ**
  - è¨»å†Š Unsplash é–‹ç™¼è€…è³¬è™Ÿ
  - ç²å– API å¯†é‘°
  - é…ç½®ç’°å¢ƒè®Šé‡

- [ ] **1.4 åŸºç¤ API è·¯ç”±**
  - å‰µå»º `/api/images/upload`
  - å‰µå»º `/api/images/list`
  - å‰µå»º `/api/unsplash/search`

**é ä¼°æ™‚é–“**ï¼š1 é€±
**è² è²¬äºº**ï¼šå¾Œç«¯é–‹ç™¼
**é¢¨éšª**ï¼šä½

---

### Phase 2ï¼šåœ–ç‰‡ä¸Šå‚³åŠŸèƒ½ï¼ˆ1-2 é€±ï¼‰

**ç›®æ¨™**ï¼šå¯¦ç¾å®Œæ•´çš„åœ–ç‰‡ä¸Šå‚³å’Œç®¡ç†åŠŸèƒ½

#### ä»»å‹™æ¸…å–®

- [ ] **2.1 åœ–ç‰‡ä¸Šå‚³ API**
  - å¯¦ç¾æ–‡ä»¶é©—è­‰ï¼ˆé¡å‹ã€å¤§å°ã€å°ºå¯¸ï¼‰
  - å¯¦ç¾åœ–ç‰‡å£“ç¸®å’Œå„ªåŒ–
  - ä¸Šå‚³åˆ° Vercel Blob
  - ä¿å­˜å…ƒæ•¸æ“šåˆ°æ•¸æ“šåº«

- [ ] **2.2 åœ–ç‰‡åˆ—è¡¨ API**
  - å¯¦ç¾åˆ†é æŸ¥è©¢
  - å¯¦ç¾æ¨™ç±¤ç¯©é¸
  - å¯¦ç¾æœç´¢åŠŸèƒ½

- [ ] **2.3 åœ–ç‰‡åˆªé™¤ API**
  - å¯¦ç¾æ¬Šé™æª¢æŸ¥
  - åˆªé™¤ Vercel Blob æ–‡ä»¶
  - åˆªé™¤æ•¸æ“šåº«è¨˜éŒ„

- [ ] **2.4 æ¸¬è©¦**
  - å–®å…ƒæ¸¬è©¦ï¼ˆAPI è·¯ç”±ï¼‰
  - é›†æˆæ¸¬è©¦ï¼ˆä¸Šå‚³æµç¨‹ï¼‰

**é ä¼°æ™‚é–“**ï¼š1-2 é€±
**è² è²¬äºº**ï¼šå¾Œç«¯é–‹ç™¼
**é¢¨éšª**ï¼šä½

#### å¯¦ç¾ç¯„ä¾‹ï¼šåœ–ç‰‡ä¸Šå‚³ API

```typescript


---

## ğŸ“ è©³ç´°ä»£ç¢¼å¯¦ç¾

### 1. ImagePicker çµ„ä»¶ï¼ˆå®Œæ•´å¯¦ç¾ï¼‰

```typescript
// components/images/ImagePicker.tsx
'use client';

import { useState, useCallback } from 'react';
import { Search, Upload, Image as ImageIcon } from 'lucide-react';
import { useDropzone } from 'react-dropzone';

interface ImagePickerProps {
  onSelect: (image: { url: string; alt?: string; source: 'upload' | 'unsplash' }) => void;
  onClose: () => void;
}

type Tab = 'search' | 'upload' | 'gallery';
type SizeFilter = 'all' | 'small' | 'medium' | 'large';

export function ImagePicker({ onSelect, onClose }: ImagePickerProps) {
  const [activeTab, setActiveTab] = useState<Tab>('search');
  const [searchQuery, setSearchQuery] = useState('');
  const [sizeFilter, setSizeFilter] = useState<SizeFilter>('all');
  const [searchResults, setSearchResults] = useState<any[]>([]);
  const [userImages, setUserImages] = useState<any[]>([]);
  const [loading, setLoading] = useState(false);

  // Unsplash æœç´¢
  const handleSearch = useCallback(async () => {
    if (!searchQuery.trim()) return;

    setLoading(true);
    try {
      const params = new URLSearchParams({
        query: searchQuery,
        page: '1',
        perPage: '20',
      });

      if (sizeFilter !== 'all') {
        const orientationMap = {
          small: 'portrait',
          medium: 'squarish',
          large: 'landscape',
        };
        params.append('orientation', orientationMap[sizeFilter]);
      }

      const response = await fetch(`/api/unsplash/search?${params}`);
      const data = await response.json();

      if (data.success) {
        setSearchResults(data.results);
      }
    } catch (error) {
      console.error('Search error:', error);
    } finally {
      setLoading(false);
    }
  }, [searchQuery, sizeFilter]);

  // æ–‡ä»¶ä¸Šå‚³
  const onDrop = useCallback(async (acceptedFiles: File[]) => {
    const file = acceptedFiles[0];
    if (!file) return;

    setLoading(true);
    try {
      const formData = new FormData();
      formData.append('image', file);

      const response = await fetch('/api/images/upload', {
        method: 'POST',
        body: formData,
      });

      const data = await response.json();

      if (data.success) {
        onSelect({
          url: data.image.url,
          alt: data.image.fileName,
          source: 'upload',
        });
        onClose();
      }
    } catch (error) {
      console.error('Upload error:', error);
    } finally {
      setLoading(false);
    }
  }, [onSelect, onClose]);

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop,
    accept: {
      'image/*': ['.jpeg', '.jpg', '.png', '.webp', '.gif'],
    },
    maxSize: 10 * 1024 * 1024, // 10MB
    multiple: false,
  });

  // åŠ è¼‰ç”¨æˆ¶åœ–ç‰‡åº«
  const loadUserImages = useCallback(async () => {
    setLoading(true);
    try {
      const response = await fetch('/api/images/list');
      const data = await response.json();

      if (data.success) {
        setUserImages(data.images);
      }
    } catch (error) {
      console.error('Load images error:', error);
    } finally {
      setLoading(false);
    }
  }, []);

  // é¸æ“‡ Unsplash åœ–ç‰‡
  const handleSelectUnsplash = async (photo: any) => {
    try {
      // è§¸ç™¼ Unsplash ä¸‹è¼‰çµ±è¨ˆ
      await fetch('/api/unsplash/download', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ downloadUrl: photo.downloadUrl }),
      });

      onSelect({
        url: photo.url,
        alt: photo.alt,
        source: 'unsplash',
      });
      onClose();
    } catch (error) {
      console.error('Select error:', error);
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
      <div className="w-full max-w-4xl bg-white rounded-lg shadow-xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b">
          <h2 className="text-xl font-semibold">é¸æ“‡åœ–ç‰‡</h2>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-full"
          >
            âœ•
          </button>
        </div>

        {/* Tabs */}
        <div className="flex border-b">
          <button
            onClick={() => setActiveTab('search')}
            className={`px-6 py-3 font-medium ${
              activeTab === 'search'
                ? 'border-b-2 border-blue-500 text-blue-600'
                : 'text-gray-600'
            }`}
          >
            <Search className="inline w-4 h-4 mr-2" />
            æœç´¢åœ–ç‰‡
          </button>
          <button
            onClick={() => setActiveTab('upload')}
            className={`px-6 py-3 font-medium ${
              activeTab === 'upload'
                ? 'border-b-2 border-blue-500 text-blue-600'
                : 'text-gray-600'
            }`}
          >
            <Upload className="inline w-4 h-4 mr-2" />
            ä¸Šå‚³åœ–ç‰‡
          </button>
          <button
            onClick={() => {
              setActiveTab('gallery');
              loadUserImages();
            }}
            className={`px-6 py-3 font-medium ${
              activeTab === 'gallery'
                ? 'border-b-2 border-blue-500 text-blue-600'
                : 'text-gray-600'
            }`}
          >
            <ImageIcon className="inline w-4 h-4 mr-2" />
            æˆ‘çš„åœ–ç‰‡åº«
          </button>
        </div>

        {/* Content */}
        <div className="p-4 h-96 overflow-y-auto">
          {/* Search Tab */}
          {activeTab === 'search' && (
            <div>
              {/* Search Bar */}
              <div className="flex gap-2 mb-4">
                <input
                  type="text"
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                  placeholder="æœç´¢åœ–ç‰‡..."
                  className="flex-1 px-4 py-2 border rounded-lg"
                />
                <button
                  onClick={handleSearch}
                  disabled={loading}
                  className="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50"
                >
                  æœç´¢
                </button>
              </div>

              {/* Size Filter */}
              <div className="flex gap-2 mb-4">
                {(['all', 'small', 'medium', 'large'] as SizeFilter[]).map((size) => (
                  <button
                    key={size}
                    onClick={() => setSizeFilter(size)}
                    className={`px-4 py-2 rounded-lg ${
                      sizeFilter === size
                        ? 'bg-blue-500 text-white'
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    {size === 'all' ? 'å…¨éƒ¨' : size === 'small' ? 'å°' : size === 'medium' ? 'ä¸­' : 'å¤§'}
                  </button>
                ))}
              </div>

              {/* Search Results */}
              <div className="grid grid-cols-3 gap-4">
                {searchResults.map((photo) => (
                  <div
                    key={photo.id}
                    onClick={() => handleSelectUnsplash(photo)}
                    className="cursor-pointer group relative aspect-square overflow-hidden rounded-lg"
                  >
                    <img
                      src={photo.thumb}
                      alt={photo.alt}
                      className="w-full h-full object-cover group-hover:scale-110 transition-transform"
                    />
                    <div className="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors" />
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Upload Tab */}
          {activeTab === 'upload' && (
            <div
              {...getRootProps()}
              className={`border-2 border-dashed rounded-lg p-12 text-center cursor-pointer ${
                isDragActive ? 'border-blue-500 bg-blue-50' : 'border-gray-300'
              }`}
            >
              <input {...getInputProps()} />
              <Upload className="w-12 h-12 mx-auto mb-4 text-gray-400" />
              <p className="text-lg font-medium mb-2">
                {isDragActive ? 'æ”¾é–‹ä»¥ä¸Šå‚³' : 'æ‹–æ”¾åœ–ç‰‡åˆ°é€™è£¡'}
              </p>
              <p className="text-sm text-gray-500">
                æˆ–é»æ“Šé¸æ“‡æ–‡ä»¶ï¼ˆæœ€å¤§ 10MBï¼‰
              </p>
            </div>
          )}

          {/* Gallery Tab */}
          {activeTab === 'gallery' && (
            <div className="grid grid-cols-3 gap-4">
              {userImages.map((image) => (
                <div
                  key={image.id}
                  onClick={() => {
                    onSelect({
                      url: image.url,
                      alt: image.alt || image.fileName,
                      source: 'upload',
                    });
                    onClose();
                  }}
                  className="cursor-pointer group relative aspect-square overflow-hidden rounded-lg"
                >
                  <img
                    src={image.url}
                    alt={image.alt || image.fileName}
                    className="w-full h-full object-cover group-hover:scale-110 transition-transform"
                  />
                  <div className="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors" />
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
```

### 2. ContentItemWithImage çµ„ä»¶ï¼ˆå®Œæ•´å¯¦ç¾ï¼‰

```typescript
// components/images/ContentItemWithImage.tsx
'use client';

import { useState } from 'react';
import { Image as ImageIcon, X } from 'lucide-react';
import { ImagePicker } from './ImagePicker';

interface ContentItemWithImageProps {
  value: {
    text: string;
    image?: {
      url: string;
      alt?: string;
      source: 'upload' | 'unsplash';
    };
  };
  onChange: (value: { text: string; image?: any }) => void;
  placeholder?: string;
}

export function ContentItemWithImage({
  value,
  onChange,
  placeholder = 'è¼¸å…¥æ–‡å­—...',
}: ContentItemWithImageProps) {
  const [showImagePicker, setShowImagePicker] = useState(false);

  const handleTextChange = (text: string) => {
    onChange({ ...value, text });
  };

  const handleImageSelect = (image: any) => {
    onChange({ ...value, image });
  };

  const handleImageRemove = () => {
    onChange({ ...value, image: undefined });
  };

  return (
    <div className="border rounded-lg p-4 space-y-3">
      {/* Text Input */}
      <input
        type="text"
        value={value.text}
        onChange={(e) => handleTextChange(e.target.value)}
        placeholder={placeholder}
        className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
      />

      {/* Image Section */}
      {value.image ? (
        <div className="relative group">
          <img
            src={value.image.url}
            alt={value.image.alt || ''}
            className="w-full h-48 object-cover rounded-lg"
          />
          <button
            onClick={handleImageRemove}
            className="absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
          >
            <X className="w-4 h-4" />
          </button>
        </div>
      ) : (
        <button
          onClick={() => setShowImagePicker(true)}
          className="w-full py-8 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors"
        >
          <ImageIcon className="w-8 h-8 mx-auto mb-2 text-gray-400" />
          <p className="text-sm text-gray-500">é»æ“Šæ·»åŠ åœ–ç‰‡</p>
        </button>
      )}

      {/* Image Picker Modal */}
      {showImagePicker && (
        <ImagePicker
          onSelect={handleImageSelect}
          onClose={() => setShowImagePicker(false)}
        />
      )}
    </div>
  );
}
```

### 3. åœ–ç‰‡åˆ—è¡¨ APIï¼ˆå®Œæ•´å¯¦ç¾ï¼‰

```typescript
// app/api/images/list/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { getServerSession } from 'next-auth';
import { authOptions } from '@/lib/auth';
import { prisma } from '@/lib/prisma';

export async function GET(request: NextRequest) {
  try {
    // é©—è­‰ç”¨æˆ¶ç™»éŒ„
    const session = await getServerSession(authOptions);
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // ç²å–æŸ¥è©¢åƒæ•¸
    const searchParams = request.nextUrl.searchParams;
    const page = parseInt(searchParams.get('page') || '1');
    const perPage = parseInt(searchParams.get('perPage') || '20');
    const source = searchParams.get('source'); // upload | unsplash
    const tags = searchParams.get('tags')?.split(',').filter(Boolean);
    const search = searchParams.get('search');

    // æ§‹å»ºæŸ¥è©¢æ¢ä»¶
    const where: any = {
      userId: session.user.id,
    };

    if (source) {
      where.source = source;
    }

    if (tags && tags.length > 0) {
      where.tags = {
        hasSome: tags,
      };
    }

    if (search) {
      where.OR = [
        { fileName: { contains: search, mode: 'insensitive' } },
        { alt: { contains: search, mode: 'insensitive' } },
      ];
    }

    // æŸ¥è©¢åœ–ç‰‡
    const [images, total] = await Promise.all([
      prisma.userImage.findMany({
        where,
        orderBy: { createdAt: 'desc' },
        skip: (page - 1) * perPage,
        take: perPage,
        select: {
          id: true,
          url: true,
          fileName: true,
          fileSize: true,
          mimeType: true,
          width: true,
          height: true,
          source: true,
          alt: true,
          tags: true,
          usageCount: true,
          createdAt: true,
        },
      }),
      prisma.userImage.count({ where }),
    ]);

    return NextResponse.json({
      success: true,
      images,
      pagination: {
        page,
        perPage,
        total,
        totalPages: Math.ceil(total / perPage),
      },
    });
  } catch (error) {
    console.error('List images error:', error);
    return NextResponse.json(
      { error: 'Failed to list images' },
      { status: 500 }
    );
  }
}
```

### 4. Unsplash ä¸‹è¼‰ APIï¼ˆå®Œæ•´å¯¦ç¾ï¼‰

```typescript
// app/api/unsplash/download/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { createApi } from 'unsplash-js';

const unsplash = createApi({
  accessKey: process.env.UNSPLASH_ACCESS_KEY!,
});

export async function POST(request: NextRequest) {
  try {
    const { downloadUrl } = await request.json();

    if (!downloadUrl) {
      return NextResponse.json(
        { error: 'Download URL required' },
        { status: 400 }
      );
    }

    // è§¸ç™¼ Unsplash ä¸‹è¼‰çµ±è¨ˆï¼ˆå¿…é ˆèª¿ç”¨ä»¥ç¬¦åˆ API ä½¿ç”¨æ¢æ¬¾ï¼‰
    await fetch(downloadUrl);

    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('Unsplash download error:', error);
    return NextResponse.json(
      { error: 'Failed to trigger download' },
      { status: 500 }
    );
  }
}
```

// app/api/images/upload/route.ts
import { put } from '@vercel/blob';
import { getServerSession } from 'next-auth';
import { prisma } from '@/lib/prisma';
import sharp from 'sharp';

export async function POST(request: NextRequest) {
  try {
    // é©—è­‰ç”¨æˆ¶ç™»éŒ„
    const session = await getServerSession(authOptions);
    if (!session?.user?.id) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    // ç²å–ä¸Šå‚³çš„æ–‡ä»¶
    const formData = await request.formData();
    const file = formData.get('image') as File;
    const tags = formData.get('tags') as string; // JSON å­—ç¬¦ä¸²

    if (!file) {
      return NextResponse.json({ error: 'No file provided' }, { status: 400 });
    }

    // é©—è­‰æ–‡ä»¶é¡å‹
    const allowedTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];
    if (!allowedTypes.includes(file.type)) {
      return NextResponse.json({ error: 'Invalid file type' }, { status: 400 });
    }

    // é©—è­‰æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§ 10MBï¼‰
    const maxSize = 10 * 1024 * 1024;
    if (file.size > maxSize) {
      return NextResponse.json({ error: 'File too large (max 10MB)' }, { status: 400 });
    }

    // è®€å–æ–‡ä»¶
    const buffer = Buffer.from(await file.arrayBuffer());

    // ä½¿ç”¨ sharp ç²å–åœ–ç‰‡å°ºå¯¸å’Œå„ªåŒ–
    const image = sharp(buffer);
    const metadata = await image.metadata();

    // å£“ç¸®åœ–ç‰‡ï¼ˆå¦‚æœå¤§æ–¼ 2000pxï¼Œç¸®å°åˆ° 2000pxï¼‰
    let optimizedBuffer = buffer;
    if (metadata.width && metadata.width > 2000) {
      optimizedBuffer = await image
        .resize(2000, null, { withoutEnlargement: true })
        .jpeg({ quality: 85 })
        .toBuffer();
    }

    // ä¸Šå‚³åˆ° Vercel Blob
    const fileName = `${session.user.id}-${Date.now()}.${file.type.split('/')[1]}`;
    const blobPath = `user-uploads/${session.user.id}/${fileName}`;

    const blob = await put(blobPath, optimizedBuffer, {
      access: 'public',
      addRandomSuffix: false,
    });

    // ä¿å­˜åˆ°æ•¸æ“šåº«
    const userImage = await prisma.userImage.create({
      data: {
        userId: session.user.id,
        url: blob.url,
        blobPath: blobPath,
        fileName: file.name,
        fileSize: optimizedBuffer.length,
        mimeType: file.type,
        width: metadata.width,
        height: metadata.height,
        source: 'upload',
        tags: tags ? JSON.parse(tags) : [],
      },
    });

    return NextResponse.json({
      success: true,
      image: userImage,
    });
  } catch (error) {
    console.error('Image upload error:', error);
    return NextResponse.json(
      { error: 'Failed to upload image' },
      { status: 500 }
    );
  }
}
```

---

### Phase 3ï¼šUnsplash æ•´åˆï¼ˆ1 é€±ï¼‰

**ç›®æ¨™**ï¼šå¯¦ç¾ Unsplash åœ–ç‰‡æœç´¢å’Œä¸‹è¼‰åŠŸèƒ½

#### ä»»å‹™æ¸…å–®

- [ ] **3.1 Unsplash æœç´¢ API**
  - å¯¦ç¾é—œéµå­—æœç´¢
  - å¯¦ç¾å°ºå¯¸ç¯©é¸
  - å¯¦ç¾åˆ†é 

- [ ] **3.2 Unsplash ä¸‹è¼‰ API**
  - å¯¦ç¾åœ–ç‰‡ä¸‹è¼‰ï¼ˆè§¸ç™¼ Unsplash çµ±è¨ˆï¼‰
  - ä¿å­˜åˆ° Vercel Blob
  - ä¿å­˜å…ƒæ•¸æ“šåˆ°æ•¸æ“šåº«

- [ ] **3.3 æ¸¬è©¦**
  - æ¸¬è©¦æœç´¢åŠŸèƒ½
  - æ¸¬è©¦ä¸‹è¼‰åŠŸèƒ½
  - æ¸¬è©¦å…è²»é¡åº¦ç›£æ§

**é ä¼°æ™‚é–“**ï¼š1 é€±
**è² è²¬äºº**ï¼šå¾Œç«¯é–‹ç™¼
**é¢¨éšª**ï¼šä½

#### å¯¦ç¾ç¯„ä¾‹ï¼šUnsplash æœç´¢ API

```typescript
// app/api/unsplash/search/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { createApi } from 'unsplash-js';

const unsplash = createApi({
  accessKey: process.env.UNSPLASH_ACCESS_KEY!,
});

export async function GET(request: NextRequest) {
  try {
    const searchParams = request.nextUrl.searchParams;
    const query = searchParams.get('query');
    const page = parseInt(searchParams.get('page') || '1');
    const perPage = parseInt(searchParams.get('perPage') || '20');
    const orientation = searchParams.get('orientation'); // landscape | portrait | squarish

    if (!query) {
      return NextResponse.json({ error: 'Query required' }, { status: 400 });
    }

    // æœç´¢åœ–ç‰‡
    const result = await unsplash.search.getPhotos({
      query,
      page,
      perPage,
      orientation: orientation as any,
    });

    if (result.errors) {
      return NextResponse.json(
        { error: result.errors[0] },
        { status: 500 }
      );
    }

    return NextResponse.json({
      success: true,
      results: result.response.results.map((photo) => ({
        id: photo.id,
        url: photo.urls.regular,
        thumb: photo.urls.thumb,
        width: photo.width,
        height: photo.height,
        alt: photo.alt_description,
        author: {
          name: photo.user.name,
          username: photo.user.username,
          link: photo.user.links.html,
        },
        downloadUrl: photo.links.download_location,
      })),
      total: result.response.total,
      totalPages: result.response.total_pages,
    });
  } catch (error) {
    console.error('Unsplash search error:', error);
    return NextResponse.json(
      { error: 'Failed to search images' },
      { status: 500 }
    );
  }
}
```

---

### Phase 4ï¼šå‰ç«¯çµ„ä»¶é–‹ç™¼ï¼ˆ2-3 é€±ï¼‰

**ç›®æ¨™**ï¼šå¯¦ç¾ ImagePicker å’Œ ContentItemWithImage çµ„ä»¶

#### ä»»å‹™æ¸…å–®

- [ ] **4.1 ImagePicker çµ„ä»¶**
  - å¯¦ç¾æœç´¢ç•Œé¢
  - å¯¦ç¾å°ºå¯¸ç¯©é¸
  - å¯¦ç¾ä¸Šå‚³åŠŸèƒ½
  - å¯¦ç¾å€‹äººåœ–ç‰‡åº«

- [ ] **4.2 ContentItemWithImage çµ„ä»¶**
  - å¯¦ç¾åœ–ç‰‡ + æ–‡å­—è¼¸å…¥
  - å¯¦ç¾åœ–ç‰‡é è¦½
  - å¯¦ç¾åœ–ç‰‡ç·¨è¼¯ï¼ˆè£å‰ªã€æ—‹è½‰ï¼‰
  - å¯¦ç¾è‡ªå‹•ä¿å­˜

- [ ] **4.3 ImageGallery çµ„ä»¶**
  - å¯¦ç¾åœ–ç‰‡åˆ—è¡¨
  - å¯¦ç¾æ¨™ç±¤ç®¡ç†
  - å¯¦ç¾æœç´¢å’Œç¯©é¸

- [ ] **4.4 éŸ¿æ‡‰å¼è¨­è¨ˆ**
  - æ¡Œé¢ç‰ˆæœ¬
  - å¹³æ¿ç‰ˆæœ¬
  - æ‰‹æ©Ÿç‰ˆæœ¬

**é ä¼°æ™‚é–“**ï¼š2-3 é€±
**è² è²¬äºº**ï¼šå‰ç«¯é–‹ç™¼
**é¢¨éšª**ï¼šä¸­

---

### Phase 5ï¼šé«˜ç´šåŠŸèƒ½ï¼ˆ1-2 é€±ï¼‰

**ç›®æ¨™**ï¼šå¯¦ç¾åœ–ç‰‡ç·¨è¼¯ã€æ‰¹é‡ä¸Šå‚³ç­‰é«˜ç´šåŠŸèƒ½

#### ä»»å‹™æ¸…å–®

- [ ] **5.1 åœ–ç‰‡ç·¨è¼¯**
  - è£å‰ªåŠŸèƒ½
  - æ—‹è½‰åŠŸèƒ½
  - æ¿¾é¡æ•ˆæœ

- [ ] **5.2 æ‰¹é‡ä¸Šå‚³**
  - å¤šæ–‡ä»¶é¸æ“‡
  - ä¸Šå‚³é€²åº¦é¡¯ç¤º
  - éŒ¯èª¤è™•ç†

- [ ] **5.3 æ‹–æ”¾ä¸Šå‚³**
  - æ‹–æ”¾å€åŸŸ
  - æ‹–æ”¾é è¦½
  - æ‹–æ”¾é©—è­‰

- [ ] **5.4 è‡ªå‹•ä¿å­˜å’Œç‰ˆæœ¬æ§åˆ¶**
  - è‡ªå‹•ä¿å­˜æ©Ÿåˆ¶
  - ç‰ˆæœ¬æ­·å²
  - æ¢å¾©åŠŸèƒ½

**é ä¼°æ™‚é–“**ï¼š1-2 é€±
**è² è²¬äºº**ï¼šå…¨æ£§é–‹ç™¼
**é¢¨éšª**ï¼šä¸­

---

### Phase 6ï¼šæ¸¬è©¦å’Œå„ªåŒ–ï¼ˆ1 é€±ï¼‰

**ç›®æ¨™**ï¼šå…¨é¢æ¸¬è©¦å’Œæ€§èƒ½å„ªåŒ–

#### ä»»å‹™æ¸…å–®

- [ ] **6.1 å–®å…ƒæ¸¬è©¦**
  - API è·¯ç”±æ¸¬è©¦
  - çµ„ä»¶æ¸¬è©¦
  - å·¥å…·å‡½æ•¸æ¸¬è©¦

- [ ] **6.2 E2E æ¸¬è©¦**
  - åœ–ç‰‡ä¸Šå‚³æµç¨‹
  - åœ–ç‰‡æœç´¢æµç¨‹
  - åœ–ç‰‡ç·¨è¼¯æµç¨‹

- [ ] **6.3 æ€§èƒ½å„ªåŒ–**
  - åœ–ç‰‡æ‡¶åŠ è¼‰
  - CDN ç·©å­˜å„ªåŒ–
  - ä»£ç¢¼åˆ†å‰²

- [ ] **6.4 å¯è¨ªå•æ€§æ¸¬è©¦**
  - éµç›¤å°èˆªæ¸¬è©¦
  - å±å¹•é–±è®€å™¨æ¸¬è©¦
  - é¡è‰²å°æ¯”åº¦æ¸¬è©¦

**é ä¼°æ™‚é–“**ï¼š1 é€±
**è² è²¬äºº**ï¼šQA + é–‹ç™¼åœ˜éšŠ
**é¢¨éšª**ï¼šä½

---

## ğŸ’° æˆæœ¬åˆ†æ

### åŸºç¤æˆæœ¬ï¼ˆVercel Blob + Neonï¼‰

```
Neon PostgreSQL Launch: $19/æœˆ
Vercel Pro è¨ˆåŠƒ: $20/æœˆï¼ˆåŒ…å« 5GB + 100GBï¼‰
Vercel Blob åŸºç¤: $5.745/æœˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åŸºç¤ç¸½è¨ˆ: $44.745/æœˆ
```

### åœ–ç‰‡åŠŸèƒ½å¢é‡æˆæœ¬ï¼ˆ10,000 ç”¨æˆ¶å ´æ™¯ï¼‰

**å‡è¨­**ï¼š
- æ¯ç”¨æˆ¶å¹³å‡ä¸Šå‚³ 20 å¼µåœ–ç‰‡
- æ¯å¼µåœ–ç‰‡å¹³å‡ 300KBï¼ˆå£“ç¸®å¾Œï¼‰
- æ¯å¼µåœ–ç‰‡æ¯æœˆè¢«è¨ªå• 15 æ¬¡

**å­˜å„²æˆæœ¬**ï¼š
```
ç¸½å­˜å„²ï¼š10,000 Ã— 20 Ã— 0.3MB = 60GB
å…è²»é¡åº¦ï¼š5GBï¼ˆPro è¨ˆåŠƒï¼‰
ä»˜è²»éƒ¨åˆ†ï¼š55GB Ã— $0.023 = $1.265/æœˆ
```

**å¸¶å¯¬æˆæœ¬**ï¼š
```
ç¸½å¸¶å¯¬ï¼š10,000 Ã— 20 Ã— 15 Ã— 0.3MB = 900GB
å…è²»é¡åº¦ï¼š100GBï¼ˆPro è¨ˆåŠƒï¼‰
ä»˜è²»éƒ¨åˆ†ï¼š800GB Ã— $0.05 = $40/æœˆ
```

**æ“ä½œæˆæœ¬**ï¼š
```
è®€å–æ“ä½œï¼š10,000 Ã— 20 Ã— 15 = 3M æ¬¡
æˆæœ¬ï¼š3M Ã— $0.40 / 1M = $1.20/æœˆ
```

**Unsplash API**ï¼š
```
å…è²»é¡åº¦ï¼š50,000 æ¬¡/æœˆ
é ä¼°ä½¿ç”¨ï¼š~10,000 æ¬¡/æœˆ
æˆæœ¬ï¼š$0/æœˆï¼ˆåœ¨å…è²»é¡åº¦å…§ï¼‰
```

**åœ–ç‰‡åŠŸèƒ½ç¸½å¢é‡æˆæœ¬**ï¼š
```
å­˜å„²ï¼š$1.265/æœˆ
å¸¶å¯¬ï¼š$40/æœˆ
æ“ä½œï¼š$1.20/æœˆ
Unsplashï¼š$0/æœˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å¢é‡ç¸½è¨ˆï¼š$42.465/æœˆ
```

**ç¸½æˆæœ¬**ï¼š
```
åŸºç¤æˆæœ¬ï¼š$44.745/æœˆ
åœ–ç‰‡åŠŸèƒ½ï¼š$42.465/æœˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¸½è¨ˆï¼š$87.21/æœˆ
```

### æˆæœ¬å„ªåŒ–å»ºè­°

1. **åœ–ç‰‡å£“ç¸®**
   - ä½¿ç”¨ sharp å£“ç¸®åœ–ç‰‡
   - ç›®æ¨™ï¼šæ¸›å°‘ 30-50% æ–‡ä»¶å¤§å°
   - é ä¼°ç¯€çœï¼š$12-20/æœˆ

2. **CDN ç·©å­˜å„ªåŒ–**
   - è¨­ç½®é•·æœŸç·©å­˜ï¼ˆ1 å¹´ï¼‰
   - æ¸›å°‘é‡è¤‡è«‹æ±‚
   - é ä¼°ç¯€çœï¼š$10-15/æœˆ

3. **æ‡¶åŠ è¼‰**
   - åªåŠ è¼‰å¯è¦‹åœ–ç‰‡
   - æ¸›å°‘ä¸å¿…è¦çš„å¸¶å¯¬
   - é ä¼°ç¯€çœï¼š$5-10/æœˆ

**å„ªåŒ–å¾Œé ä¼°æˆæœ¬**ï¼š
```
ç¸½æˆæœ¬ï¼š$87.21/æœˆ
å„ªåŒ–ç¯€çœï¼š$27-45/æœˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å„ªåŒ–å¾Œï¼š$42-60/æœˆ
```

---

## ğŸ”§ æŠ€è¡“å¯¦æ–½ç´°ç¯€

### ç’°å¢ƒè®Šé‡é…ç½®

```bash
# .env.local

# Neon Database
DATABASE_URL="postgresql://..."
DIRECT_URL="postgresql://..."

# Vercel Blob Storage
BLOB_READ_WRITE_TOKEN="vercel_blob_..."

# Unsplash API
UNSPLASH_ACCESS_KEY="your_unsplash_access_key"
UNSPLASH_SECRET_KEY="your_unsplash_secret_key"

# Supabase (Realtime)
NEXT_PUBLIC_SUPABASE_URL="https://..."
NEXT_PUBLIC_SUPABASE_ANON_KEY="..."
```

### æ–‡ä»¶çµæ§‹

```
app/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ upload/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts          # åœ–ç‰‡ä¸Šå‚³
â”‚   â”‚   â”œâ”€â”€ list/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts          # åœ–ç‰‡åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts          # åœ–ç‰‡è©³æƒ…
â”‚   â”‚   â”‚   â””â”€â”€ delete/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts      # åœ–ç‰‡åˆªé™¤
â”‚   â”‚   â””â”€â”€ tags/
â”‚   â”‚       â””â”€â”€ route.ts          # æ¨™ç±¤ç®¡ç†
â”‚   â””â”€â”€ unsplash/
â”‚       â”œâ”€â”€ search/
â”‚       â”‚   â””â”€â”€ route.ts          # Unsplash æœç´¢
â”‚       â””â”€â”€ download/
â”‚           â””â”€â”€ route.ts          # Unsplash ä¸‹è¼‰

components/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ ImagePicker.tsx           # åœ–ç‰‡é¸æ“‡å™¨
â”‚   â”œâ”€â”€ ContentItemWithImage.tsx  # åœ–ç‰‡ + æ–‡å­—è¼¸å…¥
â”‚   â”œâ”€â”€ ImageGallery.tsx          # åœ–ç‰‡åº«
â”‚   â”œâ”€â”€ ImageEditor.tsx           # åœ–ç‰‡ç·¨è¼¯å™¨
â”‚   â”œâ”€â”€ ImageUploader.tsx         # åœ–ç‰‡ä¸Šå‚³å™¨
â”‚   â””â”€â”€ ImagePreview.tsx          # åœ–ç‰‡é è¦½

lib/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ upload.ts                 # ä¸Šå‚³å·¥å…·
â”‚   â”œâ”€â”€ optimize.ts               # åœ–ç‰‡å„ªåŒ–
â”‚   â”œâ”€â”€ validate.ts               # åœ–ç‰‡é©—è­‰
â”‚   â””â”€â”€ unsplash.ts               # Unsplash å®¢æˆ¶ç«¯

prisma/
â””â”€â”€ schema.prisma                 # æ•¸æ“šæ¨¡å‹
```

---

## âš ï¸ é¢¨éšªç®¡ç†

### ä¸»è¦é¢¨éšª

| é¢¨éšª | å½±éŸ¿ | æ¦‚ç‡ | ç·©è§£æªæ–½ |
|------|------|------|----------|
| æˆæœ¬è¶…æ”¯ | é«˜ | ä¸­ | æˆæœ¬ç›£æ§ + åœ–ç‰‡å£“ç¸® + CDN å„ªåŒ– |
| æ€§èƒ½å•é¡Œ | ä¸­ | ä¸­ | æ‡¶åŠ è¼‰ + é åŠ è¼‰ + CDN ç·©å­˜ |
| Unsplash é¡åº¦è¶…é™ | ä¸­ | ä½ | ç›£æ§ä½¿ç”¨é‡ + å‚™ç”¨æ–¹æ¡ˆ |
| å­˜å„²ç©ºé–“ä¸è¶³ | ä¸­ | ä½ | å®šæœŸæ¸…ç† + ç”¨æˆ¶é…é¡ |
| å®‰å…¨æ¼æ´ | é«˜ | ä½ | å®Œæ•´é©—è­‰ + XSS é˜²è­· + CORS |

### æˆæœ¬æ§åˆ¶ç­–ç•¥

1. **è¨­ç½®ç”¨æˆ¶é…é¡**
   - æ¯ç”¨æˆ¶æœ€å¤š 100 å¼µåœ–ç‰‡
   - å–®å¼µåœ–ç‰‡æœ€å¤§ 10MB
   - ç¸½å­˜å„²é…é¡ 30MB/ç”¨æˆ¶

2. **è‡ªå‹•æ¸…ç†æ©Ÿåˆ¶**
   - åˆªé™¤ 90 å¤©æœªä½¿ç”¨çš„åœ–ç‰‡
   - åˆªé™¤æœªé—œè¯æ´»å‹•çš„åœ–ç‰‡
   - ç”¨æˆ¶ç¢ºèªå¾Œåˆªé™¤

3. **æˆæœ¬è­¦å ±**
   - è¨­ç½® Vercel æˆæœ¬è­¦å ±ï¼ˆ$100/æœˆï¼‰
   - ç›£æ§ Unsplash API ä½¿ç”¨é‡
   - æ¯é€±æˆæœ¬å ±å‘Š

---

## âœ… é©—æ”¶æ¨™æº–

### åŠŸèƒ½é©—æ”¶

- [ ] åœ–ç‰‡ä¸Šå‚³åŠŸèƒ½æ­£å¸¸ï¼ˆæœ¬åœ°ä¸Šå‚³ï¼‰
- [ ] åœ–ç‰‡æœç´¢åŠŸèƒ½æ­£å¸¸ï¼ˆUnsplashï¼‰
- [ ] åœ–ç‰‡é¸æ“‡å™¨æ­£å¸¸å·¥ä½œ
- [ ] åœ–ç‰‡ + æ–‡å­—è¼¸å…¥æ­£å¸¸
- [ ] åœ–ç‰‡ç·¨è¼¯åŠŸèƒ½æ­£å¸¸
- [ ] å€‹äººåœ–ç‰‡åº«æ­£å¸¸
- [ ] æ¨™ç±¤ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] è‡ªå‹•ä¿å­˜åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½é©—æ”¶

- [ ] åœ–ç‰‡ä¸Šå‚³æ™‚é–“ < 3sï¼ˆ5MB åœ–ç‰‡ï¼‰
- [ ] åœ–ç‰‡åŠ è¼‰æ™‚é–“ < 500ms
- [ ] æœç´¢éŸ¿æ‡‰æ™‚é–“ < 1s
- [ ] CDN ç·©å­˜å‘½ä¸­ç‡ > 80%
- [ ] é¦–å±åŠ è¼‰æ™‚é–“ < 2s

### å®‰å…¨é©—æ”¶

- [ ] XSS é˜²è­·æ¸¬è©¦é€šé
- [ ] æ–‡ä»¶é¡å‹é©—è­‰é€šé
- [ ] æ–‡ä»¶å¤§å°é™åˆ¶é€šé
- [ ] ç”¨æˆ¶æ¬Šé™æª¢æŸ¥é€šé
- [ ] CORS é…ç½®æ­£ç¢º

### å¯è¨ªå•æ€§é©—æ”¶

- [ ] éµç›¤å°èˆªæ¸¬è©¦é€šé
- [ ] å±å¹•é–±è®€å™¨æ¸¬è©¦é€šé
- [ ] é¡è‰²å°æ¯”åº¦æ¸¬è©¦é€šéï¼ˆWCAG AAï¼‰
- [ ] ç„¦é»æŒ‡ç¤ºå™¨æ¸…æ™°å¯è¦‹

### æˆæœ¬é©—æ”¶

- [ ] æœˆæˆæœ¬ < $100
- [ ] æˆæœ¬è­¦å ±è¨­ç½®å®Œæˆ
- [ ] ä½¿ç”¨é‡ç›£æ§æ­£å¸¸
- [ ] Unsplash API åœ¨å…è²»é¡åº¦å…§

---

## ğŸ“š åƒè€ƒè³‡æº

### å®˜æ–¹æ–‡æª”
- [Vercel Blob æ–‡æª”](https://vercel.com/docs/storage/vercel-blob)
- [Neon æ–‡æª”](https://neon.tech/docs)
- [Unsplash API æ–‡æª”](https://unsplash.com/documentation)
- [Prisma æ–‡æª”](https://www.prisma.io/docs)

### ç›¸é—œåˆ†ææ–‡æª”
- [Wordwall åœ–ç‰‡åŠŸèƒ½æ·±åº¦åˆ†æ](./wordwall-analysis-deep-dive.md)
- [EduCreate åœ–ç‰‡å­˜å„²ç¾ç‹€åˆ†æ](./educreate-image-storage-analysis.md)
- [Vercel Blob + Neon å¯¦æ–½è¨ˆç•«](./vercel-blob-neon-implementation-plan.md)

### å·¥å…·å’Œåº«
- [sharp](https://sharp.pixelplumbing.com/) - åœ–ç‰‡è™•ç†
- [react-dropzone](https://react-dropzone.js.org/) - æ‹–æ”¾ä¸Šå‚³
- [react-image-crop](https://www.npmjs.com/package/react-image-crop) - åœ–ç‰‡è£å‰ª
- [DOMPurify](https://github.com/cure53/DOMPurify) - XSS é˜²è­·

---

**æº–å‚™å¥½é–‹å§‹äº†å—ï¼Ÿ**

1. é–±è®€å®Œæ•´å¯¦æ–½è¨ˆç•«
2. ç¢ºèªåœ˜éšŠè³‡æºï¼ˆ6-8 é€±ï¼‰
3. ç¢ºèªé ç®—ï¼ˆ$42-100/æœˆï¼‰
4. é–‹å§‹ Phase 1ï¼

**é ä¼°å®Œæˆæ™‚é–“ï¼š6-8 é€±** ğŸ‰

