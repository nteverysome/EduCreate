# ğŸ§® SuperMemo SM-2 ç®—æ³•å¯¦ç¾è©³è§£

## ğŸ“‹ ç›®éŒ„
1. [ç®—æ³•æ¦‚è¿°](#ç®—æ³•æ¦‚è¿°)
2. [æ ¸å¿ƒåƒæ•¸](#æ ¸å¿ƒåƒæ•¸)
3. [ç®—æ³•å…¬å¼](#ç®—æ³•å…¬å¼)
4. [å¯¦ç¾ä»£ç¢¼](#å¯¦ç¾ä»£ç¢¼)
5. [å¯¦éš›ä¾‹å­](#å¯¦éš›ä¾‹å­)
6. [å„ªåŒ–å»ºè­°](#å„ªåŒ–å»ºè­°)

---

## ç®—æ³•æ¦‚è¿°

### ä»€éº¼æ˜¯ SM-2?
SuperMemo SM-2 æ˜¯ç”±æ³¢è˜­ç§‘å­¸å®¶ Piotr WoÅºniak åœ¨ 1987 å¹´ç™¼æ˜çš„é–“éš”é‡è¤‡ç®—æ³•ã€‚

### æ ¸å¿ƒæ€æƒ³
åœ¨è¨˜æ†¶å³å°‡éºå¿˜å‰å®‰æ’è¤‡ç¿’,æœ€å¤§åŒ–è¨˜æ†¶ä¿æŒç‡ã€‚

### éºå¿˜æ›²ç·š
```
è¨˜æ†¶å¼·åº¦
100% â”‚ â—
     â”‚  â•²
     â”‚   â•²
 80% â”‚    â—â”€â”€â”€â”€â”€â”€â”€â”€â—
     â”‚     â•²        â•²
     â”‚      â•²        â•²
 60% â”‚       â—â”€â”€â”€â”€â”€â”€â”€â”€â—
     â”‚        â•²        â•²
     â”‚         â•²        â•²
 40% â”‚          â—â”€â”€â”€â”€â”€â”€â”€â”€â—
     â”‚           â•²        â•²
     â”‚            â•²        â•²
 20% â”‚             â—â”€â”€â”€â”€â”€â”€â”€â”€â—
     â”‚              â•²        â•²
  0% â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ™‚é–“
     å­¸ç¿’  1å¤©  6å¤©  15å¤©  30å¤©  60å¤©
           â†‘    â†‘    â†‘     â†‘     â†‘
         è¤‡ç¿’1 è¤‡ç¿’2 è¤‡ç¿’3  è¤‡ç¿’4  è¤‡ç¿’5
```

---

## æ ¸å¿ƒåƒæ•¸

### 1. Ease Factor (EF) - é›£åº¦ä¿‚æ•¸

#### å®šç¾©
è¡¨ç¤ºå–®å­—çš„è¨˜æ†¶é›£åº¦ã€‚

#### ç¯„åœ
- æœ€å°å€¼: 1.3
- æœ€å¤§å€¼: 2.5
- é è¨­å€¼: 2.5

#### æ„ç¾©
- EF è¶Šé«˜ = è¶Šå®¹æ˜“è¨˜ä½ = è¤‡ç¿’é–“éš”æ‹‰é•·è¶Šå¿«
- EF è¶Šä½ = è¶Šé›£è¨˜ä½ = è¤‡ç¿’é–“éš”æ‹‰é•·è¶Šæ…¢

#### æ›´æ–°è¦å‰‡
```
ç­”å°: EF = EF + 0.1 (æœ€å¤§ 2.5)
ç­”éŒ¯: EF = EF - 0.2 (æœ€å° 1.3)
```

#### ä¾‹å­
```
å®¹æ˜“çš„å–®å­— (cat, dog):
- åˆå§‹ EF = 2.5
- ç­”å° 5 æ¬¡å¾Œ EF = 2.5 (å·²é”ä¸Šé™)
- è¤‡ç¿’é–“éš”: 1 â†’ 6 â†’ 15 â†’ 37 â†’ 92 å¤©

å›°é›£çš„å–®å­— (phenomenon):
- åˆå§‹ EF = 2.5
- ç­”éŒ¯ 3 æ¬¡å¾Œ EF = 1.9
- ç­”å° 5 æ¬¡å¾Œ EF = 2.4
- è¤‡ç¿’é–“éš”: 1 â†’ 6 â†’ 14 â†’ 33 â†’ 79 å¤©
```

---

### 2. Interval (I) - è¤‡ç¿’é–“éš”

#### å®šç¾©
è·é›¢ä¸Šæ¬¡è¤‡ç¿’çš„å¤©æ•¸ã€‚

#### ç¯„åœ
- æœ€å°å€¼: 1 å¤©
- æœ€å¤§å€¼: ç„¡é™åˆ¶ (å¯¦éš›ä¸Šé€šå¸¸ä¸è¶…é 1 å¹´)

#### è¨ˆç®—è¦å‰‡
```
ç¬¬ 1 æ¬¡ç­”å°: I = 1 å¤©
ç¬¬ 2 æ¬¡ç­”å°: I = 6 å¤©
ç¬¬ 3+ æ¬¡ç­”å°: I = I Ã— EF
ç­”éŒ¯: I = 1 å¤© (é‡ç½®)
```

#### ä¾‹å­
```
EF = 2.5 çš„å–®å­—:
- ç¬¬ 1 æ¬¡ç­”å°: I = 1 å¤©
- ç¬¬ 2 æ¬¡ç­”å°: I = 6 å¤©
- ç¬¬ 3 æ¬¡ç­”å°: I = 6 Ã— 2.5 = 15 å¤©
- ç¬¬ 4 æ¬¡ç­”å°: I = 15 Ã— 2.5 = 37.5 â‰ˆ 38 å¤©
- ç¬¬ 5 æ¬¡ç­”å°: I = 38 Ã— 2.5 = 95 å¤©

EF = 1.5 çš„å–®å­—:
- ç¬¬ 1 æ¬¡ç­”å°: I = 1 å¤©
- ç¬¬ 2 æ¬¡ç­”å°: I = 6 å¤©
- ç¬¬ 3 æ¬¡ç­”å°: I = 6 Ã— 1.5 = 9 å¤©
- ç¬¬ 4 æ¬¡ç­”å°: I = 9 Ã— 1.5 = 13.5 â‰ˆ 14 å¤©
- ç¬¬ 5 æ¬¡ç­”å°: I = 14 Ã— 1.5 = 21 å¤©
```

---

### 3. Repetitions (n) - é€£çºŒæ­£ç¢ºæ¬¡æ•¸

#### å®šç¾©
é€£çºŒç­”å°çš„æ¬¡æ•¸ã€‚

#### ç¯„åœ
- æœ€å°å€¼: 0
- æœ€å¤§å€¼: ç„¡é™åˆ¶

#### æ›´æ–°è¦å‰‡
```
ç­”å°: n = n + 1
ç­”éŒ¯: n = 0 (é‡ç½®)
```

#### æ„ç¾©
- n = 0: å‰›å­¸ç¿’æˆ–ç­”éŒ¯
- n = 1-2: çŸ­æœŸè¨˜æ†¶
- n = 3-4: ä¸­æœŸè¨˜æ†¶
- n â‰¥ 5: é•·æœŸè¨˜æ†¶ (å¯èƒ½å·²æŒæ¡)

---

### 4. Memory Strength (MS) - è¨˜æ†¶å¼·åº¦

#### å®šç¾©
è¡¨ç¤ºå°å–®å­—çš„è¨˜æ†¶ç¨‹åº¦ (é SM-2 åŸå§‹åƒæ•¸,æˆ‘å€‘æ–°å¢çš„)ã€‚

#### ç¯„åœ
- æœ€å°å€¼: 0 (å®Œå…¨å¿˜è¨˜)
- æœ€å¤§å€¼: 100 (å®Œå…¨è¨˜ä½)
- é è¨­å€¼: 0

#### æ›´æ–°è¦å‰‡
```
ç­”å°: MS = MS + 10 (æœ€å¤§ 100)
ç­”éŒ¯: MS = MS - 20 (æœ€å° 0)
```

#### ç”¨é€”
- ç”¨æ–¼ UI é¡¯ç¤º
- ç”¨æ–¼åˆ¤æ–·æ˜¯å¦å·²æŒæ¡
- ç”¨æ–¼è¨ˆç®—è¤‡ç¿’å„ªå…ˆç´š

---

## ç®—æ³•å…¬å¼

### å®Œæ•´å…¬å¼

#### ç•¶ç­”å°æ™‚ (Quality â‰¥ 3)
```
1. n = n + 1

2. if n = 1:
     I = 1
   else if n = 2:
     I = 6
   else:
     I = I Ã— EF

3. EF = EF + 0.1
   EF = min(EF, 2.5)

4. MS = MS + 10
   MS = min(MS, 100)

5. NextReview = Today + I å¤©
```

#### ç•¶ç­”éŒ¯æ™‚ (Quality < 3)
```
1. n = 0

2. I = 1

3. EF = EF - 0.2
   EF = max(EF, 1.3)

4. MS = MS - 20
   MS = max(MS, 0)

5. NextReview = Today + 1 å¤©
```

---

## å¯¦ç¾ä»£ç¢¼

### TypeScript ç‰ˆæœ¬

```typescript
// lib/srs/sm2.ts

interface SM2Progress {
  repetitions: number;      // n
  interval: number;         // I
  easeFactor: number;       // EF
  memoryStrength: number;   // MS
  nextReviewAt: Date;
  status: 'NEW' | 'LEARNING' | 'REVIEWING' | 'MASTERED';
}

/**
 * SuperMemo SM-2 ç®—æ³•
 * @param progress ç•¶å‰é€²åº¦
 * @param isCorrect æ˜¯å¦ç­”å°
 * @returns æ›´æ–°å¾Œçš„é€²åº¦
 */
export function updateWithSM2(
  progress: SM2Progress,
  isCorrect: boolean
): SM2Progress {
  let {
    repetitions,
    interval,
    easeFactor,
    memoryStrength
  } = progress;
  
  if (isCorrect) {
    // ===== ç­”å° =====
    
    // 1. å¢åŠ é€£çºŒæ­£ç¢ºæ¬¡æ•¸
    repetitions += 1;
    
    // 2. è¨ˆç®—æ–°çš„è¤‡ç¿’é–“éš”
    if (repetitions === 1) {
      interval = 1;  // 1 å¤©å¾Œè¤‡ç¿’
    } else if (repetitions === 2) {
      interval = 6;  // 6 å¤©å¾Œè¤‡ç¿’
    } else {
      interval = Math.round(interval * easeFactor);
    }
    
    // 3. å¢åŠ é›£åº¦ä¿‚æ•¸ (æœ€å¤§ 2.5)
    easeFactor = Math.min(2.5, easeFactor + 0.1);
    
    // 4. å¢åŠ è¨˜æ†¶å¼·åº¦ (æœ€å¤§ 100)
    memoryStrength = Math.min(100, memoryStrength + 10);
    
  } else {
    // ===== ç­”éŒ¯ =====
    
    // 1. é‡ç½®é€£çºŒæ­£ç¢ºæ¬¡æ•¸
    repetitions = 0;
    
    // 2. é‡ç½®è¤‡ç¿’é–“éš”
    interval = 1;  // æ˜å¤©å†è¤‡ç¿’
    
    // 3. é™ä½é›£åº¦ä¿‚æ•¸ (æœ€å° 1.3)
    easeFactor = Math.max(1.3, easeFactor - 0.2);
    
    // 4. é™ä½è¨˜æ†¶å¼·åº¦ (æœ€å° 0)
    memoryStrength = Math.max(0, memoryStrength - 20);
  }
  
  // 5. è¨ˆç®—ä¸‹æ¬¡è¤‡ç¿’æ™‚é–“
  const nextReviewAt = new Date();
  nextReviewAt.setDate(nextReviewAt.getDate() + interval);
  
  // 6. æ›´æ–°å­¸ç¿’ç‹€æ…‹
  let status: 'NEW' | 'LEARNING' | 'REVIEWING' | 'MASTERED';
  if (repetitions === 0) {
    status = 'LEARNING';
  } else if (memoryStrength >= 80 && repetitions >= 5) {
    status = 'MASTERED';
  } else {
    status = 'REVIEWING';
  }
  
  return {
    repetitions,
    interval,
    easeFactor,
    memoryStrength,
    nextReviewAt,
    status
  };
}

/**
 * æ ¹æ“šç­”é¡Œçµæœè¨ˆç®—è³ªé‡åˆ†æ•¸
 * @param isCorrect æ˜¯å¦ç­”å°
 * @param responseTime åæ‡‰æ™‚é–“ (æ¯«ç§’)
 * @returns è³ªé‡åˆ†æ•¸ (0-5)
 */
export function calculateQuality(
  isCorrect: boolean,
  responseTime: number
): number {
  if (!isCorrect) {
    return 0;  // å®Œå…¨å¿˜è¨˜
  }
  
  // æ ¹æ“šåæ‡‰æ™‚é–“è¨ˆç®—è³ªé‡
  if (responseTime < 2000) {
    return 5;  // å®Œç¾è¨˜ä½ (< 2 ç§’)
  } else if (responseTime < 4000) {
    return 4;  // æ­£ç¢ºä½†æœ‰é»çŒ¶è±« (2-4 ç§’)
  } else {
    return 3;  // æ­£ç¢ºä½†å¾ˆå›°é›£ (> 4 ç§’)
  }
}
```

---

### JavaScript ç‰ˆæœ¬ (Phaser 3)

```javascript
// public/games/shimozurdo-game/utils/sm2.js

class SM2 {
  /**
   * æ›´æ–°å­¸ç¿’é€²åº¦
   * @param {Object} progress - ç•¶å‰é€²åº¦
   * @param {boolean} isCorrect - æ˜¯å¦ç­”å°
   * @returns {Object} æ›´æ–°å¾Œçš„é€²åº¦
   */
  static update(progress, isCorrect) {
    let { repetitions, interval, easeFactor, memoryStrength } = progress;
    
    if (isCorrect) {
      // ç­”å°
      repetitions += 1;
      
      if (repetitions === 1) {
        interval = 1;
      } else if (repetitions === 2) {
        interval = 6;
      } else {
        interval = Math.round(interval * easeFactor);
      }
      
      easeFactor = Math.min(2.5, easeFactor + 0.1);
      memoryStrength = Math.min(100, memoryStrength + 10);
      
    } else {
      // ç­”éŒ¯
      repetitions = 0;
      interval = 1;
      easeFactor = Math.max(1.3, easeFactor - 0.2);
      memoryStrength = Math.max(0, memoryStrength - 20);
    }
    
    // è¨ˆç®—ä¸‹æ¬¡è¤‡ç¿’æ™‚é–“
    const nextReviewAt = new Date();
    nextReviewAt.setTime(nextReviewAt.getTime() + interval * 24 * 60 * 60 * 1000);
    
    // æ›´æ–°ç‹€æ…‹
    let status;
    if (repetitions === 0) {
      status = 'LEARNING';
    } else if (memoryStrength >= 80 && repetitions >= 5) {
      status = 'MASTERED';
    } else {
      status = 'REVIEWING';
    }
    
    return {
      repetitions,
      interval,
      easeFactor,
      memoryStrength,
      nextReviewAt,
      status
    };
  }
  
  /**
   * è¨ˆç®—è³ªé‡åˆ†æ•¸
   * @param {boolean} isCorrect - æ˜¯å¦ç­”å°
   * @param {number} responseTime - åæ‡‰æ™‚é–“ (æ¯«ç§’)
   * @returns {number} è³ªé‡åˆ†æ•¸ (0-5)
   */
  static calculateQuality(isCorrect, responseTime) {
    if (!isCorrect) return 0;
    
    if (responseTime < 2000) return 5;
    if (responseTime < 4000) return 4;
    return 3;
  }
}

// å°å‡º
if (typeof module !== 'undefined' && module.exports) {
  module.exports = SM2;
}
```

---

## å¯¦éš›ä¾‹å­

### ä¾‹å­ 1: å®¹æ˜“çš„å–®å­— "apple"

#### åˆå§‹ç‹€æ…‹
```
n = 0
I = 0
EF = 2.5
MS = 0
```

#### ç¬¬ 1 æ¬¡å­¸ç¿’ (Day 0) - ç­”å° âœ…
```
n = 0 + 1 = 1
I = 1 å¤©
EF = 2.5 + 0.1 = 2.5 (å·²é”ä¸Šé™)
MS = 0 + 10 = 10
NextReview = Day 1
```

#### ç¬¬ 2 æ¬¡è¤‡ç¿’ (Day 1) - ç­”å° âœ…
```
n = 1 + 1 = 2
I = 6 å¤©
EF = 2.5 (å·²é”ä¸Šé™)
MS = 10 + 10 = 20
NextReview = Day 7
```

#### ç¬¬ 3 æ¬¡è¤‡ç¿’ (Day 7) - ç­”å° âœ…
```
n = 2 + 1 = 3
I = 6 Ã— 2.5 = 15 å¤©
EF = 2.5 (å·²é”ä¸Šé™)
MS = 20 + 10 = 30
NextReview = Day 22
```

#### ç¬¬ 4 æ¬¡è¤‡ç¿’ (Day 22) - ç­”å° âœ…
```
n = 3 + 1 = 4
I = 15 Ã— 2.5 = 37.5 â‰ˆ 38 å¤©
EF = 2.5 (å·²é”ä¸Šé™)
MS = 30 + 10 = 40
NextReview = Day 60
```

#### ç¬¬ 5 æ¬¡è¤‡ç¿’ (Day 60) - ç­”å° âœ…
```
n = 4 + 1 = 5
I = 38 Ã— 2.5 = 95 å¤©
EF = 2.5 (å·²é”ä¸Šé™)
MS = 40 + 10 = 50
NextReview = Day 155
Status = REVIEWING
```

#### ç¬¬ 10 æ¬¡è¤‡ç¿’ - ç­”å° âœ…
```
n = 9 + 1 = 10
I = å¾ˆé•· (å¹¾å€‹æœˆ)
EF = 2.5
MS = 90 + 10 = 100
Status = MASTERED ğŸ‰
```

---

### ä¾‹å­ 2: å›°é›£çš„å–®å­— "phenomenon"

#### åˆå§‹ç‹€æ…‹
```
n = 0
I = 0
EF = 2.5
MS = 0
```

#### ç¬¬ 1 æ¬¡å­¸ç¿’ (Day 0) - ç­”éŒ¯ âŒ
```
n = 0
I = 1 å¤©
EF = 2.5 - 0.2 = 2.3
MS = 0 - 20 = 0 (å·²é”ä¸‹é™)
NextReview = Day 1
```

#### ç¬¬ 2 æ¬¡è¤‡ç¿’ (Day 1) - ç­”éŒ¯ âŒ
```
n = 0
I = 1 å¤©
EF = 2.3 - 0.2 = 2.1
MS = 0 (å·²é”ä¸‹é™)
NextReview = Day 2
```

#### ç¬¬ 3 æ¬¡è¤‡ç¿’ (Day 2) - ç­”å° âœ…
```
n = 0 + 1 = 1
I = 1 å¤©
EF = 2.1 + 0.1 = 2.2
MS = 0 + 10 = 10
NextReview = Day 3
```

#### ç¬¬ 4 æ¬¡è¤‡ç¿’ (Day 3) - ç­”å° âœ…
```
n = 1 + 1 = 2
I = 6 å¤©
EF = 2.2 + 0.1 = 2.3
MS = 10 + 10 = 20
NextReview = Day 9
```

#### ç¬¬ 5 æ¬¡è¤‡ç¿’ (Day 9) - ç­”å° âœ…
```
n = 2 + 1 = 3
I = 6 Ã— 2.3 = 13.8 â‰ˆ 14 å¤©
EF = 2.3 + 0.1 = 2.4
MS = 20 + 10 = 30
NextReview = Day 23
```

---

## å„ªåŒ–å»ºè­°

### 1. å‹•æ…‹èª¿æ•´åƒæ•¸

#### å•é¡Œ
ä¸åŒç”¨æˆ¶çš„è¨˜æ†¶èƒ½åŠ›ä¸åŒ,å›ºå®šåƒæ•¸å¯èƒ½ä¸é©åˆæ‰€æœ‰äººã€‚

#### è§£æ±ºæ–¹æ¡ˆ
æ ¹æ“šç”¨æˆ¶çš„æ•´é«”è¡¨ç¾å‹•æ…‹èª¿æ•´åƒæ•¸ã€‚

```typescript
function adjustParameters(userStats: UserStats) {
  const overallAccuracy = userStats.correctReviews / userStats.totalReviews;
  
  if (overallAccuracy > 0.9) {
    // ç”¨æˆ¶è¨˜æ†¶åŠ›å¾ˆå¥½,å¯ä»¥æ‹‰é•·é–“éš”
    return {
      initialEF: 2.7,
      intervalMultiplier: 1.2
    };
  } else if (overallAccuracy < 0.7) {
    // ç”¨æˆ¶è¨˜æ†¶åŠ›è¼ƒå¼±,ç¸®çŸ­é–“éš”
    return {
      initialEF: 2.3,
      intervalMultiplier: 0.8
    };
  } else {
    // æ¨™æº–åƒæ•¸
    return {
      initialEF: 2.5,
      intervalMultiplier: 1.0
    };
  }
}
```

---

### 2. è€ƒæ…®éºå¿˜æ›²ç·š

#### å•é¡Œ
SM-2 å‡è¨­éºå¿˜æ›²ç·šæ˜¯å›ºå®šçš„,ä½†å¯¦éš›ä¸Šæ¯å€‹äººçš„éºå¿˜é€Ÿåº¦ä¸åŒã€‚

#### è§£æ±ºæ–¹æ¡ˆ
è¿½è¹¤ç”¨æˆ¶çš„å¯¦éš›éºå¿˜æ›²ç·š,å‹•æ…‹èª¿æ•´è¤‡ç¿’æ™‚é–“ã€‚

```typescript
function calculateOptimalInterval(
  progress: SM2Progress,
  userForgettingCurve: ForgettingCurve
): number {
  const baseInterval = progress.interval;
  const forgettingRate = userForgettingCurve.getRateForWord(progress.wordId);
  
  // æ ¹æ“šéºå¿˜é€Ÿåº¦èª¿æ•´é–“éš”
  return Math.round(baseInterval * (1 / forgettingRate));
}
```

---

### 3. æ‰¹é‡è¤‡ç¿’å„ªåŒ–

#### å•é¡Œ
å¦‚æœæœ‰å¾ˆå¤šå–®å­—éœ€è¦è¤‡ç¿’,ç”¨æˆ¶å¯èƒ½æœƒæ„Ÿåˆ°å£“åŠ›ã€‚

#### è§£æ±ºæ–¹æ¡ˆ
é™åˆ¶æ¯å¤©çš„è¤‡ç¿’æ•¸é‡,å„ªå…ˆè¤‡ç¿’æœ€é‡è¦çš„å–®å­—ã€‚

```typescript
function selectWordsForToday(
  dueWords: UserWordProgress[],
  maxWords: number = 20
): UserWordProgress[] {
  // æŒ‰å„ªå…ˆç´šæ’åº
  const sorted = dueWords.sort((a, b) => {
    const priorityA = calculatePriority(a);
    const priorityB = calculatePriority(b);
    return priorityB - priorityA;
  });
  
  // åªé¸æ“‡å‰ N å€‹
  return sorted.slice(0, maxWords);
}
```

---

## åƒè€ƒè³‡æº

### å®˜æ–¹æ–‡æª”
- [SuperMemo å®˜ç¶²](https://www.supermemo.com/)
- [SM-2 ç®—æ³•åŸæ–‡](https://www.supermemo.com/en/archives1990-2015/english/ol/sm2)

### å­¸è¡“è«–æ–‡
- WoÅºniak, P. A. (1990). "Optimization of learning"
- Ebbinghaus, H. (1885). "Memory: A Contribution to Experimental Psychology"

### é–‹æºå¯¦ç¾
- [Anki](https://github.com/ankitects/anki)
- [Anki Algorithm](https://faqs.ankiweb.net/what-spaced-repetition-algorithm.html)

