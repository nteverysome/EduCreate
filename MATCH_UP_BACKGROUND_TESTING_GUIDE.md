# Match-Up Game 背景圖片修復 - 測試指南

## 修改概述
已修改 `public/games/match-up-game/scenes/preload.js` 以支持動態加載背景圖片。新上傳的背景圖片現在會覆蓋舊的背景。

## 快速測試步驟

### 步驟 1: 準備新的背景圖片
- 準備一張新的背景圖片（PNG、JPEG 或 WebP 格式）
- 建議尺寸：1920x1080 或更大
- 確保圖片清晰可見，便於驗證

### 步驟 2: 上傳新背景
1. 訪問 `https://edu-create.vercel.app/admin/visual-styles`
2. 確保選擇 "雲朵" 視覺風格
3. 找到 "背景圖片" 欄位
4. 點擊上傳或拖放新的背景圖片
5. 等待上傳完成（應該看到 ✅ 上傳成功消息）

### 步驟 3: 驗證背景已更新
1. 訪問 match-up-game 頁面
2. 打開瀏覽器開發者工具（F12）
3. 切換到 "控制台" 標籤
4. 查看是否有以下日誌：
   ```
   🎨 PreloadScene: 從視覺風格資源加載背景圖片 https://...
   ✅ PreloadScene: 視覺風格背景圖片加載完成
   ```

### 步驟 4: 視覺驗證
- 遊戲應該顯示新上傳的背景圖片
- 背景應該完全覆蓋遊戲區域
- 舊的背景圖片應該不再出現

## 預期行為

### 成功情況
- 新背景圖片在遊戲中顯示
- 控制台顯示成功加載日誌
- 刷新頁面後，新背景仍然顯示

### 備用方案
如果上傳的背景無法加載，遊戲會自動使用備用背景：
- 控制台會顯示警告：`⚠️ PreloadScene: 視覺風格背景圖片加載失敗，使用備用背景`
- 遊戲會顯示默認的中世紀背景圖片

## 故障排除

### 問題 1: 新背景沒有出現
**解決方案：**
1. 清除瀏覽器緩存（Ctrl+Shift+Delete）
2. 硬刷新頁面（Ctrl+F5）
3. 檢查開發者工具中的網絡標籤，確認新背景 URL 已加載
4. 確認上傳時選擇了正確的視覺風格（雲朵）

### 問題 2: 控制台顯示加載失敗
**解決方案：**
1. 檢查上傳的圖片格式是否正確（PNG、JPEG、WebP）
2. 檢查圖片文件大小是否過大
3. 檢查網絡連接是否正常
4. 嘗試重新上傳圖片

### 問題 3: 遊戲顯示白屏
**解決方案：**
1. 這是備用方案觸發，表示背景加載失敗
2. 檢查開發者工具中的錯誤信息
3. 嘗試上傳不同的背景圖片
4. 確認 Blob Storage 連接正常

## 技術細節

### 資源類型
- **ID**: `bg_layer`
- **顯示名稱**: "背景圖片"
- **支持格式**: PNG, JPEG, WebP

### 加載流程
1. PreloadScene 調用 `loadVisualStyleResources()`
2. 從 API 獲取視覺風格資源列表
3. 查找 `bg_layer` 資源
4. 使用新的 URL 加載背景圖片
5. GameScene 使用已加載的紋理顯示背景

### 緩存破壞
API 返回的 URL 包含時間戳參數，確保瀏覽器不會使用舊的緩存版本。

## 相關文件
- `public/games/match-up-game/scenes/preload.js` - 修改的主要文件
- `app/admin/visual-styles/page.tsx` - 上傳頁面
- `app/api/visual-styles/resources/route.ts` - 資源 API

## 支持
如果遇到問題，請檢查：
1. 開發者工具中的控制台日誌
2. 網絡標籤中的 API 請求
3. 上傳的圖片格式和大小

