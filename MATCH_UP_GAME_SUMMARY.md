# Match-up 遊戲完整總結文檔

## 📋 目錄
1. [遊戲概述](#遊戲概述)
2. [功能特性](#功能特性)
3. [佈局模式](#佈局模式)
4. [卡片內容組合](#卡片內容組合)
5. [遊戲機制](#遊戲機制)
6. [語音功能實現](#語音功能實現)
7. [技術架構](#技術架構)
8. [已知問題](#已知問題)

---

## 遊戲概述

**Match-up 遊戲** 是 EduCreate 平台上的一款記憶科學驅動的配對遊戲，基於 Phaser 3 遊戲引擎開發。

### 核心目標
- 幫助學生通過配對練習加強詞彙記憶
- 支援多種內容組合（文字、圖片、語音）
- 提供響應式設計，適配各種設備

### 遊戲流程
1. 用戶進入遊戲頁面
2. 系統加載詞彙數據
3. 根據佈局模式創建卡片
4. 用戶拖動英文卡片到中文框進行配對
5. 系統檢查配對結果
6. 完成所有配對後提交答案
7. 系統評分並記錄學習數據

---

## 功能特性

### ✅ 已實現功能

| 功能 | 狀態 | 說明 |
|------|------|------|
| 混合佈局 | ✅ | 英文卡片和中文框混合排列 |
| 分離佈局 | ✅ | 左右分離的傳統配對模式 |
| 圖片顯示 | ✅ | 支援 1:1 正方形圖片 |
| 文字顯示 | ✅ | 支援英文和中文文字 |
| 語音播放 | ✅ | 支援語音按鈕播放 |
| 拖放交互 | ✅ | 支援卡片拖放配對 |
| 分頁功能 | ✅ | 支援多頁卡片 |
| 響應式設計 | ✅ | 適配桌面和移動設備 |
| 計時器 | ✅ | 支援正向和倒數計時 |
| 動畫效果 | ✅ | 卡片移動和狀態變化動畫 |

---

## 佈局模式

### 1. 混合佈局（Mixed Layout）
- **特點**：英文卡片和中文框混合排列在同一區域
- **適用場景**：移動設備、小屏幕
- **卡片排列**：網格式排列
- **交互方式**：拖動英文卡片到中文框進行配對

### 2. 分離佈局（Separated Layout）
- **特點**：左側英文卡片，右側中文框分離排列
- **適用場景**：桌面設備、大屏幕
- **卡片排列**：左右兩列
- **交互方式**：拖動左側卡片到右側框進行配對

---

## 卡片內容組合

### 五種卡片內容組合情況

#### 情況 A：圖片 + 文字 + 語音按鈕 ⭐ 最常見
```
┌─────────────────┐
│   🔊 按鈕(30%)  │  語音按鈕區域
├─────────────────┤
│   圖片(40%)     │  圖片區域（1:1 正方形）
├─────────────────┤
│   文字(30%)     │  英文文字區域
└─────────────────┘
```
- **語音按鈕**：位於卡片頂部，大小 20-40px，綠色背景
- **圖片**：中間區域，保持 1:1 正方形比例
- **文字**：底部區域，只有有效文字才顯示

#### 情況 B：只有語音按鈕
```
┌─────────────────┐
│                 │
│   🔊 按鈕(40%)  │  語音按鈕置中
│                 │
└─────────────────┘
```

#### 情況 C：只有文字
```
┌─────────────────┐
│                 │
│   文字(100%)    │  文字置中
│                 │
└─────────────────┘
```

#### 情況 D：圖片 + 文字
```
┌─────────────────┐
│   圖片(90%)     │
├─────────────────┤
│   文字(10%)     │
└─────────────────┘
```

#### 情況 E：語音按鈕 + 文字
```
┌─────────────────┐
│   🔊 按鈕(60%)  │
├─────────────────┤
│   文字(40%)     │
└─────────────────┘
```

---

## 遊戲機制

### 配對邏輯
1. **拖放檢測**：監測卡片拖放到框的位置
2. **配對判定**：無論對錯都允許進入框（延遲檢查）
3. **視覺反饋**：卡片移動到框的位置
4. **狀態管理**：記錄配對狀態

### 卡片交換機制（混合佈局）
- 當拖動卡片到已有卡片的框時，自動交換位置
- 支援多次交換調整

### 分頁機制
- 支援多頁卡片顯示
- 每頁可配置卡片數量
- 分頁指示器顯示當前進度

---

## 語音功能實現

### 語音按鈕設計
- **圖標**：喇叭符號 🔊
- **顏色狀態**：
  - 綠色（#4CAF50）：未播放
  - 黃色（#FFC107）：播放中
  - 橙色（#FF9800）：加載中
- **大小**：根據卡片尺寸自適應（20-40px）

### 音頻播放流程
1. 檢查 audioUrl 是否存在
2. 使用 Phaser 的 `this.load.audio()` 載入音頻
3. 檢查音頻是否已在緩存中
4. 創建音頻對象並播放
5. 更新按鈕狀態

### 錯誤處理
- 音頻載入失敗時顯示錯誤提示
- 播放失敗時恢復按鈕狀態
- 支援重複播放

---

## 技術架構

### 文件結構
```
public/games/match-up-game/
├── config.js          # Phaser 配置
├── index.html         # HTML 入口
└── scenes/
    ├── handler.js     # 場景處理器
    ├── preload.js     # 資源預加載
    └── game.js        # 主遊戲邏輯（4675+ 行）
```

### 核心類和方法

#### GameScene 主要方法
- `createCards()`：創建卡片
- `createMixedLayout()`：創建混合佈局
- `createSeparatedLayout()`：創建分離佈局
- `createLeftCard()`：創建左側卡片
- `createCardLayoutA/B/C/D/E()`：五種佈局函數
- `createAudioButton()`：創建語音按鈕
- `playAudio()`：播放音頻
- `checkDrop()`：檢查拖放
- `checkMatch()`：檢查配對

### 數據結構

#### 詞彙項目結構
```javascript
{
  id: number,
  question: string,        // 英文
  answer: string,          // 中文
  imageUrl: string,        // 圖片 URL
  chineseImageUrl: string, // 中文圖片 URL
  audioUrl: string,        // 語音 URL
  imageSize: object,       // 圖片尺寸
  chineseImageSize: object // 中文圖片尺寸
}
```

---

## 已知問題

### 🔴 當前問題（Phase 52）

#### 問題 1：語音按鈕不播放
- **症狀**：點擊語音按鈕沒有聲音
- **原因**：詞彙數據中可能沒有 audioUrl
- **解決方案**：需要在編輯內容頁面添加語音 URL

#### 問題 2：英文文字顯示異常
- **症狀**：英文文字不管有沒有內容都顯示
- **原因**：文字檢查邏輯可能有問題
- **狀態**：已添加文字檢查邏輯

#### 問題 3：語音按鈕位置
- **症狀**：按鈕可能超出框的邊界
- **原因**：座標系統計算錯誤
- **狀態**：已修正座標系統（Commit: d9c19f7）

### 🟡 待解決事項

1. **數據驗證**：確認詞彙數據中是否包含 audioUrl
2. **調試日誌**：查看控制台日誌確認 audioUrl 值
3. **音頻加載**：驗證音頻文件是否可正常加載
4. **跨瀏覽器測試**：測試不同瀏覽器的音頻支援

---

## 最近的修改記錄

| Commit | 說明 | 日期 |
|--------|------|------|
| 618051b | 添加詳細調試日誌追蹤 audioUrl | 最新 |
| d9c19f7 | 修正語音按鈕座標系統 | 之前 |
| b46e8c8 | 減小按鈕大小、添加文字檢查 | 之前 |
| 6010b55 | 調整情況 A 佈局比例 | 之前 |

---

## 下一步行動

### 立即需要做的
1. ✅ 檢查詞彙數據是否包含 audioUrl
2. ✅ 查看控制台日誌確認 audioUrl 值
3. ✅ 驗證音頻文件是否可正常加載
4. ⏳ 根據調試結果修復問題

### 長期改進
1. 優化音頻加載性能
2. 添加更多語音效果
3. 支援多語言語音
4. 改進無障礙設計

---

**文檔最後更新**：2025-10-30
**遊戲版本**：Match-up Game v1.0
**開發者**：EduCreate 團隊

