<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match-Up Game - è‡ªå‹•æ¸¬è©¦å’Œä¿®å¾©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
        }
        .section h2 {
            margin-top: 0;
            color: #2196F3;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        button.danger {
            background: #f44336;
        }
        button.danger:hover {
            background: #da190b;
        }
        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        .log-error {
            color: #ff6b6b;
        }
        .log-success {
            color: #51cf66;
        }
        .log-warning {
            color: #ffd43b;
        }
        .log-info {
            color: #74c0fc;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-box {
            background: white;
            border: 2px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
        }
        .stat-box h3 {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 14px;
        }
        .stat-box .value {
            font-size: 32px;
            font-weight: bold;
            color: #2196F3;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Match-Up Game - è‡ªå‹•æ¸¬è©¦å’Œä¿®å¾©ç³»çµ±</h1>
        
        <div class="section">
            <h2>ğŸ“Š å¯¦æ™‚ç›£æ§çµ±è¨ˆ</h2>
            <div class="stats">
                <div class="stat-box">
                    <h3>updateLayout èª¿ç”¨</h3>
                    <div class="value" id="updateLayoutCount">0</div>
                </div>
                <div class="stat-box">
                    <h3>repositionCards èª¿ç”¨</h3>
                    <div class="value" id="repositionCardsCount">0</div>
                </div>
                <div class="stat-box">
                    <h3>resize äº‹ä»¶</h3>
                    <div class="value" id="resizeCount">0</div>
                </div>
                <div class="stat-box">
                    <h3>visibilitychange äº‹ä»¶</h3>
                    <div class="value" id="visibilityCount">0</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ”§ æ§åˆ¶é¢æ¿</h2>
            <button onclick="startMonitoring()">â–¶ï¸ é–‹å§‹ç›£æ§</button>
            <button onclick="stopMonitoring()">â¹ï¸ åœæ­¢ç›£æ§</button>
            <button onclick="clearLogs()">ğŸ—‘ï¸ æ¸…é™¤æ—¥èªŒ</button>
            <button onclick="runTests()" class="danger">ğŸ§ª é‹è¡Œå®Œæ•´æ¸¬è©¦</button>
            <button onclick="applyFix()" class="danger">ğŸ”¨ æ‡‰ç”¨ä¿®å¾©</button>
        </div>

        <div class="section">
            <h2>ğŸ“‹ è¨ºæ–·æ—¥èªŒ</h2>
            <div class="log" id="logContainer"></div>
        </div>

        <div class="section">
            <h2>ğŸ“ˆ æ¸¬è©¦çµæœ</h2>
            <div id="testResults"></div>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        let monitoring = false;
        let stats = {
            updateLayoutCount: 0,
            repositionCardsCount: 0,
            resizeCount: 0,
            visibilityCount: 0,
            fullscreenCount: 0,
            orientationCount: 0
        };
        let logs = [];

        // æ—¥èªŒå‡½æ•¸
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push({ message: logEntry, type });
            
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = logEntry;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLogs() {
            logs = [];
            document.getElementById('logContainer').innerHTML = '';
            addLog('âœ… æ—¥èªŒå·²æ¸…é™¤', 'success');
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            document.getElementById('updateLayoutCount').textContent = stats.updateLayoutCount;
            document.getElementById('repositionCardsCount').textContent = stats.repositionCardsCount;
            document.getElementById('resizeCount').textContent = stats.resizeCount;
            document.getElementById('visibilityCount').textContent = stats.visibilityCount;
        }

        // é–‹å§‹ç›£æ§
        function startMonitoring() {
            if (monitoring) {
                addLog('âš ï¸ ç›£æ§å·²åœ¨é‹è¡Œ', 'warning');
                return;
            }

            monitoring = true;
            addLog('ğŸ” é–‹å§‹ç›£æ§é‡æ–°è¼‰å…¥äº‹ä»¶...', 'info');

            // ç²å–éŠæˆ²å ´æ™¯
            const gameScene = cc?.game?.getScene?.('GameScene');
            if (!gameScene) {
                addLog('âŒ ç„¡æ³•æ‰¾åˆ° GameSceneï¼Œè«‹ç¢ºä¿éŠæˆ²å·²åŠ è¼‰', 'error');
                monitoring = false;
                return;
            }

            // ç›£æ§ updateLayout
            if (gameScene.updateLayout) {
                const originalUpdateLayout = gameScene.updateLayout;
                gameScene.updateLayout = function() {
                    stats.updateLayoutCount++;
                    addLog(`âŒ updateLayout è¢«èª¿ç”¨ #${stats.updateLayoutCount}`, 'error');
                    updateStats();
                    return originalUpdateLayout.call(this);
                };
                addLog('âœ… å·²ç›£æ§ updateLayout', 'success');
            }

            // ç›£æ§ repositionCards
            if (gameScene.repositionCards) {
                const originalRepositionCards = gameScene.repositionCards;
                gameScene.repositionCards = function() {
                    stats.repositionCardsCount++;
                    addLog(`âœ… repositionCards è¢«èª¿ç”¨ #${stats.repositionCardsCount}`, 'success');
                    updateStats();
                    return originalRepositionCards.call(this);
                };
                addLog('âœ… å·²ç›£æ§ repositionCards', 'success');
            }

            // ç›£æ§ resize äº‹ä»¶
            window.addEventListener('resize', () => {
                stats.resizeCount++;
                addLog(`ğŸ“ resize äº‹ä»¶ #${stats.resizeCount} - è¦–çª—å¤§å°: ${window.innerWidth}x${window.innerHeight}`, 'info');
                updateStats();
            });
            addLog('âœ… å·²ç›£æ§ resize äº‹ä»¶', 'success');

            // ç›£æ§ visibilitychange äº‹ä»¶
            document.addEventListener('visibilitychange', () => {
                stats.visibilityCount++;
                addLog(`ğŸ‘ï¸ visibilitychange äº‹ä»¶ #${stats.visibilityCount} - é é¢${document.hidden ? 'éš±è—' : 'é¡¯ç¤º'}`, 'info');
                updateStats();
            });
            addLog('âœ… å·²ç›£æ§ visibilitychange äº‹ä»¶', 'success');

            addLog('ğŸ¯ ç›£æ§ç³»çµ±å·²å•Ÿå‹•ï¼', 'success');
        }

        function stopMonitoring() {
            monitoring = false;
            addLog('â¹ï¸ ç›£æ§å·²åœæ­¢', 'warning');
        }

        // é‹è¡Œæ¸¬è©¦
        async function runTests() {
            addLog('ğŸ§ª é–‹å§‹é‹è¡Œå®Œæ•´æ¸¬è©¦...', 'info');
            
            // é‡ç½®è¨ˆæ•¸
            stats = {
                updateLayoutCount: 0,
                repositionCardsCount: 0,
                resizeCount: 0,
                visibilityCount: 0
            };
            updateStats();

            // æ¸¬è©¦ 1ï¼šç¸®å°è¦–çª—
            addLog('ğŸ“ æ¸¬è©¦ 1ï¼šç¸®å°è¦–çª—', 'info');
            window.resizeTo(800, 600);
            await sleep(1000);

            // æ¸¬è©¦ 2ï¼šæ”¾å¤§è¦–çª—
            addLog('ğŸ“ æ¸¬è©¦ 2ï¼šæ”¾å¤§è¦–çª—', 'info');
            window.resizeTo(1200, 800);
            await sleep(1000);

            // ç”Ÿæˆå ±å‘Š
            generateReport();
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ç”Ÿæˆå ±å‘Š
        function generateReport() {
            const resultsDiv = document.getElementById('testResults');
            let html = '<h3>ğŸ“Š æ¸¬è©¦çµæœå ±å‘Š</h3>';

            const issues = [];
            if (stats.updateLayoutCount > 0) {
                issues.push(`âŒ updateLayout è¢«èª¿ç”¨ ${stats.updateLayoutCount} æ¬¡ï¼ˆæ‡‰è©²æ˜¯ 0 æ¬¡ï¼‰`);
            }
            if (stats.repositionCardsCount === 0 && stats.resizeCount > 0) {
                issues.push(`âš ï¸ repositionCards æ²’æœ‰è¢«èª¿ç”¨ï¼ˆæ‡‰è©²åœ¨ resize æ™‚è¢«èª¿ç”¨ï¼‰`);
            }

            if (issues.length === 0) {
                html += '<div class="status success">âœ… æ‰€æœ‰æ¸¬è©¦é€šéï¼æ²’æœ‰ç™¼ç¾é‡æ–°è¼‰å…¥å•é¡Œã€‚</div>';
            } else {
                html += '<div class="status error">âŒ ç™¼ç¾ä»¥ä¸‹å•é¡Œï¼š</div>';
                issues.forEach(issue => {
                    html += `<div style="margin: 5px 0; padding: 5px; background: #fff3cd; border-left: 3px solid #ffc107;">${issue}</div>`;
                });
            }

            html += `
                <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 4px;">
                    <strong>çµ±è¨ˆæ•¸æ“šï¼š</strong><br>
                    - updateLayout èª¿ç”¨: ${stats.updateLayoutCount} æ¬¡<br>
                    - repositionCards èª¿ç”¨: ${stats.repositionCardsCount} æ¬¡<br>
                    - resize äº‹ä»¶: ${stats.resizeCount} æ¬¡<br>
                    - visibilitychange äº‹ä»¶: ${stats.visibilityCount} æ¬¡
                </div>
            `;

            resultsDiv.innerHTML = html;
        }

        // æ‡‰ç”¨ä¿®å¾©
        function applyFix() {
            addLog('ğŸ”¨ é–‹å§‹æ‡‰ç”¨ä¿®å¾©...', 'warning');
            
            const gameScene = cc?.game?.getScene?.('GameScene');
            if (!gameScene) {
                addLog('âŒ ç„¡æ³•æ‰¾åˆ° GameScene', 'error');
                return;
            }

            // ä¿®å¾© 1ï¼šä¿®æ”¹ handleFullscreenChange
            if (gameScene.handleFullscreenChange) {
                const originalHandleFullscreenChange = gameScene.handleFullscreenChange;
                gameScene.handleFullscreenChange = function() {
                    console.log('ğŸ® å…¨è¢å¹•ç‹€æ…‹è®ŠåŒ–:', document.fullscreenElement ? 'é€²å…¥å…¨è¢å¹•' : 'é€€å‡ºå…¨è¢å¹•');
                    this.repositionCards();  // âœ… æ”¹ç‚º repositionCards
                };
                addLog('âœ… å·²ä¿®å¾© handleFullscreenChange', 'success');
            }

            // ä¿®å¾© 2ï¼šä¿®æ”¹ handleOrientationChange
            if (gameScene.handleOrientationChange) {
                const originalHandleOrientationChange = gameScene.handleOrientationChange;
                gameScene.handleOrientationChange = function() {
                    const isPortrait = window.matchMedia('(orientation: portrait)').matches;
                    console.log('ğŸ® è¨­å‚™æ–¹å‘è®ŠåŒ–:', isPortrait ? 'ç›´å‘' : 'æ©«å‘');
                    this.repositionCards();  // âœ… æ”¹ç‚º repositionCards
                };
                addLog('âœ… å·²ä¿®å¾© handleOrientationChange', 'success');
            }

            addLog('ğŸ¯ ä¿®å¾©å·²æ‡‰ç”¨ï¼', 'success');
            addLog('ğŸ’¡ æç¤ºï¼šè«‹é‡æ–°é‹è¡Œæ¸¬è©¦ä»¥é©—è­‰ä¿®å¾©æ•ˆæœ', 'info');
        }

        // é é¢åŠ è¼‰æ™‚çš„åˆå§‹åŒ–
        window.addEventListener('load', () => {
            addLog('ğŸ® é é¢å·²åŠ è¼‰ï¼Œç­‰å¾…éŠæˆ²åˆå§‹åŒ–...', 'info');
            
            // ç­‰å¾…éŠæˆ²åŠ è¼‰
            setTimeout(() => {
                const gameScene = cc?.game?.getScene?.('GameScene');
                if (gameScene) {
                    addLog('âœ… éŠæˆ²å·²åŠ è¼‰ï¼Œå¯ä»¥é–‹å§‹ç›£æ§', 'success');
                } else {
                    addLog('âš ï¸ éŠæˆ²é‚„æœªåŠ è¼‰ï¼Œè«‹ç¨å€™...', 'warning');
                }
            }, 2000);
        });
    </script>
</body>
</html>

