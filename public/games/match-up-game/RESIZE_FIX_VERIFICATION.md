# Match-up Game - Resize Fix 驗證指南

## 📋 改動摘要

### 問題
改變瀏覽器尺寸時，遊戲會清除所有卡片並重新創建，導致：
- 已配對的卡片狀態丟失
- 遊戲進度被重置
- 用戶體驗不佳

### 解決方案 (v50.0)
修改 resize 事件處理，只調整卡片位置，不重新創建卡片：
- 詞彙數據（this.pairs）保持不變
- 已配對的卡片狀態保持不變
- 卡片位置和大小根據新尺寸調整

## 🔧 代碼改動

### 1. 修改 Resize 事件監聽器
**文件**: `scenes/game.js` (第 552-559 行)

```javascript
// 之前：調用 updateLayout() 會清除所有卡片
this.scale.on('resize', (gameSize) => {
    this.updateLayout();  // ❌ 清除並重建
}, this);

// 之後：調用 repositionCards() 只調整位置
this.scale.on('resize', (gameSize) => {
    this.repositionCards();  // ✅ 只調整位置
}, this);
```

### 2. 新增 repositionCards() 方法
**文件**: `scenes/game.js` (第 998-1044 行)

功能:
- 計算新的螢幕尺寸
- 根據佈局模式調用相應的位置調整方法
- 錯誤處理和回退機制

### 3. 新增 repositionSeparatedLayout() 方法
**文件**: `scenes/game.js` (第 1046-1129 行)

功能:
- 計算新的卡片尺寸
- 調整左側卡片位置
- 調整右側卡片位置
- 支持所有容器大小

### 4. 新增 repositionMixedLayout() 方法
**文件**: `scenes/game.js` (第 1131-1139 行)

功能:
- 混合佈局暫時回退到完整重建
- 未來可以實現更複雜的邏輯

## ✅ 驗證步驟

### 步驟 1: 啟動遊戲
```
http://localhost:3000/games/switcher?game=match-up-game&activityId=YOUR_ACTIVITY_ID
```

### 步驟 2: 配對卡片
1. 等待遊戲完全載入
2. 配對 3-5 個卡片
3. 記住已配對的卡片位置

### 步驟 3: 改變瀏覽器尺寸
1. 打開開發者工具（F12）
2. 點擊設備工具欄（Ctrl+Shift+M）
3. 改變視窗大小或旋轉設備

### 步驟 4: 驗證結果
- ✅ 已配對的卡片仍然保持配對狀態
- ✅ 卡片位置根據新尺寸調整
- ✅ 沒有閃爍或視覺中斷
- ✅ 遊戲流暢運行

## 🔍 調試信息

### 控制台日誌
打開開發者工具（F12）查看控制台，搜索以下日誌：

| 日誌 | 含義 |
|-----|------|
| `[v50.0] 實時 resize 事件觸發` | Resize 事件被觸發 |
| `[v50.0] repositionCards 開始` | 位置調整開始 |
| `[v50.0] 當前螢幕尺寸` | 新的螢幕尺寸 |
| `[v50.0] 新卡片尺寸` | 計算的新卡片尺寸 |
| `[v50.0] 調整分離佈局位置` | 分離佈局位置調整 |
| `[v50.0] 分離佈局位置調整完成` | 位置調整完成 |
| `❌ [v50.0] repositionCards 失敗` | 位置調整失敗 |
| `⚠️ [v50.0] 回退到完整重建` | 回退到完整重建 |

### 不應該出現的日誌
- ❌ `🎮 GameScene: 清除所有現有元素` - 表示仍在清除卡片
- ❌ `🎮 GameScene: updateLayout 開始` - 表示仍在調用 updateLayout

## 📊 支持的佈局

| 佈局類型 | 支持狀態 | 說明 |
|---------|--------|------|
| Separated | ✅ 完全支持 | 分離佈局，卡片位置可調整 |
| Mixed | ⚠️ 部分支持 | 混合佈局，暫時回退到完整重建 |

## 🧪 測試場景

### 場景 1: 桌面瀏覽器
1. 打開遊戲
2. 拖動瀏覽器窗口邊角改變大小
3. 驗證卡片位置調整

### 場景 2: 平板設備
1. 使用開發者工具模擬平板
2. 改變視窗大小
3. 驗證卡片位置調整

### 場景 3: 手機設備
1. 使用開發者工具模擬手機
2. 旋轉設備（改變方向）
3. 驗證卡片位置調整

### 場景 4: 全螢幕模式
1. 進入全螢幕模式（F11）
2. 退出全螢幕模式
3. 驗證卡片位置調整

## ⚠️ 已知限制

1. **混合佈局**: 暫時回退到完整重建
2. **錯誤回退**: 如果位置調整失敗，會自動回退到完整重建

## 🚀 未來改進

1. 實現混合佈局的位置調整
2. 優化位置調整算法
3. 添加動畫過渡效果
4. 性能優化

## 📞 問題報告

如果遇到問題，請檢查：
1. 瀏覽器控制台是否有錯誤信息
2. 是否使用了支持的佈局類型
3. 是否有其他 JavaScript 錯誤

