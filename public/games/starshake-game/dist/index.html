<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduCreate - Starshake</title>

    <style>
        /* reset CSS */
        html, body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            font-family: 'Open Sans', sans-serif;
        }

        #app {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-container {
            width: 100%;
            height: 100%;
            max-width: 1000px;
            max-height: 800px;
        }
    </style>
  <script type="module" crossorigin src="/games/starshake-game/dist/assets/index-DEhXC0VF.js"></script>
  <link rel="modulepreload" crossorigin href="/games/starshake-game/dist/assets/phaser-CmFXOKba.js">

    <!-- è§¸æ‘¸æ§åˆ¶æ¨£å¼ -->
    

    <!-- è§¸æ‘¸æ§åˆ¶æ¨£å¼ -->
    <style>
        /* è§¸æ‘¸æ§åˆ¶é¢æ¿ */
        #touch-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: transparent;
            display: none;
            z-index: 1000;
            pointer-events: none;
        }
        
        /* ç§»å‹•æ§åˆ¶å€åŸŸ */
        .touch-joystick {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 120px;
            height: 120px;
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            pointer-events: all;
        }
        
        .touch-joystick-knob {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 40px;
            height: 40px;
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s ease;
        }
        
        /* å°„æ“ŠæŒ‰éˆ• */
        .touch-shoot-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: transparent;
            border: 2px solid rgba(255, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 0, 0, 0.8);
            font-size: 24px;
            font-weight: bold;
            pointer-events: all;
            user-select: none;
        }
        
        .touch-shoot-btn:active {
            background: rgba(255, 0, 0, 0.2);
            border-color: rgba(255, 0, 0, 0.8);
            transform: scale(0.95);
        }
        
        /* ç§»å‹•è¨­å‚™æª¢æ¸¬ */
        @media (max-width: 768px), (pointer: coarse) {
            #touch-controls {
                display: block;
            }
        }
        
        /* å…¨è¢å¹•æŒ‰éˆ• */
        .fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            pointer-events: all;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="game-container"></div>
        
        <!-- è§¸æ‘¸æ§åˆ¶é¢æ¿ -->
        <div id="touch-controls">
            <!-- ç§»å‹•æ–æ¡¿ -->
            <div class="touch-joystick" id="touch-joystick">
                <div class="touch-joystick-knob" id="joystick-knob"></div>
            </div>
            
            <!-- å°„æ“ŠæŒ‰éˆ• -->
            <div class="touch-shoot-btn" id="touch-shoot">
                ğŸš€
            </div>
            
            <!-- å…¨è¢å¹•æŒ‰éˆ• -->
            <div class="fullscreen-btn" id="fullscreen-btn">
                â›¶
            </div>
        </div>
    </div>
    
    <!-- è§¸æ‘¸æ§åˆ¶ JavaScript -->
    <script>
        // è§¸æ‘¸æ§åˆ¶ç³»çµ±
        // è§¸æ‘¸æ§åˆ¶ç³»çµ±
        class TouchControls {
            constructor() {
                this.joystick = document.getElementById('touch-joystick');
                this.knob = document.getElementById('joystick-knob');
                this.shootBtn = document.getElementById('touch-shoot');
                this.fullscreenBtn = document.getElementById('fullscreen-btn');
                
                this.joystickActive = false;
                this.joystickCenter = { x: 0, y: 0 };
                this.currentDirection = { x: 0, y: 0 };
                this.shooting = false;
                
                // èª¿è©¦æ¨™èªŒ
                this.debug = true;
                
                this.init();
            }
            
            init() {
                if (this.debug) console.log('ğŸ® TouchControls åˆå§‹åŒ–é–‹å§‹...');
                
                // æª¢æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
                if (!this.joystick || !this.knob || !this.shootBtn) {
                    console.error('âŒ TouchControls å…ƒç´ æœªæ‰¾åˆ°:', {
                        joystick: !!this.joystick,
                        knob: !!this.knob,
                        shootBtn: !!this.shootBtn
                    });
                    return;
                }
                
                // æ–æ¡¿æ§åˆ¶ - æ·»åŠ å¤šç¨®äº‹ä»¶é¡å‹
                this.joystick.addEventListener('touchstart', this.onJoystickStart.bind(this), { passive: false });
                this.joystick.addEventListener('touchmove', this.onJoystickMove.bind(this), { passive: false });
                this.joystick.addEventListener('touchend', this.onJoystickEnd.bind(this), { passive: false });
                this.joystick.addEventListener('touchcancel', this.onJoystickEnd.bind(this), { passive: false });
                
                // æ·»åŠ é¼ æ¨™äº‹ä»¶ä½œç‚ºå‚™ç”¨ï¼ˆç”¨æ–¼æ¡Œé¢æ¸¬è©¦ï¼‰
                this.joystick.addEventListener('mousedown', this.onJoystickStartMouse.bind(this));
                this.joystick.addEventListener('mousemove', this.onJoystickMoveMouse.bind(this));
                this.joystick.addEventListener('mouseup', this.onJoystickEndMouse.bind(this));
                this.joystick.addEventListener('mouseleave', this.onJoystickEndMouse.bind(this));
                
                // å°„æ“ŠæŒ‰éˆ•
                this.shootBtn.addEventListener('touchstart', this.onShootStart.bind(this), { passive: false });
                this.shootBtn.addEventListener('touchend', this.onShootEnd.bind(this), { passive: false });
                this.shootBtn.addEventListener('touchcancel', this.onShootEnd.bind(this), { passive: false });
                
                // é¼ æ¨™äº‹ä»¶ä½œç‚ºå‚™ç”¨
                this.shootBtn.addEventListener('mousedown', this.onShootStart.bind(this));
                this.shootBtn.addEventListener('mouseup', this.onShootEnd.bind(this));
                
                // å…¨è¢å¹•æŒ‰éˆ•
                if (this.fullscreenBtn) {
                    this.fullscreenBtn.addEventListener('click', this.toggleFullscreen.bind(this));
                    this.fullscreenBtn.addEventListener('touchend', this.toggleFullscreen.bind(this));
                }
                
                // é˜²æ­¢é»˜èªè§¸æ‘¸è¡Œç‚º
                document.addEventListener('touchmove', (e) => {
                    if (e.target.closest('#touch-controls')) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                // é˜²æ­¢ä¸Šä¸‹æ–‡èœå–®
                document.addEventListener('contextmenu', (e) => {
                    if (e.target.closest('#touch-controls')) {
                        e.preventDefault();
                    }
                });
                
                if (this.debug) console.log('âœ… TouchControls äº‹ä»¶ç›£è½å™¨å·²è¨­ç½®');
            }
            
            onJoystickStart(e) {
                e.preventDefault();
                if (this.debug) console.log('ğŸ•¹ï¸ æ–æ¡¿è§¸æ‘¸é–‹å§‹');
                this.joystickActive = true;
                const rect = this.joystick.getBoundingClientRect();
                this.joystickCenter = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
                if (this.debug) console.log('ğŸ“ æ–æ¡¿ä¸­å¿ƒ:', this.joystickCenter);
            }
            
            onJoystickStartMouse(e) {
                e.preventDefault();
                if (this.debug) console.log('ğŸ–±ï¸ æ–æ¡¿é¼ æ¨™é–‹å§‹');
                this.joystickActive = true;
                const rect = this.joystick.getBoundingClientRect();
                this.joystickCenter = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
            }
            
            onJoystickMove(e) {
                if (!this.joystickActive) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                if (!touch) return;
                
                this.updateJoystickPosition(touch.clientX, touch.clientY);
            }
            
            onJoystickMoveMouse(e) {
                if (!this.joystickActive) return;
                e.preventDefault();
                
                this.updateJoystickPosition(e.clientX, e.clientY);
            }
            
            updateJoystickPosition(clientX, clientY) {
                const deltaX = clientX - this.joystickCenter.x;
                const deltaY = clientY - this.joystickCenter.y;
                
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const maxDistance = 40;
                
                if (distance <= maxDistance) {
                    this.knob.style.transform = `translate(${deltaX - 20}px, ${deltaY - 20}px)`;
                    this.currentDirection = {
                        x: deltaX / maxDistance,
                        y: deltaY / maxDistance
                    };
                } else {
                    const angle = Math.atan2(deltaY, deltaX);
                    const limitedX = Math.cos(angle) * maxDistance;
                    const limitedY = Math.sin(angle) * maxDistance;
                    
                    this.knob.style.transform = `translate(${limitedX - 20}px, ${limitedY - 20}px)`;
                    this.currentDirection = {
                        x: Math.cos(angle),
                        y: Math.sin(angle)
                    };
                }
                
                if (this.debug && Math.abs(this.currentDirection.x) > 0.1 || Math.abs(this.currentDirection.y) > 0.1) {
                    console.log('ğŸ¯ æ–æ¡¿æ–¹å‘:', this.currentDirection);
                }
            }
            
            onJoystickEnd(e) {
                e.preventDefault();
                if (this.debug) console.log('ğŸ•¹ï¸ æ–æ¡¿è§¸æ‘¸çµæŸ');
                this.joystickActive = false;
                this.knob.style.transform = 'translate(-50%, -50%)';
                this.currentDirection = { x: 0, y: 0 };
            }
            
            onJoystickEndMouse(e) {
                e.preventDefault();
                if (this.debug) console.log('ğŸ–±ï¸ æ–æ¡¿é¼ æ¨™çµæŸ');
                this.joystickActive = false;
                this.knob.style.transform = 'translate(-50%, -50%)';
                this.currentDirection = { x: 0, y: 0 };
            }
            
            onShootStart(e) {
                e.preventDefault();
                if (this.debug) console.log('ğŸš€ å°„æ“Šé–‹å§‹');
                this.shooting = true;
                // æ·»åŠ è¦–è¦ºåé¥‹
                this.shootBtn.style.transform = 'scale(0.9)';
                this.shootBtn.style.backgroundColor = '#ff6b6b';
            }
            
            onShootEnd(e) {
                e.preventDefault();
                if (this.debug) console.log('ğŸš€ å°„æ“ŠçµæŸ');
                this.shooting = false;
                // æ¢å¾©è¦–è¦ºåé¥‹
                this.shootBtn.style.transform = 'scale(1)';
                this.shootBtn.style.backgroundColor = '#ff4757';
            }
            
            toggleFullscreen() {
                if (this.debug) console.log('ğŸ–¥ï¸ åˆ‡æ›å…¨è¢å¹•');
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log('å…¨è¢å¹•è«‹æ±‚å¤±æ•—:', err);
                    });
                } else {
                    document.exitFullscreen().catch(err => {
                        console.log('é€€å‡ºå…¨è¢å¹•å¤±æ•—:', err);
                    });
                }
            }
            
            // ç²å–ç•¶å‰è¼¸å…¥ç‹€æ…‹
            getInputState() {
                const state = {
                    direction: { ...this.currentDirection },
                    shooting: this.shooting
                };
                
                // åªåœ¨ç‹€æ…‹è®ŠåŒ–æ™‚è¨˜éŒ„
                if (this.debug && (Math.abs(state.direction.x) > 0.1 || Math.abs(state.direction.y) > 0.1 || state.shooting)) {
                    console.log('ğŸ“Š ç•¶å‰ç‹€æ…‹:', state);
                }
                
                return state;
            }
            
            // æ¸¬è©¦æ–¹æ³•
            testControls() {
                console.log('ğŸ§ª TouchControls æ¸¬è©¦:');
                console.log('  - æ–æ¡¿å…ƒç´ :', !!this.joystick);
                console.log('  - æ–æ¡¿æ—‹éˆ•:', !!this.knob);
                console.log('  - å°„æ“ŠæŒ‰éˆ•:', !!this.shootBtn);
                console.log('  - å…¨è¢å¹•æŒ‰éˆ•:', !!this.fullscreenBtn);
                console.log('  - ç•¶å‰ç‹€æ…‹:', this.getInputState());
                return true;
            }
        }
        
        // åˆå§‹åŒ–è§¸æ‘¸æ§åˆ¶
        window.touchControls = new TouchControls();
        
        // æ·»åŠ æ¸¬è©¦æ–¹æ³•åˆ° window
        window.testTouchControls = () => window.touchControls.testControls();
        
        console.log('ğŸ® è§¸æ‘¸æ§åˆ¶ç³»çµ±å·²åˆå§‹åŒ–');
        console.log('ğŸ’¡ ä½¿ç”¨ testTouchControls() é€²è¡Œæ¸¬è©¦');
        
        // èª¿è©¦åŠŸèƒ½
        window.toggleTouchDebug = function() {
            document.body.classList.toggle('touch-debug');
            console.log('ğŸ› TouchControls èª¿è©¦æ¨¡å¼:', document.body.classList.contains('touch-debug') ? 'é–‹å•Ÿ' : 'é—œé–‰');
        };
        
        // å¼·åˆ¶é¡¯ç¤º TouchControlsï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
        window.forceTouchControls = function(show = true) {
            const controls = document.getElementById('touch-controls');
            if (controls) {
                controls.style.display = show ? 'block' : 'none';
                console.log('ğŸ® TouchControls å¼·åˆ¶é¡¯ç¤º:', show);
            }
        };
        
        // æª¢æŸ¥åª’é«”æŸ¥è©¢
        window.checkMediaQueries = function() {
            const queries = [
                '(max-width: 1024px)',
                '(max-height: 768px)',
                '(pointer: coarse)',
                '(hover: none) and (pointer: coarse)',
                '(min-width: 768px) and (max-width: 1024px)',
                '(min-width: 414px) and (max-width: 768px)'
            ];
            
            console.log('ğŸ“± åª’é«”æŸ¥è©¢æª¢æŸ¥:');
            queries.forEach(query => {
                const matches = window.matchMedia(query).matches;
                console.log(`  ${query}: ${matches ? 'âœ…' : 'âŒ'}`);
            });
            
            const controls = document.getElementById('touch-controls');
            const isVisible = controls && window.getComputedStyle(controls).display !== 'none';
            console.log(`ğŸ® TouchControls å¯è¦‹: ${isVisible ? 'âœ…' : 'âŒ'}`);
        };
    </script>

    <!-- å•Ÿå‹•ç•«é¢é»æ“Šæ”¯æ´ JavaScript -->
    <script>
        // å•Ÿå‹•ç•«é¢é»æ“Šå’Œè§¸æ‘¸æ”¯æ´
        window.addStartScreenClickSupport = function() {
            console.log('ğŸ® æ·»åŠ å•Ÿå‹•ç•«é¢é»æ“Šå’Œè§¸æ‘¸æ”¯æ´');
            
            // ç­‰å¾… Phaser éŠæˆ²åˆå§‹åŒ–
            const checkPhaserGame = setInterval(() => {
                if (window.game && window.game.scene && window.game.scene.scenes.length > 0) {
                    clearInterval(checkPhaserGame);
                    
                    // æŸ¥æ‰¾ splash å ´æ™¯
                    const splashScene = window.game.scene.scenes.find(scene => scene.scene.key === 'splash');
                    
                    if (splashScene && splashScene.scene.isActive()) {
                        console.log('ğŸ¯ æ‰¾åˆ° splash å ´æ™¯ï¼Œæ·»åŠ é»æ“Šæ”¯æ´');
                        addClickSupportToSplash(splashScene);
                    } else {
                        // ç›£è½å ´æ™¯åˆ‡æ›ï¼Œç•¶ splash å ´æ™¯å•Ÿå‹•æ™‚æ·»åŠ æ”¯æ´
                        window.game.events.on('scenestart', (scene) => {
                            if (scene.scene.key === 'splash') {
                                console.log('ğŸ¯ splash å ´æ™¯å•Ÿå‹•ï¼Œæ·»åŠ é»æ“Šæ”¯æ´');
                                setTimeout(() => addClickSupportToSplash(scene), 100);
                            }
                        });
                    }
                }
            }, 100);
            
            // ç‚º splash å ´æ™¯æ·»åŠ é»æ“Šå’Œè§¸æ‘¸æ”¯æ´
            function addClickSupportToSplash(scene) {
                if (scene.clickSupportAdded) return;
                scene.clickSupportAdded = true;
                
                console.log('âœ… ç‚º splash å ´æ™¯æ·»åŠ é»æ“Šå’Œè§¸æ‘¸æ”¯æ´');
                
                // æ·»åŠ é»æ“Šäº‹ä»¶ç›£è½å™¨
                scene.input.on('pointerdown', () => {
                    console.log('ğŸ–±ï¸ æª¢æ¸¬åˆ°é»æ“Šï¼Œé–‹å§‹éŠæˆ²');
                    if (scene.transitionToChange && typeof scene.transitionToChange === 'function') {
                        scene.transitionToChange();
                    }
                });
                
                // æ·»åŠ è§¸æ‘¸äº‹ä»¶ç›£è½å™¨ï¼ˆå‚™ç”¨ï¼‰
                const canvas = scene.sys.game.canvas;
                if (canvas) {
                    const touchStartHandler = (e) => {
                        e.preventDefault();
                        console.log('ğŸ‘† æª¢æ¸¬åˆ°è§¸æ‘¸ï¼Œé–‹å§‹éŠæˆ²');
                        if (scene.transitionToChange && typeof scene.transitionToChange === 'function') {
                            scene.transitionToChange();
                        }
                    };
                    
                    canvas.addEventListener('touchstart', touchStartHandler, { passive: false });
                    canvas.addEventListener('click', touchStartHandler);
                    
                    // æ¸…ç†å‡½æ•¸
                    scene.events.once('shutdown', () => {
                        canvas.removeEventListener('touchstart', touchStartHandler);
                        canvas.removeEventListener('click', touchStartHandler);
                    });
                }
                
                // æ·»åŠ è¦–è¦ºæç¤º
                const instructionText = scene.add.bitmapText(
                    scene.center_width, 
                    scene.center_height + 150, 
                    "wendy", 
                    "é»æ“Šä»»æ„ä½ç½®æˆ–æŒ‰ SPACE é–‹å§‹", 
                    40
                ).setOrigin(0.5);
                
                // é–ƒçˆæ•ˆæœ
                scene.tweens.add({
                    targets: instructionText,
                    alpha: { from: 0.3, to: 1 },
                    duration: 800,
                    repeat: -1,
                    yoyo: true
                });
            }
        };
        
        // ç•¶é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', window.addStartScreenClickSupport);
        } else {
            window.addStartScreenClickSupport();
        }
    </script>


        <!-- ğŸ¯ åº§æ¨™åŒæ­¥è§£æ±ºæ–¹æ¡ˆ - COORDINATE_SYNC_SOLUTION -->
        <script>
            console.log('ğŸ¯ è¼‰å…¥åº§æ¨™åŒæ­¥è§£æ±ºæ–¹æ¡ˆ');
            
            // ç­‰å¾… TouchControls è¼‰å…¥å®Œæˆ
            function waitForTouchControls() {
                return new Promise((resolve) => {
                    const checkTouchControls = () => {
                        if (window.touchControls && window.touchControls.toggleFullscreen) {
                            resolve();
                        } else {
                            setTimeout(checkTouchControls, 100);
                        }
                    };
                    checkTouchControls();
                });
            }
            
            // å¯¦ç¾åº§æ¨™åŒæ­¥çš„å…¨è¢å¹•åˆ‡æ›
            async function implementCoordinateSync() {
                await waitForTouchControls();
                
                console.log('ğŸ”§ é–‹å§‹å¯¦ç¾åº§æ¨™åŒæ­¥');
                
                // ä¿å­˜åŸå§‹çš„å…¨è¢å¹•åˆ‡æ›å‡½æ•¸
                const originalToggleFullscreen = window.touchControls.toggleFullscreen;
                
                // æ›¿æ›ç‚ºåº§æ¨™åŒæ­¥ç‰ˆæœ¬
                window.touchControls.toggleFullscreen = async function() {
                    console.log('ğŸ¯ åŸ·è¡Œåº§æ¨™åŒæ­¥å…¨è¢å¹•åˆ‡æ›');
                    
                    try {
                        const isCurrentlyFullscreen = !!document.fullscreenElement;
                        
                        if (!isCurrentlyFullscreen) {
                            // é€²å…¥å…¨è¢å¹•
                            console.log('ğŸ“± é€²å…¥å…¨è¢å¹•æ¨¡å¼');
                            
                            // 1. è§¸ç™¼åŸç”Ÿ Fullscreen API
                            await document.documentElement.requestFullscreen();
                            console.log('âœ… åŸç”Ÿå…¨è¢å¹•å·²è§¸ç™¼');
                            
                            // 2. ç­‰å¾…å…¨è¢å¹•ç‹€æ…‹ç©©å®š
                            await new Promise(resolve => setTimeout(resolve, 300));
                            
                            // 3. é‡æ–°è¨ˆç®—åº§æ¨™
                            this.recalculateCoordinates();
                            
                            // 4. è§¸ç™¼ resize äº‹ä»¶è®“ Phaser é‡æ–°è¨ˆç®—
                            window.dispatchEvent(new Event('resize'));
                            
                            // 5. å¦‚æœæœ‰ Phaser éŠæˆ²ï¼Œåˆ·æ–° scale
                            if (window.game && window.game.scale) {
                                setTimeout(() => {
                                    window.game.scale.refresh();
                                    console.log('ğŸ® Phaser éŠæˆ² scale å·²åˆ·æ–°');
                                }, 100);
                            }
                            
                        } else {
                            // é€€å‡ºå…¨è¢å¹•
                            console.log('ğŸ“± é€€å‡ºå…¨è¢å¹•æ¨¡å¼');
                            
                            await document.exitFullscreen();
                            console.log('âœ… å·²é€€å‡ºåŸç”Ÿå…¨è¢å¹•');
                            
                            // ç­‰å¾…é€€å‡ºç‹€æ…‹ç©©å®š
                            await new Promise(resolve => setTimeout(resolve, 300));
                            
                            // é‡æ–°è¨ˆç®—åº§æ¨™
                            this.recalculateCoordinates();
                            
                            // è§¸ç™¼ resize äº‹ä»¶
                            window.dispatchEvent(new Event('resize'));
                            
                            // åˆ·æ–° Phaser scale
                            if (window.game && window.game.scale) {
                                setTimeout(() => {
                                    window.game.scale.refresh();
                                    console.log('ğŸ® Phaser éŠæˆ² scale å·²åˆ·æ–°');
                                }, 100);
                            }
                        }
                        
                        console.log('âœ… åº§æ¨™åŒæ­¥å…¨è¢å¹•åˆ‡æ›å®Œæˆ');
                        
                    } catch (error) {
                        console.log('âŒ åº§æ¨™åŒæ­¥å…¨è¢å¹•åˆ‡æ›å¤±æ•—:', error);
                        // å›é€€åˆ°åŸå§‹æ–¹æ³•
                        originalToggleFullscreen.call(this);
                    }
                };
                
                // æ·»åŠ åº§æ¨™é‡æ–°è¨ˆç®—æ–¹æ³•
                window.touchControls.recalculateCoordinates = function() {
                    console.log('ğŸ”„ é‡æ–°è¨ˆç®— TouchControls åº§æ¨™');
                    
                    // é‡æ–°è¨ˆç®—æ–æ¡¿ä¸­å¿ƒåº§æ¨™
                    if (this.joystick) {
                        const rect = this.joystick.getBoundingClientRect();
                        this.joystickCenter = {
                            x: rect.left + rect.width / 2,
                            y: rect.top + rect.height / 2
                        };
                        console.log('ğŸ•¹ï¸ æ–æ¡¿ä¸­å¿ƒåº§æ¨™å·²æ›´æ–°:', this.joystickCenter);
                    }
                    
                    // é‡æ–°è¨ˆç®—å°„æ“ŠæŒ‰éˆ•åº§æ¨™
                    if (this.shootBtn) {
                        const rect = this.shootBtn.getBoundingClientRect();
                        console.log('ğŸš€ å°„æ“ŠæŒ‰éˆ•åº§æ¨™å·²æ›´æ–°:', {
                            left: rect.left,
                            top: rect.top,
                            width: rect.width,
                            height: rect.height
                        });
                    }
                    
                    // é‡æ–°è¨ˆç®—å…¨è¢å¹•æŒ‰éˆ•åº§æ¨™
                    const fullscreenBtn = document.querySelector('.fullscreen-btn');
                    if (fullscreenBtn) {
                        const rect = fullscreenBtn.getBoundingClientRect();
                        console.log('â›¶ å…¨è¢å¹•æŒ‰éˆ•åº§æ¨™å·²æ›´æ–°:', {
                            left: rect.left,
                            top: rect.top,
                            width: rect.width,
                            height: rect.height
                        });
                    }
                };
                
                // ç›£è½å…¨è¢å¹•ç‹€æ…‹è®ŠåŒ–
                document.addEventListener('fullscreenchange', () => {
                    console.log('ğŸ”„ å…¨è¢å¹•ç‹€æ…‹è®ŠåŒ–ï¼Œé‡æ–°è¨ˆç®—åº§æ¨™');
                    setTimeout(() => {
                        if (window.touchControls && window.touchControls.recalculateCoordinates) {
                            window.touchControls.recalculateCoordinates();
                        }
                    }, 200);
                });
                
                // ç›£è½ resize äº‹ä»¶
                window.addEventListener('resize', () => {
                    console.log('ğŸ”„ è¦–çª—å¤§å°è®ŠåŒ–ï¼Œé‡æ–°è¨ˆç®—åº§æ¨™');
                    setTimeout(() => {
                        if (window.touchControls && window.touchControls.recalculateCoordinates) {
                            window.touchControls.recalculateCoordinates();
                        }
                    }, 100);
                });
                
                console.log('âœ… åº§æ¨™åŒæ­¥è§£æ±ºæ–¹æ¡ˆå¯¦ç¾å®Œæˆ');
                
                // æ·»åŠ æ¸¬è©¦å‡½æ•¸
                window.testCoordinateSync = function() {
                    console.log('ğŸ§ª æ¸¬è©¦åº§æ¨™åŒæ­¥åŠŸèƒ½');
                    
                    const currentCoords = {
                        viewport: {
                            width: window.innerWidth,
                            height: window.innerHeight
                        },
                        isFullscreen: !!document.fullscreenElement,
                        touchControls: {}
                    };
                    
                    if (window.touchControls) {
                        if (window.touchControls.joystickCenter) {
                            currentCoords.touchControls.joystickCenter = window.touchControls.joystickCenter;
                        }
                        
                        const joystick = document.querySelector('.touch-joystick');
                        if (joystick) {
                            const rect = joystick.getBoundingClientRect();
                            currentCoords.touchControls.joystick = {
                                left: rect.left,
                                top: rect.top,
                                width: rect.width,
                                height: rect.height
                            };
                        }
                    }
                    
                    console.log('ğŸ“Š ç•¶å‰åº§æ¨™ç‹€æ…‹:', currentCoords);
                    return currentCoords;
                };
                
                // æ·»åŠ å¼·åˆ¶é‡æ–°è¨ˆç®—å‡½æ•¸
                window.forceRecalculateCoordinates = function() {
                    console.log('ğŸ”§ å¼·åˆ¶é‡æ–°è¨ˆç®—æ‰€æœ‰åº§æ¨™');
                    
                    if (window.touchControls && window.touchControls.recalculateCoordinates) {
                        window.touchControls.recalculateCoordinates();
                    }
                    
                    // è§¸ç™¼ Phaser é‡æ–°è¨ˆç®—
                    window.dispatchEvent(new Event('resize'));
                    
                    if (window.game && window.game.scale) {
                        window.game.scale.refresh();
                    }
                    
                    console.log('âœ… å¼·åˆ¶é‡æ–°è¨ˆç®—å®Œæˆ');
                };
            }
            
            // é é¢è¼‰å…¥å®Œæˆå¾Œå¯¦ç¾åº§æ¨™åŒæ­¥
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', implementCoordinateSync);
            } else {
                implementCoordinateSync();
            }
        </script>
        
        
        <!-- ğŸ Safari å…¨è¢å¹•æ”¯æ´ - SAFARI_FULLSCREEN_SUPPORT -->
        <script>
            console.log('ğŸ è¼‰å…¥ Safari å…¨è¢å¹•æ”¯æ´');
            
            // è·¨ç€è¦½å™¨å…¨è¢å¹• API å…¼å®¹æ€§å‡½æ•¸
            function createCrossBrowserFullscreenAPI() {
                console.log('ğŸ”§ å‰µå»ºè·¨ç€è¦½å™¨å…¨è¢å¹• API');
                
                // æª¢æ¸¬ç€è¦½å™¨é¡å‹
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
                const isWebKit = 'webkitRequestFullscreen' in document.documentElement;
                
                console.log('ğŸ” ç€è¦½å™¨æª¢æ¸¬:', {
                    isIOS: isIOS,
                    isSafari: isSafari,
                    isWebKit: isWebKit,
                    userAgent: navigator.userAgent
                });
                
                // è·¨ç€è¦½å™¨è«‹æ±‚å…¨è¢å¹•å‡½æ•¸
                window.requestFullscreenCrossBrowser = function(element = document.documentElement) {
                    console.log('ğŸ“± åŸ·è¡Œè·¨ç€è¦½å™¨å…¨è¢å¹•è«‹æ±‚');
                    
                    return new Promise((resolve, reject) => {
                        try {
                            // æ¨™æº– Fullscreen API
                            if (element.requestFullscreen) {
                                console.log('âœ… ä½¿ç”¨æ¨™æº– requestFullscreen');
                                element.requestFullscreen().then(resolve).catch(reject);
                            }
                            // WebKit (Safari)
                            else if (element.webkitRequestFullscreen) {
                                console.log('ğŸ ä½¿ç”¨ WebKit webkitRequestFullscreen');
                                element.webkitRequestFullscreen();
                                resolve();
                            }
                            // WebKit (èˆŠç‰ˆ)
                            else if (element.webkitRequestFullScreen) {
                                console.log('ğŸ ä½¿ç”¨èˆŠç‰ˆ WebKit webkitRequestFullScreen');
                                element.webkitRequestFullScreen();
                                resolve();
                            }
                            // Mozilla
                            else if (element.mozRequestFullScreen) {
                                console.log('ğŸ¦Š ä½¿ç”¨ Mozilla mozRequestFullScreen');
                                element.mozRequestFullScreen();
                                resolve();
                            }
                            // Microsoft
                            else if (element.msRequestFullscreen) {
                                console.log('ğŸªŸ ä½¿ç”¨ Microsoft msRequestFullscreen');
                                element.msRequestFullscreen();
                                resolve();
                            }
                            // iOS Safari ç‰¹æ®Šè™•ç†
                            else if (isIOS) {
                                console.log('ğŸ“± iOS Safari ç‰¹æ®Šè™•ç†');
                                // iOS Safari ä¸æ”¯æ´çœŸæ­£çš„å…¨è¢å¹•ï¼Œä½¿ç”¨ CSS æ¨¡æ“¬
                                document.body.classList.add('ios-fullscreen-simulation');
                                resolve();
                            }
                            else {
                                console.log('âŒ ç€è¦½å™¨ä¸æ”¯æ´å…¨è¢å¹• API');
                                reject(new Error('Fullscreen not supported'));
                            }
                        } catch (error) {
                            console.log('âŒ å…¨è¢å¹•è«‹æ±‚å¤±æ•—:', error);
                            reject(error);
                        }
                    });
                };
                
                // è·¨ç€è¦½å™¨é€€å‡ºå…¨è¢å¹•å‡½æ•¸
                window.exitFullscreenCrossBrowser = function() {
                    console.log('ğŸ“± åŸ·è¡Œè·¨ç€è¦½å™¨é€€å‡ºå…¨è¢å¹•');
                    
                    return new Promise((resolve, reject) => {
                        try {
                            // æ¨™æº– Fullscreen API
                            if (document.exitFullscreen) {
                                console.log('âœ… ä½¿ç”¨æ¨™æº– exitFullscreen');
                                document.exitFullscreen().then(resolve).catch(reject);
                            }
                            // WebKit (Safari)
                            else if (document.webkitExitFullscreen) {
                                console.log('ğŸ ä½¿ç”¨ WebKit webkitExitFullscreen');
                                document.webkitExitFullscreen();
                                resolve();
                            }
                            // WebKit (èˆŠç‰ˆ)
                            else if (document.webkitCancelFullScreen) {
                                console.log('ğŸ ä½¿ç”¨èˆŠç‰ˆ WebKit webkitCancelFullScreen');
                                document.webkitCancelFullScreen();
                                resolve();
                            }
                            // Mozilla
                            else if (document.mozCancelFullScreen) {
                                console.log('ğŸ¦Š ä½¿ç”¨ Mozilla mozCancelFullScreen');
                                document.mozCancelFullScreen();
                                resolve();
                            }
                            // Microsoft
                            else if (document.msExitFullscreen) {
                                console.log('ğŸªŸ ä½¿ç”¨ Microsoft msExitFullscreen');
                                document.msExitFullscreen();
                                resolve();
                            }
                            // iOS Safari ç‰¹æ®Šè™•ç†
                            else if (isIOS) {
                                console.log('ğŸ“± iOS Safari é€€å‡ºæ¨¡æ“¬å…¨è¢å¹•');
                                document.body.classList.remove('ios-fullscreen-simulation');
                                resolve();
                            }
                            else {
                                console.log('âŒ ç€è¦½å™¨ä¸æ”¯æ´é€€å‡ºå…¨è¢å¹•');
                                reject(new Error('Exit fullscreen not supported'));
                            }
                        } catch (error) {
                            console.log('âŒ é€€å‡ºå…¨è¢å¹•å¤±æ•—:', error);
                            reject(error);
                        }
                    });
                };
                
                // è·¨ç€è¦½å™¨æª¢æŸ¥å…¨è¢å¹•ç‹€æ…‹å‡½æ•¸
                window.isFullscreenCrossBrowser = function() {
                    const fullscreenElement = document.fullscreenElement ||
                                            document.webkitFullscreenElement ||
                                            document.webkitCurrentFullScreenElement ||
                                            document.mozFullScreenElement ||
                                            document.msFullscreenElement;
                    
                    const isIOSSimulation = document.body.classList.contains('ios-fullscreen-simulation');
                    
                    return !!(fullscreenElement || isIOSSimulation);
                };
                
                console.log('âœ… è·¨ç€è¦½å™¨å…¨è¢å¹• API å·²å‰µå»º');
            }
            
            // ç‚º iOS Safari æ·»åŠ  CSS æ¨¡æ“¬å…¨è¢å¹•æ¨£å¼
            function addIOSFullscreenStyles() {
                console.log('ğŸ“± æ·»åŠ  iOS Safari å…¨è¢å¹•æ¨¡æ“¬æ¨£å¼');
                
                let style = document.getElementById('ios-fullscreen-style');
                if (!style) {
                    style = document.createElement('style');
                    style.id = 'ios-fullscreen-style';
                    style.textContent = `
                        /* iOS Safari å…¨è¢å¹•æ¨¡æ“¬ */
                        body.ios-fullscreen-simulation {
                            position: fixed !important;
                            top: 0 !important;
                            left: 0 !important;
                            width: 100vw !important;
                            height: 100vh !important;
                            height: 100dvh !important;
                            margin: 0 !important;
                            padding: 0 !important;
                            overflow: hidden !important;
                            background: black !important;
                            z-index: 2147483647 !important;
                        }
                        
                        body.ios-fullscreen-simulation #app {
                            width: 100vw !important;
                            height: 100vh !important;
                            height: 100dvh !important;
                        }
                        
                        body.ios-fullscreen-simulation #game-container {
                            width: 100% !important;
                            height: 100% !important;
                            max-width: none !important;
                            max-height: none !important;
                        }
                        
                        /* éš±è— iOS Safari åœ°å€æ¬„ */
                        @supports (-webkit-touch-callout: none) {
                            body.ios-fullscreen-simulation {
                                height: -webkit-fill-available !important;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                    console.log('âœ… iOS Safari å…¨è¢å¹•æ¨¡æ“¬æ¨£å¼å·²æ·»åŠ ');
                }
            }
            
            // ä¿®æ”¹åŸå§‹çš„ toggleFullscreen æ–¹æ³•ä»¥æ”¯æ´ Safari
            function enhanceToggleFullscreenForSafari() {
                console.log('ğŸ”§ å¢å¼· toggleFullscreen æ–¹æ³•ä»¥æ”¯æ´ Safari');
                
                // ç­‰å¾… TouchControls è¼‰å…¥
                const waitForTouchControls = () => {
                    return new Promise((resolve) => {
                        const check = () => {
                            if (window.touchControls && window.touchControls.toggleFullscreen) {
                                resolve();
                            } else {
                                setTimeout(check, 100);
                            }
                        };
                        check();
                    });
                };
                
                waitForTouchControls().then(() => {
                    console.log('ğŸ”§ é–‹å§‹å¢å¼· TouchControls çš„ Safari æ”¯æ´');
                    
                    // ä¿å­˜ç•¶å‰çš„ toggleFullscreen æ–¹æ³•
                    const originalToggleFullscreen = window.touchControls.toggleFullscreen;
                    
                    // æ›¿æ›ç‚º Safari å…¼å®¹ç‰ˆæœ¬
                    window.touchControls.toggleFullscreen = async function() {
                        console.log('ğŸ åŸ·è¡Œ Safari å…¼å®¹å…¨è¢å¹•åˆ‡æ›');
                        
                        try {
                            const isCurrentlyFullscreen = window.isFullscreenCrossBrowser();
                            
                            if (!isCurrentlyFullscreen) {
                                console.log('ğŸ“± é€²å…¥ Safari å…¼å®¹å…¨è¢å¹•æ¨¡å¼');
                                
                                // ä½¿ç”¨è·¨ç€è¦½å™¨ API
                                await window.requestFullscreenCrossBrowser();
                                
                                // ç­‰å¾…ç‹€æ…‹ç©©å®š
                                await new Promise(resolve => setTimeout(resolve, 300));
                                
                                // é‡æ–°è¨ˆç®—åº§æ¨™
                                if (this.recalculateCoordinates) {
                                    this.recalculateCoordinates();
                                }
                                
                                // è§¸ç™¼ resize äº‹ä»¶
                                window.dispatchEvent(new Event('resize'));
                                
                                // å¦‚æœæœ‰ Phaser éŠæˆ²ï¼Œåˆ·æ–° scale
                                if (window.game && window.game.scale) {
                                    setTimeout(() => {
                                        window.game.scale.refresh();
                                        console.log('ğŸ® Phaser éŠæˆ² scale å·²åˆ·æ–°');
                                    }, 100);
                                }
                                
                                console.log('âœ… Safari å…¼å®¹å…¨è¢å¹•å·²å•Ÿç”¨');
                                
                            } else {
                                console.log('ğŸ“± é€€å‡º Safari å…¼å®¹å…¨è¢å¹•æ¨¡å¼');
                                
                                await window.exitFullscreenCrossBrowser();
                                
                                // ç­‰å¾…é€€å‡ºç‹€æ…‹ç©©å®š
                                await new Promise(resolve => setTimeout(resolve, 300));
                                
                                // é‡æ–°è¨ˆç®—åº§æ¨™
                                if (this.recalculateCoordinates) {
                                    this.recalculateCoordinates();
                                }
                                
                                // è§¸ç™¼ resize äº‹ä»¶
                                window.dispatchEvent(new Event('resize'));
                                
                                // åˆ·æ–° Phaser scale
                                if (window.game && window.game.scale) {
                                    setTimeout(() => {
                                        window.game.scale.refresh();
                                        console.log('ğŸ® Phaser éŠæˆ² scale å·²åˆ·æ–°');
                                    }, 100);
                                }
                                
                                console.log('âœ… å·²é€€å‡º Safari å…¼å®¹å…¨è¢å¹•');
                            }
                            
                        } catch (error) {
                            console.log('âŒ Safari å…¼å®¹å…¨è¢å¹•åˆ‡æ›å¤±æ•—:', error);
                            // å›é€€åˆ°åŸå§‹æ–¹æ³•
                            if (originalToggleFullscreen) {
                                originalToggleFullscreen.call(this);
                            }
                        }
                    };
                    
                    console.log('âœ… TouchControls Safari æ”¯æ´å¢å¼·å®Œæˆ');
                });
            }
            
            // åˆå§‹åŒ– Safari æ”¯æ´
            function initSafariFullscreenSupport() {
                console.log('ğŸš€ åˆå§‹åŒ– Safari å…¨è¢å¹•æ”¯æ´');
                
                // å‰µå»ºè·¨ç€è¦½å™¨ API
                createCrossBrowserFullscreenAPI();
                
                // æ·»åŠ  iOS æ¨£å¼
                addIOSFullscreenStyles();
                
                // å¢å¼· toggleFullscreen æ–¹æ³•
                enhanceToggleFullscreenForSafari();
                
                console.log('âœ… Safari å…¨è¢å¹•æ”¯æ´åˆå§‹åŒ–å®Œæˆ');
                
                // æ·»åŠ æ¸¬è©¦å‡½æ•¸
                window.testSafariFullscreen = function() {
                    console.log('ğŸ§ª æ¸¬è©¦ Safari å…¨è¢å¹•æ”¯æ´');
                    
                    const support = {
                        standardAPI: !!document.documentElement.requestFullscreen,
                        webkitAPI: !!document.documentElement.webkitRequestFullscreen,
                        oldWebkitAPI: !!document.documentElement.webkitRequestFullScreen,
                        mozAPI: !!document.documentElement.mozRequestFullScreen,
                        msAPI: !!document.documentElement.msRequestFullscreen,
                        isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
                        isSafari: /^((?!chrome|android).)*safari/i.test(navigator.userAgent),
                        currentFullscreen: window.isFullscreenCrossBrowser()
                    };
                    
                    console.log('ğŸ Safari å…¨è¢å¹•æ”¯æ´ç‹€æ…‹:', support);
                    return support;
                };
            }
            
            // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initSafariFullscreenSupport);
            } else {
                initSafariFullscreenSupport();
            }
        </script>
        <!-- Safari å…¨è¢å¹•æ”¯æ´çµæŸ -->
        <!-- ğŸ¯ é›™é‡å…¨è¢å¹•åŒæ­¥åŠŸèƒ½ - DUAL_FULLSCREEN_SYNC -->
        <script>
            console.log('ğŸ¯ è¼‰å…¥é›™é‡å…¨è¢å¹•åŒæ­¥åŠŸèƒ½');
            
            // ç­‰å¾… TouchControls å’Œåº§æ¨™åŒæ­¥è¼‰å…¥å®Œæˆ
            function waitForEnhancedTouchControls() {
                return new Promise((resolve) => {
                    const checkEnhanced = () => {
                        if (window.touchControls && 
                            window.touchControls.toggleFullscreen && 
                            window.touchControls.recalculateCoordinates) {
                            resolve();
                        } else {
                            setTimeout(checkEnhanced, 100);
                        }
                    };
                    checkEnhanced();
                });
            }
            
            // å¯¦ç¾é›™é‡å…¨è¢å¹•åŒæ­¥
            async function implementDualFullscreenSync() {
                await waitForEnhancedTouchControls();
                
                console.log('ğŸ”§ é–‹å§‹å¯¦ç¾é›™é‡å…¨è¢å¹•åŒæ­¥');
                
                // ä¿å­˜ç•¶å‰çš„åº§æ¨™åŒæ­¥ç‰ˆæœ¬
                const coordinateSyncToggleFullscreen = window.touchControls.toggleFullscreen;
                
                // æ›¿æ›ç‚ºé›™é‡åŒæ­¥ç‰ˆæœ¬
                window.touchControls.toggleFullscreen = async function() {
                    console.log('ğŸ¯ åŸ·è¡Œé›™é‡å…¨è¢å¹•åŒæ­¥åˆ‡æ›');
                    
                    try {
                        const isCurrentlyFullscreen = !!document.fullscreenElement;
                        const isInIframe = window !== window.parent;
                        
                        if (!isCurrentlyFullscreen) {
                            // é€²å…¥å…¨è¢å¹•
                            console.log('ğŸ“± é€²å…¥é›™é‡å…¨è¢å¹•æ¨¡å¼');
                            
                            // 1. è§¸ç™¼åŸç”Ÿ Fullscreen APIï¼ˆåº§æ¨™åŒæ­¥ç‰ˆæœ¬ï¼‰
                            await coordinateSyncToggleFullscreen.call(this);
                            
                            // 2. å¦‚æœåœ¨ iframe ä¸­ï¼Œé€šçŸ¥çˆ¶é é¢è§¸ç™¼ CSS å¼·åˆ¶å…¨è¢å¹•
                            if (isInIframe) {
                                console.log('ğŸ“¤ é€šçŸ¥çˆ¶é é¢è§¸ç™¼ CSS å¼·åˆ¶å…¨è¢å¹•');
                                window.parent.postMessage({
                                    type: 'DUAL_FULLSCREEN_REQUEST',
                                    action: 'ENTER_CSS_FULLSCREEN',
                                    timestamp: Date.now()
                                }, '*');
                            }
                            
                            // 3. ç­‰å¾…çˆ¶é é¢éŸ¿æ‡‰
                            await new Promise(resolve => setTimeout(resolve, 200));
                            
                            console.log('âœ… é›™é‡å…¨è¢å¹•ï¼ˆåŸç”Ÿ + CSSï¼‰å·²å•Ÿç”¨');
                            
                        } else {
                            // é€€å‡ºå…¨è¢å¹•
                            console.log('ğŸ“± é€€å‡ºé›™é‡å…¨è¢å¹•æ¨¡å¼');
                            
                            // 1. å¦‚æœåœ¨ iframe ä¸­ï¼Œé€šçŸ¥çˆ¶é é¢é€€å‡º CSS å¼·åˆ¶å…¨è¢å¹•
                            if (isInIframe) {
                                console.log('ğŸ“¤ é€šçŸ¥çˆ¶é é¢é€€å‡º CSS å¼·åˆ¶å…¨è¢å¹•');
                                window.parent.postMessage({
                                    type: 'DUAL_FULLSCREEN_REQUEST',
                                    action: 'EXIT_CSS_FULLSCREEN',
                                    timestamp: Date.now()
                                }, '*');
                            }
                            
                            // 2. è§¸ç™¼åŸç”Ÿ Fullscreen API é€€å‡ºï¼ˆåº§æ¨™åŒæ­¥ç‰ˆæœ¬ï¼‰
                            await coordinateSyncToggleFullscreen.call(this);
                            
                            console.log('âœ… é›™é‡å…¨è¢å¹•å·²é€€å‡º');
                        }
                        
                    } catch (error) {
                        console.log('âŒ é›™é‡å…¨è¢å¹•åŒæ­¥å¤±æ•—:', error);
                        // å›é€€åˆ°åº§æ¨™åŒæ­¥ç‰ˆæœ¬
                        coordinateSyncToggleFullscreen.call(this);
                    }
                };
                
                // ç›£è½ä¾†è‡ªçˆ¶é é¢çš„éŸ¿æ‡‰
                window.addEventListener('message', (event) => {
                    if (event.data.type === 'DUAL_FULLSCREEN_RESPONSE') {
                        console.log('ğŸ“¥ æ”¶åˆ°çˆ¶é é¢éŸ¿æ‡‰:', event.data);
                        
                        switch (event.data.action) {
                            case 'CSS_FULLSCREEN_ENABLED':
                                console.log('âœ… çˆ¶é é¢ CSS å¼·åˆ¶å…¨è¢å¹•å·²å•Ÿç”¨');
                                break;
                            case 'CSS_FULLSCREEN_DISABLED':
                                console.log('âœ… çˆ¶é é¢ CSS å¼·åˆ¶å…¨è¢å¹•å·²åœç”¨');
                                break;
                            case 'CSS_FULLSCREEN_ERROR':
                                console.log('âŒ çˆ¶é é¢ CSS å¼·åˆ¶å…¨è¢å¹•éŒ¯èª¤:', event.data.error);
                                break;
                        }
                    }
                });
                
                console.log('âœ… é›™é‡å…¨è¢å¹•åŒæ­¥åŠŸèƒ½å¯¦ç¾å®Œæˆ');
                
                // æ·»åŠ æ¸¬è©¦å‡½æ•¸
                window.testDualFullscreen = function() {
                    console.log('ğŸ§ª æ¸¬è©¦é›™é‡å…¨è¢å¹•åŠŸèƒ½');
                    
                    const status = {
                        isInIframe: window !== window.parent,
                        nativeFullscreen: !!document.fullscreenElement,
                        viewport: {
                            width: window.innerWidth,
                            height: window.innerHeight
                        },
                        touchControls: !!window.touchControls,
                        dualSyncEnabled: true
                    };
                    
                    console.log('ğŸ“Š é›™é‡å…¨è¢å¹•ç‹€æ…‹:', status);
                    return status;
                };
                
                // æ·»åŠ å¼·åˆ¶åŒæ­¥å‡½æ•¸
                window.forceDualFullscreenSync = async function() {
                    console.log('ğŸ”§ å¼·åˆ¶åŸ·è¡Œé›™é‡å…¨è¢å¹•åŒæ­¥');
                    
                    if (window.touchControls && window.touchControls.toggleFullscreen) {
                        await window.touchControls.toggleFullscreen();
                    }
                    
                    console.log('âœ… å¼·åˆ¶åŒæ­¥å®Œæˆ');
                };
            }
            
            // é é¢è¼‰å…¥å®Œæˆå¾Œå¯¦ç¾é›™é‡åŒæ­¥
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', implementDualFullscreenSync);
            } else {
                implementDualFullscreenSync();
            }
        </script>
        <!-- é›™é‡å…¨è¢å¹•åŒæ­¥åŠŸèƒ½çµæŸ -->
        <!-- åº§æ¨™åŒæ­¥è§£æ±ºæ–¹æ¡ˆçµæŸ -->
    </body>
</html>
