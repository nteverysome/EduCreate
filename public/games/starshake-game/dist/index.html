<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduCreate - Starshake</title>

    <style>
        /* reset CSS */
        html, body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            font-family: 'Open Sans', sans-serif;
        }

        #app {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-container {
            width: 100%;
            height: 100%;
            max-width: 1000px;
            max-height: 800px;
        }
    </style>
  <script type="module" crossorigin src="/games/starshake-game/dist/assets/index-DEhXC0VF.js"></script>
  <link rel="modulepreload" crossorigin href="/games/starshake-game/dist/assets/phaser-CmFXOKba.js">

    <!-- Ëß∏Êë∏ÊéßÂà∂Ê®£Âºè -->
    

    <!-- Ëß∏Êë∏ÊéßÂà∂Ê®£Âºè -->
    <style>
        /* Ëß∏Êë∏ÊéßÂà∂Èù¢Êùø */
        #touch-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: transparent;
            display: none;
            z-index: 1000;
            pointer-events: none;
        }
        
        /* ÁßªÂãïÊéßÂà∂ÂçÄÂüü */
        .touch-joystick {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 120px;
            height: 120px;
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            pointer-events: all;
        }
        
        .touch-joystick-knob {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 40px;
            height: 40px;
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s ease;
        }
        
        /* Â∞ÑÊìäÊåâÈàï */
        .touch-shoot-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: transparent;
            border: 2px solid rgba(255, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 0, 0, 0.8);
            font-size: 24px;
            font-weight: bold;
            pointer-events: all;
            user-select: none;
        }
        
        .touch-shoot-btn:active {
            background: rgba(255, 0, 0, 0.2);
            border-color: rgba(255, 0, 0, 0.8);
            transform: scale(0.95);
        }
        
        /* ÁßªÂãïË®≠ÂÇôÊ™¢Ê∏¨ */
        @media (max-width: 768px), (pointer: coarse) {
            #touch-controls {
                display: block;
            }
        }
        
        /* ÂÖ®Ëû¢ÂπïÊåâÈàï */
        .fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            pointer-events: all;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="game-container"></div>
        
        <!-- Ëß∏Êë∏ÊéßÂà∂Èù¢Êùø -->
        <div id="touch-controls">
            <!-- ÁßªÂãïÊêñÊ°ø -->
            <div class="touch-joystick" id="touch-joystick">
                <div class="touch-joystick-knob" id="joystick-knob"></div>
            </div>
            
            <!-- Â∞ÑÊìäÊåâÈàï -->
            <div class="touch-shoot-btn" id="touch-shoot">
                üöÄ
            </div>
            
            <!-- ÂÖ®Ëû¢ÂπïÊåâÈàï -->
            <div class="fullscreen-btn" id="fullscreen-btn">
                ‚õ∂
            </div>
        </div>
    </div>
    
    <!-- Ëß∏Êë∏ÊéßÂà∂ JavaScript -->
    <script>
        // Ëß∏Êë∏ÊéßÂà∂Á≥ªÁµ±
        // Ëß∏Êë∏ÊéßÂà∂Á≥ªÁµ±
        class TouchControls {
            constructor() {
                this.joystick = document.getElementById('touch-joystick');
                this.knob = document.getElementById('joystick-knob');
                this.shootBtn = document.getElementById('touch-shoot');
                this.fullscreenBtn = document.getElementById('fullscreen-btn');
                
                this.joystickActive = false;
                this.joystickCenter = { x: 0, y: 0 };
                this.currentDirection = { x: 0, y: 0 };
                this.shooting = false;
                
                // Ë™øË©¶Ê®ôË™å
                this.debug = true;
                
                this.init();
            }
            
            init() {
                if (this.debug) console.log('üéÆ TouchControls ÂàùÂßãÂåñÈñãÂßã...');
                
                // Ê™¢Êü•ÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
                if (!this.joystick || !this.knob || !this.shootBtn) {
                    console.error('‚ùå TouchControls ÂÖÉÁ¥†Êú™ÊâæÂà∞:', {
                        joystick: !!this.joystick,
                        knob: !!this.knob,
                        shootBtn: !!this.shootBtn
                    });
                    return;
                }
                
                // ÊêñÊ°øÊéßÂà∂ - Ê∑ªÂä†Â§öÁ®Æ‰∫ã‰ª∂È°ûÂûã
                this.joystick.addEventListener('touchstart', this.onJoystickStart.bind(this), { passive: false });
                this.joystick.addEventListener('touchmove', this.onJoystickMove.bind(this), { passive: false });
                this.joystick.addEventListener('touchend', this.onJoystickEnd.bind(this), { passive: false });
                this.joystick.addEventListener('touchcancel', this.onJoystickEnd.bind(this), { passive: false });
                
                // Ê∑ªÂä†Èº†Ê®ô‰∫ã‰ª∂‰ΩúÁÇ∫ÂÇôÁî®ÔºàÁî®ÊñºÊ°åÈù¢Ê∏¨Ë©¶Ôºâ
                this.joystick.addEventListener('mousedown', this.onJoystickStartMouse.bind(this));
                this.joystick.addEventListener('mousemove', this.onJoystickMoveMouse.bind(this));
                this.joystick.addEventListener('mouseup', this.onJoystickEndMouse.bind(this));
                this.joystick.addEventListener('mouseleave', this.onJoystickEndMouse.bind(this));
                
                // Â∞ÑÊìäÊåâÈàï
                this.shootBtn.addEventListener('touchstart', this.onShootStart.bind(this), { passive: false });
                this.shootBtn.addEventListener('touchend', this.onShootEnd.bind(this), { passive: false });
                this.shootBtn.addEventListener('touchcancel', this.onShootEnd.bind(this), { passive: false });
                
                // Èº†Ê®ô‰∫ã‰ª∂‰ΩúÁÇ∫ÂÇôÁî®
                this.shootBtn.addEventListener('mousedown', this.onShootStart.bind(this));
                this.shootBtn.addEventListener('mouseup', this.onShootEnd.bind(this));
                
                // ÂÖ®Ëû¢ÂπïÊåâÈàï
                if (this.fullscreenBtn) {
                    this.fullscreenBtn.addEventListener('click', this.toggleFullscreen.bind(this));
                    this.fullscreenBtn.addEventListener('touchend', this.toggleFullscreen.bind(this));
                }
                
                // Èò≤Ê≠¢ÈªòË™çËß∏Êë∏Ë°åÁÇ∫
                document.addEventListener('touchmove', (e) => {
                    if (e.target.closest('#touch-controls')) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                // Èò≤Ê≠¢‰∏ä‰∏ãÊñáËèúÂñÆ
                document.addEventListener('contextmenu', (e) => {
                    if (e.target.closest('#touch-controls')) {
                        e.preventDefault();
                    }
                });
                
                if (this.debug) console.log('‚úÖ TouchControls ‰∫ã‰ª∂Áõ£ËÅΩÂô®Â∑≤Ë®≠ÁΩÆ');
            }
            
            onJoystickStart(e) {
                e.preventDefault();
                if (this.debug) console.log('üïπÔ∏è ÊêñÊ°øËß∏Êë∏ÈñãÂßã');
                this.joystickActive = true;
                const rect = this.joystick.getBoundingClientRect();
                this.joystickCenter = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
                if (this.debug) console.log('üìç ÊêñÊ°ø‰∏≠ÂøÉ:', this.joystickCenter);
            }
            
            onJoystickStartMouse(e) {
                e.preventDefault();
                if (this.debug) console.log('üñ±Ô∏è ÊêñÊ°øÈº†Ê®ôÈñãÂßã');
                this.joystickActive = true;
                const rect = this.joystick.getBoundingClientRect();
                this.joystickCenter = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
            }
            
            onJoystickMove(e) {
                if (!this.joystickActive) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                if (!touch) return;
                
                this.updateJoystickPosition(touch.clientX, touch.clientY);
            }
            
            onJoystickMoveMouse(e) {
                if (!this.joystickActive) return;
                e.preventDefault();
                
                this.updateJoystickPosition(e.clientX, e.clientY);
            }
            
            updateJoystickPosition(clientX, clientY) {
                const deltaX = clientX - this.joystickCenter.x;
                const deltaY = clientY - this.joystickCenter.y;
                
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const maxDistance = 40;
                
                if (distance <= maxDistance) {
                    this.knob.style.transform = `translate(${deltaX - 20}px, ${deltaY - 20}px)`;
                    this.currentDirection = {
                        x: deltaX / maxDistance,
                        y: deltaY / maxDistance
                    };
                } else {
                    const angle = Math.atan2(deltaY, deltaX);
                    const limitedX = Math.cos(angle) * maxDistance;
                    const limitedY = Math.sin(angle) * maxDistance;
                    
                    this.knob.style.transform = `translate(${limitedX - 20}px, ${limitedY - 20}px)`;
                    this.currentDirection = {
                        x: Math.cos(angle),
                        y: Math.sin(angle)
                    };
                }
                
                if (this.debug && Math.abs(this.currentDirection.x) > 0.1 || Math.abs(this.currentDirection.y) > 0.1) {
                    console.log('üéØ ÊêñÊ°øÊñπÂêë:', this.currentDirection);
                }
            }
            
            onJoystickEnd(e) {
                e.preventDefault();
                if (this.debug) console.log('üïπÔ∏è ÊêñÊ°øËß∏Êë∏ÁµêÊùü');
                this.joystickActive = false;
                this.knob.style.transform = 'translate(-50%, -50%)';
                this.currentDirection = { x: 0, y: 0 };
            }
            
            onJoystickEndMouse(e) {
                e.preventDefault();
                if (this.debug) console.log('üñ±Ô∏è ÊêñÊ°øÈº†Ê®ôÁµêÊùü');
                this.joystickActive = false;
                this.knob.style.transform = 'translate(-50%, -50%)';
                this.currentDirection = { x: 0, y: 0 };
            }
            
            onShootStart(e) {
                e.preventDefault();
                if (this.debug) console.log('üöÄ Â∞ÑÊìäÈñãÂßã');
                this.shooting = true;
                // Ê∑ªÂä†Ë¶ñË¶∫ÂèçÈ•ã
                this.shootBtn.style.transform = 'scale(0.9)';
                this.shootBtn.style.backgroundColor = '#ff6b6b';
            }
            
            onShootEnd(e) {
                e.preventDefault();
                if (this.debug) console.log('üöÄ Â∞ÑÊìäÁµêÊùü');
                this.shooting = false;
                // ÊÅ¢Âæ©Ë¶ñË¶∫ÂèçÈ•ã
                this.shootBtn.style.transform = 'scale(1)';
                this.shootBtn.style.backgroundColor = '#ff4757';
            }
            
            toggleFullscreen() {
                if (this.debug) console.log('üñ•Ô∏è ÂàáÊèõÂÖ®Ëû¢Âπï');
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log('ÂÖ®Ëû¢ÂπïË´ãÊ±ÇÂ§±Êïó:', err);
                    });
                } else {
                    document.exitFullscreen().catch(err => {
                        console.log('ÈÄÄÂá∫ÂÖ®Ëû¢ÂπïÂ§±Êïó:', err);
                    });
                }
            }
            
            // Áç≤ÂèñÁï∂ÂâçËº∏ÂÖ•ÁãÄÊÖã
            getInputState() {
                const state = {
                    direction: { ...this.currentDirection },
                    shooting: this.shooting
                };
                
                // Âè™Âú®ÁãÄÊÖãËÆäÂåñÊôÇË®òÈåÑ
                if (this.debug && (Math.abs(state.direction.x) > 0.1 || Math.abs(state.direction.y) > 0.1 || state.shooting)) {
                    console.log('üìä Áï∂ÂâçÁãÄÊÖã:', state);
                }
                
                return state;
            }
            
            // Ê∏¨Ë©¶ÊñπÊ≥ï
            testControls() {
                console.log('üß™ TouchControls Ê∏¨Ë©¶:');
                console.log('  - ÊêñÊ°øÂÖÉÁ¥†:', !!this.joystick);
                console.log('  - ÊêñÊ°øÊóãÈàï:', !!this.knob);
                console.log('  - Â∞ÑÊìäÊåâÈàï:', !!this.shootBtn);
                console.log('  - ÂÖ®Ëû¢ÂπïÊåâÈàï:', !!this.fullscreenBtn);
                console.log('  - Áï∂ÂâçÁãÄÊÖã:', this.getInputState());
                return true;
            }
        }
        
        // ÂàùÂßãÂåñËß∏Êë∏ÊéßÂà∂
        window.touchControls = new TouchControls();
        
        // Ê∑ªÂä†Ê∏¨Ë©¶ÊñπÊ≥ïÂà∞ window
        window.testTouchControls = () => window.touchControls.testControls();
        
        console.log('üéÆ Ëß∏Êë∏ÊéßÂà∂Á≥ªÁµ±Â∑≤ÂàùÂßãÂåñ');
        console.log('üí° ‰ΩøÁî® testTouchControls() ÈÄ≤Ë°åÊ∏¨Ë©¶');
        
        // Ë™øË©¶ÂäüËÉΩ
        window.toggleTouchDebug = function() {
            document.body.classList.toggle('touch-debug');
            console.log('üêõ TouchControls Ë™øË©¶Ê®°Âºè:', document.body.classList.contains('touch-debug') ? 'ÈñãÂïü' : 'ÈóúÈñâ');
        };
        
        // Âº∑Âà∂È°ØÁ§∫ TouchControlsÔºàÁî®ÊñºÊ∏¨Ë©¶Ôºâ
        window.forceTouchControls = function(show = true) {
            const controls = document.getElementById('touch-controls');
            if (controls) {
                controls.style.display = show ? 'block' : 'none';
                console.log('üéÆ TouchControls Âº∑Âà∂È°ØÁ§∫:', show);
            }
        };
        
        // Ê™¢Êü•Â™íÈ´îÊü•Ë©¢
        window.checkMediaQueries = function() {
            const queries = [
                '(max-width: 1024px)',
                '(max-height: 768px)',
                '(pointer: coarse)',
                '(hover: none) and (pointer: coarse)',
                '(min-width: 768px) and (max-width: 1024px)',
                '(min-width: 414px) and (max-width: 768px)'
            ];
            
            console.log('üì± Â™íÈ´îÊü•Ë©¢Ê™¢Êü•:');
            queries.forEach(query => {
                const matches = window.matchMedia(query).matches;
                console.log(`  ${query}: ${matches ? '‚úÖ' : '‚ùå'}`);
            });
            
            const controls = document.getElementById('touch-controls');
            const isVisible = controls && window.getComputedStyle(controls).display !== 'none';
            console.log(`üéÆ TouchControls ÂèØË¶ã: ${isVisible ? '‚úÖ' : '‚ùå'}`);
        };
    </script>

    <!-- ÂïüÂãïÁï´Èù¢ÈªûÊìäÊîØÊè¥ JavaScript -->
    <script>
        // ÂïüÂãïÁï´Èù¢ÈªûÊìäÂíåËß∏Êë∏ÊîØÊè¥
        window.addStartScreenClickSupport = function() {
            console.log('üéÆ Ê∑ªÂä†ÂïüÂãïÁï´Èù¢ÈªûÊìäÂíåËß∏Êë∏ÊîØÊè¥');
            
            // Á≠âÂæÖ Phaser ÈÅäÊà≤ÂàùÂßãÂåñ
            const checkPhaserGame = setInterval(() => {
                if (window.game && window.game.scene && window.game.scene.scenes.length > 0) {
                    clearInterval(checkPhaserGame);
                    
                    // Êü•Êâæ splash Â†¥ÊôØ
                    const splashScene = window.game.scene.scenes.find(scene => scene.scene.key === 'splash');
                    
                    if (splashScene && splashScene.scene.isActive()) {
                        console.log('üéØ ÊâæÂà∞ splash Â†¥ÊôØÔºåÊ∑ªÂä†ÈªûÊìäÊîØÊè¥');
                        addClickSupportToSplash(splashScene);
                    } else {
                        // Áõ£ËÅΩÂ†¥ÊôØÂàáÊèõÔºåÁï∂ splash Â†¥ÊôØÂïüÂãïÊôÇÊ∑ªÂä†ÊîØÊè¥
                        window.game.events.on('scenestart', (scene) => {
                            if (scene.scene.key === 'splash') {
                                console.log('üéØ splash Â†¥ÊôØÂïüÂãïÔºåÊ∑ªÂä†ÈªûÊìäÊîØÊè¥');
                                setTimeout(() => addClickSupportToSplash(scene), 100);
                            }
                        });
                    }
                }
            }, 100);
            
            // ÁÇ∫ splash Â†¥ÊôØÊ∑ªÂä†ÈªûÊìäÂíåËß∏Êë∏ÊîØÊè¥
            function addClickSupportToSplash(scene) {
                if (scene.clickSupportAdded) return;
                scene.clickSupportAdded = true;
                
                console.log('‚úÖ ÁÇ∫ splash Â†¥ÊôØÊ∑ªÂä†ÈªûÊìäÂíåËß∏Êë∏ÊîØÊè¥');
                
                // Ê∑ªÂä†ÈªûÊìä‰∫ã‰ª∂Áõ£ËÅΩÂô®
                scene.input.on('pointerdown', () => {
                    console.log('üñ±Ô∏è Ê™¢Ê∏¨Âà∞ÈªûÊìäÔºåÈñãÂßãÈÅäÊà≤');
                    if (scene.transitionToChange && typeof scene.transitionToChange === 'function') {
                        scene.transitionToChange();
                    }
                });
                
                // Ê∑ªÂä†Ëß∏Êë∏‰∫ã‰ª∂Áõ£ËÅΩÂô®ÔºàÂÇôÁî®Ôºâ
                const canvas = scene.sys.game.canvas;
                if (canvas) {
                    const touchStartHandler = (e) => {
                        e.preventDefault();
                        console.log('üëÜ Ê™¢Ê∏¨Âà∞Ëß∏Êë∏ÔºåÈñãÂßãÈÅäÊà≤');
                        if (scene.transitionToChange && typeof scene.transitionToChange === 'function') {
                            scene.transitionToChange();
                        }
                    };
                    
                    canvas.addEventListener('touchstart', touchStartHandler, { passive: false });
                    canvas.addEventListener('click', touchStartHandler);
                    
                    // Ê∏ÖÁêÜÂáΩÊï∏
                    scene.events.once('shutdown', () => {
                        canvas.removeEventListener('touchstart', touchStartHandler);
                        canvas.removeEventListener('click', touchStartHandler);
                    });
                }
                
                // Ê∑ªÂä†Ë¶ñË¶∫ÊèêÁ§∫
                const instructionText = scene.add.bitmapText(
                    scene.center_width, 
                    scene.center_height + 150, 
                    "wendy", 
                    "ÈªûÊìä‰ªªÊÑè‰ΩçÁΩÆÊàñÊåâ SPACE ÈñãÂßã", 
                    40
                ).setOrigin(0.5);
                
                // ÈñÉÁàçÊïàÊûú
                scene.tweens.add({
                    targets: instructionText,
                    alpha: { from: 0.3, to: 1 },
                    duration: 800,
                    repeat: -1,
                    yoyo: true
                });
            }
        };
        
        // Áï∂È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', window.addStartScreenClickSupport);
        } else {
            window.addStartScreenClickSupport();
        }
    </script>


        <!-- üéØ Â∫ßÊ®ôÂêåÊ≠•Ëß£Ê±∫ÊñπÊ°à - COORDINATE_SYNC_SOLUTION -->
        <script>
            console.log('üéØ ËºâÂÖ•Â∫ßÊ®ôÂêåÊ≠•Ëß£Ê±∫ÊñπÊ°à');
            
            // Á≠âÂæÖ TouchControls ËºâÂÖ•ÂÆåÊàê
            function waitForTouchControls() {
                return new Promise((resolve) => {
                    const checkTouchControls = () => {
                        if (window.touchControls && window.touchControls.toggleFullscreen) {
                            resolve();
                        } else {
                            setTimeout(checkTouchControls, 100);
                        }
                    };
                    checkTouchControls();
                });
            }
            
            // ÂØ¶ÁèæÂ∫ßÊ®ôÂêåÊ≠•ÁöÑÂÖ®Ëû¢ÂπïÂàáÊèõ
            async function implementCoordinateSync() {
                await waitForTouchControls();
                
                console.log('üîß ÈñãÂßãÂØ¶ÁèæÂ∫ßÊ®ôÂêåÊ≠•');
                
                // ‰øùÂ≠òÂéüÂßãÁöÑÂÖ®Ëû¢ÂπïÂàáÊèõÂáΩÊï∏
                const originalToggleFullscreen = window.touchControls.toggleFullscreen;
                
                // ÊõøÊèõÁÇ∫Â∫ßÊ®ôÂêåÊ≠•ÁâàÊú¨
                window.touchControls.toggleFullscreen = async function() {
                    console.log('üéØ Âü∑Ë°åÂ∫ßÊ®ôÂêåÊ≠•ÂÖ®Ëû¢ÂπïÂàáÊèõ');
                    
                    try {
                        const isCurrentlyFullscreen = !!document.fullscreenElement;
                        
                        if (!isCurrentlyFullscreen) {
                            // ÈÄ≤ÂÖ•ÂÖ®Ëû¢Âπï
                            console.log('üì± ÈÄ≤ÂÖ•ÂÖ®Ëû¢ÂπïÊ®°Âºè');
                            
                            // 1. Ëß∏ÁôºÂéüÁîü Fullscreen API
                            await document.documentElement.requestFullscreen();
                            console.log('‚úÖ ÂéüÁîüÂÖ®Ëû¢ÂπïÂ∑≤Ëß∏Áôº');
                            
                            // 2. Á≠âÂæÖÂÖ®Ëû¢ÂπïÁãÄÊÖãÁ©©ÂÆö
                            await new Promise(resolve => setTimeout(resolve, 300));
                            
                            // 3. ÈáçÊñ∞Ë®àÁÆóÂ∫ßÊ®ô
                            this.recalculateCoordinates();
                            
                            // 4. Ëß∏Áôº resize ‰∫ã‰ª∂ËÆì Phaser ÈáçÊñ∞Ë®àÁÆó
                            window.dispatchEvent(new Event('resize'));
                            
                            // 5. Â¶ÇÊûúÊúâ Phaser ÈÅäÊà≤ÔºåÂà∑Êñ∞ scale
                            if (window.game && window.game.scale) {
                                setTimeout(() => {
                                    window.game.scale.refresh();
                                    console.log('üéÆ Phaser ÈÅäÊà≤ scale Â∑≤Âà∑Êñ∞');
                                }, 100);
                            }
                            
                        } else {
                            // ÈÄÄÂá∫ÂÖ®Ëû¢Âπï
                            console.log('üì± ÈÄÄÂá∫ÂÖ®Ëû¢ÂπïÊ®°Âºè');
                            
                            await document.exitFullscreen();
                            console.log('‚úÖ Â∑≤ÈÄÄÂá∫ÂéüÁîüÂÖ®Ëû¢Âπï');
                            
                            // Á≠âÂæÖÈÄÄÂá∫ÁãÄÊÖãÁ©©ÂÆö
                            await new Promise(resolve => setTimeout(resolve, 300));
                            
                            // ÈáçÊñ∞Ë®àÁÆóÂ∫ßÊ®ô
                            this.recalculateCoordinates();
                            
                            // Ëß∏Áôº resize ‰∫ã‰ª∂
                            window.dispatchEvent(new Event('resize'));
                            
                            // Âà∑Êñ∞ Phaser scale
                            if (window.game && window.game.scale) {
                                setTimeout(() => {
                                    window.game.scale.refresh();
                                    console.log('üéÆ Phaser ÈÅäÊà≤ scale Â∑≤Âà∑Êñ∞');
                                }, 100);
                            }
                        }
                        
                        console.log('‚úÖ Â∫ßÊ®ôÂêåÊ≠•ÂÖ®Ëû¢ÂπïÂàáÊèõÂÆåÊàê');
                        
                    } catch (error) {
                        console.log('‚ùå Â∫ßÊ®ôÂêåÊ≠•ÂÖ®Ëû¢ÂπïÂàáÊèõÂ§±Êïó:', error);
                        // ÂõûÈÄÄÂà∞ÂéüÂßãÊñπÊ≥ï
                        originalToggleFullscreen.call(this);
                    }
                };
                
                // Ê∑ªÂä†Â∫ßÊ®ôÈáçÊñ∞Ë®àÁÆóÊñπÊ≥ï
                window.touchControls.recalculateCoordinates = function() {
                    console.log('üîÑ ÈáçÊñ∞Ë®àÁÆó TouchControls Â∫ßÊ®ô');
                    
                    // ÈáçÊñ∞Ë®àÁÆóÊêñÊ°ø‰∏≠ÂøÉÂ∫ßÊ®ô
                    if (this.joystick) {
                        const rect = this.joystick.getBoundingClientRect();
                        this.joystickCenter = {
                            x: rect.left + rect.width / 2,
                            y: rect.top + rect.height / 2
                        };
                        console.log('üïπÔ∏è ÊêñÊ°ø‰∏≠ÂøÉÂ∫ßÊ®ôÂ∑≤Êõ¥Êñ∞:', this.joystickCenter);
                    }
                    
                    // ÈáçÊñ∞Ë®àÁÆóÂ∞ÑÊìäÊåâÈàïÂ∫ßÊ®ô
                    if (this.shootBtn) {
                        const rect = this.shootBtn.getBoundingClientRect();
                        console.log('üöÄ Â∞ÑÊìäÊåâÈàïÂ∫ßÊ®ôÂ∑≤Êõ¥Êñ∞:', {
                            left: rect.left,
                            top: rect.top,
                            width: rect.width,
                            height: rect.height
                        });
                    }
                    
                    // ÈáçÊñ∞Ë®àÁÆóÂÖ®Ëû¢ÂπïÊåâÈàïÂ∫ßÊ®ô
                    const fullscreenBtn = document.querySelector('.fullscreen-btn');
                    if (fullscreenBtn) {
                        const rect = fullscreenBtn.getBoundingClientRect();
                        console.log('‚õ∂ ÂÖ®Ëû¢ÂπïÊåâÈàïÂ∫ßÊ®ôÂ∑≤Êõ¥Êñ∞:', {
                            left: rect.left,
                            top: rect.top,
                            width: rect.width,
                            height: rect.height
                        });
                    }
                };
                
                // Áõ£ËÅΩÂÖ®Ëû¢ÂπïÁãÄÊÖãËÆäÂåñ
                document.addEventListener('fullscreenchange', () => {
                    console.log('üîÑ ÂÖ®Ëû¢ÂπïÁãÄÊÖãËÆäÂåñÔºåÈáçÊñ∞Ë®àÁÆóÂ∫ßÊ®ô');
                    setTimeout(() => {
                        if (window.touchControls && window.touchControls.recalculateCoordinates) {
                            window.touchControls.recalculateCoordinates();
                        }
                    }, 200);
                });
                
                // Áõ£ËÅΩ resize ‰∫ã‰ª∂
                window.addEventListener('resize', () => {
                    console.log('üîÑ Ë¶ñÁ™óÂ§ßÂ∞èËÆäÂåñÔºåÈáçÊñ∞Ë®àÁÆóÂ∫ßÊ®ô');
                    setTimeout(() => {
                        if (window.touchControls && window.touchControls.recalculateCoordinates) {
                            window.touchControls.recalculateCoordinates();
                        }
                    }, 100);
                });
                
                console.log('‚úÖ Â∫ßÊ®ôÂêåÊ≠•Ëß£Ê±∫ÊñπÊ°àÂØ¶ÁèæÂÆåÊàê');
                
                // Ê∑ªÂä†Ê∏¨Ë©¶ÂáΩÊï∏
                window.testCoordinateSync = function() {
                    console.log('üß™ Ê∏¨Ë©¶Â∫ßÊ®ôÂêåÊ≠•ÂäüËÉΩ');
                    
                    const currentCoords = {
                        viewport: {
                            width: window.innerWidth,
                            height: window.innerHeight
                        },
                        isFullscreen: !!document.fullscreenElement,
                        touchControls: {}
                    };
                    
                    if (window.touchControls) {
                        if (window.touchControls.joystickCenter) {
                            currentCoords.touchControls.joystickCenter = window.touchControls.joystickCenter;
                        }
                        
                        const joystick = document.querySelector('.touch-joystick');
                        if (joystick) {
                            const rect = joystick.getBoundingClientRect();
                            currentCoords.touchControls.joystick = {
                                left: rect.left,
                                top: rect.top,
                                width: rect.width,
                                height: rect.height
                            };
                        }
                    }
                    
                    console.log('üìä Áï∂ÂâçÂ∫ßÊ®ôÁãÄÊÖã:', currentCoords);
                    return currentCoords;
                };
                
                // Ê∑ªÂä†Âº∑Âà∂ÈáçÊñ∞Ë®àÁÆóÂáΩÊï∏
                window.forceRecalculateCoordinates = function() {
                    console.log('üîß Âº∑Âà∂ÈáçÊñ∞Ë®àÁÆóÊâÄÊúâÂ∫ßÊ®ô');
                    
                    if (window.touchControls && window.touchControls.recalculateCoordinates) {
                        window.touchControls.recalculateCoordinates();
                    }
                    
                    // Ëß∏Áôº Phaser ÈáçÊñ∞Ë®àÁÆó
                    window.dispatchEvent(new Event('resize'));
                    
                    if (window.game && window.game.scale) {
                        window.game.scale.refresh();
                    }
                    
                    console.log('‚úÖ Âº∑Âà∂ÈáçÊñ∞Ë®àÁÆóÂÆåÊàê');
                };
            }
            
            // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂØ¶ÁèæÂ∫ßÊ®ôÂêåÊ≠•
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', implementCoordinateSync);
            } else {
                implementCoordinateSync();
            }
        </script>
        
        
        <!-- üçé Safari ÂÖ®Ëû¢ÂπïÊîØÊè¥ - SAFARI_FULLSCREEN_SUPPORT -->
        <script>
            console.log('üçé ËºâÂÖ• Safari ÂÖ®Ëû¢ÂπïÊîØÊè¥');
            
            // Ë∑®ÁÄèË¶ΩÂô®ÂÖ®Ëû¢Âπï API ÂÖºÂÆπÊÄßÂáΩÊï∏
            function createCrossBrowserFullscreenAPI() {
                console.log('üîß ÂâµÂª∫Ë∑®ÁÄèË¶ΩÂô®ÂÖ®Ëû¢Âπï API');
                
                // Ê™¢Ê∏¨ÁÄèË¶ΩÂô®È°ûÂûã
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
                const isWebKit = 'webkitRequestFullscreen' in document.documentElement;
                
                console.log('üîç ÁÄèË¶ΩÂô®Ê™¢Ê∏¨:', {
                    isIOS: isIOS,
                    isSafari: isSafari,
                    isWebKit: isWebKit,
                    userAgent: navigator.userAgent
                });
                
                // Ë∑®ÁÄèË¶ΩÂô®Ë´ãÊ±ÇÂÖ®Ëû¢ÂπïÂáΩÊï∏
                window.requestFullscreenCrossBrowser = function(element = document.documentElement) {
                    console.log('üì± Âü∑Ë°åË∑®ÁÄèË¶ΩÂô®ÂÖ®Ëû¢ÂπïË´ãÊ±Ç');
                    
                    return new Promise((resolve, reject) => {
                        try {
                            // Ê®ôÊ∫ñ Fullscreen API
                            if (element.requestFullscreen) {
                                console.log('‚úÖ ‰ΩøÁî®Ê®ôÊ∫ñ requestFullscreen');
                                element.requestFullscreen().then(resolve).catch(reject);
                            }
                            // WebKit (Safari)
                            else if (element.webkitRequestFullscreen) {
                                console.log('üçé ‰ΩøÁî® WebKit webkitRequestFullscreen');
                                element.webkitRequestFullscreen();
                                resolve();
                            }
                            // WebKit (ËàäÁâà)
                            else if (element.webkitRequestFullScreen) {
                                console.log('üçé ‰ΩøÁî®ËàäÁâà WebKit webkitRequestFullScreen');
                                element.webkitRequestFullScreen();
                                resolve();
                            }
                            // Mozilla
                            else if (element.mozRequestFullScreen) {
                                console.log('ü¶ä ‰ΩøÁî® Mozilla mozRequestFullScreen');
                                element.mozRequestFullScreen();
                                resolve();
                            }
                            // Microsoft
                            else if (element.msRequestFullscreen) {
                                console.log('ü™ü ‰ΩøÁî® Microsoft msRequestFullscreen');
                                element.msRequestFullscreen();
                                resolve();
                            }
                            // iOS Safari ÁâπÊÆäËôïÁêÜ
                            else if (isIOS) {
                                console.log('üì± iOS Safari ÁâπÊÆäËôïÁêÜ');
                                // iOS Safari ‰∏çÊîØÊè¥ÁúüÊ≠£ÁöÑÂÖ®Ëû¢ÂπïÔºå‰ΩøÁî® CSS Ê®°Êì¨
                                document.body.classList.add('ios-fullscreen-simulation');
                                resolve();
                            }
                            else {
                                console.log('‚ùå ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥ÂÖ®Ëû¢Âπï API');
                                reject(new Error('Fullscreen not supported'));
                            }
                        } catch (error) {
                            console.log('‚ùå ÂÖ®Ëû¢ÂπïË´ãÊ±ÇÂ§±Êïó:', error);
                            reject(error);
                        }
                    });
                };
                
                // Ë∑®ÁÄèË¶ΩÂô®ÈÄÄÂá∫ÂÖ®Ëû¢ÂπïÂáΩÊï∏
                window.exitFullscreenCrossBrowser = function() {
                    console.log('üì± Âü∑Ë°åË∑®ÁÄèË¶ΩÂô®ÈÄÄÂá∫ÂÖ®Ëû¢Âπï');
                    
                    return new Promise((resolve, reject) => {
                        try {
                            // Ê®ôÊ∫ñ Fullscreen API
                            if (document.exitFullscreen) {
                                console.log('‚úÖ ‰ΩøÁî®Ê®ôÊ∫ñ exitFullscreen');
                                document.exitFullscreen().then(resolve).catch(reject);
                            }
                            // WebKit (Safari)
                            else if (document.webkitExitFullscreen) {
                                console.log('üçé ‰ΩøÁî® WebKit webkitExitFullscreen');
                                document.webkitExitFullscreen();
                                resolve();
                            }
                            // WebKit (ËàäÁâà)
                            else if (document.webkitCancelFullScreen) {
                                console.log('üçé ‰ΩøÁî®ËàäÁâà WebKit webkitCancelFullScreen');
                                document.webkitCancelFullScreen();
                                resolve();
                            }
                            // Mozilla
                            else if (document.mozCancelFullScreen) {
                                console.log('ü¶ä ‰ΩøÁî® Mozilla mozCancelFullScreen');
                                document.mozCancelFullScreen();
                                resolve();
                            }
                            // Microsoft
                            else if (document.msExitFullscreen) {
                                console.log('ü™ü ‰ΩøÁî® Microsoft msExitFullscreen');
                                document.msExitFullscreen();
                                resolve();
                            }
                            // iOS Safari ÁâπÊÆäËôïÁêÜ
                            else if (isIOS) {
                                console.log('üì± iOS Safari ÈÄÄÂá∫Ê®°Êì¨ÂÖ®Ëû¢Âπï');
                                document.body.classList.remove('ios-fullscreen-simulation');
                                resolve();
                            }
                            else {
                                console.log('‚ùå ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥ÈÄÄÂá∫ÂÖ®Ëû¢Âπï');
                                reject(new Error('Exit fullscreen not supported'));
                            }
                        } catch (error) {
                            console.log('‚ùå ÈÄÄÂá∫ÂÖ®Ëû¢ÂπïÂ§±Êïó:', error);
                            reject(error);
                        }
                    });
                };
                
                // Ë∑®ÁÄèË¶ΩÂô®Ê™¢Êü•ÂÖ®Ëû¢ÂπïÁãÄÊÖãÂáΩÊï∏
                window.isFullscreenCrossBrowser = function() {
                    const fullscreenElement = document.fullscreenElement ||
                                            document.webkitFullscreenElement ||
                                            document.webkitCurrentFullScreenElement ||
                                            document.mozFullScreenElement ||
                                            document.msFullscreenElement;
                    
                    const isIOSSimulation = document.body.classList.contains('ios-fullscreen-simulation');
                    
                    return !!(fullscreenElement || isIOSSimulation);
                };
                
                console.log('‚úÖ Ë∑®ÁÄèË¶ΩÂô®ÂÖ®Ëû¢Âπï API Â∑≤ÂâµÂª∫');
            }
            
            // ÁÇ∫ iOS Safari Ê∑ªÂä† CSS Ê®°Êì¨ÂÖ®Ëû¢ÂπïÊ®£Âºè
            function addIOSFullscreenStyles() {
                console.log('üì± Ê∑ªÂä† iOS Safari ÂÖ®Ëû¢ÂπïÊ®°Êì¨Ê®£Âºè');
                
                let style = document.getElementById('ios-fullscreen-style');
                if (!style) {
                    style = document.createElement('style');
                    style.id = 'ios-fullscreen-style';
                    style.textContent = `
                        /* iOS Safari ÂÖ®Ëû¢ÂπïÊ®°Êì¨ */
                        body.ios-fullscreen-simulation {
                            position: fixed !important;
                            top: 0 !important;
                            left: 0 !important;
                            width: 100vw !important;
                            height: 100vh !important;
                            height: 100dvh !important;
                            margin: 0 !important;
                            padding: 0 !important;
                            overflow: hidden !important;
                            background: black !important;
                            z-index: 2147483647 !important;
                        }
                        
                        body.ios-fullscreen-simulation #app {
                            width: 100vw !important;
                            height: 100vh !important;
                            height: 100dvh !important;
                        }
                        
                        body.ios-fullscreen-simulation #game-container {
                            width: 100% !important;
                            height: 100% !important;
                            max-width: none !important;
                            max-height: none !important;
                        }
                        
                        /* Èö±Ëóè iOS Safari Âú∞ÂùÄÊ¨Ñ */
                        @supports (-webkit-touch-callout: none) {
                            body.ios-fullscreen-simulation {
                                height: -webkit-fill-available !important;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                    console.log('‚úÖ iOS Safari ÂÖ®Ëû¢ÂπïÊ®°Êì¨Ê®£ÂºèÂ∑≤Ê∑ªÂä†');
                }
            }
            
            // ‰øÆÊîπÂéüÂßãÁöÑ toggleFullscreen ÊñπÊ≥ï‰ª•ÊîØÊè¥ Safari
            function enhanceToggleFullscreenForSafari() {
                console.log('üîß Â¢ûÂº∑ toggleFullscreen ÊñπÊ≥ï‰ª•ÊîØÊè¥ Safari');
                
                // Á≠âÂæÖ TouchControls ËºâÂÖ•
                const waitForTouchControls = () => {
                    return new Promise((resolve) => {
                        const check = () => {
                            if (window.touchControls && window.touchControls.toggleFullscreen) {
                                resolve();
                            } else {
                                setTimeout(check, 100);
                            }
                        };
                        check();
                    });
                };
                
                waitForTouchControls().then(() => {
                    console.log('üîß ÈñãÂßãÂ¢ûÂº∑ TouchControls ÁöÑ Safari ÊîØÊè¥');
                    
                    // ‰øùÂ≠òÁï∂ÂâçÁöÑ toggleFullscreen ÊñπÊ≥ï
                    const originalToggleFullscreen = window.touchControls.toggleFullscreen;
                    
                    // ÊõøÊèõÁÇ∫ Safari ÂÖºÂÆπÁâàÊú¨
                    window.touchControls.toggleFullscreen = async function() {
                        console.log('üçé Âü∑Ë°å Safari ÂÖºÂÆπÂÖ®Ëû¢ÂπïÂàáÊèõ');
                        
                        try {
                            const isCurrentlyFullscreen = window.isFullscreenCrossBrowser();
                            
                            if (!isCurrentlyFullscreen) {
                                console.log('üì± ÈÄ≤ÂÖ• Safari ÂÖºÂÆπÂÖ®Ëû¢ÂπïÊ®°Âºè');
                                
                                // ‰ΩøÁî®Ë∑®ÁÄèË¶ΩÂô® API
                                await window.requestFullscreenCrossBrowser();
                                
                                // Á≠âÂæÖÁãÄÊÖãÁ©©ÂÆö
                                await new Promise(resolve => setTimeout(resolve, 300));
                                
                                // ÈáçÊñ∞Ë®àÁÆóÂ∫ßÊ®ô
                                if (this.recalculateCoordinates) {
                                    this.recalculateCoordinates();
                                }
                                
                                // Ëß∏Áôº resize ‰∫ã‰ª∂
                                window.dispatchEvent(new Event('resize'));
                                
                                // Â¶ÇÊûúÊúâ Phaser ÈÅäÊà≤ÔºåÂà∑Êñ∞ scale
                                if (window.game && window.game.scale) {
                                    setTimeout(() => {
                                        window.game.scale.refresh();
                                        console.log('üéÆ Phaser ÈÅäÊà≤ scale Â∑≤Âà∑Êñ∞');
                                    }, 100);
                                }
                                
                                console.log('‚úÖ Safari ÂÖºÂÆπÂÖ®Ëû¢ÂπïÂ∑≤ÂïüÁî®');
                                
                            } else {
                                console.log('üì± ÈÄÄÂá∫ Safari ÂÖºÂÆπÂÖ®Ëû¢ÂπïÊ®°Âºè');
                                
                                await window.exitFullscreenCrossBrowser();
                                
                                // Á≠âÂæÖÈÄÄÂá∫ÁãÄÊÖãÁ©©ÂÆö
                                await new Promise(resolve => setTimeout(resolve, 300));
                                
                                // ÈáçÊñ∞Ë®àÁÆóÂ∫ßÊ®ô
                                if (this.recalculateCoordinates) {
                                    this.recalculateCoordinates();
                                }
                                
                                // Ëß∏Áôº resize ‰∫ã‰ª∂
                                window.dispatchEvent(new Event('resize'));
                                
                                // Âà∑Êñ∞ Phaser scale
                                if (window.game && window.game.scale) {
                                    setTimeout(() => {
                                        window.game.scale.refresh();
                                        console.log('üéÆ Phaser ÈÅäÊà≤ scale Â∑≤Âà∑Êñ∞');
                                    }, 100);
                                }
                                
                                console.log('‚úÖ Â∑≤ÈÄÄÂá∫ Safari ÂÖºÂÆπÂÖ®Ëû¢Âπï');
                            }
                            
                        } catch (error) {
                            console.log('‚ùå Safari ÂÖºÂÆπÂÖ®Ëû¢ÂπïÂàáÊèõÂ§±Êïó:', error);
                            // ÂõûÈÄÄÂà∞ÂéüÂßãÊñπÊ≥ï
                            if (originalToggleFullscreen) {
                                originalToggleFullscreen.call(this);
                            }
                        }
                    };
                    
                    console.log('‚úÖ TouchControls Safari ÊîØÊè¥Â¢ûÂº∑ÂÆåÊàê');
                });
            }
            
            // ÂàùÂßãÂåñ Safari ÊîØÊè¥
            function initSafariFullscreenSupport() {
                console.log('üöÄ ÂàùÂßãÂåñ Safari ÂÖ®Ëû¢ÂπïÊîØÊè¥');
                
                // ÂâµÂª∫Ë∑®ÁÄèË¶ΩÂô® API
                createCrossBrowserFullscreenAPI();
                
                // Ê∑ªÂä† iOS Ê®£Âºè
                addIOSFullscreenStyles();
                
                // Â¢ûÂº∑ toggleFullscreen ÊñπÊ≥ï
                enhanceToggleFullscreenForSafari();
                
                console.log('‚úÖ Safari ÂÖ®Ëû¢ÂπïÊîØÊè¥ÂàùÂßãÂåñÂÆåÊàê');
                
                // Ê∑ªÂä†Ê∏¨Ë©¶ÂáΩÊï∏
                window.testSafariFullscreen = function() {
                    console.log('üß™ Ê∏¨Ë©¶ Safari ÂÖ®Ëû¢ÂπïÊîØÊè¥');
                    
                    const support = {
                        standardAPI: !!document.documentElement.requestFullscreen,
                        webkitAPI: !!document.documentElement.webkitRequestFullscreen,
                        oldWebkitAPI: !!document.documentElement.webkitRequestFullScreen,
                        mozAPI: !!document.documentElement.mozRequestFullScreen,
                        msAPI: !!document.documentElement.msRequestFullscreen,
                        isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
                        isSafari: /^((?!chrome|android).)*safari/i.test(navigator.userAgent),
                        currentFullscreen: window.isFullscreenCrossBrowser()
                    };
                    
                    console.log('üçé Safari ÂÖ®Ëû¢ÂπïÊîØÊè¥ÁãÄÊÖã:', support);
                    return support;
                };
            }
            
            // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñ
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initSafariFullscreenSupport);
            } else {
                initSafariFullscreenSupport();
            }
        </script>
        <!-- Safari ÂÖ®Ëû¢ÂπïÊîØÊè¥ÁµêÊùü -->
        <!-- üéØ ÈõôÈáçÂÖ®Ëû¢ÂπïÂêåÊ≠•ÂäüËÉΩ - DUAL_FULLSCREEN_SYNC -->
        <script>
            console.log('üéØ ËºâÂÖ•ÈõôÈáçÂÖ®Ëû¢ÂπïÂêåÊ≠•ÂäüËÉΩ');
            
            // Á≠âÂæÖ TouchControls ÂíåÂ∫ßÊ®ôÂêåÊ≠•ËºâÂÖ•ÂÆåÊàê
            function waitForEnhancedTouchControls() {
                return new Promise((resolve) => {
                    const checkEnhanced = () => {
                        if (window.touchControls && 
                            window.touchControls.toggleFullscreen && 
                            window.touchControls.recalculateCoordinates) {
                            resolve();
                        } else {
                            setTimeout(checkEnhanced, 100);
                        }
                    };
                    checkEnhanced();
                });
            }
            
            // ÂØ¶ÁèæÈõôÈáçÂÖ®Ëû¢ÂπïÂêåÊ≠•
            async function implementDualFullscreenSync() {
                await waitForEnhancedTouchControls();
                
                console.log('üîß ÈñãÂßãÂØ¶ÁèæÈõôÈáçÂÖ®Ëû¢ÂπïÂêåÊ≠•');
                
                // ‰øùÂ≠òÁï∂ÂâçÁöÑÂ∫ßÊ®ôÂêåÊ≠•ÁâàÊú¨
                const coordinateSyncToggleFullscreen = window.touchControls.toggleFullscreen;
                
                // ÊõøÊèõÁÇ∫ÈõôÈáçÂêåÊ≠•ÁâàÊú¨
                window.touchControls.toggleFullscreen = async function() {
                    console.log('üéØ Âü∑Ë°åÈõôÈáçÂÖ®Ëû¢ÂπïÂêåÊ≠•ÂàáÊèõ');
                    
                    try {
                        const isCurrentlyFullscreen = !!document.fullscreenElement;
                        const isInIframe = window !== window.parent;
                        
                        if (!isCurrentlyFullscreen) {
                            // ÈÄ≤ÂÖ•ÂÖ®Ëû¢Âπï
                            console.log('üì± ÈÄ≤ÂÖ•ÈõôÈáçÂÖ®Ëû¢ÂπïÊ®°Âºè');
                            
                            // 1. Ëß∏ÁôºÂéüÁîü Fullscreen APIÔºàÂ∫ßÊ®ôÂêåÊ≠•ÁâàÊú¨Ôºâ
                            await coordinateSyncToggleFullscreen.call(this);
                            
                            // 2. Â¶ÇÊûúÂú® iframe ‰∏≠ÔºåÈÄöÁü•Áà∂È†ÅÈù¢Ëß∏Áôº CSS Âº∑Âà∂ÂÖ®Ëû¢Âπï
                            if (isInIframe) {
                                console.log('üì§ ÈÄöÁü•Áà∂È†ÅÈù¢Ëß∏Áôº CSS Âº∑Âà∂ÂÖ®Ëû¢Âπï');
                                window.parent.postMessage({
                                    type: 'DUAL_FULLSCREEN_REQUEST',
                                    action: 'ENTER_CSS_FULLSCREEN',
                                    timestamp: Date.now()
                                }, '*');
                            }
                            
                            // 3. Á≠âÂæÖÁà∂È†ÅÈù¢ÈüøÊáâ
                            await new Promise(resolve => setTimeout(resolve, 200));
                            
                            console.log('‚úÖ ÈõôÈáçÂÖ®Ëû¢ÂπïÔºàÂéüÁîü + CSSÔºâÂ∑≤ÂïüÁî®');
                            
                        } else {
                            // ÈÄÄÂá∫ÂÖ®Ëû¢Âπï
                            console.log('üì± ÈÄÄÂá∫ÈõôÈáçÂÖ®Ëû¢ÂπïÊ®°Âºè');
                            
                            // 1. Â¶ÇÊûúÂú® iframe ‰∏≠ÔºåÈÄöÁü•Áà∂È†ÅÈù¢ÈÄÄÂá∫ CSS Âº∑Âà∂ÂÖ®Ëû¢Âπï
                            if (isInIframe) {
                                console.log('üì§ ÈÄöÁü•Áà∂È†ÅÈù¢ÈÄÄÂá∫ CSS Âº∑Âà∂ÂÖ®Ëû¢Âπï');
                                window.parent.postMessage({
                                    type: 'DUAL_FULLSCREEN_REQUEST',
                                    action: 'EXIT_CSS_FULLSCREEN',
                                    timestamp: Date.now()
                                }, '*');
                            }
                            
                            // 2. Ëß∏ÁôºÂéüÁîü Fullscreen API ÈÄÄÂá∫ÔºàÂ∫ßÊ®ôÂêåÊ≠•ÁâàÊú¨Ôºâ
                            await coordinateSyncToggleFullscreen.call(this);
                            
                            console.log('‚úÖ ÈõôÈáçÂÖ®Ëû¢ÂπïÂ∑≤ÈÄÄÂá∫');
                        }
                        
                    } catch (error) {
                        console.log('‚ùå ÈõôÈáçÂÖ®Ëû¢ÂπïÂêåÊ≠•Â§±Êïó:', error);
                        // ÂõûÈÄÄÂà∞Â∫ßÊ®ôÂêåÊ≠•ÁâàÊú¨
                        coordinateSyncToggleFullscreen.call(this);
                    }
                };
                
                // Áõ£ËÅΩ‰æÜËá™Áà∂È†ÅÈù¢ÁöÑÈüøÊáâ
                window.addEventListener('message', (event) => {
                    if (event.data.type === 'DUAL_FULLSCREEN_RESPONSE') {
                        console.log('üì• Êî∂Âà∞Áà∂È†ÅÈù¢ÈüøÊáâ:', event.data);
                        
                        switch (event.data.action) {
                            case 'CSS_FULLSCREEN_ENABLED':
                                console.log('‚úÖ Áà∂È†ÅÈù¢ CSS Âº∑Âà∂ÂÖ®Ëû¢ÂπïÂ∑≤ÂïüÁî®');
                                break;
                            case 'CSS_FULLSCREEN_DISABLED':
                                console.log('‚úÖ Áà∂È†ÅÈù¢ CSS Âº∑Âà∂ÂÖ®Ëû¢ÂπïÂ∑≤ÂÅúÁî®');
                                break;
                            case 'CSS_FULLSCREEN_ERROR':
                                console.log('‚ùå Áà∂È†ÅÈù¢ CSS Âº∑Âà∂ÂÖ®Ëû¢ÂπïÈåØË™§:', event.data.error);
                                break;
                        }
                    }
                });
                
                console.log('‚úÖ ÈõôÈáçÂÖ®Ëû¢ÂπïÂêåÊ≠•ÂäüËÉΩÂØ¶ÁèæÂÆåÊàê');
                
                // Ê∑ªÂä†Ê∏¨Ë©¶ÂáΩÊï∏
                window.testDualFullscreen = function() {
                    console.log('üß™ Ê∏¨Ë©¶ÈõôÈáçÂÖ®Ëû¢ÂπïÂäüËÉΩ');
                    
                    const status = {
                        isInIframe: window !== window.parent,
                        nativeFullscreen: !!document.fullscreenElement,
                        viewport: {
                            width: window.innerWidth,
                            height: window.innerHeight
                        },
                        touchControls: !!window.touchControls,
                        dualSyncEnabled: true
                    };
                    
                    console.log('üìä ÈõôÈáçÂÖ®Ëû¢ÂπïÁãÄÊÖã:', status);
                    return status;
                };
                
                // Ê∑ªÂä†Âº∑Âà∂ÂêåÊ≠•ÂáΩÊï∏
                window.forceDualFullscreenSync = async function() {
                    console.log('üîß Âº∑Âà∂Âü∑Ë°åÈõôÈáçÂÖ®Ëû¢ÂπïÂêåÊ≠•');
                    
                    if (window.touchControls && window.touchControls.toggleFullscreen) {
                        await window.touchControls.toggleFullscreen();
                    }
                    
                    console.log('‚úÖ Âº∑Âà∂ÂêåÊ≠•ÂÆåÊàê');
                };
            }
            
            // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂØ¶ÁèæÈõôÈáçÂêåÊ≠•
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', implementDualFullscreenSync);
            } else {
                implementDualFullscreenSync();
            }
        </script>
        <!-- ÈõôÈáçÂÖ®Ëû¢ÂπïÂêåÊ≠•ÂäüËÉΩÁµêÊùü -->
        <!-- Â∫ßÊ®ôÂêåÊ≠•Ëß£Ê±∫ÊñπÊ°àÁµêÊùü -->
    </body>
</html>
