import{P as e}from"./phaser-HlBRf90L.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class t extends Phaser.GameObjects.Rectangle{constructor(e,t,s,i){super(e,t,s,48,48,65280),this.setOrigin(.5),this.scene.add.existing(this),this.scene.physics.add.existing(this),this.body.collideWorldBounds=!0,this.setScale(1),this.jumping=!1,this.invincible=!1,this.health=10,this.body.mass=10,this.body.setDragY=10}}class s{constructor(e){this.scene=e,this.spawnX=e.width+20,this.pinos=0,this.initEvent=this.scene.time.delayedCall(2e3,()=>this.init(),null,this),this.cloudEvent=null,this.obstacleEvent=null,this.coinEvent=null}init(){this.generateCloud(),this.generateObstacle(),this.generateCoin()}generateCloud(){new i(this.scene,this.spawnX),this.cloudEvent=this.scene.time.delayedCall(Phaser.Math.Between(2e3,3e3),()=>this.generateCloud(),null,this)}generateObstacle(){this.scene.obstacles.add(new o(this.scene,this.spawnX,this.scene.height-Phaser.Math.Between(48,150))),this.obstacleEvent=this.scene.time.delayedCall(Phaser.Math.Between(1500,2500),()=>this.generateObstacle(),null,this)}generateCoin(){this.scene.coins.add(new a(this.scene,this.spawnX,this.scene.height-Phaser.Math.Between(60,180))),this.coinEvent=this.scene.time.delayedCall(Phaser.Math.Between(500,1500),()=>this.generateCoin(1),null,this)}stop(){console.log("ğŸ›‘ åœæ­¢æ•µäººç”Ÿæˆ"),this.initEvent&&(this.initEvent.remove(),this.initEvent=null),this.cloudEvent&&(this.cloudEvent.remove(),this.cloudEvent=null),this.obstacleEvent&&(this.obstacleEvent.remove(),this.obstacleEvent=null),this.coinEvent&&(this.coinEvent.remove(),this.coinEvent=null),console.log("âœ… æ•µäººç”Ÿæˆå·²åœæ­¢")}}class i extends Phaser.GameObjects.Rectangle{constructor(e,t,s){const i=s||Phaser.Math.Between(20,150),o=t||e.width+20;super(e,o,i,98,32,16777215),e.add.existing(this);const a=1/Phaser.Math.Between(1,3);this.spawnX=o,this.setScale(a),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:this.spawnX,to:-100},duration:3e3/this.scale,onComplete:()=>{this.destroy()}})}}class o extends Phaser.GameObjects.Rectangle{constructor(e,t,s){super(e,t,s,48,48,16711680),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1),this.spawnX=t,this.init()}init(){this.scene.tweens.add({targets:this,x:{from:this.spawnX,to:-100},duration:3e3,onComplete:()=>{this.destroy()}})}}class a extends Phaser.GameObjects.Text{constructor(e,t,s){var i;super(e,t,s,(null==(i=e.currentWord)?void 0:i.english)||"?",{fontSize:"28px",fontFamily:"Arial",color:"#ffffff",fontStyle:"bold",backgroundColor:"#ffff00",padding:{x:10,y:5}}),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1),this.spawnX=t,this.setOrigin(.5),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:this.spawnX,to:-100},duration:3e3,onComplete:()=>{this.destroy()}})}}const n={clouds:{id:"clouds",name:"é›²æœµ",displayName:"â˜ï¸ é›²æœµ",colors:{background:8900331,ground:9127187,player:5227511,enemy:16777215,coin:16766720,text:"#ffffff",modalBg:2894892},emoji:{player:"ğŸƒ",enemy:"â˜ï¸",coin:"â­",decorations:["ğŸŒ¤ï¸","ğŸŒˆ","ğŸ¦‹","ğŸŒ¸"]}},videogame:{id:"videogame",name:"é›»å­éŠæˆ²",displayName:"ğŸ® é›»å­éŠæˆ²",colors:{background:0,ground:65280,player:65280,enemy:16711935,coin:16776960,text:"#00ff00",modalBg:4352},emoji:{player:"ğŸ‘¾",enemy:"ğŸ‘»",coin:"ğŸ’",decorations:["â­","ğŸ¯","ğŸ•¹ï¸","ğŸ“º"]}},space:{id:"space",name:"å¤ªç©º",displayName:"ğŸš€ å¤ªç©º",colors:{background:858922,ground:4868682,player:58879,enemy:10233776,coin:16766720,text:"#00e5ff",modalBg:1779259},emoji:{player:"ğŸš€",enemy:"ğŸ‘½",coin:"â­",decorations:["ğŸŒŸ","ğŸŒ™","ğŸ’«","ğŸ›¸"]}},underwater:{id:"underwater",name:"æµ·åº•",displayName:"ğŸ  æµ·åº•",colors:{background:27028,ground:13935988,player:16750592,enemy:48340,coin:16761095,text:"#00bcd4",modalBg:19814},emoji:{player:"ğŸ¬",enemy:"ğŸ™",coin:"ğŸš",decorations:["ğŸ ","ğŸ¦€","ğŸŒŠ","ğŸª¸"]}},dinosaur:{id:"dinosaur",name:"æé¾",displayName:"ğŸ¦• æé¾",colors:{background:9268835,ground:7162945,player:5025616,enemy:10586239,coin:16761095,text:"#4caf50",modalBg:5125166},emoji:{player:"ğŸ¦–",enemy:"ğŸª¨",coin:"ğŸ¥š",decorations:["ğŸŒ´","ğŸŒ‹","ğŸ¦•","â˜„ï¸"]}},forest:{id:"forest",name:"æ£®æ—",displayName:"ğŸŒ² æ£®æ—",colors:{background:2263842,ground:6111287,player:16733986,enemy:7951688,coin:16771899,text:"#ffeb3b",modalBg:1793568},emoji:{player:"ğŸ¦Š",enemy:"ğŸŒ²",coin:"ğŸ",decorations:["ğŸ„","ğŸ¦‰","ğŸŒ¿","ğŸ¦‹"]}},candy:{id:"candy",name:"ç³–æœ",displayName:"ğŸ¬ ç³–æœ",colors:{background:16761035,ground:9127187,player:16738740,enemy:10233776,coin:16766720,text:"#ff69b4",modalBg:8916559},emoji:{player:"ğŸ§",enemy:"ğŸ­",coin:"â­",decorations:["ğŸ©","ğŸª","ğŸ‚","ğŸ«"]}}};class r extends Phaser.Scene{constructor(){super({key:"game"}),this.player=null,this.score=0,this.wordsLearned=0,this.visualStyle=null,this.currentStyleId="clouds",this.timerText=null,this.scoreText=null,this.englishImage=null,this.englishText=null,this.chineseImage=null,this.chineseText=null,this.vocabulary=[],this.currentWordIndex=0,this.currentWord=null,this.timeElapsed=0,this.timerEvent=null}init(e){this.name=e.name,this.number=e.number;const t=new URLSearchParams(window.location.search);this.currentStyleId=t.get("visualStyle")||"clouds",this.visualStyle=n[this.currentStyleId]||n.clouds,console.log("ğŸ¨ Runner Game è¦–è¦ºé¢¨æ ¼:",this.currentStyleId,this.visualStyle)}preload(){this.registry.set("score","0");const e="/games/runner-game/dist/assets";this.load.audio("coin",`${e}/sounds/coin.mp3`),this.load.audio("jump",`${e}/sounds/jump.mp3`),this.load.audio("dead",`${e}/sounds/dead.mp3`),this.load.audio("theme",`${e}/sounds/theme.mp3`),this.load.spritesheet("coin",`${e}/images/coin.png`,{frameWidth:32,frameHeight:32}),this.load.bitmapFont("arcade",`${e}/fonts/arcade.png`,`${e}/fonts/arcade.xml`),this.score=0,this.wordsLearned=0,this.loadVisualStyleResources()}async loadVisualStyleResources(){try{const e=Date.now(),t=`${window.location.origin}/api/visual-styles/resources?styleId=${this.currentStyleId}&game=runner-game&t=${e}`;console.log("ğŸ¨ Runner Game: æ­£åœ¨åŠ è¼‰è¦–è¦ºé¢¨æ ¼è³‡æº",{styleId:this.currentStyleId,apiUrl:t});const s=await fetch(t,{cache:"no-store"});if(!s.ok)return void console.warn("âš ï¸ Runner Game: ç„¡æ³•åŠ è¼‰è¦–è¦ºé¢¨æ ¼è³‡æºï¼Œä½¿ç”¨é»˜èªé…ç½®",s.status);const i=await s.json();console.log("ğŸ“¦ Runner Game: è¦–è¦ºé¢¨æ ¼è³‡æºå·²åŠ è¼‰",i.resources),this.visualStyleResources=i.resources||{}}catch(e){console.error("âŒ Runner Game: åŠ è¼‰è¦–è¦ºé¢¨æ ¼è³‡æºå¤±æ•—",e),this.visualStyleResources={}}}create(){var e,i,o;if(this.width=this.sys.game.config.width,this.height=this.sys.game.config.height,this.center_width=this.width/2,this.center_height=this.height/2,window.gameStartTime||(window.gameStartTime=Date.now()),null==(e=this.visualStyleResources)?void 0:e.background)console.log("ğŸ¨ åŠ è¼‰è‡ªå®šç¾©èƒŒæ™¯åœ–ç‰‡:",this.visualStyleResources.background),this.load.image("custom-background",this.visualStyleResources.background),this.load.once("complete",()=>{this.textures.exists("custom-background")&&(this.add.image(this.center_width,this.center_height,"custom-background").setDisplaySize(this.width,this.height).setDepth(-1),console.log("âœ… è‡ªå®šç¾©èƒŒæ™¯åœ–ç‰‡å·²åŠ è¼‰"))}),this.load.start();else{const e=(null==(o=null==(i=this.visualStyle)?void 0:i.colors)?void 0:o.background)||1710638;this.cameras.main.setBackgroundColor(e),console.log("ğŸ¨ æ‡‰ç”¨èƒŒæ™¯é¡è‰²:",e.toString(16))}this.obstacles=this.add.group(),this.coins=this.add.group(),this.generator=new s(this),this.SPACE=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.player=new t(this,this.center_width-100,this.height-200),this.loadVocabulary(),this.createFiveColumnLayout(),this.physics.add.collider(this.player,this.obstacles,this.hitObstacle,()=>!0,this),this.physics.add.overlap(this.player,this.coins,this.hitCoin,()=>!0,this),this.loadAudios(),this.playMusic(),this.input.on("pointerdown",e=>this.jump(),this),this.updateScoreEvent=this.time.addEvent({delay:100,callback:()=>this.updateScore(),callbackScope:this,loop:!0}),this.startTimer()}hitObstacle(e,t){this.updateScoreEvent.destroy(),this.finishScene()}hitCoin(e,t){this.playAudio("coin"),this.updateScore(1e3),t.destroy(),this.updateVocabularyDisplay()}loadAudios(){this.audios={jump:this.sound.add("jump"),coin:this.sound.add("coin"),dead:this.sound.add("dead")}}playAudio(e){this.audios[e].play()}playMusic(e="theme"){this.theme=this.sound.add(e),this.theme.stop(),this.theme.play({mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!0,delay:0})}update(){var e;Phaser.Input.Keyboard.JustDown(this.SPACE)?this.jump():this.player.body.blocked.down&&(null==(e=this.jumpTween)||e.stop(),this.player.rotation=0)}jump(){this.player.body.blocked.down&&(this.player.body.setVelocityY(-300),this.playAudio("jump"),this.jumpTween=this.tweens.add({targets:this.player,duration:1e3,angle:{from:0,to:360},repeat:-1}))}finishScene(){this.gameCompleteModalShown?console.log("âš ï¸ éŠæˆ²çµæŸæ¨¡æ…‹æ¡†å·²é¡¯ç¤ºï¼Œè·³éé‡è¤‡èª¿ç”¨"):(this.gameCompleteModalShown=!0,this.theme.stop(),this.playAudio("dead"),this.registry.set("score",""+this.score),this.timerEvent&&(this.timerEvent.remove(),this.timerEvent=null),this.generator&&this.generator.stop(),console.log("ğŸ›‘ æ•µäººç”Ÿæˆå·²åœæ­¢ï¼ŒéŠæˆ²æ»¾å‹•å·²åœæ­¢"),this.showGameCompleteModal())}updateScore(e=1){this.score+=e,this.updateScoreDisplay()}loadVocabulary(){try{console.log("ğŸ“š é–‹å§‹è¼‰å…¥è©å½™...");const t=new URLSearchParams(window.location.search).get("customVocabulary");if(t&&"true"!==t&&"false"!==t)try{const e=JSON.parse(decodeURIComponent(t));if(Array.isArray(e))return this.vocabulary=e,void console.log("âœ… å¾ URL åƒæ•¸è¼‰å…¥è©å½™:",this.vocabulary.length,"å€‹")}catch(e){console.warn("âš ï¸ è§£æ URL è©å½™åƒæ•¸å¤±æ•—:",e)}const s=localStorage.getItem("gameCustomVocabulary");if(s)try{return this.vocabulary=JSON.parse(s),void console.log("âœ… å¾ localStorage è¼‰å…¥è©å½™:",this.vocabulary.length,"å€‹")}catch(e){console.warn("âš ï¸ è§£æ localStorage è©å½™å¤±æ•—:",e)}console.log("â„¹ï¸ æ²’æœ‰æ‰¾åˆ°è‡ªå®šç¾©è©å½™"),this.vocabulary=[]}catch(t){console.error("âŒ è¼‰å…¥è©å½™æ™‚å‡ºéŒ¯:",t),this.vocabulary=[]}}createFiveColumnLayout(){var e,t;this.vocabulary&&this.vocabulary.length>0&&(this.currentWord=this.vocabulary[0],this.currentWordIndex=0),this.timerText=this.add.text(80,45,"0:00",{fontSize:"24px",fontFamily:"Arial",color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setDepth(200),this.scoreText=this.add.text(180,45,"åˆ†æ•¸: 0\nå–®å­—: 0",{fontSize:"18px",fontFamily:"Arial",color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setDepth(200),this.updateEnglishImage();const s=(null==(e=this.currentWord)?void 0:e.english)||"";this.englishText=this.add.text(450,45,s,{fontSize:"32px",fontFamily:"Arial",color:"#000000",fontStyle:"bold",backgroundColor:"#ffff00",padding:{x:15,y:8}}).setOrigin(.5).setDepth(200).setInteractive(),this.englishText.on("pointerdown",()=>{var e;(null==(e=this.currentWord)?void 0:e.english)&&this.speakText(this.currentWord.english,"en-US")}),this.updateChineseImage();const i=(null==(t=this.currentWord)?void 0:t.chinese)||"";this.chineseText=this.add.text(750,45,i,{fontSize:"32px",fontFamily:"Microsoft YaHei, Arial",color:"#ffff00",fontStyle:"bold",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(200).setInteractive(),this.chineseText.on("pointerdown",()=>{var e;(null==(e=this.currentWord)?void 0:e.chinese)&&this.speakText(this.currentWord.chinese,"zh-TW")}),this.currentWord||(this.englishText.setVisible(!1),this.chineseText.setVisible(!1)),console.log("âœ… äº”åˆ—ä½ˆå±€å‰µå»ºå®Œæˆ")}updateEnglishImage(){var e;const t=null==(e=this.currentWord)?void 0:e.imageUrl;if(t){const e=`english-image-${this.currentWord.id||Date.now()}`;this.textures.exists(e)?this.createOrUpdateImage("english",e):(this.load.image(e,t),this.load.once("complete",()=>{this.createOrUpdateImage("english",e)}),this.load.start())}else this.englishImage&&this.englishImage.setVisible(!1)}updateChineseImage(){var e;const t=null==(e=this.currentWord)?void 0:e.chineseImageUrl;if(t){const e=`chinese-image-${this.currentWord.id||Date.now()}`;this.textures.exists(e)?this.createOrUpdateImage("chinese",e):(this.load.image(e,t),this.load.once("complete",()=>{this.createOrUpdateImage("chinese",e)}),this.load.start())}else this.chineseImage&&this.chineseImage.setVisible(!1)}createOrUpdateImage(e,t){"english"===e?(this.englishImage?(this.englishImage.setTexture(t),this.englishImage.setVisible(!0)):(this.englishImage=this.add.image(320,45,t),this.englishImage.setDisplaySize(80,80),this.englishImage.setDepth(200),this.englishImage.setOrigin(.5)),console.log("ğŸ–¼ï¸ è‹±æ–‡åœ–ç‰‡å·²æ›´æ–°")):"chinese"===e&&(this.chineseImage?(this.chineseImage.setTexture(t),this.chineseImage.setVisible(!0)):(this.chineseImage=this.add.image(620,45,t),this.chineseImage.setDisplaySize(80,80),this.chineseImage.setDepth(200),this.chineseImage.setOrigin(.5)),console.log("ğŸ–¼ï¸ ä¸­æ–‡åœ–ç‰‡å·²æ›´æ–°"))}speakText(e,t){if("speechSynthesis"in window){const s=new SpeechSynthesisUtterance(e);s.lang=t,s.rate=.9,window.speechSynthesis.speak(s),console.log("ğŸ”Š æ’­æ”¾èªéŸ³:",e,t)}}startTimer(){this.timeElapsed=0,this.timerEvent=this.time.addEvent({delay:1e3,callback:()=>{this.timeElapsed++,this.timerText&&this.timerText.setText(this.formatTime(this.timeElapsed))},loop:!0})}formatTime(e){return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`}updateScoreDisplay(){this.scoreText&&this.scoreText.setText(`åˆ†æ•¸: ${this.score}\nå–®å­—: ${this.wordsLearned}`)}updateVocabularyDisplay(){this.vocabulary&&0!==this.vocabulary.length&&(this.currentWordIndex=(this.currentWordIndex+1)%this.vocabulary.length,this.currentWord=this.vocabulary[this.currentWordIndex],this.wordsLearned++,this.currentWord&&(this.englishText&&(this.englishText.setText(this.currentWord.english||""),this.englishText.setVisible(!!this.currentWord.english)),this.chineseText&&(this.chineseText.setText(this.currentWord.chinese||""),this.chineseText.setVisible(!!this.currentWord.chinese)),this.updateEnglishImage(),this.updateChineseImage(),this.currentWord.english&&this.speakText(this.currentWord.english,"en-US"),this.updateScoreDisplay(),console.log("ğŸ”„ è©å½™å·²æ›´æ–°:",this.currentWord.english,"-",this.currentWord.chinese)))}showGameCompleteModal(){const e=this.scale.width,t=this.scale.height,s=this.score,i=this.wordsLearned,o=this.formatTime(this.timeElapsed);console.log("ğŸ® é¡¯ç¤ºéŠæˆ²çµæŸæ¨¡æ…‹æ¡†",{totalScore:s,totalWords:i,timeSpent:this.timeElapsed}),this.notifyParentGameComplete(s),this.saveGameProgress(s);const a=this.add.rectangle(e/2,t/2,e,t,0,.7);a.setDepth(5e3);const n=Math.min(500,.85*e),r=Math.min(380,.7*t),l=this.add.container(e/2,t/2);l.setDepth(5001);const h=this.add.rectangle(0,0,n,r,2894892);h.setStrokeStyle(4,0),l.add(h);const d=this.add.text(0,-r/2+30,"GAME COMPLETE",{fontSize:"32px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);l.add(d);const c=this.add.text(-80,-r/2+70,"Score",{fontSize:"18px",color:"#4a9eff",fontFamily:"Arial"}).setOrigin(.5);l.add(c);const m=this.add.text(-80,-r/2+95,`${s}`,{fontSize:"28px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);l.add(m);const g=this.add.text(80,-r/2+70,"Time",{fontSize:"18px",color:"#4a9eff",fontFamily:"Arial"}).setOrigin(.5);l.add(g);const p=this.add.text(80,-r/2+95,o,{fontSize:"28px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);l.add(p);const u=this.add.text(0,-r/2+130,`Words Learned: ${i}`,{fontSize:"16px",color:"#4caf50",fontFamily:"Arial"}).setOrigin(.5);l.add(u);const y=-r/2+180;this.createModalButton(l,0,y,"Leaderboard",()=>{console.log("ğŸ® é»æ“Š Leaderboard æŒ‰éˆ•"),this.showEnterNamePage(s)}),this.createModalButton(l,0,y+50,"Start again",()=>{console.log("ğŸ® é»æ“Š Start again æŒ‰éˆ•"),a.destroy(),l.destroy(),this.gameCompleteModalShown=!1,this.restartGame()}),this.gameCompleteModal={overlay:a,modal:l}}createModalButton(e,t,s,i,o){const a=this.add.rectangle(t,s,280,45,3947580);a.setStrokeStyle(2,0),a.setInteractive({useHandCursor:!0}),e.add(a);const n=this.add.text(t,s,i,{fontSize:"20px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);return e.add(n),a.on("pointerdown",o),a.on("pointerover",()=>{a.setFillStyle(5000268)}),a.on("pointerout",()=>{a.setFillStyle(3947580)}),{buttonBg:a,buttonText:n}}showEnterNamePage(e){console.log("ğŸ® é¡¯ç¤ºè¼¸å…¥åç¨±é é¢"),this.pendingScore=e,this.gameCompleteModal&&(this.gameCompleteModal.overlay.setVisible(!1),this.gameCompleteModal.modal.setVisible(!1));const t=this.scale.width,s=this.scale.height,i=this.add.rectangle(t/2,s/2,t,s,0,.7);i.setDepth(7e3);const o=Math.min(600,.9*t),a=Math.min(500,.8*s),n=this.add.container(t/2,s/2);n.setDepth(7001);const r=this.add.rectangle(0,0,o,a,2894892);r.setStrokeStyle(4,0),n.add(r);const l=this.add.text(0,-a/2+40,"ENTER YOUR NAME",{fontSize:"24px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"});l.setOrigin(.5),n.add(l);const h=this.add.text(0,-a/2+80,"Enter your name for the leaderboard",{fontSize:"16px",color:"#cccccc",fontFamily:"Arial"});h.setOrigin(.5),n.add(h);const d=.8*o,c=-a/2+130,m=this.add.rectangle(0,c,d,50,16777215);m.setStrokeStyle(2,0),n.add(m),this.playerName="";const g=this.add.text(0,c,"",{fontSize:"24px",color:"#000000",fontFamily:"Arial"});g.setOrigin(.5),n.add(g);const p=-a/2+220;this.createVirtualKeyboard(n,0,p,g);const u=a/2-60;this.createModalButton(n,-120,u,"Skip",()=>{console.log("ğŸ® é»æ“Š Skip æŒ‰éˆ•"),this.hideEnterNamePage()}),this.createModalButton(n,120,u,"Enter",()=>{console.log("ğŸ® é»æ“Š Enter æŒ‰éˆ•ï¼Œåç¨±:",this.playerName),this.submitPlayerName()}),this.enterNamePage={overlay:i,page:n,inputText:g}}hideEnterNamePageOnly(){this.enterNamePage&&(this.enterNamePage.overlay.destroy(),this.enterNamePage.page.destroy(),this.enterNamePage=null)}hideEnterNamePage(){this.enterNamePage&&(this.enterNamePage.overlay.destroy(),this.enterNamePage.page.destroy(),this.enterNamePage=null),this.gameCompleteModal&&(this.gameCompleteModal.overlay.setVisible(!0),this.gameCompleteModal.modal.setVisible(!0))}createVirtualKeyboard(e,t,s,i){[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["â†‘","Z","X","C","V","B","N","M","â†"]].forEach((o,a)=>{const n=45*o.length-5,r=t-n/2+20,l=s+45*a;o.forEach((t,s)=>{const o=r+45*s;this.createKeyButton(e,o,l,t,40,40,i)})});const o=s+135;this.createKeyButton(e,t,o,"Space",200,40,i)}createKeyButton(e,t,s,i,o,a,n){const r=this.add.rectangle(t,s,o,a,5000268);r.setStrokeStyle(2,0),r.setInteractive({useHandCursor:!0}),e.add(r);const l="Space"===i?"â£":i,h=this.add.text(t,s,l,{fontSize:"Space"===i?"16px":"18px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"});h.setOrigin(.5),e.add(h),r.on("pointerdown",()=>{this.handleKeyPress(i,n)}),r.on("pointerover",()=>{r.setFillStyle(6052956)}),r.on("pointerout",()=>{r.setFillStyle(5000268)})}handleKeyPress(e,t){"â†"===e?this.playerName=this.playerName.slice(0,-1):"â†‘"===e?console.log("ğŸ® åˆ‡æ›å¤§å°å¯«"):"Space"===e?this.playerName+=" ":this.playerName.length<20&&(this.playerName+=e),t.setText(this.playerName),console.log("ğŸ® ç•¶å‰åç¨±:",this.playerName)}async submitPlayerName(){const e=this.playerName&&""!==this.playerName.trim()?this.playerName.trim():`Player_${Math.random().toString(36).substring(2,12)}`;console.log("ğŸ® æäº¤ç©å®¶åç¨±:",e);const t=this.pendingScore||this.score;await this.saveScoreToLeaderboardWithName(t,e),this.hideEnterNamePageOnly(),await this.showLeaderboard(),this.notifyParentShowLeaderboard()}async saveScoreToLeaderboardWithName(e,t){var s,i,o;try{const a=new URLSearchParams(window.location.search).get("activityId");if(!a)return void console.warn("âš ï¸ ç¼ºå°‘ activityIdï¼Œç„¡æ³•ä¿å­˜æ’è¡Œæ¦œ");const n={activityId:a,playerName:t,score:parseInt(e)||0,correctCount:this.wordsLearned||0,totalCount:(null==(s=this.vocabulary)?void 0:s.length)||0,accuracy:(null==(i=this.vocabulary)?void 0:i.length)>0?this.wordsLearned/this.vocabulary.length*100:0,timeSpent:this.timeElapsed||0,gameData:{wordsLearned:this.wordsLearned,totalWords:(null==(o=this.vocabulary)?void 0:o.length)||0,timeElapsed:this.timeElapsed,timestamp:(new Date).toISOString()}};console.log("ğŸ® ä¿å­˜æ’è¡Œæ¦œæ•¸æ“š:",n);const r=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(r.ok){const e=await r.json();console.log("âœ… æ’è¡Œæ¦œæ•¸æ“šå·²ä¿å­˜:",e.data)}else console.error("âŒ ä¿å­˜æ’è¡Œæ¦œå¤±æ•—:",r.statusText)}catch(a){console.error("âŒ ä¿å­˜æ’è¡Œæ¦œå‡ºéŒ¯:",a)}}restartGame(){console.log("ğŸ”„ é‡æ–°é–‹å§‹éŠæˆ²..."),this.score=0,this.wordsLearned=0,this.timeElapsed=0,this.currentWordIndex=0,this.gameCompleteModalShown=!1,this.generator&&this.generator.stop(),console.log("âœ… èˆŠçš„æ•µäººç”Ÿæˆå·²åœæ­¢"),this.physics.resume(),console.log("âœ… ç‰©ç†ç³»çµ±å·²æ¢å¾©"),this.player&&(this.player.x=this.center_width-100,this.player.y=this.height-200,this.player.body.setVelocity(0,0),this.player.rotation=0,console.log("âœ… ç©å®¶ä½ç½®å·²é‡ç½®")),this.obstacles&&this.obstacles.clear(!0),this.coins&&this.coins.clear(!0),console.log("âœ… éšœç¤™ç‰©å’Œç¡¬å¹£å·²æ¸…é™¤"),this.startTimer(),console.log("âœ… è¨ˆæ™‚å™¨å·²é‡æ–°å•Ÿå‹•"),this.generator=new s(this),console.log("âœ… æ•µäººç”Ÿæˆå·²é‡æ–°å•Ÿå‹•"),this.playMusic(),console.log("âœ… éŸ³æ¨‚å·²é‡æ–°å•Ÿå‹•"),this.updateVocabularyDisplay(),console.log("âœ… ç›®æ¨™è©å½™å·²é‡æ–°è¨­ç½®"),console.log("ğŸ® éŠæˆ²å·²å®Œå…¨é‡æ–°é–‹å§‹")}notifyParentShowLeaderboard(){const e=new URLSearchParams(window.location.search).get("activityId");console.log("ğŸ® é€šçŸ¥çˆ¶é é¢é¡¯ç¤ºæ’è¡Œæ¦œ:",e),window.parent&&window.parent!==window&&(window.parent.postMessage({type:"SHOW_LEADERBOARD",activityId:e,timestamp:Date.now(),source:"runner-game"},"*"),console.log("ğŸ“¤ å·²ç™¼é€ SHOW_LEADERBOARD åˆ°çˆ¶é é¢"))}async showLeaderboard(){console.log("ğŸ® é¡¯ç¤ºéŠæˆ²å…§æ’è¡Œæ¦œ");const e=this.scale.width,t=this.scale.height,s=new URLSearchParams(window.location.search).get("activityId");this.gameCompleteModal&&(this.gameCompleteModal.overlay.setVisible(!1),this.gameCompleteModal.modal.setVisible(!1));const i=this.add.rectangle(e/2,t/2,e,t,0,.7);i.setScrollFactor(0),i.setDepth(8e3);const o=this.add.container(e/2,t/2);o.setScrollFactor(0),o.setDepth(8001);const a=this.add.rectangle(0,0,600,500,2894892);a.setStrokeStyle(3,16777215),o.add(a);const n=this.add.text(0,-210,"ğŸ† æ’è¡Œæ¦œ",{fontSize:"32px",color:"#ffeb3b",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);o.add(n);try{const e=await fetch(`/api/leaderboard?activityId=${s}&limit=10`);if(e.ok){const t=(await e.json()).data||[];console.log("âœ… æ’è¡Œæ¦œæ•¸æ“š:",t);const s=-150,i=35;if(t.slice(0,10).forEach((e,t)=>{const a=s+t*i,n=t+1,r=e.playerName===this.playerName?"#ffeb3b":"#ffffff",l=this.add.text(-270,a,`${n}.`,{fontSize:"18px",color:r,fontFamily:"Arial",fontStyle:"bold"});l.setOrigin(0,.5),o.add(l);const h=this.add.text(-230,a,e.playerName||"åŒ¿åç©å®¶",{fontSize:"18px",color:r,fontFamily:"Arial"});h.setOrigin(0,.5),o.add(h);const d=this.add.text(270,a,`${e.score||0}`,{fontSize:"18px",color:r,fontFamily:"Arial",fontStyle:"bold"});d.setOrigin(1,.5),o.add(d)}),0===t.length){const e=this.add.text(0,0,"é‚„æ²’æœ‰æ’è¡Œæ¦œæ•¸æ“š",{fontSize:"20px",color:"#ffffff",fontFamily:"Arial"}).setOrigin(.5);o.add(e)}}}catch(r){console.error("âŒ è¼‰å…¥æ’è¡Œæ¦œå¤±æ•—:",r);const e=this.add.text(0,0,"è¼‰å…¥æ’è¡Œæ¦œå¤±æ•—",{fontSize:"20px",color:"#ff6b6b",fontFamily:"Arial"}).setOrigin(.5);o.add(e)}this.createModalButton(o,0,200,"Back",()=>{console.log("ğŸ® é»æ“Š Back æŒ‰éˆ•"),this.hideLeaderboard()}),this.leaderboardPage={overlay:i,page:o}}hideLeaderboard(){this.leaderboardPage&&(this.leaderboardPage.overlay.destroy(),this.leaderboardPage.page.destroy(),this.leaderboardPage=null),this.gameCompleteModal&&(this.gameCompleteModal.overlay.setVisible(!0),this.gameCompleteModal.modal.setVisible(!0))}notifyParentGameComplete(e){const t=new URLSearchParams(window.location.search).get("activityId"),s={score:parseInt(e)||0,activityId:t,gameType:"runner-game",completedAt:(new Date).toISOString(),timeSpent:this.timeElapsed,wordsLearned:this.wordsLearned};console.log("ğŸ® é€šçŸ¥çˆ¶é é¢éŠæˆ²å®Œæˆ:",s),"function"==typeof window.notifyGameComplete&&window.notifyGameComplete(e,s),window.parent&&window.parent!==window&&(window.parent.postMessage({type:"GAME_COMPLETE",score:parseInt(e)||0,gameData:s,timestamp:Date.now(),source:"runner-game"},"*"),console.log("ğŸ“¤ å·²ç™¼é€ GAME_COMPLETE åˆ°çˆ¶é é¢"))}async saveScoreToLeaderboard(e){try{const t=new URLSearchParams(window.location.search).get("activityId");if(!t)return void console.warn("âš ï¸ ç¼ºå°‘ activityIdï¼Œç„¡æ³•ä¿å­˜æ’è¡Œæ¦œ");const s={activityId:t,playerName:`Player_${Math.random().toString(36).substring(2,11)}`,score:parseInt(e)||0,correctCount:this.wordsLearned||0,totalCount:this.totalWords||0,accuracy:this.totalWords>0?(this.wordsLearned||0)/this.totalWords*100:0,timeSpent:this.timeElapsed||0,gameData:{wordsLearned:this.wordsLearned||0,totalWords:this.totalWords||0,timeElapsed:this.timeElapsed||0,timestamp:(new Date).toISOString()}};console.log("ğŸ® æ’è¡Œæ¦œæ•¸æ“š:",s);const i=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(i.ok){const e=await i.json();console.log("âœ… æ’è¡Œæ¦œæ•¸æ“šå·²ä¿å­˜:",e.data)}else console.error("âŒ ä¿å­˜æ’è¡Œæ¦œå¤±æ•—:",i.statusText)}catch(t){console.error("âŒ ä¿å­˜æ’è¡Œæ¦œå‡ºéŒ¯:",t)}}async saveGameProgress(e){try{const t=new URLSearchParams(window.location.search),s=t.get("activityId"),i=t.get("sessionId")||`runner-${Date.now()}`;if(!s)return void console.warn("âš ï¸ ç¼ºå°‘ activityIdï¼Œç„¡æ³•ä¿å­˜éŠæˆ²é€²åº¦");const o={activityId:s,sessionId:i,score:parseInt(e)||0,gameState:"completed",timeSpent:this.timeElapsed,wordsLearned:this.wordsLearned,completedAt:(new Date).toISOString()},a=await fetch("/api/game-progress/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});a.ok?console.log("âœ… éŠæˆ²é€²åº¦å·²ä¿å­˜:",o):console.error("âŒ ä¿å­˜éŠæˆ²é€²åº¦å¤±æ•—:",a.statusText)}catch(t){console.error("âŒ ä¿å­˜éŠæˆ²é€²åº¦å‡ºéŒ¯:",t)}}}class l extends Phaser.Scene{constructor(){super({key:"gameover"})}create(){this.width=this.sys.game.config.width,this.height=this.sys.game.config.height,this.center_width=this.width/2,this.center_height=this.height/2,this.cameras.main.setBackgroundColor(8900331);const e=this.registry.get("score");this.add.bitmapText(this.center_width,80,"arcade",`Score: ${e}`,30).setOrigin(.5),this.add.bitmapText(this.center_width,this.center_height,"arcade","GAME OVER",50).setOrigin(.5),this.add.bitmapText(this.center_width,this.center_height+80,"arcade","Press SPACE or Click to restart!",18).setOrigin(.5),this.saveGameProgress(e),this.notifyParentGameComplete(e),this.input.keyboard.on("keydown-SPACE",this.startGame,this),this.input.on("pointerdown",()=>this.startGame(),this)}notifyParentGameComplete(e){const t=new URLSearchParams(window.location.search).get("activityId"),s={score:parseInt(e)||0,activityId:t,gameType:"runner-game",completedAt:(new Date).toISOString(),timeSpent:Math.floor((Date.now()-(window.gameStartTime||Date.now()))/1e3)};"function"==typeof window.notifyGameComplete&&window.notifyGameComplete(e,s),window.parent&&window.parent!==window&&(window.parent.postMessage({type:"GAME_COMPLETE",score:parseInt(e)||0,gameData:s,timestamp:Date.now(),source:"runner-game"},"*"),console.log("ğŸ“¤ å·²ç™¼é€ GAME_COMPLETE åˆ°çˆ¶é é¢"))}async saveGameProgress(e){try{const t=new URLSearchParams(window.location.search),s=t.get("activityId"),i=t.get("sessionId")||`runner-${Date.now()}`;if(!s)return void console.warn("âš ï¸ ç¼ºå°‘ activityIdï¼Œç„¡æ³•ä¿å­˜éŠæˆ²é€²åº¦");const o={activityId:s,sessionId:i,score:parseInt(e)||0,gameState:"completed",timeSpent:Math.floor((Date.now()-(window.gameStartTime||Date.now()))/1e3),completedAt:(new Date).toISOString()},a=await fetch("/api/game-progress/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});a.ok?console.log("âœ… éŠæˆ²é€²åº¦å·²ä¿å­˜:",o):console.error("âŒ ä¿å­˜éŠæˆ²é€²åº¦å¤±æ•—:",a.statusText)}catch(t){console.error("âŒ ä¿å­˜éŠæˆ²é€²åº¦å‡ºéŒ¯:",t)}}startGame(){this.scene.start("game")}}const h={type:e.AUTO,width:960,height:540,scale:{mode:e.Scale.FIT,autoCenter:e.Scale.CENTER_BOTH,expandParent:!0,min:{width:320,height:270},max:{width:1920,height:1080},resolution:window.devicePixelRatio||1},autoRound:!1,parent:"game-container",backgroundColor:"#87ceeb",physics:{default:"arcade",arcade:{gravity:{y:350},debug:!1}},disableContextMenu:!0,pauseOnBlur:!1,scene:[r,l]},d=new e.Game(h);d.screenBaseSize={width:960,height:540,maxWidth:1920,maxHeight:1080,minWidth:320,minHeight:270},window.runnerGame=d;
