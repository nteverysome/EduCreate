import{P as e}from"./phaser-HlBRf90L.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class t extends Phaser.GameObjects.Rectangle{constructor(e,t,s,i){super(e,t,s,48,48,65280),this.setOrigin(.5),this.scene.add.existing(this),this.scene.physics.add.existing(this),this.body.collideWorldBounds=!0,this.setScale(1),this.jumping=!1,this.invincible=!1,this.health=10,this.body.mass=10,this.body.setDragY=10}}class s{constructor(e){this.scene=e,this.spawnX=e.width+20,this.pinos=0,this.initEvent=this.scene.time.delayedCall(2e3,()=>this.init(),null,this),this.cloudEvent=null,this.obstacleEvent=null,this.coinEvent=null}init(){this.generateCloud(),this.generateObstacle(),this.generateCoin()}generateCloud(){new i(this.scene,this.spawnX),this.cloudEvent=this.scene.time.delayedCall(Phaser.Math.Between(2e3,3e3),()=>this.generateCloud(),null,this)}generateObstacle(){this.scene.obstacles.add(new o(this.scene,this.spawnX,this.scene.height-Phaser.Math.Between(48,150))),this.obstacleEvent=this.scene.time.delayedCall(Phaser.Math.Between(1500,2500),()=>this.generateObstacle(),null,this)}generateCoin(){this.scene.coins.add(new n(this.scene,this.spawnX,this.scene.height-Phaser.Math.Between(60,180))),this.coinEvent=this.scene.time.delayedCall(Phaser.Math.Between(500,1500),()=>this.generateCoin(1),null,this)}stop(){console.log("ğŸ›‘ åœæ­¢æ•µäººç”Ÿæˆ"),this.initEvent&&(this.initEvent.remove(),this.initEvent=null),this.cloudEvent&&(this.cloudEvent.remove(),this.cloudEvent=null),this.obstacleEvent&&(this.obstacleEvent.remove(),this.obstacleEvent=null),this.coinEvent&&(this.coinEvent.remove(),this.coinEvent=null),console.log("âœ… æ•µäººç”Ÿæˆå·²åœæ­¢")}}class i extends Phaser.GameObjects.Rectangle{constructor(e,t,s){const i=s||Phaser.Math.Between(20,150),o=t||e.width+20;super(e,o,i,98,32,16777215),e.add.existing(this);const n=1/Phaser.Math.Between(1,3);this.spawnX=o,this.setScale(n),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:this.spawnX,to:-100},duration:3e3/this.scale,onComplete:()=>{this.destroy()}})}}class o extends Phaser.GameObjects.Rectangle{constructor(e,t,s){super(e,t,s,48,48,16711680),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1),this.spawnX=t,this.init()}init(){this.scene.tweens.add({targets:this,x:{from:this.spawnX,to:-100},duration:3e3,onComplete:()=>{this.destroy()}})}}class n extends Phaser.GameObjects.Text{constructor(e,t,s){var i;super(e,t,s,(null==(i=e.currentWord)?void 0:i.english)||"?",{fontSize:"28px",fontFamily:"Arial",color:"#ffffff",fontStyle:"bold",backgroundColor:"#ffff00",padding:{x:10,y:5}}),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1),this.spawnX=t,this.setOrigin(.5),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:this.spawnX,to:-100},duration:3e3,onComplete:()=>{this.destroy()}})}}class a extends Phaser.Scene{constructor(){super({key:"game"}),this.player=null,this.score=0,this.wordsLearned=0,this.timerText=null,this.scoreText=null,this.englishImage=null,this.englishText=null,this.chineseImage=null,this.chineseText=null,this.vocabulary=[],this.currentWordIndex=0,this.currentWord=null,this.timeElapsed=0,this.timerEvent=null}init(e){this.name=e.name,this.number=e.number}preload(){this.registry.set("score","0");const e="/games/runner-game/dist/assets";this.load.audio("coin",`${e}/sounds/coin.mp3`),this.load.audio("jump",`${e}/sounds/jump.mp3`),this.load.audio("dead",`${e}/sounds/dead.mp3`),this.load.audio("theme",`${e}/sounds/theme.mp3`),this.load.spritesheet("coin",`${e}/images/coin.png`,{frameWidth:32,frameHeight:32}),this.load.bitmapFont("arcade",`${e}/fonts/arcade.png`,`${e}/fonts/arcade.xml`),this.score=0,this.wordsLearned=0}create(){this.width=this.sys.game.config.width,this.height=this.sys.game.config.height,this.center_width=this.width/2,this.center_height=this.height/2,window.gameStartTime||(window.gameStartTime=Date.now()),this.cameras.main.setBackgroundColor(1710638),this.obstacles=this.add.group(),this.coins=this.add.group(),this.generator=new s(this),this.SPACE=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.player=new t(this,this.center_width-100,this.height-200),this.loadVocabulary(),this.createFiveColumnLayout(),this.physics.add.collider(this.player,this.obstacles,this.hitObstacle,()=>!0,this),this.physics.add.overlap(this.player,this.coins,this.hitCoin,()=>!0,this),this.loadAudios(),this.playMusic(),this.input.on("pointerdown",e=>this.jump(),this),this.updateScoreEvent=this.time.addEvent({delay:100,callback:()=>this.updateScore(),callbackScope:this,loop:!0}),this.startTimer()}hitObstacle(e,t){this.updateScoreEvent.destroy(),this.finishScene()}hitCoin(e,t){this.playAudio("coin"),this.updateScore(1e3),t.destroy(),this.updateVocabularyDisplay()}loadAudios(){this.audios={jump:this.sound.add("jump"),coin:this.sound.add("coin"),dead:this.sound.add("dead")}}playAudio(e){this.audios[e].play()}playMusic(e="theme"){this.theme=this.sound.add(e),this.theme.stop(),this.theme.play({mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!0,delay:0})}update(){var e;Phaser.Input.Keyboard.JustDown(this.SPACE)?this.jump():this.player.body.blocked.down&&(null==(e=this.jumpTween)||e.stop(),this.player.rotation=0)}jump(){this.player.body.blocked.down&&(this.player.body.setVelocityY(-300),this.playAudio("jump"),this.jumpTween=this.tweens.add({targets:this.player,duration:1e3,angle:{from:0,to:360},repeat:-1}))}finishScene(){this.gameCompleteModalShown?console.log("âš ï¸ éŠæˆ²çµæŸæ¨¡æ…‹æ¡†å·²é¡¯ç¤ºï¼Œè·³éé‡è¤‡èª¿ç”¨"):(this.gameCompleteModalShown=!0,this.theme.stop(),this.playAudio("dead"),this.registry.set("score",""+this.score),this.timerEvent&&(this.timerEvent.remove(),this.timerEvent=null),this.generator&&this.generator.stop(),console.log("ğŸ›‘ æ•µäººç”Ÿæˆå·²åœæ­¢ï¼ŒéŠæˆ²æ»¾å‹•å·²åœæ­¢"),this.showGameCompleteModal())}updateScore(e=1){this.score+=e,this.updateScoreDisplay()}loadVocabulary(){try{console.log("ğŸ“š é–‹å§‹è¼‰å…¥è©å½™...");const t=new URLSearchParams(window.location.search).get("customVocabulary");if(t&&"true"!==t&&"false"!==t)try{const e=JSON.parse(decodeURIComponent(t));if(Array.isArray(e))return this.vocabulary=e,void console.log("âœ… å¾ URL åƒæ•¸è¼‰å…¥è©å½™:",this.vocabulary.length,"å€‹")}catch(e){console.warn("âš ï¸ è§£æ URL è©å½™åƒæ•¸å¤±æ•—:",e)}const s=localStorage.getItem("gameCustomVocabulary");if(s)try{return this.vocabulary=JSON.parse(s),void console.log("âœ… å¾ localStorage è¼‰å…¥è©å½™:",this.vocabulary.length,"å€‹")}catch(e){console.warn("âš ï¸ è§£æ localStorage è©å½™å¤±æ•—:",e)}console.log("â„¹ï¸ æ²’æœ‰æ‰¾åˆ°è‡ªå®šç¾©è©å½™"),this.vocabulary=[]}catch(t){console.error("âŒ è¼‰å…¥è©å½™æ™‚å‡ºéŒ¯:",t),this.vocabulary=[]}}createFiveColumnLayout(){var e,t;this.vocabulary&&this.vocabulary.length>0&&(this.currentWord=this.vocabulary[0],this.currentWordIndex=0),this.timerText=this.add.text(80,45,"0:00",{fontSize:"24px",fontFamily:"Arial",color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setDepth(200),this.scoreText=this.add.text(180,45,"åˆ†æ•¸: 0\nå–®å­—: 0",{fontSize:"18px",fontFamily:"Arial",color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:3,align:"center"}).setOrigin(.5).setDepth(200),this.updateEnglishImage();const s=(null==(e=this.currentWord)?void 0:e.english)||"";this.englishText=this.add.text(450,45,s,{fontSize:"32px",fontFamily:"Arial",color:"#000000",fontStyle:"bold",backgroundColor:"#ffff00",padding:{x:15,y:8}}).setOrigin(.5).setDepth(200).setInteractive(),this.englishText.on("pointerdown",()=>{var e;(null==(e=this.currentWord)?void 0:e.english)&&this.speakText(this.currentWord.english,"en-US")}),this.updateChineseImage();const i=(null==(t=this.currentWord)?void 0:t.chinese)||"";this.chineseText=this.add.text(750,45,i,{fontSize:"32px",fontFamily:"Microsoft YaHei, Arial",color:"#ffff00",fontStyle:"bold",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(200).setInteractive(),this.chineseText.on("pointerdown",()=>{var e;(null==(e=this.currentWord)?void 0:e.chinese)&&this.speakText(this.currentWord.chinese,"zh-TW")}),this.currentWord||(this.englishText.setVisible(!1),this.chineseText.setVisible(!1)),console.log("âœ… äº”åˆ—ä½ˆå±€å‰µå»ºå®Œæˆ")}updateEnglishImage(){var e;const t=null==(e=this.currentWord)?void 0:e.imageUrl;if(t){const e=`english-image-${this.currentWord.id||Date.now()}`;this.textures.exists(e)?this.createOrUpdateImage("english",e):(this.load.image(e,t),this.load.once("complete",()=>{this.createOrUpdateImage("english",e)}),this.load.start())}else this.englishImage&&this.englishImage.setVisible(!1)}updateChineseImage(){var e;const t=null==(e=this.currentWord)?void 0:e.chineseImageUrl;if(t){const e=`chinese-image-${this.currentWord.id||Date.now()}`;this.textures.exists(e)?this.createOrUpdateImage("chinese",e):(this.load.image(e,t),this.load.once("complete",()=>{this.createOrUpdateImage("chinese",e)}),this.load.start())}else this.chineseImage&&this.chineseImage.setVisible(!1)}createOrUpdateImage(e,t){"english"===e?(this.englishImage?(this.englishImage.setTexture(t),this.englishImage.setVisible(!0)):(this.englishImage=this.add.image(320,45,t),this.englishImage.setDisplaySize(80,80),this.englishImage.setDepth(200),this.englishImage.setOrigin(.5)),console.log("ğŸ–¼ï¸ è‹±æ–‡åœ–ç‰‡å·²æ›´æ–°")):"chinese"===e&&(this.chineseImage?(this.chineseImage.setTexture(t),this.chineseImage.setVisible(!0)):(this.chineseImage=this.add.image(620,45,t),this.chineseImage.setDisplaySize(80,80),this.chineseImage.setDepth(200),this.chineseImage.setOrigin(.5)),console.log("ğŸ–¼ï¸ ä¸­æ–‡åœ–ç‰‡å·²æ›´æ–°"))}speakText(e,t){if("speechSynthesis"in window){const s=new SpeechSynthesisUtterance(e);s.lang=t,s.rate=.9,window.speechSynthesis.speak(s),console.log("ğŸ”Š æ’­æ”¾èªéŸ³:",e,t)}}startTimer(){this.timeElapsed=0,this.timerEvent=this.time.addEvent({delay:1e3,callback:()=>{this.timeElapsed++,this.timerText&&this.timerText.setText(this.formatTime(this.timeElapsed))},loop:!0})}formatTime(e){return`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`}updateScoreDisplay(){this.scoreText&&this.scoreText.setText(`åˆ†æ•¸: ${this.score}\nå–®å­—: ${this.wordsLearned}`)}updateVocabularyDisplay(){this.vocabulary&&0!==this.vocabulary.length&&(this.currentWordIndex=(this.currentWordIndex+1)%this.vocabulary.length,this.currentWord=this.vocabulary[this.currentWordIndex],this.wordsLearned++,this.currentWord&&(this.englishText&&(this.englishText.setText(this.currentWord.english||""),this.englishText.setVisible(!!this.currentWord.english)),this.chineseText&&(this.chineseText.setText(this.currentWord.chinese||""),this.chineseText.setVisible(!!this.currentWord.chinese)),this.updateEnglishImage(),this.updateChineseImage(),this.currentWord.english&&this.speakText(this.currentWord.english,"en-US"),this.updateScoreDisplay(),console.log("ğŸ”„ è©å½™å·²æ›´æ–°:",this.currentWord.english,"-",this.currentWord.chinese)))}showGameCompleteModal(){const e=this.scale.width,t=this.scale.height,s=this.score,i=this.wordsLearned,o=this.formatTime(this.timeElapsed);console.log("ğŸ® é¡¯ç¤ºéŠæˆ²çµæŸæ¨¡æ…‹æ¡†",{totalScore:s,totalWords:i,timeSpent:this.timeElapsed}),this.notifyParentGameComplete(s),this.saveGameProgress(s);const n=this.add.rectangle(e/2,t/2,e,t,0,.7);n.setDepth(5e3);const a=Math.min(500,.85*e),r=Math.min(380,.7*t),h=this.add.container(e/2,t/2);h.setDepth(5001);const l=this.add.rectangle(0,0,a,r,2894892);l.setStrokeStyle(4,0),h.add(l);const c=this.add.text(0,-r/2+30,"GAME COMPLETE",{fontSize:"32px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);h.add(c);const d=this.add.text(-80,-r/2+70,"Score",{fontSize:"18px",color:"#4a9eff",fontFamily:"Arial"}).setOrigin(.5);h.add(d);const g=this.add.text(-80,-r/2+95,`${s}`,{fontSize:"28px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);h.add(g);const m=this.add.text(80,-r/2+70,"Time",{fontSize:"18px",color:"#4a9eff",fontFamily:"Arial"}).setOrigin(.5);h.add(m);const p=this.add.text(80,-r/2+95,o,{fontSize:"28px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);h.add(p);const u=this.add.text(0,-r/2+130,`Words Learned: ${i}`,{fontSize:"16px",color:"#4caf50",fontFamily:"Arial"}).setOrigin(.5);h.add(u);const y=-r/2+180;this.createModalButton(h,0,y,"Leaderboard",()=>{console.log("ğŸ® é»æ“Š Leaderboard æŒ‰éˆ•"),this.notifyParentShowLeaderboard()}),this.createModalButton(h,0,y+50,"Start again",()=>{console.log("ğŸ® é»æ“Š Start again æŒ‰éˆ•"),n.destroy(),h.destroy(),this.gameCompleteModalShown=!1,this.restartGame()}),this.gameCompleteModal={overlay:n,modal:h}}createModalButton(e,t,s,i,o){const n=this.add.rectangle(t,s,280,45,3947580);n.setStrokeStyle(2,0),n.setInteractive({useHandCursor:!0}),e.add(n);const a=this.add.text(t,s,i,{fontSize:"20px",color:"#ffffff",fontFamily:"Arial",fontStyle:"bold"}).setOrigin(.5);return e.add(a),n.on("pointerdown",o),n.on("pointerover",()=>{n.setFillStyle(5000268)}),n.on("pointerout",()=>{n.setFillStyle(3947580)}),{buttonBg:n,buttonText:a}}restartGame(){console.log("ğŸ”„ é‡æ–°é–‹å§‹éŠæˆ²..."),this.score=0,this.wordsLearned=0,this.timeElapsed=0,this.currentWordIndex=0,this.gameCompleteModalShown=!1,this.generator&&this.generator.stop(),console.log("âœ… èˆŠçš„æ•µäººç”Ÿæˆå·²åœæ­¢"),this.physics.resume(),console.log("âœ… ç‰©ç†ç³»çµ±å·²æ¢å¾©"),this.player&&(this.player.x=this.center_width-100,this.player.y=this.height-200,this.player.body.setVelocity(0,0),this.player.rotation=0,console.log("âœ… ç©å®¶ä½ç½®å·²é‡ç½®")),this.obstacles&&this.obstacles.clear(!0),this.coins&&this.coins.clear(!0),console.log("âœ… éšœç¤™ç‰©å’Œç¡¬å¹£å·²æ¸…é™¤"),this.startTimer(),console.log("âœ… è¨ˆæ™‚å™¨å·²é‡æ–°å•Ÿå‹•"),this.generator=new s(this),console.log("âœ… æ•µäººç”Ÿæˆå·²é‡æ–°å•Ÿå‹•"),this.playMusic(),console.log("âœ… éŸ³æ¨‚å·²é‡æ–°å•Ÿå‹•"),this.updateVocabularyDisplay(),console.log("âœ… ç›®æ¨™è©å½™å·²é‡æ–°è¨­ç½®"),console.log("ğŸ® éŠæˆ²å·²å®Œå…¨é‡æ–°é–‹å§‹")}notifyParentShowLeaderboard(){const e=new URLSearchParams(window.location.search).get("activityId");console.log("ğŸ® é€šçŸ¥çˆ¶é é¢é¡¯ç¤ºæ’è¡Œæ¦œ:",e),window.parent&&window.parent!==window&&(window.parent.postMessage({type:"SHOW_LEADERBOARD",activityId:e,timestamp:Date.now(),source:"runner-game"},"*"),console.log("ğŸ“¤ å·²ç™¼é€ SHOW_LEADERBOARD åˆ°çˆ¶é é¢"))}notifyParentGameComplete(e){const t=new URLSearchParams(window.location.search).get("activityId"),s={score:parseInt(e)||0,activityId:t,gameType:"runner-game",completedAt:(new Date).toISOString(),timeSpent:this.timeElapsed,wordsLearned:this.wordsLearned};console.log("ğŸ® é€šçŸ¥çˆ¶é é¢éŠæˆ²å®Œæˆ:",s),"function"==typeof window.notifyGameComplete&&window.notifyGameComplete(e,s),window.parent&&window.parent!==window&&(window.parent.postMessage({type:"GAME_COMPLETE",score:parseInt(e)||0,gameData:s,timestamp:Date.now(),source:"runner-game"},"*"),console.log("ğŸ“¤ å·²ç™¼é€ GAME_COMPLETE åˆ°çˆ¶é é¢"))}async saveGameProgress(e){try{const t=new URLSearchParams(window.location.search),s=t.get("activityId"),i=t.get("sessionId")||`runner-${Date.now()}`;if(!s)return void console.warn("âš ï¸ ç¼ºå°‘ activityIdï¼Œç„¡æ³•ä¿å­˜éŠæˆ²é€²åº¦");const o={activityId:s,sessionId:i,score:parseInt(e)||0,gameState:"completed",timeSpent:this.timeElapsed,wordsLearned:this.wordsLearned,completedAt:(new Date).toISOString()},n=await fetch("/api/game-progress/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});n.ok?console.log("âœ… éŠæˆ²é€²åº¦å·²ä¿å­˜:",o):console.error("âŒ ä¿å­˜éŠæˆ²é€²åº¦å¤±æ•—:",n.statusText)}catch(t){console.error("âŒ ä¿å­˜éŠæˆ²é€²åº¦å‡ºéŒ¯:",t)}}}class r extends Phaser.Scene{constructor(){super({key:"gameover"})}create(){this.width=this.sys.game.config.width,this.height=this.sys.game.config.height,this.center_width=this.width/2,this.center_height=this.height/2,this.cameras.main.setBackgroundColor(8900331);const e=this.registry.get("score");this.add.bitmapText(this.center_width,80,"arcade",`Score: ${e}`,30).setOrigin(.5),this.add.bitmapText(this.center_width,this.center_height,"arcade","GAME OVER",50).setOrigin(.5),this.add.bitmapText(this.center_width,this.center_height+80,"arcade","Press SPACE or Click to restart!",18).setOrigin(.5),this.saveGameProgress(e),this.notifyParentGameComplete(e),this.input.keyboard.on("keydown-SPACE",this.startGame,this),this.input.on("pointerdown",()=>this.startGame(),this)}notifyParentGameComplete(e){const t=new URLSearchParams(window.location.search).get("activityId"),s={score:parseInt(e)||0,activityId:t,gameType:"runner-game",completedAt:(new Date).toISOString(),timeSpent:Math.floor((Date.now()-(window.gameStartTime||Date.now()))/1e3)};"function"==typeof window.notifyGameComplete&&window.notifyGameComplete(e,s),window.parent&&window.parent!==window&&(window.parent.postMessage({type:"GAME_COMPLETE",score:parseInt(e)||0,gameData:s,timestamp:Date.now(),source:"runner-game"},"*"),console.log("ğŸ“¤ å·²ç™¼é€ GAME_COMPLETE åˆ°çˆ¶é é¢"))}async saveGameProgress(e){try{const t=new URLSearchParams(window.location.search),s=t.get("activityId"),i=t.get("sessionId")||`runner-${Date.now()}`;if(!s)return void console.warn("âš ï¸ ç¼ºå°‘ activityIdï¼Œç„¡æ³•ä¿å­˜éŠæˆ²é€²åº¦");const o={activityId:s,sessionId:i,score:parseInt(e)||0,gameState:"completed",timeSpent:Math.floor((Date.now()-(window.gameStartTime||Date.now()))/1e3),completedAt:(new Date).toISOString()},n=await fetch("/api/game-progress/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});n.ok?console.log("âœ… éŠæˆ²é€²åº¦å·²ä¿å­˜:",o):console.error("âŒ ä¿å­˜éŠæˆ²é€²åº¦å¤±æ•—:",n.statusText)}catch(t){console.error("âŒ ä¿å­˜éŠæˆ²é€²åº¦å‡ºéŒ¯:",t)}}startGame(){this.scene.start("game")}}const h={type:e.AUTO,width:960,height:540,scale:{mode:e.Scale.FIT,autoCenter:e.Scale.CENTER_BOTH,expandParent:!0,min:{width:320,height:270},max:{width:1920,height:1080},resolution:window.devicePixelRatio||1},autoRound:!1,parent:"game-container",backgroundColor:"#87ceeb",physics:{default:"arcade",arcade:{gravity:{y:350},debug:!1}},disableContextMenu:!0,pauseOnBlur:!1,scene:[a,r]},l=new e.Game(h);l.screenBaseSize={width:960,height:540,maxWidth:1920,maxHeight:1080,minWidth:320,minHeight:270},window.runnerGame=l;
