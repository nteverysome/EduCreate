<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â¤ï¸ ç”Ÿå‘½å€¼ç³»çµ±æ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }
        #game {
            border: 2px solid #4facfe;
            border-radius: 10px;
            margin: 20px 0;
        }
        .info {
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            max-width: 600px;
            text-align: center;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        .btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            min-width: 120px;
        }
        .btn:hover {
            background: #357abd;
        }
        .btn.danger {
            background: #ff4757;
        }
        .btn.danger:hover {
            background: #ff3742;
        }
        .btn.success {
            background: #2ed573;
        }
        .btn.success:hover {
            background: #26d065;
        }
        .health-demo {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>â¤ï¸ ç”Ÿå‘½å€¼ç³»çµ±æ¸¬è©¦</h1>
    
    <div class="info">
        <p><strong>æ¸¬è©¦åŠŸèƒ½</strong>: å·¦ä¸‹è§’ç”Ÿå‘½å€¼æ¢é¡¯ç¤ºå’Œç¢°æ’å‚·å®³ç³»çµ±</p>
        <p><strong>ç¢°æ’æ©Ÿåˆ¶</strong>: å¤ªç©ºèˆ¹ç¢°åˆ°é›²æœµæœƒå—åˆ°10é»å‚·å®³</p>
        <p><strong>è¦–è¦ºæ•ˆæœ</strong>: ç”Ÿå‘½å€¼æ¢æœƒæ ¹æ“šè¡€é‡è®Šè‰²ï¼ˆç¶ â†’é»ƒâ†’ç´…ï¼‰</p>
    </div>
    
    <div class="controls">
        <button class="btn danger" onclick="takeDamage(10)">ğŸ’¥ å—åˆ°10é»å‚·å®³</button>
        <button class="btn danger" onclick="takeDamage(25)">ğŸ’¥ å—åˆ°25é»å‚·å®³</button>
        <button class="btn success" onclick="heal(20)">ğŸ’š æ¢å¾©20é»ç”Ÿå‘½</button>
        <button class="btn success" onclick="heal(50)">ğŸ’š æ¢å¾©50é»ç”Ÿå‘½</button>
        <button class="btn" onclick="resetHealth()">ğŸ”„ é‡ç½®ç”Ÿå‘½å€¼</button>
        <button class="btn" onclick="spawnEnemy()">â˜ï¸ ç”Ÿæˆæ•µäºº</button>
    </div>
    
    <div class="health-demo">
        <h3>ğŸ¯ ç”Ÿå‘½å€¼æ¢é¡è‰²èªªæ˜ï¼š</h3>
        <p>ğŸŸ¢ <strong>ç¶ è‰²</strong>: 61-100 ç”Ÿå‘½å€¼ï¼ˆå¥åº·ï¼‰</p>
        <p>ğŸŸ¡ <strong>é»ƒè‰²</strong>: 31-60 ç”Ÿå‘½å€¼ï¼ˆè­¦å‘Šï¼‰</p>
        <p>ğŸ”´ <strong>ç´…è‰²</strong>: 1-30 ç”Ÿå‘½å€¼ï¼ˆå±éšªï¼‰</p>
    </div>
    
    <div id="game"></div>
    
    <div id="status" style="color: #4facfe; margin-top: 10px;">è¼‰å…¥ä¸­...</div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    <script>
        let gameScene;

        class HealthSystemTestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'HealthSystemTestScene' });
            }

            preload() {
                // è¼‰å…¥å¤ªç©ºèˆ¹ç²¾éˆåœ–
                this.load.spritesheet('player_spaceship', 'assets/images/sprites/player_spaceship.png', {
                    frameWidth: Math.floor(2450 / 7),
                    frameHeight: 150
                });
                
                // è¼‰å…¥é›²æœµæ•µäºº
                this.load.image('cloud_enemy', 'assets/images/enemies/cloud_shape3_1.png');
                
                console.log('â¤ï¸ è¼‰å…¥ç”Ÿå‘½å€¼ç³»çµ±æ¸¬è©¦è³‡æº...');
            }

            create() {
                gameScene = this;
                const { width, height } = this.cameras.main;
                
                // å‰µå»ºæ·±è‰²èƒŒæ™¯
                this.add.rectangle(width/2, height/2, width, height, 0x1a1a2e);
                
                // æ¨™é¡Œ
                this.add.text(width/2, 50, 'â¤ï¸ ç”Ÿå‘½å€¼ç³»çµ±æ¸¬è©¦', {
                    fontSize: '24px',
                    color: '#4facfe',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
                
                // å‰µå»ºå¤ªç©ºèˆ¹
                this.createSpaceship();
                
                // å‰µå»ºç”Ÿå‘½å€¼ç³»çµ±
                this.createHealthSystem();
                
                // å‰µå»ºæ•µäººç³»çµ±
                this.createEnemySystem();
                
                // æ›´æ–°é é¢ç‹€æ…‹
                document.getElementById('status').textContent = 'âœ… ç”Ÿå‘½å€¼ç³»çµ±å·²å•Ÿå‹• - ä½¿ç”¨æŒ‰éˆ•æ¸¬è©¦æˆ–è®“å¤ªç©ºèˆ¹ç¢°æ’é›²æœµ';
            }

            createSpaceship() {
                const { width, height } = this.cameras.main;
                
                if (this.textures.exists('player_spaceship')) {
                    // å‰µå»ºå‹•ç•«
                    this.anims.create({
                        key: 'spaceship_fly',
                        frames: this.anims.generateFrameNumbers('player_spaceship', {
                            start: 0, end: 6
                        }),
                        frameRate: 10,
                        repeat: -1
                    });
                    
                    this.player = this.add.sprite(width * 0.2, height * 0.5, 'player_spaceship');
                    this.player.setScale(0.4);
                    this.player.play('spaceship_fly');
                } else {
                    // å‚™ç”¨å¤ªç©ºèˆ¹
                    const graphics = this.add.graphics();
                    graphics.fillStyle(0x4facfe);
                    graphics.fillTriangle(30, 0, 0, 20, 0, -20);
                    graphics.generateTexture('backup_spaceship', 40, 40);
                    graphics.destroy();
                    
                    this.player = this.add.sprite(width * 0.2, height * 0.5, 'backup_spaceship');
                    this.player.setScale(1.5);
                }
                
                this.player.setOrigin(0.5, 0.5);
                console.log('ğŸš€ å¤ªç©ºèˆ¹å‰µå»ºå®Œæˆ');
            }

            createHealthSystem() {
                const { width, height } = this.cameras.main;
                
                // ç”Ÿå‘½å€¼è¨­å®š
                this.maxHealth = 100;
                this.currentHealth = 100;
                
                // ç”Ÿå‘½å€¼æ¢ä½ç½®å’Œå°ºå¯¸ï¼ˆå·¦ä¸‹è§’ï¼‰
                const healthBarWidth = 200;
                const healthBarHeight = 20;
                const margin = 20;
                const healthBarX = margin;
                const healthBarY = height - margin - healthBarHeight;
                
                // å‰µå»ºç”Ÿå‘½å€¼æ¢èƒŒæ™¯ï¼ˆé»‘è‰²é‚Šæ¡†ï¼‰
                this.healthBarBg = this.add.rectangle(
                    healthBarX, healthBarY, 
                    healthBarWidth + 4, healthBarHeight + 4, 
                    0x000000
                );
                this.healthBarBg.setOrigin(0, 0);
                this.healthBarBg.setDepth(100);
                
                // å‰µå»ºç”Ÿå‘½å€¼æ¢èƒŒæ™¯ï¼ˆæ·±ç°è‰²ï¼‰
                this.healthBarBackground = this.add.rectangle(
                    healthBarX + 2, healthBarY + 2, 
                    healthBarWidth, healthBarHeight, 
                    0x333333
                );
                this.healthBarBackground.setOrigin(0, 0);
                this.healthBarBackground.setDepth(101);
                
                // å‰µå»ºç”Ÿå‘½å€¼æ¢ï¼ˆç¶ è‰²ï¼‰
                this.healthBar = this.add.rectangle(
                    healthBarX + 2, healthBarY + 2, 
                    healthBarWidth, healthBarHeight, 
                    0x00ff00
                );
                this.healthBar.setOrigin(0, 0);
                this.healthBar.setDepth(102);
                
                // å‰µå»ºç”Ÿå‘½å€¼æ–‡å­—
                this.healthText = this.add.text(
                    healthBarX + healthBarWidth + 15, 
                    healthBarY + healthBarHeight / 2, 
                    `${this.currentHealth}/${this.maxHealth}`, 
                    {
                        fontSize: '16px',
                        color: '#ffffff',
                        fontStyle: 'bold'
                    }
                );
                this.healthText.setOrigin(0, 0.5);
                this.healthText.setDepth(103);
                
                console.log('â¤ï¸ ç”Ÿå‘½å€¼ç³»çµ±å‰µå»ºå®Œæˆ');
            }

            createEnemySystem() {
                this.enemies = [];
                this.enemySpawnTimer = 0;
                this.enemySpawnDelay = 4000; // 4ç§’ç”Ÿæˆä¸€å€‹æ•µäºº
            }

            spawnCloudEnemy() {
                const { width, height } = this.cameras.main;
                
                if (!this.textures.exists('cloud_enemy')) return;
                
                const enemy = this.add.sprite(width + 100, Phaser.Math.Between(100, height - 100), 'cloud_enemy');
                enemy.setOrigin(0.5, 0.5);
                enemy.setScale(0.4);
                enemy.setAlpha(0.8);
                enemy.speed = 2;
                
                this.enemies.push(enemy);
                console.log('â˜ï¸ ç”Ÿæˆé›²æœµæ•µäºº');
            }

            updateHealthDisplay() {
                if (!this.healthBar || !this.healthText) return;
                
                const healthPercent = this.currentHealth / this.maxHealth;
                const maxWidth = 200;
                this.healthBar.displayWidth = maxWidth * healthPercent;
                
                // æ ¹æ“šç”Ÿå‘½å€¼æ”¹è®Šé¡è‰²
                let color = 0x00ff00; // ç¶ è‰²
                if (healthPercent <= 0.3) {
                    color = 0xff0000; // ç´…è‰²
                } else if (healthPercent <= 0.6) {
                    color = 0xffff00; // é»ƒè‰²
                }
                this.healthBar.setFillStyle(color);
                
                this.healthText.setText(`${this.currentHealth}/${this.maxHealth}`);
            }

            takeDamage(damage) {
                this.currentHealth = Math.max(0, this.currentHealth - damage);
                this.updateHealthDisplay();
                
                if (this.currentHealth <= 0) {
                    console.log('ğŸ’€ å¤ªç©ºèˆ¹è¢«æ‘§æ¯€ï¼');
                }
                
                console.log(`ğŸ’¥ å—åˆ° ${damage} é»å‚·å®³ï¼Œå‰©é¤˜ç”Ÿå‘½å€¼: ${this.currentHealth}`);
            }

            heal(amount) {
                this.currentHealth = Math.min(this.maxHealth, this.currentHealth + amount);
                this.updateHealthDisplay();
                console.log(`ğŸ’š æ¢å¾© ${amount} é»ç”Ÿå‘½å€¼ï¼Œç•¶å‰ç”Ÿå‘½å€¼: ${this.currentHealth}`);
            }

            checkCollision(obj1, obj2) {
                if (!obj1 || !obj2 || !obj1.active || !obj2.active) return false;
                const bounds1 = obj1.getBounds();
                const bounds2 = obj2.getBounds();
                return Phaser.Geom.Rectangle.Overlaps(bounds1, bounds2);
            }

            update() {
                const currentTime = this.time.now;
                
                // è‡ªå‹•ç”Ÿæˆæ•µäºº
                if (currentTime - this.enemySpawnTimer > this.enemySpawnDelay) {
                    this.spawnCloudEnemy();
                    this.enemySpawnTimer = currentTime;
                    this.enemySpawnDelay = Phaser.Math.Between(3000, 6000);
                }
                
                // æ›´æ–°æ•µäºº
                for (let i = this.enemies.length - 1; i >= 0; i--) {
                    const enemy = this.enemies[i];
                    
                    if (enemy && enemy.active) {
                        enemy.x -= enemy.speed;
                        
                        // æª¢æŸ¥ç¢°æ’
                        if (this.player && this.checkCollision(this.player, enemy)) {
                            this.takeDamage(10);
                            enemy.destroy();
                            this.enemies.splice(i, 1);
                            console.log('ğŸ’¥ å¤ªç©ºèˆ¹èˆ‡é›²æœµç¢°æ’ï¼');
                            continue;
                        }
                        
                        if (enemy.x < -100) {
                            enemy.destroy();
                            this.enemies.splice(i, 1);
                        }
                    } else {
                        this.enemies.splice(i, 1);
                    }
                }
            }
        }

        // æ§åˆ¶å‡½æ•¸
        function takeDamage(amount) {
            if (gameScene) gameScene.takeDamage(amount);
        }

        function heal(amount) {
            if (gameScene) gameScene.heal(amount);
        }

        function resetHealth() {
            if (gameScene) {
                gameScene.currentHealth = gameScene.maxHealth;
                gameScene.updateHealthDisplay();
                console.log('ğŸ”„ ç”Ÿå‘½å€¼å·²é‡ç½®');
            }
        }

        function spawnEnemy() {
            if (gameScene) gameScene.spawnCloudEnemy();
        }

        // Phaser é…ç½®
        const config = {
            type: Phaser.AUTO,
            width: 900,
            height: 600,
            parent: 'game',
            backgroundColor: '#1a1a2e',
            scene: HealthSystemTestScene
        };

        const game = new Phaser.Game(config);
        console.log('â¤ï¸ ç”Ÿå‘½å€¼ç³»çµ±æ¸¬è©¦å•Ÿå‹•');
    </script>
</body>
</html>
