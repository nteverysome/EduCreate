<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â˜ï¸ é›²æœµæ•µäººæ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }
        #game {
            border: 2px solid #4facfe;
            border-radius: 10px;
            margin: 20px 0;
        }
        .info {
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            max-width: 600px;
            text-align: center;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn:hover {
            background: #357abd;
        }
    </style>
</head>
<body>
    <h1>â˜ï¸ é›²æœµæ•µäººç³»çµ±æ¸¬è©¦</h1>
    
    <div class="info">
        <p><strong>æ¸¬è©¦åŠŸèƒ½</strong>: é›²æœµæ•µäººå¾å³å´éš¨æ©Ÿå‡ºç¾ï¼Œå‘å·¦ç§»å‹•</p>
        <p><strong>ç”Ÿæˆè¦å¾‹</strong>: æ¯2-4ç§’éš¨æ©Ÿç”Ÿæˆä¸€å€‹é›²æœµæ•µäºº</p>
        <p><strong>ç§»å‹•ç‰¹æ€§</strong>: éš¨æ©Ÿé€Ÿåº¦ + æµ®å‹•å‹•ç•«æ•ˆæœ</p>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="manualSpawn()">ğŸ¯ æ‰‹å‹•ç”Ÿæˆæ•µäºº</button>
        <button class="btn" onclick="clearEnemies()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•µäºº</button>
        <button class="btn" onclick="toggleAutoSpawn()">â¸ï¸ æš«åœ/æ¢å¾©è‡ªå‹•ç”Ÿæˆ</button>
    </div>
    
    <div id="game"></div>
    
    <div id="status" style="color: #4facfe; margin-top: 10px;">è¼‰å…¥ä¸­...</div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    <script>
        let gameScene;
        let autoSpawnEnabled = true;

        class CloudEnemyTestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'CloudEnemyTestScene' });
            }

            preload() {
                // è¼‰å…¥é›²æœµæ•µäººåœ–ç‰‡
                this.load.image('cloud_enemy', 'assets/images/enemies/cloud_shape3_1.png');
                console.log('â˜ï¸ è¼‰å…¥é›²æœµæ•µäººè³‡æº...');
            }

            create() {
                gameScene = this;
                const { width, height } = this.cameras.main;
                
                // å‰µå»ºæ·±è‰²èƒŒæ™¯
                this.add.rectangle(width/2, height/2, width, height, 0x1a1a2e);
                
                // æ¨™é¡Œ
                this.add.text(width/2, 50, 'â˜ï¸ é›²æœµæ•µäººæ¸¬è©¦', {
                    fontSize: '24px',
                    color: '#4facfe',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
                
                // å‰µå»ºæ•µäººç³»çµ±
                this.createEnemySystem();
                
                // ç‹€æ…‹é¡¯ç¤º
                this.statusText = this.add.text(20, height - 60, '', {
                    fontSize: '14px',
                    color: '#ffffff',
                    backgroundColor: 'rgba(0,0,0,0.7)',
                    padding: { x: 10, y: 5 }
                });
                
                // æ›´æ–°é é¢ç‹€æ…‹
                document.getElementById('status').textContent = 'âœ… é›²æœµæ•µäººç³»çµ±å·²å•Ÿå‹•';
            }

            createEnemySystem() {
                // åˆå§‹åŒ–æ•µäººç¾¤çµ„
                this.enemies = [];
                this.enemySpawnTimer = 0;
                this.enemySpawnDelay = 3000;
                
                console.log('â˜ï¸ æ•µäººç³»çµ±åˆå§‹åŒ–å®Œæˆ');
            }

            spawnCloudEnemy() {
                const { width, height } = this.cameras.main;
                
                if (!this.textures.exists('cloud_enemy')) {
                    console.warn('âš ï¸ é›²æœµæ•µäººè³‡æºä¸å­˜åœ¨');
                    return;
                }
                
                // å‰µå»ºæ•µäºº
                const enemy = this.add.sprite(width + 100, Phaser.Math.Between(100, height - 100), 'cloud_enemy');
                enemy.setOrigin(0.5, 0.5);
                enemy.setScale(0.4);
                enemy.setAlpha(0.8);
                
                // è¨­ç½®å±¬æ€§
                enemy.speed = Phaser.Math.Between(1, 3);
                
                // æµ®å‹•å‹•ç•«
                this.tweens.add({
                    targets: enemy,
                    y: enemy.y + Phaser.Math.Between(-30, 30),
                    duration: Phaser.Math.Between(2000, 4000),
                    yoyo: true,
                    repeat: -1,
                    ease: 'Sine.easeInOut'
                });
                
                // æ·»åŠ åˆ°ç¾¤çµ„
                this.enemies.push(enemy);
                
                console.log(`â˜ï¸ ç”Ÿæˆé›²æœµæ•µäºº (${enemy.x}, ${enemy.y})`);
            }

            clearAllEnemies() {
                this.enemies.forEach(enemy => {
                    if (enemy && enemy.active) {
                        enemy.destroy();
                    }
                });
                this.enemies = [];
                console.log('ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•µäºº');
            }

            update() {
                const currentTime = this.time.now;
                
                // è‡ªå‹•ç”Ÿæˆæ•µäºº
                if (autoSpawnEnabled && currentTime - this.enemySpawnTimer > this.enemySpawnDelay) {
                    this.spawnCloudEnemy();
                    this.enemySpawnTimer = currentTime;
                    this.enemySpawnDelay = Phaser.Math.Between(2000, 4000);
                }
                
                // æ›´æ–°æ•µäºº
                for (let i = this.enemies.length - 1; i >= 0; i--) {
                    const enemy = this.enemies[i];
                    
                    if (enemy && enemy.active) {
                        enemy.x -= enemy.speed;
                        
                        if (enemy.x < -100) {
                            enemy.destroy();
                            this.enemies.splice(i, 1);
                        }
                    } else {
                        this.enemies.splice(i, 1);
                    }
                }
                
                // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
                if (this.statusText) {
                    const activeEnemies = this.enemies.length;
                    const nextSpawn = autoSpawnEnabled ? 
                        Math.max(0, Math.round((this.enemySpawnDelay - (currentTime - this.enemySpawnTimer)) / 1000)) : 
                        'æš«åœ';
                    this.statusText.setText(`æ´»èºæ•µäºº: ${activeEnemies} | ä¸‹æ¬¡ç”Ÿæˆ: ${nextSpawn}${typeof nextSpawn === 'number' ? 'ç§’' : ''}`);
                }
            }
        }

        // æ§åˆ¶å‡½æ•¸
        function manualSpawn() {
            if (gameScene) {
                gameScene.spawnCloudEnemy();
            }
        }

        function clearEnemies() {
            if (gameScene) {
                gameScene.clearAllEnemies();
            }
        }

        function toggleAutoSpawn() {
            autoSpawnEnabled = !autoSpawnEnabled;
            const btn = document.querySelector('button[onclick="toggleAutoSpawn()"]');
            btn.textContent = autoSpawnEnabled ? 'â¸ï¸ æš«åœè‡ªå‹•ç”Ÿæˆ' : 'â–¶ï¸ æ¢å¾©è‡ªå‹•ç”Ÿæˆ';
            console.log(autoSpawnEnabled ? 'â–¶ï¸ æ¢å¾©è‡ªå‹•ç”Ÿæˆ' : 'â¸ï¸ æš«åœè‡ªå‹•ç”Ÿæˆ');
        }

        // Phaser é…ç½®
        const config = {
            type: Phaser.AUTO,
            width: 900,
            height: 600,
            parent: 'game',
            backgroundColor: '#1a1a2e',
            scene: CloudEnemyTestScene
        };

        const game = new Phaser.Game(config);
        console.log('â˜ï¸ é›²æœµæ•µäººæ¸¬è©¦å•Ÿå‹•');
    </script>
</body>
</html>
