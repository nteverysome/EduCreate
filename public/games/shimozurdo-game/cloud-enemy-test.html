<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>☁️ 雲朵敵人測試</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }
        #game {
            border: 2px solid #4facfe;
            border-radius: 10px;
            margin: 20px 0;
        }
        .info {
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            max-width: 600px;
            text-align: center;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn:hover {
            background: #357abd;
        }
    </style>
</head>
<body>
    <h1>☁️ 雲朵敵人系統測試</h1>
    
    <div class="info">
        <p><strong>測試功能</strong>: 雲朵敵人從右側隨機出現，向左移動</p>
        <p><strong>生成規律</strong>: 每2-4秒隨機生成一個雲朵敵人</p>
        <p><strong>移動特性</strong>: 隨機速度 + 浮動動畫效果</p>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="manualSpawn()">🎯 手動生成敵人</button>
        <button class="btn" onclick="clearEnemies()">🗑️ 清除所有敵人</button>
        <button class="btn" onclick="toggleAutoSpawn()">⏸️ 暫停/恢復自動生成</button>
    </div>
    
    <div id="game"></div>
    
    <div id="status" style="color: #4facfe; margin-top: 10px;">載入中...</div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    <script>
        let gameScene;
        let autoSpawnEnabled = true;

        class CloudEnemyTestScene extends Phaser.Scene {
            constructor() {
                super({ key: 'CloudEnemyTestScene' });
            }

            preload() {
                // 載入雲朵敵人圖片
                this.load.image('cloud_enemy', 'assets/images/enemies/cloud_shape3_1.png');
                console.log('☁️ 載入雲朵敵人資源...');
            }

            create() {
                gameScene = this;
                const { width, height } = this.cameras.main;
                
                // 創建深色背景
                this.add.rectangle(width/2, height/2, width, height, 0x1a1a2e);
                
                // 標題
                this.add.text(width/2, 50, '☁️ 雲朵敵人測試', {
                    fontSize: '24px',
                    color: '#4facfe',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
                
                // 創建敵人系統
                this.createEnemySystem();
                
                // 狀態顯示
                this.statusText = this.add.text(20, height - 60, '', {
                    fontSize: '14px',
                    color: '#ffffff',
                    backgroundColor: 'rgba(0,0,0,0.7)',
                    padding: { x: 10, y: 5 }
                });
                
                // 更新頁面狀態
                document.getElementById('status').textContent = '✅ 雲朵敵人系統已啟動';
            }

            createEnemySystem() {
                // 初始化敵人群組
                this.enemies = [];
                this.enemySpawnTimer = 0;
                this.enemySpawnDelay = 3000;
                
                console.log('☁️ 敵人系統初始化完成');
            }

            spawnCloudEnemy() {
                const { width, height } = this.cameras.main;
                
                if (!this.textures.exists('cloud_enemy')) {
                    console.warn('⚠️ 雲朵敵人資源不存在');
                    return;
                }
                
                // 創建敵人
                const enemy = this.add.sprite(width + 100, Phaser.Math.Between(100, height - 100), 'cloud_enemy');
                enemy.setOrigin(0.5, 0.5);
                enemy.setScale(0.4);
                enemy.setAlpha(0.8);
                
                // 設置屬性
                enemy.speed = Phaser.Math.Between(1, 3);
                
                // 浮動動畫
                this.tweens.add({
                    targets: enemy,
                    y: enemy.y + Phaser.Math.Between(-30, 30),
                    duration: Phaser.Math.Between(2000, 4000),
                    yoyo: true,
                    repeat: -1,
                    ease: 'Sine.easeInOut'
                });
                
                // 添加到群組
                this.enemies.push(enemy);
                
                console.log(`☁️ 生成雲朵敵人 (${enemy.x}, ${enemy.y})`);
            }

            clearAllEnemies() {
                this.enemies.forEach(enemy => {
                    if (enemy && enemy.active) {
                        enemy.destroy();
                    }
                });
                this.enemies = [];
                console.log('🗑️ 清除所有敵人');
            }

            update() {
                const currentTime = this.time.now;
                
                // 自動生成敵人
                if (autoSpawnEnabled && currentTime - this.enemySpawnTimer > this.enemySpawnDelay) {
                    this.spawnCloudEnemy();
                    this.enemySpawnTimer = currentTime;
                    this.enemySpawnDelay = Phaser.Math.Between(2000, 4000);
                }
                
                // 更新敵人
                for (let i = this.enemies.length - 1; i >= 0; i--) {
                    const enemy = this.enemies[i];
                    
                    if (enemy && enemy.active) {
                        enemy.x -= enemy.speed;
                        
                        if (enemy.x < -100) {
                            enemy.destroy();
                            this.enemies.splice(i, 1);
                        }
                    } else {
                        this.enemies.splice(i, 1);
                    }
                }
                
                // 更新狀態顯示
                if (this.statusText) {
                    const activeEnemies = this.enemies.length;
                    const nextSpawn = autoSpawnEnabled ? 
                        Math.max(0, Math.round((this.enemySpawnDelay - (currentTime - this.enemySpawnTimer)) / 1000)) : 
                        '暫停';
                    this.statusText.setText(`活躍敵人: ${activeEnemies} | 下次生成: ${nextSpawn}${typeof nextSpawn === 'number' ? '秒' : ''}`);
                }
            }
        }

        // 控制函數
        function manualSpawn() {
            if (gameScene) {
                gameScene.spawnCloudEnemy();
            }
        }

        function clearEnemies() {
            if (gameScene) {
                gameScene.clearAllEnemies();
            }
        }

        function toggleAutoSpawn() {
            autoSpawnEnabled = !autoSpawnEnabled;
            const btn = document.querySelector('button[onclick="toggleAutoSpawn()"]');
            btn.textContent = autoSpawnEnabled ? '⏸️ 暫停自動生成' : '▶️ 恢復自動生成';
            console.log(autoSpawnEnabled ? '▶️ 恢復自動生成' : '⏸️ 暫停自動生成');
        }

        // Phaser 配置
        const config = {
            type: Phaser.AUTO,
            width: 900,
            height: 600,
            parent: 'game',
            backgroundColor: '#1a1a2e',
            scene: CloudEnemyTestScene
        };

        const game = new Phaser.Game(config);
        console.log('☁️ 雲朵敵人測試啟動');
    </script>
</body>
</html>
