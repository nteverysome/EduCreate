<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Phaser-DOMåº§æ¨™çµ±ä¸€æ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #000;
            color: #fff;
        }
        
        #gameContainer {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border: 2px solid #00ff00;
            position: relative;
        }
        
        #info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10000;
        }
        
        .marker {
            position: fixed;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
            pointer-events: none;
            z-index: 9999;
        }
        
        .dom-marker {
            background: red;
        }
        
        .phaser-marker {
            background: blue;
        }
    </style>
</head>
<body>
    <div id="info">
        <div>ğŸ¯ Phaser-DOMåº§æ¨™çµ±ä¸€æ¸¬è©¦</div>
        <div id="domCoords">DOMåº§æ¨™: (0, 0)</div>
        <div id="phaserCoords">Phaseråº§æ¨™: (0, 0)</div>
        <div id="status">ç‹€æ…‹: åˆå§‹åŒ–ä¸­...</div>
    </div>
    
    <div id="gameContainer"></div>

    <!-- Phaser 3 -->
    <script src="//cdn.jsdelivr.net/npm/phaser@3.53.1/dist/phaser.min.js"></script>
    
    <!-- æˆ‘å€‘çš„åº§æ¨™çµ±ä¸€å™¨ -->
    <script src="/games/shimozurdo-game/scenes/phaser-dom-coordinate-unifier.js"></script>
    
    <script>
        // å…¨åŸŸè®Šæ•¸
        let domCoords = { x: 0, y: 0 };
        let phaserCoords = { x: 0, y: 0 };
        let coordinateUnifier = null;
        let markers = [];
        
        // DOMåº§æ¨™è¿½è¹¤
        function setupDOMTracking() {
            document.addEventListener('touchstart', (event) => {
                if (event.touches.length > 0) {
                    const touch = event.touches[0];
                    domCoords.x = touch.clientX;
                    domCoords.y = touch.clientY;
                    createMarker(touch.clientX, touch.clientY, 'dom-marker');
                    updateInfo();
                }
            }, { passive: true });

            document.addEventListener('mousedown', (event) => {
                domCoords.x = event.clientX;
                domCoords.y = event.clientY;
                createMarker(event.clientX, event.clientY, 'dom-marker');
                updateInfo();
            }, { passive: true });
        }
        
        // å‰µå»ºè¦–è¦ºæ¨™è¨˜
        function createMarker(x, y, className) {
            const marker = document.createElement('div');
            marker.className = `marker ${className}`;
            marker.style.left = (x - 10) + 'px';
            marker.style.top = (y - 10) + 'px';
            document.body.appendChild(marker);
            
            markers.push(marker);
            
            // é™åˆ¶æ¨™è¨˜æ•¸é‡
            if (markers.length > 10) {
                const oldMarker = markers.shift();
                if (oldMarker.parentNode) {
                    oldMarker.parentNode.removeChild(oldMarker);
                }
            }
            
            // 3ç§’å¾Œè‡ªå‹•ç§»é™¤
            setTimeout(() => {
                if (marker.parentNode) {
                    marker.parentNode.removeChild(marker);
                }
            }, 3000);
        }
        
        // æ›´æ–°ä¿¡æ¯é¡¯ç¤º
        function updateInfo() {
            document.getElementById('domCoords').textContent = `DOMåº§æ¨™: (${domCoords.x}, ${domCoords.y})`;
            document.getElementById('phaserCoords').textContent = `Phaseråº§æ¨™: (${phaserCoords.x}, ${phaserCoords.y})`;
            
            const diff = Math.sqrt(Math.pow(domCoords.x - phaserCoords.x, 2) + Math.pow(domCoords.y - phaserCoords.y, 2));
            const status = diff < 5 ? 'âœ… åº§æ¨™çµ±ä¸€æˆåŠŸ' : `âŒ åº§æ¨™åå·®: ${diff.toFixed(1)}px`;
            document.getElementById('status').textContent = `ç‹€æ…‹: ${status}`;
        }
        
        // PhaseréŠæˆ²é…ç½®
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'gameContainer',
            backgroundColor: '#2c3e50',
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };
        
        let scene;
        
        function preload() {
            // å‰µå»ºç°¡å–®çš„åœ–å½¢
            this.add.graphics()
                .fillStyle(0x3498db)
                .fillRect(0, 0, 800, 600);
        }
        
        function create() {
            scene = this;
            
            // ğŸ¯ åˆå§‹åŒ–åº§æ¨™çµ±ä¸€å™¨
            if (window.PhaserDOMCoordinateUnifier) {
                coordinateUnifier = new window.PhaserDOMCoordinateUnifier(this);
                console.log('âœ… åº§æ¨™çµ±ä¸€å™¨å·²åˆå§‹åŒ–');
            }
            
            // æ·»åŠ èªªæ˜æ–‡å­—
            this.add.text(400, 50, 'ğŸ¯ Phaser-DOMåº§æ¨™çµ±ä¸€æ¸¬è©¦', {
                fontSize: '24px',
                fill: '#ffffff',
                align: 'center'
            }).setOrigin(0.5);
            
            this.add.text(400, 100, 'é»æ“Šä»»ä½•ä½ç½®æ¸¬è©¦åº§æ¨™çµ±ä¸€æ•ˆæœ', {
                fontSize: '16px',
                fill: '#ecf0f1',
                align: 'center'
            }).setOrigin(0.5);
            
            this.add.text(400, 130, 'ğŸ”´ ç´…è‰² = DOMåº§æ¨™  ğŸ”µ è—è‰² = Phaseråº§æ¨™', {
                fontSize: '14px',
                fill: '#95a5a6',
                align: 'center'
            }).setOrigin(0.5);
            
            // Phaserè¼¸å…¥äº‹ä»¶
            this.input.on('pointerdown', (pointer) => {
                phaserCoords.x = pointer.x;
                phaserCoords.y = pointer.y;
                
                // è½‰æ›ç‚ºè¢å¹•åº§æ¨™
                const canvas = this.sys.game.canvas;
                const canvasRect = canvas.getBoundingClientRect();
                const screenX = canvasRect.left + pointer.x;
                const screenY = canvasRect.top + pointer.y;
                
                createMarker(screenX, screenY, 'phaser-marker');
                updateInfo();
                
                console.log(`ğŸ¯ Phaseräº‹ä»¶: (${pointer.x}, ${pointer.y})`);
                console.log(`ğŸ¯ è¢å¹•ä½ç½®: (${screenX}, ${screenY})`);
                
                if (coordinateUnifier) {
                    const unifiedCoords = coordinateUnifier.getUnifiedCoordinates();
                    console.log(`ğŸ¯ çµ±ä¸€åº§æ¨™: (${unifiedCoords.x}, ${unifiedCoords.y})`);
                }
            });
        }
        
        function update() {
            // éŠæˆ²æ›´æ–°é‚è¼¯
        }
        
        // åˆå§‹åŒ–
        setupDOMTracking();
        const game = new Phaser.Game(config);
        
        console.log('ğŸ¯ åº§æ¨™çµ±ä¸€æ¸¬è©¦é é¢å·²è¼‰å…¥');
    </script>
</body>
</html>
