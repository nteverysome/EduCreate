<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ å¤ªç©ºèˆ¹èª¿è©¦æ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a2e;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }
        #game {
            border: 2px solid #4facfe;
            border-radius: 10px;
            margin: 20px 0;
        }
        .debug-info {
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            max-width: 600px;
            text-align: left;
        }
        .step {
            margin: 5px 0;
            padding: 5px 10px;
            border-radius: 3px;
        }
        .step.success { background: rgba(0,255,0,0.2); }
        .step.error { background: rgba(255,0,0,0.2); }
        .step.pending { background: rgba(255,255,0,0.2); }
    </style>
</head>
<body>
    <h1>ğŸš€ å¤ªç©ºèˆ¹èª¿è©¦æ¸¬è©¦</h1>
    
    <div class="debug-info">
        <div id="step1" class="step pending">1. æª¢æŸ¥ Phaser ç‰©ç†å¼•æ“</div>
        <div id="step2" class="step pending">2. æª¢æŸ¥ç²¾éˆåœ–è³‡æº</div>
        <div id="step3" class="step pending">3. å‰µå»ºå¤ªç©ºèˆ¹</div>
        <div id="step4" class="step pending">4. æª¢æŸ¥å¤ªç©ºèˆ¹ä½ç½®</div>
        <div id="step5" class="step pending">5. æª¢æŸ¥å¤ªç©ºèˆ¹å¯è¦‹æ€§</div>
    </div>
    
    <div id="game"></div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
    <script>
        function updateStep(stepId, status, message) {
            const step = document.getElementById(stepId);
            step.className = `step ${status}`;
            step.textContent = message;
            console.log(`[${status.toUpperCase()}] ${message}`);
        }

        class SpaceshipDebugScene extends Phaser.Scene {
            constructor() {
                super({ key: 'SpaceshipDebugScene' });
            }

            preload() {
                updateStep('step1', 'success', '1. âœ… Phaser ç‰©ç†å¼•æ“å·²å•Ÿç”¨');
                
                // è¼‰å…¥å¤ªç©ºèˆ¹ç²¾éˆåœ–
                this.load.spritesheet('player_spaceship', 'assets/images/sprites/player_spaceship.png', {
                    frameWidth: Math.floor(2450 / 7),
                    frameHeight: 150
                });
                
                this.load.on('filecomplete-spritesheet-player_spaceship', () => {
                    updateStep('step2', 'success', '2. âœ… å¤ªç©ºèˆ¹ç²¾éˆåœ–è¼‰å…¥æˆåŠŸ');
                });
                
                this.load.on('loaderror', (file) => {
                    if (file.key === 'player_spaceship') {
                        updateStep('step2', 'error', '2. âŒ å¤ªç©ºèˆ¹ç²¾éˆåœ–è¼‰å…¥å¤±æ•—');
                    }
                });
            }

            create() {
                const { width, height } = this.cameras.main;
                
                // å‰µå»ºæ·±è‰²èƒŒæ™¯
                this.add.rectangle(width/2, height/2, width, height, 0x1a1a2e);
                
                // æ¨™é¡Œ
                this.add.text(width/2, 50, 'ğŸš€ å¤ªç©ºèˆ¹èª¿è©¦å ´æ™¯', {
                    fontSize: '24px',
                    color: '#4facfe',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
                
                // å˜—è©¦å‰µå»ºå¤ªç©ºèˆ¹
                this.createDebugSpaceship();
                
                // é¡¯ç¤ºèª¿è©¦ä¿¡æ¯
                this.createDebugInfo();
            }

            createDebugSpaceship() {
                const { width, height } = this.cameras.main;
                
                try {
                    if (this.textures.exists('player_spaceship')) {
                        updateStep('step3', 'pending', '3. ğŸ”„ ä½¿ç”¨çœŸå¯¦ç²¾éˆåœ–å‰µå»ºå¤ªç©ºèˆ¹...');
                        
                        // å‰µå»ºå‹•ç•«
                        this.anims.create({
                            key: 'spaceship_fly',
                            frames: this.anims.generateFrameNumbers('player_spaceship', {
                                start: 0, end: 6
                            }),
                            frameRate: 10,
                            repeat: -1
                        });
                        
                        // å‰µå»ºå¤ªç©ºèˆ¹ï¼ˆä½¿ç”¨ç‰©ç†ï¼‰
                        this.player = this.physics.add.sprite(width * 0.2, height * 0.5, 'player_spaceship');
                        this.player.setOrigin(0.5, 0.5);
                        this.player.setScale(0.4);
                        this.player.setDepth(10); // ç¢ºä¿åœ¨å‰æ™¯
                        this.player.play('spaceship_fly');
                        
                        // è¨­ç½®ç‰©ç†å±¬æ€§
                        this.player.setCollideWorldBounds(true);
                        
                        updateStep('step3', 'success', '3. âœ… çœŸå¯¦å¤ªç©ºèˆ¹å‰µå»ºæˆåŠŸ');
                        
                    } else {
                        updateStep('step3', 'pending', '3. ğŸ”„ ä½¿ç”¨å‚™ç”¨å¤ªç©ºèˆ¹...');
                        this.createBackupSpaceship();
                    }
                    
                    // æª¢æŸ¥å¤ªç©ºèˆ¹ç‹€æ…‹
                    this.checkSpaceshipStatus();
                    
                } catch (error) {
                    updateStep('step3', 'error', `3. âŒ å¤ªç©ºèˆ¹å‰µå»ºå¤±æ•—: ${error.message}`);
                    console.error('å¤ªç©ºèˆ¹å‰µå»ºéŒ¯èª¤:', error);
                }
            }

            createBackupSpaceship() {
                const { width, height } = this.cameras.main;
                
                try {
                    // å‰µå»ºç°¡å–®çš„å‚™ç”¨å¤ªç©ºèˆ¹
                    const graphics = this.add.graphics();
                    graphics.fillStyle(0x4facfe);
                    graphics.fillTriangle(30, 0, 0, 20, 0, -20);
                    graphics.lineStyle(2, 0xffffff, 1);
                    graphics.strokeTriangle(30, 0, 0, 20, 0, -20);
                    graphics.generateTexture('backup_spaceship', 40, 40);
                    graphics.destroy();
                    
                    // å‰µå»ºå‚™ç”¨å¤ªç©ºèˆ¹
                    this.player = this.physics.add.sprite(width * 0.2, height * 0.5, 'backup_spaceship');
                    this.player.setOrigin(0.5, 0.5);
                    this.player.setScale(1.5);
                    this.player.setDepth(10);
                    this.player.setCollideWorldBounds(true);
                    
                    updateStep('step3', 'success', '3. âœ… å‚™ç”¨å¤ªç©ºèˆ¹å‰µå»ºæˆåŠŸ');
                    
                } catch (error) {
                    updateStep('step3', 'error', `3. âŒ å‚™ç”¨å¤ªç©ºèˆ¹å‰µå»ºå¤±æ•—: ${error.message}`);
                }
            }

            checkSpaceshipStatus() {
                if (this.player) {
                    const x = Math.round(this.player.x);
                    const y = Math.round(this.player.y);
                    const visible = this.player.visible;
                    const active = this.player.active;
                    const alpha = this.player.alpha;
                    const depth = this.player.depth;
                    
                    updateStep('step4', 'success', `4. âœ… å¤ªç©ºèˆ¹ä½ç½®: (${x}, ${y})`);
                    updateStep('step5', visible ? 'success' : 'error', 
                        `5. ${visible ? 'âœ…' : 'âŒ'} å¯è¦‹æ€§: ${visible}, æ´»èº: ${active}, é€æ˜åº¦: ${alpha}, æ·±åº¦: ${depth}`);
                    
                    // åœ¨æ§åˆ¶å°è¼¸å‡ºè©³ç´°ä¿¡æ¯
                    console.log('å¤ªç©ºèˆ¹è©³ç´°ç‹€æ…‹:', {
                        x, y, visible, active, alpha, depth,
                        texture: this.player.texture.key,
                        scale: this.player.scale
                    });
                    
                } else {
                    updateStep('step4', 'error', '4. âŒ å¤ªç©ºèˆ¹å°è±¡ä¸å­˜åœ¨');
                    updateStep('step5', 'error', '5. âŒ ç„¡æ³•æª¢æŸ¥å¯è¦‹æ€§');
                }
            }

            createDebugInfo() {
                const { width, height } = this.cameras.main;
                
                // é¡¯ç¤ºå¤ªç©ºèˆ¹æ‡‰è©²åœ¨çš„ä½ç½®ï¼ˆç´…è‰²åœ“åœˆï¼‰
                const expectedX = width * 0.2;
                const expectedY = height * 0.5;
                
                const circle = this.add.circle(expectedX, expectedY, 50, 0xff0000, 0.3);
                circle.setStrokeStyle(2, 0xff0000);
                circle.setDepth(5);
                
                this.add.text(expectedX, expectedY + 70, 'é æœŸå¤ªç©ºèˆ¹ä½ç½®', {
                    fontSize: '16px',
                    color: '#ff0000'
                }).setOrigin(0.5);
                
                // æ·»åŠ èªªæ˜æ–‡å­—
                this.add.text(width/2, height - 100, 'ç´…è‰²åœ“åœˆæ¨™ç¤ºå¤ªç©ºèˆ¹æ‡‰è©²å‡ºç¾çš„ä½ç½®', {
                    fontSize: '18px',
                    color: '#ffffff'
                }).setOrigin(0.5);
            }

            update() {
                // æŒçºŒæª¢æŸ¥å¤ªç©ºèˆ¹ç‹€æ…‹
                if (this.player && this.time.now % 1000 < 16) { // æ¯ç§’æª¢æŸ¥ä¸€æ¬¡
                    this.checkSpaceshipStatus();
                }
            }
        }

        // Phaser é…ç½®
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game',
            backgroundColor: '#1a1a2e',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: true // å•Ÿç”¨ç‰©ç†èª¿è©¦
                }
            },
            scene: SpaceshipDebugScene
        };

        try {
            const game = new Phaser.Game(config);
            console.log('ğŸ® èª¿è©¦éŠæˆ²å•Ÿå‹•æˆåŠŸ');
        } catch (error) {
            updateStep('step1', 'error', `1. âŒ Phaser åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
            console.error('Phaser åˆå§‹åŒ–éŒ¯èª¤:', error);
        }
    </script>
</body>
</html>
