<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ ç´”CSSå…¨è¢å¹•æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .status {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .iframe-container {
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        #gameIframe {
            width: 100%;
            height: 600px;
            border: none;
            display: block;
        }
        
        .log {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: background 0.3s;
        }
        
        .test-button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ç´”CSSå…¨è¢å¹•æ¸¬è©¦</h1>
        
        <div class="status">
            <h3>ğŸ“Š ç‹€æ…‹</h3>
            <p>å…¨è¢å¹•ç‹€æ…‹: <span id="fullscreenStatus">å¦</span></p>
            <p>èªªæ˜: é€™å€‹ç‰ˆæœ¬åªä½¿ç”¨CSSï¼Œå®Œå…¨é¿å…åŸç”Ÿå…¨è¢å¹•API</p>
        </div>
        
        <div class="status">
            <h3>ğŸ”§ æ‰‹å‹•æ¸¬è©¦</h3>
            <button class="test-button" onclick="manualToggle()">
                æ‰‹å‹•åˆ‡æ›å…¨è¢å¹•
            </button>
            <p style="font-size: 14px; opacity: 0.8;">
                å¦‚æœéŠæˆ²å…§æŒ‰éˆ•æœ‰å•é¡Œï¼Œå¯ä»¥ç”¨é€™å€‹æŒ‰éˆ•æ¸¬è©¦
            </p>
        </div>
        
        <div class="iframe-container" id="iframeContainer">
            <iframe id="gameIframe" src="/games/starshake-game/dist/index.html"></iframe>
        </div>
        
        <div class="log" id="logContainer">
            <h3>ğŸ“ æ¸¬è©¦æ—¥èªŒ</h3>
            <div id="logContent"></div>
        </div>
    </div>

    <script>
        // å…¨è¢å¹•ç‹€æ…‹
        let isFullscreen = false;
        
        // æ—¥èªŒå‡½æ•¸
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logContent = document.getElementById('logContent');
            logContent.innerHTML += `[${timestamp}] ${message}<br>`;
            logContent.scrollTop = logContent.scrollHeight;
            console.log(message);
        }
        
        // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
        function updateStatus() {
            document.getElementById('fullscreenStatus').textContent = isFullscreen ? 'æ˜¯' : 'å¦';
        }
        
        // é€²å…¥CSSå…¨è¢å¹•
        function enterCSSFullscreen() {
            log('ğŸš€ é€²å…¥CSSå…¨è¢å¹•');
            
            const container = document.querySelector('.container');
            const iframeContainer = document.getElementById('iframeContainer');
            const iframe = document.getElementById('gameIframe');
            
            // éš±è—å…¶ä»–å…ƒç´ 
            const children = container.children;
            for (let i = 0; i < children.length; i++) {
                if (children[i] !== iframeContainer) {
                    children[i].style.display = 'none';
                }
            }
            
            // è¨­ç½®å…¨è¢å¹•æ¨£å¼
            document.body.style.margin = '0';
            document.body.style.padding = '0';
            document.body.style.background = '#000';
            
            container.style.maxWidth = 'none';
            container.style.width = '100vw';
            container.style.height = '100vh';
            container.style.margin = '0';
            container.style.padding = '0';
            container.style.background = '#000';
            
            iframeContainer.style.position = 'fixed';
            iframeContainer.style.top = '-80px';
            iframeContainer.style.left = '0';
            iframeContainer.style.width = '100vw';
            iframeContainer.style.height = 'calc(100vh + 80px)';
            iframeContainer.style.zIndex = '9999';
            iframeContainer.style.borderRadius = '0';
            
            iframe.style.position = 'absolute';
            iframe.style.top = '-100px';
            iframe.style.left = '0';
            iframe.style.width = '100vw';
            iframe.style.height = 'calc(100vh + 100px)';
            
            // éš±è—åœ°å€æ¬„
            window.scrollTo(0, 1);
            setTimeout(() => window.scrollTo(0, 1), 100);
            
            isFullscreen = true;
            updateStatus();
            log('âœ… CSSå…¨è¢å¹•å·²å•Ÿç”¨');
        }
        
        // é€€å‡ºCSSå…¨è¢å¹•
        function exitCSSFullscreen() {
            log('ğŸ”„ é€€å‡ºCSSå…¨è¢å¹•');
            
            const container = document.querySelector('.container');
            const iframeContainer = document.getElementById('iframeContainer');
            const iframe = document.getElementById('gameIframe');
            
            // æ¢å¾©å…¶ä»–å…ƒç´ 
            const children = container.children;
            for (let i = 0; i < children.length; i++) {
                children[i].style.display = '';
            }
            
            // æ¢å¾©æ¨£å¼
            document.body.style.margin = '';
            document.body.style.padding = '';
            document.body.style.background = '';
            
            container.style.maxWidth = '';
            container.style.width = '';
            container.style.height = '';
            container.style.margin = '';
            container.style.padding = '';
            container.style.background = '';
            
            iframeContainer.style.position = '';
            iframeContainer.style.top = '';
            iframeContainer.style.left = '';
            iframeContainer.style.width = '';
            iframeContainer.style.height = '';
            iframeContainer.style.zIndex = '';
            iframeContainer.style.borderRadius = '';
            
            iframe.style.position = '';
            iframe.style.top = '';
            iframe.style.left = '';
            iframe.style.width = '';
            iframe.style.height = '';
            
            isFullscreen = false;
            updateStatus();
            log('âœ… CSSå…¨è¢å¹•å·²é€€å‡º');
        }
        
        // æ‰‹å‹•åˆ‡æ›
        function manualToggle() {
            log('ğŸ”§ æ‰‹å‹•åˆ‡æ›å…¨è¢å¹•');
            if (isFullscreen) {
                exitCSSFullscreen();
            } else {
                enterCSSFullscreen();
            }
        }
        
        // PostMessage ç›£è½å™¨ - åªè™•ç†CSS
        window.addEventListener('message', (event) => {
            try {
                const message = event.data;
                
                if (message.type === 'DUAL_FULLSCREEN_REQUEST' || message.type === 'SIMPLE_FULLSCREEN_TOGGLE') {
                    log('ğŸ æ”¶åˆ°å…¨è¢å¹•è«‹æ±‚');
                    
                    // ç°¡å–®åˆ‡æ›ï¼šæ ¹æ“šç•¶å‰ç‹€æ…‹æ±ºå®šå‹•ä½œ
                    if (isFullscreen) {
                        exitCSSFullscreen();
                    } else {
                        enterCSSFullscreen();
                    }
                }
                
            } catch (error) {
                log('âŒ æ¶ˆæ¯è™•ç†å¤±æ•—: ' + error.message);
            }
        });
        
        // åˆå§‹åŒ–
        log('ğŸš€ ç´”CSSå…¨è¢å¹•æ¸¬è©¦åˆå§‹åŒ–');
        updateStatus();
        log('âœ… æº–å‚™å°±ç·’ï¼Œç­‰å¾…å…¨è¢å¹•è«‹æ±‚');
        log('ğŸ”§ æ­¤ç‰ˆæœ¬åªä½¿ç”¨CSSï¼Œå®Œå…¨é¿å…åŸç”Ÿå…¨è¢å¹•API');
    </script>
</body>
</html>
